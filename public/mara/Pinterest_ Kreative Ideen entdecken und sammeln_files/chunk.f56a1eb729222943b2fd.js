webpackJsonp([66],{257:function(e,t,o){goog.provide("P.modules.AboutLinks"),goog.require("P.Module"),P.modules.AboutLinks=P.Module.extend({getHeight:function(){return this.$el.outerHeight()}}),P.modules.AboutLinks.prototype.className="AboutLinks",goog.provide("P.modules.AddPinRepWithPlace"),goog.require("P.Module"),P.modules.AddPinRepWithPlace=P.Module.extend({}),P.modules.AddPinRepWithPlace.prototype.className="AddPinRepWithPlace",goog.provide("P.modules.AddPinURL"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.i18n"),goog.require("P.validator"),goog.require("P.genConst"),goog.require("P.errorUtil"),P.modules.AddPinURL=P.Module.extend({events:{"click .pinmarkletLink":"onPinmarkletLinkClick"},onContentReady:function(){var e=this.$(".standardForm"),t={prevalidate:!0,message:P.i18n._("Where do you want to Pin from?")},o={url:[P.validator.Required(t),P.validator.URL()]};this.form=new P.Form(e,o,t),this.form.getField("url").placeholder(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onPinmarkletLinkClick:function(){this.logPinmarkletLinkClick(),P.browserExtension.instance.isExtensionInstalled()?P.errorUtil.showError(P.i18n._("Oops! You already have the browser button.")):P.browserExtension.instance.handleExtensionInstall(function(){this.destroy()}.bind(this),function(){P.errorUtil.showError(P.i18n._("Oops! The download didn't work."))})},logPinmarkletLinkClick:function(){this._logCustomContextEvent(P.genConst.EventType.CLICK,this.options.pinmarklet_link_element_type,P.genConst.ComponentType.MODAL_ADD_PIN,{})},onSubmitValidated:function(e){if(!e.errors[0]){var t=this.form.getValue("url").trim();this.navigate("/pin/find/?"+$.param({url:t}))}}}),P.modules.AddPinURL.prototype.className="AddPinURL",goog.provide("P.modules.AddressForm"),goog.require("P.Module"),P.modules.AddressForm=P.Module.extend({}),P.modules.AddressForm.prototype.className="AddressForm",goog.provide("P.modules.AdhocFeedIndexPage"),goog.require("P.Module"),P.modules.AdhocFeedIndexPage=P.Module.extend({}),P.modules.AdhocFeedIndexPage.prototype.className="AdhocFeedIndexPage",goog.provide("P.modules.AdhocFeedPage"),goog.require("P.Module"),P.modules.AdhocFeedPage=P.Module.extend({}),P.modules.AdhocFeedPage.prototype.className="AdhocFeedPage",goog.provide("P.modules.AnchorLinks"),goog.require("P.Module"),goog.require("P.util"),P.modules.AnchorLinks=P.Module.extend({events:{"click .links li":"_onLinkClick"},CssClassName:{LINK_SELECTED:"selected"},onCreated:function(){this.initiallySelectedLinkIndex=this.options.selected_link_index||0,this.links=this.options.links||[],this.initialSectionTop=null,this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),this.targetTop=null},onContentReady:function(){this.linkElements=[],this.sectionElements=[],this._indexLinksAndSections(),this.options.state_selectedLinkElement=this.linkElements.length>0?this.linkElements[0]:null,this.jumpToInitialSection()},updateDom:function(){this.$("."+this.CssClassName.LINK_SELECTED).removeClass(this.CssClassName.LINK_SELECTED),$(this.options.state_selectedLinkElement).addClass(this.CssClassName.LINK_SELECTED)},areSectionsAvailable:function(){if(0===this.sectionElements.length)return!1;for(var e=0;e<this.sectionElements.length;e++)if(0===this.sectionElements[e].length)return!1;return!0},jumpToInitialSection:function(){return this._indexLinksAndSections(),this.areSectionsAvailable()?void(this.initiallySelectedLinkIndex&&this.selectLinkAtIndex(this.initiallySelectedLinkIndex)||this.selectFirstAvailableLink()):void setTimeout(this.jumpToInitialSection.bind(this),100)},_indexLinksAndSections:function(){this.linkElements=[],this.sectionElements=[];var e=this;if(this.$(".links li").each(function(t){var o=this,n=e.getSectionForLinkElement(o);e.linkElements.push(o),e.sectionElements.push(n)}),this.links.length>0){var t=this.initialSectionTop||0;this.initialSectionTop=this._getScrollTopPositionForLinkIndex(0)+t}},_onLinkClick:function(e){this._selectLink($(e.currentTarget),!0)},_getScrollTopPositionForLinkIndex:function(e){var t=this.sectionElements[e];return this._getScrollTopPositionForSectionElement(t)},_getScrollTopPositionForSectionElement:function(e){if(!e)return null;var t=e.position();if(!t)return null;var o=this.getIndexForSectionElement(e);if(-1===o)return null;var n=this.links[o].y_offset||0,a=t.top;return a-this.initialSectionTop+n},_getCurrentScrollTop:function(){return this.getScrollableElement().scrollTop()},getSectionForLinkElement:function(e){var t=$(e).attr("section");return $(t)},getSelectedLinkElement:function(){return this.options.state_selectedLinkElement?$(this.options.state_selectedLinkElement):null},getIndexForSectionElement:function(e){for(var t=0;t<this.sectionElements.length;t++)if(e.is(this.sectionElements[t]))return t;return-1},selectFirstAvailableLink:function(){for(var e=0;e<this.linkElements.length;e++)if(this.isIndexAvailable(e))return void this.selectLinkAtIndex(e)},isIndexAvailable:function(e){var t=this.sectionElements[e];return t&&t.height()>0},selectLinkAtIndex:function(e){return this.isIndexAvailable(e)?(this._selectLink(this.linkElements[e],!0),!0):!1},_selectLink:function(e,t){this.updateOptionsAndDom({state_selectedLinkElement:e});var o=this.getSectionForLinkElement(e),n=this.links[this.getIndexForSectionElement(o)];if(n){var a={id:n.id,element_type:n.log_element_type};this.triggerEvent(P.CONST.EVENT_ITEM_SELECTED,a,!0)}if(t){this.isScrolling=!0;var r=this._getScrollTopPositionForSectionElement(o);this.targetTop=r,P.util.scrollToTop({newScrollOffset:r,duration:P.CONST.SCROLL_TO_TOP_ANIMATION_TIME,callback:function(){this.isScrolling=!1}.bind(this)})}},_onScroll:function(){null!==this.initialSectionTop&&this.sectionElements[0].parent()||this._indexLinksAndSections();var e=this._getCurrentScrollTop();if(!(0>e||this.isScrolling)){for(var t=null,o=null,n=0,a=0;a<this.links.length;a++)if(this.isIndexAvailable(a)){var r=this._getScrollTopPositionForLinkIndex(a),i=this.sectionElements[a];e>=r-P.CONST.SCROLL_MARGIN_OF_ERROR&&(!t||n<r-P.CONST.SCROLL_MARGIN_OF_ERROR)&&(t=i,o=this.linkElements[a],n=r)}o&&!$(this.options.state_selectedLinkElement).is($(o))&&this._selectLink(o,!1)}}}),P.modules.AnchorLinks.prototype.className="AnchorLinks",goog.provide("P.modules.AnimationPlaces"),goog.require("P.Module"),P.modules.AnimationPlaces=P.Module.extend({events:{"mouseenter .balloonLayer":"activateBalloon","mouseleave .balloonLayer":"deactivateBalloon"},onContentReady:function(){this.$balloon=this.$(".balloon")},activateBalloon:function(){var e=this.$(".balloonAudio").get(0);e.play(),this.$balloon.hide()},deactivateBalloon:function(){this.$balloon.show()}}),P.modules.AnimationPlaces.prototype.className="AnimationPlaces",goog.provide("P.modules.AnnotationResults"),goog.require("P.Module"),P.modules.AnnotationResults=P.Module.extend({}),P.modules.AnnotationResults.prototype.className="AnnotationResults",goog.provide("P.modules.AppBase"),goog.require("P.BrowserDetector"),goog.require("P.Module"),goog.require("P.navigateData.NavigateData"),goog.require("P.util"),goog.require("P.router"),goog.require("P.moduleFactory"),goog.require("P.ga"),goog.require("P.timer"),goog.require("P.historyNavigator"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),goog.require("P.app"),goog.require("P.errorUtil"),goog.require("P.router"),goog.require("P.resourceFactory"),goog.require("P.tutorialUtil");var n=500,a={REPLACE:0,REPLACE_TOP:1,APPEND:2,CLOSE:3,IGNORE:4};P.modules.AppBase=P.Module.extend({MAIN_MODULE_ID:"mainModule",CLOSEUP_NAME:"Closeup",CssClassName:{HAS_KLP_BAR:"hasKLPBar"},onCreated:function(){P.user.instance.isAuthenticated()||P.user.instance.attemptLogin(),this.backgroundModule=null,this.canUpdatePageInfo=!1,this.browser=P.BrowserDetector.getBrowser();var e={};e[P.CONST.PUBSUB_TOPIC_WINDOW_LOCATION_CHANGE]=this._onWindowLocationChange,e[P.CONST.PUBSUB_TOPIC_APPEND_TO_MAIN_MODULE]=this._appendChildToMainModule,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e);var t={};t[P.CONST.PUBSUB_TOPIC_KLP_BAR_HIDDEN]=this.removeHasKLPBarClass,t[P.CONST.PUBSUB_TOPIC_KLP_BAR_SHOWN]=this.addHasKLPBarClass,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_KLP_BAR,t),this._modalManager=null,this.router=P.router.instance},onAddedToDom:function(){this.router.start(),P.AppVersion.setup(P.context.instance.app_version),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_SCROLL_TO_ELEMENT,this._onChildScrollToElement),this.listen(this.router,P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),this.listen(this.router,P.CONST.EVENT_ROUTE_NO_MATCH,this.onRouteNoMatch),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,this.onChildEventRequiresAuthentication),this.childListen(P.CONST.EVENT_CLOSE,this._onChildClose);var e={};e[P.CONST.PUBSUB_TOPIC_PAGE_INFO]=this.onPageInfoChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.childListen(P.CONST.EVENT_MODAL,this._onChildModal)},onChildAdded:function(e){this._adjustScrollToTopPositionIfNeeded()},onChildEventRequiresAuthentication:function(e){var t=e.data.authRedirectUrl;t&&this.navigate(e.data.authRedirectUrl)},_onChildClose:function(e){this.router.getHistoryManager().closeCurrentModule()},_onChildScrollToElement:function(e){var t=e.data,o=t.$el,n={scrollOffset:t.scrollOffset,callback:t.callback};this._scrollToElement(o,n)},_onWindowLocationChange:function(){this.router.setStatus(P.router.NavStatus.READY)},_getCurrentMainModule:function(){var e=this.getChildById(this.MAIN_MODULE_ID);return e?e:this.children[this.children.length-1]},debugGetCurrentMainModuleName:function(){return this._getCurrentMainModule().className},_scrollToElement:function(e,t){var o=this._getCurrentMainModule(),n=e.positionAncestor(o.getScrollableElement()).top,a=P.util.normalizeScroller(o.getScrollableElement()),r=0===t.scrollOffset?0:t.scrollOffset||P.CONST.SCROLL_TO_ELEMENT_OFFSET,i={newScrollOffset:Math.max(n-r,0),$scroller:a,callback:t.callback};P.util.scrollToTop(i)},setUpContextLogging:function(){var e=this._getCurrentMainModule();if(!e.getHasError()){var t=window.location.pathname+window.location.search,o=this.router.resolve(t);if(o){var n=o.extraContent.log;if(n){var a=P.context.instanceEvent.fromPlainObject(n);a.setEventType(P.genConst.EventType.VIEW),a.setRequestIdentifier(Pc.PAGE_LOAD_REQUEST_IDENTIFIER);var r=e.getLoggingObjectIdStr();r&&a.setObjectIdStr(r),P.context.instanceLogger.getInstance().addEvent(a)}}else this.log.error("Router couldn't resolve url for context logging",{url:t})}},onRemovedFromDom:function(){this._removeListeners()},onRouteMatched:function(e){var t;this.userAgentPlatform&&e.extraContent&&(t=P.DeepLink.getLinkForUserAgent(this.extraData.userAgent,e.extraContent)),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_DEEP_LINK,t);var o=e.module,n=e.options,a=e.resource&&e.resource.name?P.resourceFactory.instance.createFromPlainObject(e.resource):null;this.removeAllModals();var r=this._getCurrentMainModule();e.navigateData.currentModule=r,P.moduleFactory.getConstructor(o).then(function(t){var o=this.router.getHistoryManager().getModule(t,e.navigateData);if(!this._getCurrentMainModule())return void window.location.reload();var r=null,i=e.extraContent.log;i?(i.event_type=P.genConst.EventType.VIEW,r=P.context.instanceEvent.fromPlainObject(i)):P.context.instanceLogger.getInstance().clearContext(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_NAVIGATE,P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED),this.updateMainModule(o,n,a,e,r).then(void 0,function(e){this.router.setStatus(P.router.NavStatus.CANCELED)}.bind(this)),P.user.instance.isAuthenticated()||P.util.trackRegisterAction("unauth_navigate."+o.module.className)}.bind(this));var i=this.router.getHistoryManager().getPageInfo();i&&this.setPageInfo(i),this.canUpdatePageInfo=!i},onRouteNoMatch:function(e){window.location.reload()},onPageInfoChange:function(e,t,o){this.canUpdatePageInfo&&(this.router.getHistoryManager().setPageInfo(o),this.setPageInfo(o),this.canUpdatePageInfo=!1)},setPageInfo:function(e){e.title&&$(document).attr("title",e.title),$("head meta[data-app]").remove();var t=[];_.each(e.meta,function(e,o){t.push($("<meta>").prop({name:o,property:o,content:e,"data-app":1}))}),$("head").append(t)},startModuleTransition:function(e){this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID||this.browser===P.CONST.BrowserType.SAFARI?e.hideModule():e.fadeOut(),clearTimeout(this._loaderTimeout),this._loaderTimeout=P.timer.setTimeout(function(){this.loadingShown=!0,this.showLoading()}.bind(this),n,"App loader")},stopModuleTransition:function(e){clearTimeout(this._loaderTimeout),this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID||this.browser===P.CONST.BrowserType.SAFARI?e.showModule():e.fadeIn(),this.loadingShown&&(this.hideLoading(),this.loadingShown=!1)},updateMainModule:function(e,t,o,n,r){return new Promise(function(i,s){var l=function(e,t,o){this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_NAVIGATE),this.router.getStatus()!==P.router.NavStatus.READY&&s()}.bind(this),u={};u[P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED]=l,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_NAVIGATE,u);var d=n.navigateData,c=e.module,p=e.backgroundModule,m=this._getCurrentMainModule();m.saveExtraState(!0),this.log.debug("Current:",m.className,"New:",c.className);var h=this._getNextAction(m,c,p,d),g=h===a.REPLACE&&m.className!==this.CLOSEUP_NAME&&c.className!==this.CLOSEUP_NAME;this.router.setStatus(P.router.NavStatus.TRANSITIONING),g&&this.startModuleTransition(m),c.clearFades();var _=this._getCanClose(m,e,h);null!==_&&(t.can_close=_,t.origin_location=m.options.origin_location||d.fromHistoryUid,t.source_data=m.options.source_data||this.getChildInfoByModuleName("GridItems"));var f=null===_||_===!1;if(P.Body.setScrolling(f),r){var b=function(e,t,o){var n=o;r.setRequestIdentifier(n),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_REQUEST)}.bind(this);u={},u[P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER]=b,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_REQUEST,u)}var k=function(){if(g&&this.stopModuleTransition(c),h!==a.IGNORE&&h!==a.CLOSE&&c.showModule(),this.updateScrollWatchers(c),r&&!c.getHasError()){var e=c.getLoggingObjectIdStr();if(e&&r.setObjectIdStr(e),n.extraContent.perf_log){var t=P.trackingTimer.instance.end(n.module,"NavigateToRender");t&&r.updateAuxData({interaction_wait:t.elapsedTime})}P.context.instanceLogger.getInstance().addEvent(r),P.pubSub.instance.clearChannel(P.CONST.PUBSUB_CHANNEL_REQUEST)}this.router.setStatus(P.router.NavStatus.READY)}.bind(this);return c.errorStrategy=P.CONST.ErrorStrategy.SHOW,c.setAsMainModule(t,o,d).then(function(){return this.router.getStatus()===P.router.NavStatus.CANCELED?Promise.reject():(h!==a.IGNORE&&h!==a.CLOSE&&c.hideModule(),this._performNextAction(h,m,e,d),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW,this._getCurrentMainModule()),this._adjustScrollToTopPositionIfNeeded(),this._scrollMainModuleIfNeeded(),void i())}.bind(this),function(e){this.router.getHistoryManager().cancelNavigation(),s(e)}).fin(function(){k(),!P.user.instance.isAuthenticated()&&d.fromNavigate&&P.signupModalManager.modalsEnabled&&P.signupModalManager.showInlineSignupModal(c,c.resource)})}.bind(this))},_getNextAction:function(e,t,o,n){var r=null;return r=e===t?a.IGNORE:t.className!==this.CLOSEUP_NAME?e.className===this.CLOSEUP_NAME&&e.options.can_close&&this.backgroundModule&&t===this.backgroundModule?a.CLOSE:a.REPLACE:n.fromNavigate?e.className===this.CLOSEUP_NAME?e.options.can_close?a.REPLACE_TOP:a.REPLACE:a.APPEND:e===o&&t.className===this.CLOSEUP_NAME?a.APPEND:a.REPLACE},_getCanClose:function(e,t,o){var n=t.module,r=t.backgroundModule;if(n.className!==this.CLOSEUP_NAME)return null;var i=e.className===this.CLOSEUP_NAME,s=!!e.options.can_close;switch(o){case a.REPLACE:return!!r;case a.REPLACE_TOP:return s;case a.APPEND:return!i||s;case a.IGNORE:return s}return null},_performNextAction:function(e,t,o,n){var r=o.module,i=o.backgroundModule,s=r.$el,l=e!==a.IGNORE,u=this.getChildById("header"),d=0;if(u&&(d=u.getHeight()),e===a.IGNORE)this.backgroundModule&&this.router.getHistoryManager().updateBackgroundModule(this.backgroundModule,n);else if(e===a.CLOSE)this.backgroundModule=null,t.detachElement(),this.removeChildId(t);else if(e===a.REPLACE){this.backgroundModule!==i&&(this.backgroundModule&&(this.backgroundModule.detachElement(),this.backgroundModule=null),i&&(i!==t&&(i.appendToElement(this.$(".mainContainer")),this.addChild(i)),this.backgroundModule=i)),t!==i&&(this.removeChildId(t),t.detachElement()),this.removeChildId(t),s.css("min-height",P.Viewport.height-d);var c=this.backgroundModule?$(".appendedContainer"):$(".mainContainer");c.append(s),this.addChild(r)}else e===a.REPLACE_TOP?(t.detachElement(),s.css("min-height",P.Viewport.height-d),$(".appendedContainer").append(s),this.addChild(r),this.router.getHistoryManager().updateBackgroundModule(this.backgroundModule,n)):e===a.APPEND&&(this.backgroundModule=t,this.removeChildId(t),s.css("min-height",P.Viewport.height-d),$(".appendedContainer").append(s),this.addChild(r),this.router.getHistoryManager().updateBackgroundModule(this.backgroundModule,n));(l||this._forceRefreshRequested(n))&&(this.setChildId(r,this.MAIN_MODULE_ID),r.restoreExtraState(!0))},onContentReady:function(){this._modalManager=this.getChildById("modalManager"),this.setUpContextLogging();var e=this._getCurrentMainModule();this.initModule=e,P.ga.trackPageview(e.className),_.defer(this._startTutorials.bind(this)),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW,e),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CAMPBELL,P.CONST.PUBSUB_TOPIC_DRAWER_SIDE_NAV_SHOW,null),this.setChildId(e,this.MAIN_MODULE_ID),this.router.getHistoryManager().start(e),this.router.getHistoryManager().setPageInfo(P.PAGE_INFO),this.setPageInfo(P.PAGE_INFO),this.updateScrollWatchers(e),this._setDevicePixelRatioCookie(),this._adjustScrollToTopPositionIfNeeded(),this._scrollMainModuleIfNeeded()},_setDevicePixelRatioCookie:function(){var e=(window.devicePixelRatio||1)+"";Cookie.set(P.CONST.COOKIE_DEVICE_PIXEL_RATIO,e)},onChildNavigate:function(e){this._adjustScrollToTopPositionIfNeeded();var t=e.data.url;this.log.debug("App got navigate event from child",e.target,"for url:",t);var o=new P.navigateData.NavigateData;o.evt=e,o.reuseLast=!!e.data.handled,P.router.instance.getHistoryManager().populateNavigateData(o),P.historyNavigator.instance.navigate(t,o),e.stopPropagation()},_adjustScrollToTopPositionIfNeeded:function(){},_scrollMainModuleIfNeeded:function(){},_startTutorials:function(){P.TutorialManager.instance().resumeTutorial(),P.ExperienceTutorialManager.instance().startTutorial()},isTutorialActive:function(){return P.tutorialUtil.isTutorialActive()},_appendChildToMainModule:function(e,t,o){this._getCurrentMainModule().appendChild(o.module)},updateScrollWatchers:function(e){},addHasKLPBarClass:function(){var e=this.CssClassName.HAS_KLP_BAR;this.$(".appContent").addClass(e),this.$(".message.messageUnauth").addClass(e)},removeHasKLPBarClass:function(){this.$(".appContent").removeClass(this.CssClassName.HAS_KLP_BAR),this.$(".message.messageUnauth").removeClass(this.CssClassName.HAS_KLP_BAR)},updateNavigationBar:function(){var e=P.app.instance.getChildByModuleName("Nags");e&&e.render();var t=P.app.instance.getChildById("header");t&&(delete t.options.class_name,t.render()),this._showFooterButtons()},_showFooterButtons:function(){var e=P.app.instance.getChildById("footerButtons");e&&e.setVisible(!0)},_onChildModal:function(e){this.log.debug("Got modal event from child",e.target,"for module:",e.data.module),e.stopPropagation(),this._modalManager.createAndShowModal(e.data.module,e.data.showModalOptions||{},e.target)},_isTutorialActive:function(){return P.tutorialUtil.isTutorialActive()},removeAllModals:function(){this._isTutorialActive()||this._modalManager.removeAllModals(!0)},debugNumGridItems:function(){for(var e=[],t=[this],o;t.length>0;)o=t.pop(),"GridItems"===o.className&&e.push(o),t=t.concat(o.children);return _.each(e,function(e,t){for(var o=e.parent,n=e.className+" has "+e.children.length+" children";o;)n=o.className+"->"+n,o=o.parent;this.log.debug(t+1+": "+n)}.bind(this)),0===e.length&&this.log.debug("There are no grids in the page."),":)"}}),P.errorUtil.wrap(P.modules.AppBase.prototype,["_onChildModal"]),P.modules.AppBase.prototype.className="AppBase",goog.provide("P.modules.AppInstallModal"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.ExperienceManager"),P.modules.AppInstallModal=P.Module.extend({events:{"click .leftArrowPadding":"shiftPanelLeft","click .rightArrowPadding":"shiftPanelRight","click .leftHalf":"shiftPanelLeft","click .rightHalf":"shiftPanelRight","click .leftFooter":"shiftPanelLeft","click .rightFooter":"shiftPanelRight","click .playStoreScreenshot":"openCompletionPanel","click .appStoreScreenshot":"openCompletionPanel","click .dismissModal":"dismissModal","click .continueToPhonePicker":"continueToPhonePicker"},onContentReady:function(){this.options.placedExperienceId&&P.ExperienceManager.instance.completePlacedExperienceId(this.options.placedExperienceId),this.MIDDLE_PANEL="middle",this.LEFT_PANEL="left",this.RIGHT_PANEL="right",this.currentPanel=this.MIDDLE_PANEL,this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.openCompletionPanel),this.childListen(P.CONST.EVENT_GPLUS_BUTTON_CLICKED,this.openCompletionPanel),P.util.trackRegisterAction("app_install_modal_opened")},shiftPanelLeft:function(){var e;this.currentPanel===this.MIDDLE_PANEL?(this.currentPanel=this.LEFT_PANEL,e="150%",this.$(".leftArrow").fadeOut()):this.currentPanel===this.RIGHT_PANEL&&(this.currentPanel=this.MIDDLE_PANEL,e="50%",this.$(".rightArrow").fadeIn()),e&&(this.$(".container").animate({left:e},{queue:!1}),P.util.trackRegisterAction("app_install_modal_ios_selected"))},shiftPanelRight:function(){var e;this.currentPanel===this.LEFT_PANEL?(this.currentPanel=this.MIDDLE_PANEL,e="50%",this.$(".leftArrow").fadeIn()):this.currentPanel===this.MIDDLE_PANEL&&(this.currentPanel=this.RIGHT_PANEL,e="-50%",this.$(".rightArrow").fadeOut()),e&&(this.$(".container").animate({left:e},{queue:!1}),P.util.trackRegisterAction("app_install_modal_android_selected"))},openCompletionPanel:function(e){"continueToPhonePicker"!==e.target.id&&setTimeout(function(){P.util.trackRegisterAction("app_install_modal_store_opened"),this.$(".completedPanel").fadeIn()}.bind(this),1e3)},dismissModal:function(){P.util.trackRegisterAction("app_install_modal_experience_completed"),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.destroy()},continueToPhonePicker:function(){P.util.trackRegisterAction("continued_to_phone_picker"),this.$(".appUpsell").fadeOut(),this.$(".phonePicker").fadeIn()}}),P.modules.AppInstallModal.prototype.className="AppInstallModal",goog.provide("P.modules.AppInterstitial"),goog.require("P.Module"),goog.require("P.nativeApp"),goog.require("P.util"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),goog.require("P.router"),P.modules.AppInterstitial=P.Module.extend({events:{"click .stayInBrowserLink":"onClickStayInBrowser","click .loginBrowserLink":"onClickLoginBrowser","click .continueBrowserLink":"onClickContinueBrowser","click .appInfo":"onClickOpenInApp","click .openInApp":"onClickOpenInApp","click .RelatedItemsSlideshow":"onClickOpenInApp","click .overlayTop":"onClickOpenInApp","click .boardWrapper":"onClickOpenInApp","click .interstitialHeaderLoginWithBrowserLink":"redirectToLogin"},onContentReady:function(){var e=P.context.instanceEvent.fromEventType(P.genConst.EventType.INTERSTITIAL_LOADED);P.context.instanceLogger.getInstance().addEvent(e),P.context.instance.user_agent_platform===P.CONST.USER_AGENT_PLATFORM_IOS||P.context.instance.user_agent_platform===P.CONST.USER_AGENT_PLATFORM_IPAD?this.deviceString=P.context.instance.user_agent_platform:P.context.instance.user_agent_platform===P.CONST.USER_AGENT_PLATFORM_ANDROID?this.options.is_tablet?this.deviceString="android_tablet":this.deviceString=P.context.instance.user_agent_platform:this.deviceString="other",this.typeString=this.options.type||"regular",P.util.trackRegisterAction("interstitial."+this.typeString+".loaded."+this.deviceString)},removeInterstitial:function(){var e=this.parent;e&&e.destroy()},onClickOpenInApp:function(){P.nativeApp.setOpenInAppPreference(),P.util.trackRegisterAction("interstitial."+this.typeString+".open_in_app."+this.deviceString),this.triggerEvent(P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP,null,!0);var e=P.context.instanceEvent.fromEventType(P.genConst.EventType.INTERSTITIAL_OPEN_IN_APP);if(P.context.instanceLogger.getInstance().addEvent(e),P.context.instance.user_agent_platform===P.CONST.USER_AGENT_PLATFORM_ANDROID){var t=P.experiments.instance.getGroupForExperiment("return_interstitial_android_v2");("enabled"===t||"enabled2"===t)&&(this.options.type||this.removeInterstitial())}else P.context.instance.user_agent_platform===P.CONST.USER_AGENT_PLATFORM_IOS&&(this.options.type||this.removeInterstitial())},onClickStayInBrowser:function(){var e=P.context.instanceEvent.fromEventType(P.genConst.EventType.INTERSTITIAL_OPEN_IN_BROWSER);P.nativeApp.setStayInBrowserPreference(!0,!1),P.context.instanceLogger.getInstance().addEvent(e),P.util.trackRegisterAction("interstitial."+this.typeString+".open_in_browser."+this.deviceString),this.removeInterstitial()},onClickLoginBrowser:function(){this.onClickStayInBrowser(),this.triggerEvent(P.CONST.EVENT_CLEAR_HAS_RETURN_INTERSTITIAL,{},!0),P.util.trackRegisterAction("interstitial."+this.typeString+".login_with_browser."+this.deviceString),P.user.instance.isAuthenticated()||P.router.instance.navigate("/login/?next="+window.location.pathname)},onClickContinueBrowser:function(){this.onClickStayInBrowser(),this.triggerEvent(P.CONST.EVENT_CLEAR_HAS_RETURN_INTERSTITIAL,{},!0),P.util.trackRegisterAction("interstitial."+this.typeString+".continue_in_browser."+this.deviceString)},redirectToLogin:function(){P.router.instance.navigate("/login/?next="+window.location.pathname),this.$el.fadeOut(),this.triggerEvent(P.CONST.EVENT_HEADER_INTERSTITIAL_DISMISSED,null,!0)}}),P.modules.AppInterstitial.prototype.className="AppInterstitial",goog.provide("P.modules.AppealForm"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.validator"),P.modules.AppealForm=P.Module.extend({onContentReady:function(){var e={email:[P.validator.Email({}),P.validator.Required()],type:[P.validator.Required()]},t={prevalidate:!0};this.$form=this.$("form"),this.form=new P.Form(this.$form,e,t),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(e){e.errors[0]||this.submitAppeal()},submitAppeal:function(){var e=this.getChildById("submitButton");e.showLoading();var t=this.form.getData(),o=P.resourceFactory.instance.create("AppealResource",t);o.options=t,o.callCreate({showError:!0}).then(function(){e.hideLoading();var t={name:"ConfirmDialog",options:{template:"appeal"}};P.moduleFactory.load(t).then(function(e){this.showInModal(e)}.bind(this))}.bind(this)).fin(function(){e.hideLoading()})}}),P.modules.AppealForm.prototype.className="AppealForm",goog.provide("P.modules.AuthHomePage"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),goog.require("P.i18n"),goog.require("P.frontEndEvent"),goog.require("P.experienceUtil"),goog.require("P.genConst"),P.modules.AuthHomePage=P.Module.extend({onContentReady:function(){return this.options.is_modal_nux?(P.experienceUtil.launchPlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,{}),void delete this.options.is_modal_nux):(_.defer(this.addTutorials.bind(this)),this.grid=this.getChildById("feedGrid"),this.grid.hasItems()||P.frontEndEvent.log("auth_home_page_empty_grid",1),this.options.show_inviter_modal&&this.showFriendInviterModal(),this.extraData&&this.extraData.emailUpdated&&this.showUpdateEmailSuccess(),this._setUpFastFollow(),this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),void this.setRecentPinId())},showFriendInviterModal:function(){P.moduleFactory.load({name:"MultiInviter"}).then(function(e){P.modalManager.get().createAndShowModal(e,{can_dismiss:!0,only_modal:!0})})},showUpdateEmailSuccess:function(){if(Cookie.get(P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED)){if(Cookie.unset(P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED),!this.extraData||!this.extraData.email)return;var e=P.string.format(P.i18n._("You updated your address! Now you just need to confirm it. Look for the message we sent to {{ new_email }}."),{new_email:this.extraData.email}),t={name:"ConfirmDialog",options:{button_text:P.i18n._("Ok"),body_message:e,title:P.i18n._("Email updated"),template:"generic"}};return void P.moduleFactory.load(t).then(function(e){this.showInModal(e)}.bind(this))}},_setUpFastFollow:function(){var e={};e[P.CONST.PUBSUB_TOPIC_HOMEFEED_REFRESH]=this.onBoardInteraction.bind(this),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},addTutorials:function(){var e=P.genConst.Placement.WEB_HOME_TAKEOVER;P.experienceUtil.launchPlacedExperience(e,{},this)},onBoardInteraction:function(e,t,o){var n=function(){};o&&o.callback&&(n=o.callback),this.render().then(n)},onAddedToDom:function(){this._setUpFastFollow(),this.setRecentPinId()},onRemovedFromDom:function(){P.Updater.instance().setRecentPinId(null)},_onScroll:function(){var e=this.getScrollableElement().scrollTop();e>10?(this.$(".cookieBar").fadeOut(250),this.$(".cookieBarText").fadeOut(250),this.$(".nonEuPrivacyPolicy").fadeOut(250)):0===e&&(this.$(".cookieBar").fadeIn(1e3),this.$(".cookieBarText").fadeIn(1e3),this.$(".nonEuPrivacyPolicy").fadeIn(1e3))},setRecentPinId:function(){P.Updater.instance().setRecentPinId(this.getRecentPinId())},getRecentPinId:function(){if(!this.grid)return null;var e=this.grid.getFirstGridItem("Pin");return e?e.getPinId():void 0}}),P.modules.AuthHomePage.prototype.className="AuthHomePage",goog.provide("P.modules.AutoFollow"),goog.require("P.Module"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.AutoFollow=P.Module.extend({events:{},onContentReady:function(){var e={username:this.options.username,username_and_slug:this.options.username_and_slug},t="UserAutoFollowResource",o="/"+this.options.username+"/",n="user_auto_follow";this.options.username_and_slug&&(t="BoardAutoFollowResource",o="/"+this.options.username_and_slug+"/",n="board_auto_follow");var a=P.resourceFactory.instance.create(t,e);a.callCreate().then(function(){P.ga.trackEvent(n,P.CONST.GA_ACTION_SUCCESS)},function(){P.ga.trackEvent(n,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.navigate(o+"?auto_follow=true")}.bind(this))}}),P.modules.AutoFollow.prototype.className="AutoFollow",goog.provide("P.modules.BackgroundImage"),goog.require("P.Module"),goog.require("P.util"),P.modules.BackgroundImage=P.Module.extend({CssClassName:{LOADED:"loaded"},onContentReady:function(){P.util.preloadImage(this.options.image_url).then(function(){this.$(".background").addClass(this.CssClassName.LOADED)}.bind(this))}}),P.modules.BackgroundImage.prototype.className="BackgroundImage",goog.provide("P.modules.BlockAndUnfollowForm"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.BlockAndUnfollowForm=P.Module.extend({events:{"change input":"onInputChange","click button":"onButtonClicked"},CssClassName:{CLASS_VISIBLE:"visible",BLOCK_BUTTON:"blockButton"},buttonConfig:{unfollowBoard:{buttonClassName:".unfollowBoardButton",buttonClickHandler:"_unfollowBoard",userActions:["unfollow_board"]},unfollowPinner:{buttonClassName:".unfollowPinnerButton",buttonClickHandler:"_unfollowPinner",userActions:["unfollow_pinner"]},blockPinner:{buttonClassName:".blockButton",userActions:["block_pinner"]
},leaveAndUnfollowBoard:{buttonClassName:".leaveAndUnfollowBoardButton",buttonClickHandler:"_leaveAndUnfollowBoard",userActions:["leave_board"]},leaveBoardAndBlockPinner:{buttonClassName:".blockButton",userActions:["leave_board","block_pinner"]},"leaveAndUnfollowBoard leaveBoardAndBlockPinner":{buttonClassName:".blockButton",userActions:["leave_board","block_pinner"]},"":{buttonClassName:".doneButton",buttonClickHandler:"destroy",userActions:[]}},onContentReady:function(){var e={},t=this.getUserToBlock("id");t&&(e[P.CONST.PUBSUB_TOPIC_USER_BLOCKED]=this._onUserBlockConfirmed,this.pubsubSubscribe(t,e))},onInputChange:function(e){var t=this._getCheckedValues();this.$("button.visible").toggleClass(this.CssClassName.CLASS_VISIBLE,!1),this.$(this.getButtonConfig(t).buttonClassName).toggleClass(this.CssClassName.CLASS_VISIBLE,!0)},onButtonClicked:function(e){var t=$(e.target);if(!t.hasClass(this.CssClassName.BLOCK_BUTTON)){this.showLoading();var o=this._getCheckedValues(),n=this.buttonConfig[o].buttonClickHandler;n&&this[n]&&("destroy"===n&&"ignoreThisPin"===this.options.flagReason?this._onUserActionDone():this[n].apply(this))}},_getCheckedValues:function(){var e=[];return this.$("input:checked").each(function(){e.push($(this).val())}),e.join(" ")},_onUserBlockConfirmed:function(){var e=P.modalManager.get();e.removeTopModal(),this._onUserActionDone()},_onUserActionDone:function(){this.hideLoading();var e=this.getUserToBlock("full_name"),t={pinnerName:e},o=this._getCheckedValues();t.userActions={};var n=this.getButtonConfig(o).userActions;n.forEach(function(e){t.userActions[e]=!0}),t.template="block_and_unfollow",t.fluid=!P.context.instance.is_mobile_agent;var a={name:"ConfirmDialog",options:t};P.moduleFactory.load(a).then(function(e){this.showInModal(e),this.destroy()}.bind(this))},_unfollowBoard:function(){var e=this.data&&this.data.board&&this.data.board.id,t={name:"BoardFollowResource",options:{board_id:e}},o={id:e,topic:P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW};this._resourceDeleteCall(t,"board_unfollow",o).then(function(){this._onUserActionDone()}.bind(this))},_unfollowPinner:function(){var e=this.getUserToBlock("id"),t={name:"UserFollowResource",options:{user_id:e}},o={id:e,topic:P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW};this._resourceDeleteCall(t,"user_unfollow",o).then(function(){this._onUserActionDone()}.bind(this))},_leaveAndUnfollowBoard:function(){var e=this.data&&this.data.board&&this.data.board.id,t={name:"BoardCollaboratorResource",options:{board_id:e,invited_user_id:this.options.user_id,ban:!1}},o={id:e,topic:P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW},n={name:"BoardFollowResource",options:{board_id:e}},a={id:e,topic:P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED},r=this._resourceDeleteCall(t,"collaborator_delete_invite",o),i=this._resourceDeleteCall(n,"board_unfollow",a),s=[i,r];Promise.all(s).then(function(){this._onUserActionDone()}.bind(this))},_resourceDeleteCall:function(e,t,o){var n=P.resourceFactory.instance.create(e.name,e.options);return n?n.callDelete().then(function(){return t&&P.ga.trackEvent(t,P.CONST.GA_ACTION_SUCCESS),o&&P.pubSub.instance.publish(o.id,o.topic,!0),Promise.resolve()},function(){return t&&P.ga.trackEvent(t,P.CONST.GA_ACTION_ERROR),Promise.reject(new Error(n.getName()+" failed to call callDelete()"))}):(this.log.error("No resource created from "+n.getName()),Promise.reject(new Error(n.getName()+" was not created")))}}),P.modules.BlockAndUnfollowForm.prototype.className="BlockAndUnfollowForm",goog.provide("P.modules.BlockAndUnfollowMessage"),goog.require("P.modules.BlockAndUnfollowForm"),P.modules.BlockAndUnfollowMessage=P.modules.BlockAndUnfollowForm.extend({buttonConfig:{blockPinner:{buttonClassName:".blockButton",userActions:["block_pinner"]},blockPinners:{buttonClassName:".blockButton",userActions:["block_multiple_pinners"]},"":{buttonClassName:".doneButton",buttonClickHandler:"destroy",userActions:[]}},blockConfig:{numBlocked:0,numToBlock:0},onContentReady:function(){var e={};if(this.options.conversation&&this.options.conversation.users){var t=_.pluck(this.options.conversation.users,"user_id");t&&(e[P.CONST.PUBSUB_TOPIC_USER_BLOCKED]=this._onUserBlockConfirmed,_.each(t,function(t){this.pubsubSubscribe(t,e)}.bind(this)))}},getUsersToBlock:function(e){if(this.options.conversation&&this.options.conversation.users){var t=this.options.conversation.users,o=this._getCheckedValues().split(" ");return _.pluck(_.filter(t,function(e){return-1!==_.indexOf(o,e.user_id)}),e)}return[]},getButtonConfig:function(e){if(""===e)return this.buttonConfig[e];var t=e.split(" ");return t.length>1?this.buttonConfig.blockPinners:1===t.length?this.buttonConfig.blockPinner:void 0},getUserToBlock:function(e){return this.getUsersToBlock(e)},onInputChange:function(e){var t=this._getCheckedValues().split(" ");1===t.length&&""===t[0]?this.blockConfig.numToBlock=0:this.blockConfig.numToBlock=t.length;var o=this.getChildByModuleName("ShowModalButton").options.submodule;o.options.blocked_users=t,o.options.first_name=this.getUserToBlock("first_name"),P.modules.BlockAndUnfollowForm.prototype.onInputChange.call(this,e)},_onUserBlockConfirmed:function(){this.blockConfig.numBlocked++,this.blockConfig.numToBlock>0&&this.blockConfig.numBlocked===this.blockConfig.numToBlock&&P.modules.BlockAndUnfollowForm.prototype._onUserBlockConfirmed.call(this)},onRemovedFromDom:function(){this.blockConfig.numBlocked=0,this.blockConfig.numToBlock=0}}),P.modules.BlockAndUnfollowMessage.prototype.className="BlockAndUnfollowMessage",goog.provide("P.modules.BlueAppBanner"),goog.require("P.Module"),goog.require("P.util"),P.modules.BlueAppBanner=P.Module.extend({events:{click:"openInApp"},onContentReady:function(){P.util.trackRegisterAction("blue_banner_loaded")},openInApp:function(){P.util.trackRegisterAction("blue_banner_getapp_clicked"),this.triggerEvent(P.CONST.EVENT_AUTH_BANNER_OPEN_IN_APP,null,!0)}}),P.modules.BlueAppBanner.prototype.className="BlueAppBanner",goog.provide("P.modules.BoardButtons"),goog.require("P.Module"),P.modules.BoardButtons=P.Module.extend({}),P.modules.BoardButtons.prototype.className="BoardButtons",goog.provide("P.modules.BoardCollaboratorInvitesBase"),goog.require("P.Module"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.BoardCollaboratorInvitesBase=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this.onChildInviteUser),this.childListen(P.CONST.EVENT_INVITE_EMAIL,this.onChildInviteEmail)},onInviteAdded:function(e,t){},onChildInviteUser:function(e){var t,o=this.getChildById("boardInviteForm");o.showLoading();var n=e.data.userId,a=e.data.type,r=this.getBoardId();"user"===a?(t=P.resourceFactory.instance.create("BoardInviteResource",{board_id:r,invited_user_id:n}),t.callCreate().then(function(t){this.onInviteAdded(e.data.pending,{invitee:n,type:"pinner"}),o.clearTypeahead()}.bind(this)).fin(function(e){o.hideLoading()})):a===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER?(t=P.resourceFactory.instance.create("BoardFacebookInviteResource",{board_id:r}),t.callGet({showError:!1}).then(function(e){var a=e.resource_response.data;o.hideLoading(),P.FacebookDialog.open({type:"send",path:a.url,to:n,callback:function(e){e&&e.success&&(t=P.resourceFactory.instance.create("BoardFacebookInviteResource",{board_id:this.getBoardId(),invite_code:a.invite_code}),t.callUpdate())}.bind(this)})}.bind(this),function(e){o.hideLoading(),P.errorUtil.showError(e.message)})):this._inviteEmail(n,e.data.pending)},_inviteEmail:function(e,t){var o=this.getChildById("boardInviteForm"),n={board_id:this.getBoardId(),emails:[e]},a=P.resourceFactory.instance.create("BoardEmailInviteResource",n);a.callCreate().then(function(){this.onInviteAdded(t,{invitee:e,type:"email"}),o.clearTypeahead();var n=P.string.format(P.i18n.commonStrings.successInviteSentToEmail,{email:e}),a=$("<div class='alert'>"+n+"</div>").hide();this.insertAfterModule(a,o),a.fadeIn(function(){a.delay(5e3).fadeOut(function(){a.remove()})})}.bind(this)).fin(function(){o.hideLoading()})},getBoardId:function(){return this.resource.options.board_id},onChildInviteEmail:function(e){var t=this.getChildById("boardInviteForm");t.showLoading();var o=e.data.email,n=e.data.pending;this._inviteEmail(o,n)}}),P.modules.BoardCollaboratorInvitesBase.prototype.className="BoardCollaboratorInvitesBase",goog.provide("P.modules.BoardCollaborators"),goog.require("P.modules.BoardCollaboratorInvitesBase"),P.modules.BoardCollaborators=P.modules.BoardCollaboratorInvitesBase.extend({onContentReady:function(){this.boardInviteForm=this.getChildById("boardInviteForm");var e=this.getBoardId();if(e){var t={};t[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,this.pubsubSubscribe(e,t)}},onBoardUpdated:function(){this.render()}}),P.modules.BoardCollaborators.prototype.className="BoardCollaborators",goog.provide("P.modules.BoardCoverEditPage"),goog.require("P.Module"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.BoardCoverEditPage=P.Module.extend({events:{"click .save":"save","click .cancel":"cancel"},save:function(e){P.ga.trackEvent("board_edit_cover",P.CONST.GA_ACTION_CLICK_SUBMIT);var t=this.getChildByModuleName("BoardCoverEdit"),o=t.getBoardCoverData(),n=this.getChildById("saveCover");n.showLoading();var a=_.extend(o,{board_id:this.extraData.boardId,url:this.$(".in").attr("src")}),r=P.resourceFactory.instance.create("BoardResource",a),i=Math.round(o.nativeWidth*o.scale),s=Math.round(o.width),l=Math.round(o.nativeHeight*o.scale),u=Math.round(o.height);if(l!==u&&i!==s){var d=_.extend({},o,{userAgent:window.navigator.userAgent});this.log.error("Invalid cover data (crop box bound error)",d)}r.callUpdate().then(function(){P.ga.trackEvent("board_edit_cover",P.CONST.GA_ACTION_SUCCESS),this.destroy(),P.pubSub.instance.publish(this.extraData.boardId,P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED,a)}.bind(this)).fin(function(){n.hideLoading()})},cancel:function(){P.ga.trackEvent("board_edit_cover",P.CONST.GA_ACTION_CLICK_CANCEL),this.destroy()}}),P.modules.BoardCoverEditPage.prototype.className="BoardCoverEditPage",goog.provide("P.modules.BoardCycler"),goog.require("P.Module"),P.modules.BoardCycler=P.Module.extend({onContentReady:function(){}}),P.modules.BoardCycler.prototype.className="BoardCycler",goog.provide("P.modules.BoardEditBase"),goog.require("P.Form"),goog.require("P.modules.BoardCollaboratorInvitesBase"),goog.require("P.ga"),goog.require("P.validator"),goog.require("P.resourceFactory"),P.modules.BoardEditBase=P.modules.BoardCollaboratorInvitesBase.extend({CssClassName:_.extend(P.modules.BoardCollaboratorInvitesBase.prototype.CssClassName,{INLINE_ERROR:"inlineError"}),onCreated:function(){P.modules.BoardCollaboratorInvitesBase.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},setupForm:function(){this.$form=this.$("form");var e={},t=this.extraData;if(this._isOwner()){var o=t.errorMessages.name.required;e={name:[P.validator.Required({message:o}),P.validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_TITLE})],description:[P.validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]}}this.form=new P.Form(this.$form,e),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onContentReady:function(){this.setupForm()},onButtonClick:function(e){var t=e.target;if(t){var o=this._getGACategory();"submitButton"===t.id?P.ga.trackEvent(o,P.CONST.GA_ACTION_CLICK_SUBMIT):"cancelButton"===t.id&&P.ga.trackEvent(o,P.CONST.GA_ACTION_CLICK_CANCEL)}},onSubmitValidated:function(e){e.errors[0]||this.saveBoard()},getBoardId:function(){return this.data&&this.data.id},_getGACategory:function(){return this.getBoardId()?"board_edit":"board_create"},isPrivacyChanged:function(e){return this.data&&this.data.privacy!==e},getFieldValues:function(){var e=this.$("form"),t={},o=e.find("[name=name]");o.length&&(t.name=o.val());var n=this.getChildById("boardCategory");n&&(t.category=n.getValue());var a=e.find("[name=description]");a.length&&(t.description=a.val());var r=this.getChildById("secretCheckbox");r&&(t.privacy=r.isChecked()?"secret":"public");var i=this.getChildById("emailCheckbox");i&&(t.collab_board_email=i.isChecked());var s=this.getChildById("placeLayoutCheckbox");s&&(t.layout=s.isChecked()?"places":"default");var l=this.getChildById("collaboratorInvitesEnabledCheckbox");return l&&(t.collaborator_invites_enabled=l.isChecked()),this.extraData&&this.extraData.isProtected&&(t["protected"]=1),t},_isOwner:function(){return this.extraData&&this.extraData.isOwner},saveBoard:function(){var e=this.getChildById("submitButton");e.showLoading();var t=this.getFieldValues(),o=this.getBoardId(),n=_.clone(t);o&&(n.board_id=o);var a;if(this._isOwner()){a=P.resourceFactory.instance.create("BoardResource",n);var r={showError:!1},i=o?a.callUpdate(r):a.callCreate(r);i.then(this.onSaveSuccess.bind(this),this.onSaveError.bind(this)).fin(function(){e.hideLoading()})}else a=P.resourceFactory.instance.create("BoardSettingsResource",n),a.callUpdate().fin(function(){this.updateBoardPickerBoardsResource(),e.hideLoading(),this.destroy()}.bind(this))},updateBoardPickerBoardsResource:function(){var e=P.resourceFactory.instance.create("BoardPickerBoardsResource",{filter:"all",field_set_key:"board_picker",allow_stale:!0});P.resourceCache.instance.callGet(e)},onSaveError:function(e){P.ga.trackEvent(this._getGACategory(),P.CONST.GA_ACTION_ERROR);var t=this.$(".formFooter"),o=this.$(".inlineError");o.length?o.empty():o=$("<p></p>").addClass(this.CssClassName.INLINE_ERROR),o.text(e.message),o.insertBefore(t)},_isNewBoard:function(){var e=this.getBoardId();return!e},onSaveSuccess:function(e){var t=this.getChildById("boardInvites"),o,n,a;t&&(o=t.getSelectedInvitees("pinner"),n=t.getSelectedInvitees("email"),a=t.getSelectedInvitees("facebook"));var r=this.getBoardId(),i=this._isNewBoard();P.ga.trackEvent(this._getGACategory(),P.CONST.GA_ACTION_SUCCESS),this.updateBoardPickerBoardsResource();var s=e.resource_response.data;if(r){if(P.pubSub.instance.publish(r,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,s),this.isPrivacyChanged(s.privacy)&&(P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,P.CONST.PUBSUB_MESSAGE_BOARD_PRIVACY_CHANGED),"secret"===s.privacy)){var l={name:"ConfirmDialog",options:{template:"make_board_private"}};P.moduleFactory.load(l).then(function(e){P.modalManager.get().createAndShowModal(e)})}}else P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,s),this.triggerEvent(P.CONST.EVENT_BOARD_CREATED,s,!0);i&&(o&&this.inviteUsers(s.id,o),n&&this.inviteEmail(s.id,n),a&&a.length>0&&this.inviteFacebook(s.id,a));var u="navigate_on_success"in this.options?this.options.navigate_on_success:i||!this.isInModal();u?this.navigate(s.url,null,i?P.genConst.ForceRefreshType.PAGE:null):this.options.custom_board_create_success_destroy||this.destroy()},displayFacebookDialog:function(e,t,o){P.FacebookDialog.open({type:"send",path:t,to:e,callback:o})},inviteUsers:function(e,t){var o={board_id:e,invited_user_ids:t};if(t&&t.length>0){var n=P.resourceFactory.instance.create("BoardInviteResource",o);n.callCreate()}},inviteEmail:function(e,t){var o={board_id:e,emails:t};if(t&&t.length>0){var n=P.resourceFactory.instance.create("BoardEmailInviteResource",o);n.callCreate()}},inviteFacebook:function(e,t){var o=P.resourceFactory.instance.create("BoardFacebookInviteResource",{board_id:e});o.callGet().then(function(o){var n=o.resource_response.data;this._inviteFacebookRecursive(e,t,n.invite_code,n.url)}.bind(this))},_inviteFacebookRecursive:function(e,t,o,n){if(t.length>0){var a=t.pop();this.displayFacebookDialog(a,n,function(a){if(this._inviteFacebookRecursive(e,t,o,n),a&&a.success){var r=P.resourceFactory.instance.create("BoardFacebookInviteResource",{board_id:e,invite_code:o});r.callUpdate()}}.bind(this))}}}),P.modules.BoardEditBase.prototype.className="BoardEditBase",goog.provide("P.modules.BoardFollowers"),goog.require("P.Module"),P.modules.BoardFollowers=P.Module.extend({}),P.modules.BoardFollowers.prototype.className="BoardFollowers",goog.provide("P.modules.BoardHeader"),goog.require("P.Module");var r="BoardInfoBar";P.modules.BoardHeader=P.Module.extend({CssClassName:{HEADER_COLLAPSED:P.CONST.CLASS_HEADER_COLLAPSED},onCreated:function(){this.childListen(P.CONST.EVENT_INFO_BAR_COLLAPSED,this.onInfoBarCollapsed),this.childListen(P.CONST.EVENT_INFO_BAR_EXPANDED,this.onInfoBarExpanded)},showEditModal:function(){var e=this.getChildByModuleName(r);return e.showEditModal()},onInfoBarCollapsed:function(){this.updateOptionsAndDom({headerCollapsed:!0})},onInfoBarExpanded:function(){this.updateOptionsAndDom({headerCollapsed:!1})},updateDom:function(){this.$el.toggleClass(this.CssClassName.HEADER_COLLAPSED,this.options.headerCollapsed)}}),P.modules.BoardHeader.prototype.className="BoardHeader",goog.provide("P.modules.BoardIcons"),goog.require("P.Module"),P.modules.BoardIcons=P.Module.extend({CssClassName:{LIGHT:"light"},setLightColor:function(e){this.$el.toggleClass(this.CssClassName.LIGHT,e)}}),P.modules.BoardIcons.prototype.className="BoardIcons",goog.provide("P.modules.BoardInvite"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.ga"),goog.require("P.resourceFactory");var i=5e3;P.modules.BoardInvite=P.Module.extend({onContentReady:function(){this.declineButton=this.getChildById("declineButton"),this.removeButton=this.getChildById("removeButton"),this.acceptButton=this.getChildById("acceptButton"),this.approveButton=this.getChildById("approveButton"),this.declineButton&&this.listen(this.declineButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickDecline),this.removeButton&&this.listen(this.removeButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickRemove),this.acceptButton&&this.listen(this.acceptButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickAccept),this.approveButton&&this.listen(this.approveButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickApprove)},getConfirmBoardInvite:function(){return"boardEdit"===this.options.view_type},deleteBoardInvite:function(e){var t=this._getCurrentUserIsInvitedUser(),o;o=t?"collaborator_decline_invite":"collaborator_delete_invite",P.ga.trackEvent(o,P.CONST.GA_ACTION_CLICK),this.removeButton&&this.removeButton.showLoading();var n=!1;if(e){var a=e.data.formData;n=a&&a.ban}var r=this._getRemoveResource(n);r.callDelete({showError:!1}).then(function(){P.ga.trackEvent(o,P.CONST.GA_ACTION_SUCCESS);var e=this.data.board.id;this.fadeOut(function(){this.destroy(),P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED),n&&this.extraData.has_delete_permission&&P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR)}.bind(this)),t&&(P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF),P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF))}.bind(this),function(){P.ga.trackEvent(o,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.removeButton.hideLoading()}.bind(this))},onClickDecline:function(e){},onClickRemove:function(e){var t=this.options.view_type;"boardCreate"===t?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"pinner",identifier:this.options.identifier},!0),this.destroy()):"email"===t?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"email",identifier:this.options.identifier},!0),this.destroy()):"facebook"===t?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"facebook",identifier:this.options.identifier},!0),this.destroy()):this.getConfirmBoardInvite()?this.confirmDeleteBoardInvite():this.deleteBoardInvite()},confirmDeleteBoardInvite:function(){var e=this._getCurrentUserIsInvitedUser(),t=this._getInvitedUserFullName(),o={name:"RemoveUserFromBoardDialog",options:{template:"delete_board_invite",current_user_is_invited_user:e,invited_user_first_name:this.extraData.invitedUserFirstName,invited_user_full_name:t}};P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.deleteBoardInvite)}.bind(this))},onClickAccept:function(e){var t="collaborator_invite_accept";P.ga.trackEvent(t,P.CONST.GA_ACTION_CLICK),this.acceptButton&&this.acceptButton.showLoading();var o=P.resourceFactory.instance.clone(this.resource);o.callUpdate().then(function(){P.ga.trackEvent(t,P.CONST.GA_ACTION_SUCCESS);var e=this.$(".pending"),o=this.$(".success");if(this.data.board){var n=this.data.board.id;P.pubSub.instance.publish(n,P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED)}e.fadeOut(function(){o.fadeIn(function(){o.delay(i).fadeOut(function(){this.destroy()}.bind(this))}.bind(this))}.bind(this))}.bind(this),function(){P.ga.trackEvent(t,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.acceptButton.hideLoading()}.bind(this))},onClickApprove:function(e){var t="collaborator_approve_invite",o=P.resourceFactory.instance.create("BoardInviteResource",this.resource.copyOptions(!0));this.approveButton&&this.approveButton.showLoading(),o.callUpdate().then(function(){P.ga.trackEvent(t,P.CONST.GA_ACTION_SUCCESS),this.fadeOut(function(){this.destroy()}.bind(this));var e=this.data.board.id;P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE,{userId:this._getInviteUserId()})}.bind(this),function(){P.ga.trackEvent(t,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.approveButton.hideLoading()}.bind(this))},_getRemoveResource:function(e){var t=this.extraData.accepted,o=t?"BoardCollaboratorResource":"BoardInviteResource",n=this.resource.copyOptions(!0);t&&this.getConfirmBoardInvite()&&(n.ban=e);var a=P.resourceFactory.instance.create(o,n);return a},_getInviteUserId:function(){return this.extraData.invitedUserId},_getCurrentUserIsInvitedUser:function(){return this.extraData.currentUserIsInvitedUser},_getInvitedUserFullName:function(){return this.extraData.invitedUserFullName}}),P.modules.BoardInvite.prototype.className="BoardInvite",goog.provide("P.modules.BoardInviteForm"),goog.require("P.Module"),goog.require("P.validator"),goog.require("P.ga"),goog.require("P.validator"),P.modules.BoardInviteForm=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onChildEnterPressed),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onClickInviteButton),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_CONTACT_SELECTED,this.onRecentContactSelected)},onChildItemSelected:function(e){P.ga.trackEvent("collaborator_invite_user",P.CONST.GA_ACTION_SELECT_SUBMIT);var t=e.data.item,o=t.attributes;this._inviteUser(o),e.stopPropagation()},onRecentContactSelected:function(e){var t=e.data.type;"emailcontact"===t?(P.ga.trackEvent("collaborator_invite_email",P.CONST.GA_ACTION_SELECT_SUBMIT),this._inviteEmail(e.data.email_address)):"user"===t&&(P.ga.trackEvent("collaborator_invite_user",P.CONST.GA_ACTION_SELECT_SUBMIT),this._inviteUser({type:e.data.type,id:e.data.id,username:e.data.username})),e.stopPropagation()},onChildEnterPressed:function(e){P.ga.trackEvent("collaborator_invite_email",P.CONST.GA_ACTION_ENTER_SUBMIT),this.submit(),e.stopPropagation()},onClickInviteButton:function(e){P.ga.trackEvent("collaborator_invite_email",P.CONST.GA_ACTION_CLICK_SUBMIT),this.submit(),e.stopPropagation()},onChildContentChanged:function(e){e.stopPropagation()},submit:function(){var e=this.getChildById("typeaheadField"),t=e.getValue(),o=e.getField();if(this.options.email_supported){var n=new P.validator.Validator(o,[P.validator.Length({min:1}),P.validator.Email()]);n.validate(function(e){e.errors.length>0?this.log.debug(e.errors):this._inviteEmail(t)}.bind(this))}return!1},setTypeaheadFieldValue:function(e){var t=this.getChildById("typeaheadField");t.setValue(e)},clearTypeahead:function(){var e=this.getChildById("typeaheadField");e.clear()},_inviteEmail:function(e){this.triggerEvent(P.CONST.EVENT_INVITE_EMAIL,{email:e,pending:this.options.pending},!0)},_inviteUser:function(e){var t=e.type,o=e.email?e.email:e.id;this.triggerEvent(P.CONST.EVENT_INVITE_USER,{userId:o,type:t,pending:this.options.pending,attributes:e},!0)}}),P.modules.BoardInviteForm.prototype.className="BoardInviteForm",goog.provide("P.modules.BoardInvites"),goog.require("P.Module"),goog.require("P.modules.BoardInvite"),goog.require("P.moduleFactory"),goog.require("P.i18n"),P.modules.BoardInvites=P.Module.extend({onContentReady:function(){if(!this.options.pending){var e=this.resource.options.board_id,t={};t[P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE]=this.onApprovedCollaboratorInvite,this.pubsubSubscribe(e,t)}this.childListen(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,this.onInviteeRemoved),this.boardCreateInvitees=[]},onApprovedCollaboratorInvite:function(e,t,o){this.addInvitee({type:"pinner",userId:o.userId})},onInviteeRemoved:function(e){var t=e.data.type,o=e.data.identifier;this.boardCreateInvitees=_.filter(this.boardCreateInvitees,function(e){return t!==e.type||o!==e.identifier})},getSelectedInvitees:function(e){var t=_.filter(this.boardCreateInvitees,function(t){return e===t.type});return _.pluck(t,"identifier")},hasSelectedInvitee:function(e){var t=!1;return _.each(this.boardCreateInvitees,function(o){o.type===e.type&&o.identifier===e.identifier&&(t=!0)}),t},_createPinnerBoardEditInvite:function(e){var t=e.identifier,o={resource:{name:"BoardInviteResource",options:{board_id:this.resource.options.board_id,invited_user_id:t,invite_type:e.type,field_set_key:"boardEdit"}},options:{link:this.options.link_to_users_profiles}};return new P.modules.BoardInvite(o)},_createEmailBoardInvite:function(e){var t=e.identifier;return new P.modules.BoardInvite({options:{view_type:this.options.view_type,invite_type:e.type,identifier:t}})},_createPinnerBoardCreateInvite:function(e){var t=e.identifier,o={resource:{name:"UserResource",options:{user_id:t,field_set_key:"board_invite"}},options:{view_type:"boardCreate",invite_type:e.type,link:this.options.link_to_users_profiles,identifier:t}};return new P.modules.BoardInvite(o)},_createFacebookBoardInvite:function(e){var t=e.attributes,o=e.identifier,n=t.name,a=t.send_pin_image;return new P.modules.BoardInvite({options:{invite_type:e.type,identifier:o,name:n,image:a,view_type:this.options.view_type}})},addInvitee:function(e){var t=this.options.view_type,o=this.getChildById("boardInvitesPagedGrid"),n=e.type,a;if(this.hasSelectedInvitee(e)){var r={name:"ConfirmDialog",options:{message:P.i18n._("That user has already been invited to add Pins on this board!")}};P.moduleFactory.load(r).then(function(e){this.showInModal(e)}.bind(this))}else"boardCreate"===t?(a="email"===n?this._createEmailBoardInvite(e):"facebook"===n?this._createFacebookBoardInvite(e):this._createPinnerBoardCreateInvite(e),this.boardCreateInvitees.push({type:n,identifier:e.identifier})):"pinner"===n?a=this._createPinnerBoardEditInvite(e):"email"===n&&(a=this._createEmailBoardInvite(e));a&&a.render().then(function(){o.prependChildItem(a)})}}),P.modules.BoardInvites.prototype.className="BoardInvites",goog.provide("P.modules.BoardLabel"),goog.require("P.Module"),P.modules.BoardLabel=P.Module.extend({onCreated:function(){this._DOMTextReplacerInstance=null},setSelectedStyle:function(e){this.getChildById("boardIcons").setLightColor(e)},highlightMatchedText:function(e){this.unHighlightMatchedText();var t=new RegExp(e,"i");this._DOMTextReplacerInstance=window.findAndReplaceDOMText(this.$(".nameAndIcons")[0],{find:t,replace:function(e,t){var o=$('<em class="highlightMatchText"></em>');return o.html(e.text),o[0]}})},unHighlightMatchedText:function(){this._DOMTextReplacerInstance&&this._DOMTextReplacerInstance.revert()}}),P.modules.BoardLabel.prototype.className="BoardLabel",goog.provide("P.modules.BoardPickerSpinnerBlock"),goog.require("P.Module"),P.modules.BoardPickerSpinnerBlock=P.Module.extend({}),P.modules.BoardPickerSpinnerBlock.prototype.className="BoardPickerSpinnerBlock",goog.provide("P.modules.BoardRecommendationsModule"),goog.require("P.Module"),P.modules.BoardRecommendationsModule=P.Module.extend({onContentReady:function(){this.destroyIfEmpty()},isEmpty:function(){if(!this.contentReady)return!1;var e=this.getChildById("relatedBoardsFeed");return!e||!e.hasItems()}}),P.modules.BoardRecommendationsModule.prototype.className="BoardRecommendationsModule",goog.provide("P.modules.BoardSuggestionSummary"),goog.require("P.Module"),P.modules.BoardSuggestionSummary=P.Module.extend({}),P.modules.BoardSuggestionSummary.prototype.className="BoardSuggestionSummary",goog.provide("P.modules.BottomBanner"),goog.require("P.Module"),P.modules.BottomBanner=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_VIEW_CHANGE]=this.destroyBanner,e[P.CONST.PUBSUB_TOPIC_CLOSE_CLOSEUP]=this.destroyBanner,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},destroyBanner:function(e,t,o){e===P.CONST.PUBSUB_CHANNEL_TUTORIAL?"Modal"===o.moduleName&&this.destroy():this.destroy()},onDestroyed:function(){this.options.placed_experience_id&&P.ExperienceManager.instance.completePlacedExperienceId(this.options.placed_experience_id)},onAdded:function(){this.options.placed_experience_id&&P.ExperienceManager.instance.viewPlacedExperienceId(this.options.placed_experience_id)}}),P.modules.BottomBanner.prototype.className="BottomBanner",goog.provide("P.modules.BrowserExtensionUninstallPage"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.validator"),P.modules.BrowserExtensionUninstallPage=P.Module.extend({events:{"change input":"onInputChanged"},onContentReady:function(){var e={reason:[P.validator.Required()]};this.form=new P.Form(this.$("form"),e),this.submitButton=this.getChildById("submitButton"),this.submitButton.disable(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated),this._logUninstallEvent()},onInputChanged:function(e){this.submitButton.enable(),this.hideAndShowDetails($(e.target).attr("value"))},hideAll:function(){this.$(".hiddenText").hide()},hideAndShowDetails:function(e){this.hideAll(),"accident"===e&&this.$("#accidental").show()},_logUninstallEvent:function(){var e=P.url.getQueryStringParams(),t=e.xuid,o=e.xv,n={type:"extension",event:"uninstall"};t&&(n.xuid=t),o&&(n.xv=o),P.util.logWidgetEvent(n)},_onSubmitValidated:function(e){e.errors[0]||this._submitReason()},_onSuccess:function(){var e={name:"ConfirmDialog",options:{template:"uninstall_extension_reason",view_type:"mediumWide"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(e,P.CONST.EVENT_DESTROYED,this._successCancel)}.bind(this))},_onFailure:function(e){P.errorUtil.showError(e)},_submitReason:function(){var e=P.url.getQueryStringParams().xuid,t={user_id:P.user.instance.id,reason:this.$('input:radio[name="reason"]:checked').val()};e&&(t.xuid=e);var o=P.resourceFactory.instance.create("UninstallBrowserExtensionResource",t);this.submitButton.showLoading(),o.callCreate().then(function(){this._onSuccess()}.bind(this),function(e){this._onFailure(e.message)}.bind(this)).fin(function(){this.submitButton.hideLoading()}.bind(this))},_successCancel:function(){this.navigate("/"),this.destroy()}}),P.modules.BrowserExtensionUninstallPage.prototype.className="BrowserExtensionUninstallPage",goog.provide("P.modules.BulkBoardPicker"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.resourceFactory"),P.modules.BulkBoardPicker=P.Module.extend({onContentReady:function(){this.form=new P.Form(this.$("form"),{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},getBoardPicker:function(){return this.getChildById("boardPicker")},getBoardId:function(){return this.getBoardPicker().getSelectedBoardId()},onSubmitValidated:function(){var e=this.getBoardId(),t=P.resourceFactory.instance.create("BulkEditResource",{board_id:e,pin_ids:this.options.pin_ids});
this.options.action_type===P.CONST.BulkAction.MOVE?t.callUpdate({showError:!0}).then(function(){for(var t=this.options.pin_ids,o=0;o<t.length;o++)P.pubSub.instance.publish(t[o],P.CONST.PUBSUB_TOPIC_PIN_DELETED);P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED),this.showSuccessModal(e),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}.bind(this)):this.options.action_type===P.CONST.BulkAction.COPY&&t.callCreate({showError:!0}).then(function(){P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED),this.showSuccessModal(e),P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}.bind(this))},showSuccessModal:function(e){var t=P.resourceFactory.instance.create("BoardResource",{board_id:e,field_set_key:"grid_item",user_name:P.user.instance.get("username")});t.callGet().then(function(e){var t=e.resource_response.data,o={id:"pinSuccess",name:"PinCreateSuccess",options:{action:this.options.action_type,board_name:t.name,board_category:t.category,board_id:t.id,board_url:t.url,is_collaborative:t.is_collaborative,is_extension_installed:!0,privacy:t.privacy,is_bulk_action:!0}};this.showLoading(),P.moduleFactory.load(o).then(function(e){this.modal&&this.modal.setSubmodule(e)}.bind(this));var n=this.getBoardPicker(),a=P.resourceFactory.instance.clone(n.resource);P.resourceCache.instance.callGet(a)}.bind(this))}}),P.modules.BulkBoardPicker.prototype.className="BulkBoardPicker",goog.provide("P.modules.BusinessAccountCreate"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.genConst"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.validator"),goog.require("P.resourceFactory"),P.modules.BusinessAccountCreate=P.Module.extend({CssClassName:{CANCEL_CONVERT:"cancelConvert"},onContentReady:function(){if(P.util.trackRegisterAction("create_business_account_loaded"),P.user.instance.isAuthenticated())if(P.user.instance.attributes.is_partner)this.navigate(P.genConst.Settings.PARTNER_GET_STARTED);else if("create"===this.options.view_type){var e={name:"ConfirmDialog",options:{template:"confirm_create_a_business"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_DIALOG_BUTTON_CLICKED,this.onConfirmClick)}.bind(this))}var t={account_type:[P.validator.Required()],business_name:[P.validator.Required()],website_url:[P.validator.URL()]};"create"===this.options.view_type&&(t.password=[P.validator.Password(),P.validator.Required()],t.email=[P.validator.Email({}),P.validator.Required()]);var o={};this.$form=this.$("form"),this.form=new P.Form(this.$form,t,o),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(e){if(!e.errors[0]){var t=this.getChildById("submitButton"),o=this.form.getData();if(t.showLoading(),"create"===this.options.view_type)P.util.trackRegisterAction("create_business_submit_clicked"),P.UserRegistration.register("partner",o).then(function(e){P.util.trackRegisterAction("create_business_signup_success"),this.log.debug("Signup success:",e),this.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0)&&(window.location="/")}.bind(this)).fin(function(e){t.hideLoading()});else{var n=P.resourceFactory.instance.create("PartnerResource",o);n.callUpdate().fin(function(){t.hideLoading()}).then(function(){this.navigate(P.genConst.Settings.PARTNER_GET_STARTED)}.bind(this))}}},onConfirmClick:function(e){var t=$(e.data),o="";t.hasClass(this.CssClassName.CANCEL_CONVERT)?o="/":t.hasClass("continueConvert")&&(o="/logout/?next="+P.genConst.Settings.PARTNER_GET_STARTED),this.navigate(o)}}),P.modules.BusinessAccountCreate.prototype.className="BusinessAccountCreate",goog.provide("P.modules.BusinessGetStartedCards"),goog.require("P.Module"),goog.require("P.fb"),goog.require("P.twttr"),goog.require("P.AdTracking"),goog.require("P.resourceFactory"),P.modules.BusinessGetStartedCards=P.Module.extend({events:{"click .dismiss":"onDismissClick"},onContentReady:function(){var e="6013056087942",t=968689080,o="NeuUCJjtygkQuIv0zQM",n="l550e";P.fb.injectTrackingPixel(e),P.AdTracking.pingGoogleConversion(t,o),P.twttr.injectTrackingPixel(n)},onDismissClick:function(e){var t=$(e.target),o=t.parents(".getStartedCard"),n=o.data("card-name"),a=P.resourceFactory.instance.create("PartnerCardResource",{card_name:n});a.callDelete(),o.remove()}}),P.modules.BusinessGetStartedCards.prototype.className="BusinessGetStartedCards",goog.provide("P.modules.Button"),goog.require("P.Module");var s={ATTR_DISABLED:"disabled",SELECTOR_BUTTON_TEXT:".buttonText",SELECTOR_BUTTON_BADGE:".buttonBadge"};P.modules.Button=P.Module.extend({events:{click:"onClick"},CssClassName:{ACTIVE:"active",BADGED:"badged",DISABLED:"disabled",HIGHLIGHTED:"highlighted",SELECTED:"selected"},onClick:function(e){return e&&this.isDisabled()?(e.preventDefault(),!1):void this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)},disable:function(){this.$el.attr(s.ATTR_DISABLED,!0).addClass(this.CssClassName.DISABLED)},enable:function(){this.$el.removeAttr(s.ATTR_DISABLED).removeClass(this.CssClassName.DISABLED)},setEnabled:function(e){e?this.enable():this.disable()},setHighlight:function(e){this.updateOptionsAndDom({is_highlighted:e})},isDisabled:function(){return this.$el.is(":disabled")},isCancelButton:function(){return this.options.cancelButton},isSegmentedControlButton:function(){return this.options.segmented_control_button},getText:function(){var e=this.$(s.SELECTOR_BUTTON_TEXT).text();return e.trim()},setText:function(e){var t=e.trim();this.$(s.SELECTOR_BUTTON_TEXT).text(t)},setAccessibilityText:function(e){var t=e.trim();this.$(".accessibilityText").text(t)},getLoadingSpinnerOptions:function(){return _.extend(P.Module.prototype.getLoadingSpinnerOptions.call(this),{size:P.Spinner.Size.SMALL})},setBadge:function(e){var t=String(e).trim();this.$(s.SELECTOR_BUTTON_BADGE).text(t),this.$el.addClass(this.CssClassName.BADGED)},getBadgeCount:function(){var e=this.$(s.SELECTOR_BUTTON_BADGE).text().trim();return e&&void 0!==e||(e=0),parseInt(e,10)},clearBadge:function(){this.$(s.SELECTOR_BUTTON_BADGE).text(""),this.$el.removeClass(this.CssClassName.BADGED)},setBadgeCount:function(e){0>=e?this.clearBadge():this.setBadge(e)},setActive:function(e){this.updateOptionsAndDom({is_active:e})},setSelected:function(e){this.updateOptionsAndDom({is_selected:e})},isSelected:function(){return!!this.options.is_selected},updateDom:function(){this.$el.toggleClass(this.CssClassName.ACTIVE,!!this.options.is_active),this.$el.toggleClass(this.CssClassName.SELECTED,!!this.options.is_selected),this.$el.toggleClass(this.CssClassName.HIGHLIGHTED,!!this.options.is_highlighted)},isActive:function(){return!!this.options.is_active},_shouldShowSpinner:function(){var e=this.options.show_spinner;return void 0!==e?e:this.options.borderless&&this.options.show_text===!1?!1:!0},showLoading:function(){this.disable(),this._shouldShowSpinner()&&P.Module.prototype.showLoading.call(this)},hideLoading:function(){this.enable(),this._shouldShowSpinner()&&P.Module.prototype.hideLoading.call(this)},getLoggingObjectIdStr:function(){return this.parent?this.parent.getLoggingObjectIdStr():null},_getLabelModule:function(){return this.getChildById("label")}}),P.modules.Button.prototype.className="Button",goog.provide("P.modules.CSRCreateSuccess"),goog.require("P.Module"),P.modules.CSRCreateSuccess=P.Module.extend({}),P.modules.CSRCreateSuccess.prototype.className="CSRCreateSuccess",goog.provide("P.modules.CSRDomainSuggestions"),goog.require("P.Module"),P.modules.CSRDomainSuggestions=P.Module.extend({}),P.modules.CSRDomainSuggestions.prototype.className="CSRDomainSuggestions",goog.provide("P.modules.CampbellRightHeader"),goog.require("P.Module"),P.modules.CampbellRightHeader=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_DRAWER_SIDE_NAV_SHOW]=this._loadDrawer,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CAMPBELL,e)},_loadDrawer:function(){var e=this.$(".campbellDrawerButton");console.log(e),e.trigger("click")}}),P.modules.CampbellRightHeader.prototype.className="CampbellRightHeader",goog.provide("P.modules.CategoriesMenu"),goog.require("P.Module"),goog.require("P.preventScrollMixin"),P.modules.CategoriesMenu=P.Module.extend({CssClassName:{ACTIVE:"active",SELECTED:"selected"},getItemByCategory:function(e){return this.$("a[data-category="+e+"]")},mixins:[P.preventScrollMixin],onCategoryUpdated:function(e,t,o){if(this.$("a").removeClass(this.CssClassName.SELECTED),o){var n=this.getItemByCategory(o);n.length?(n.addClass(this.CssClassName.SELECTED),this.waitingMessage=null):this.waitingMessage=o}},onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY]=this.onCategoryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.waitingMessage&&this.getItemByCategory(this.waitingMessage).addClass(this.CssClassName.SELECTED)},getHeight:function(){if("height"in this.options)return this.options.height;this.$el.css("display","block");var e=this.$(".categoriesWrapper").outerHeight(),t=this.getChildByModuleName("AboutLinks");return t&&(e=e+t.getHeight()+1),this.$el.css("display",""),this.options.height=e,this.options.height}}),P.modules.CategoriesMenu.prototype.className="CategoriesMenu",goog.provide("P.modules.CategoriesPage"),goog.require("P.Module"),P.modules.CategoriesPage=P.Module.extend({}),P.modules.CategoriesPage.prototype.className="CategoriesPage",goog.provide("P.modules.CategoriesSelect"),goog.require("P.Module"),P.modules.CategoriesSelect=P.Module.extend({getValue:function(){return this.$("option:selected").val().trim()}}),P.modules.CategoriesSelect.prototype.className="CategoriesSelect",goog.provide("P.modules.Category"),goog.require("P.Module"),P.modules.Category=P.Module.extend({}),P.modules.Category.prototype.className="Category",goog.provide("P.modules.Checkbox"),goog.require("P.Module");var l="checked";P.modules.Checkbox=P.Module.extend({CssClassName:{IS_DISABLED:"disabled",IS_ON:"on"},onContentReady:function(){this.$input=this.$el,"fancyToggle"===this.options.view_type||"fancyCheckbox"===this.options.view_type||"flatToggle"===this.options.view_type?(this.$input=this.$("input"),this.$el.on("click",this.onFancyToggleCheckboxClick.bind(this))):this.$el.on("change",this.toggle.bind(this)),this.options.disabled===!0&&this.setDisabled(!0)},onFancyToggleCheckboxClick:function(e){var t=$(e.currentTarget).parent()[0].tagName,o="label"===t.toLowerCase(),n=!o||o&&$(e.target).is(":checkbox");n&&this.toggle()},toggle:function(){this.setChecked(!this.options.checked,!0)},setChecked:function(e,t){void 0===t&&(t=!0),e===this.options.checked||this.options.disabled||(this.options.checked=e,this.$el.toggleClass(this.CssClassName.IS_ON,e),this.$input.prop(l,e),t&&this.triggerEvent(P.CONST.EVENT_CHANGE,{checked:e},!0))},setDisabled:function(e,t){void 0===t&&(t=!0),void 0!==this.$input&&(this.options.disabled=e,this.$el.toggleClass(this.CssClassName.IS_DISABLED,e),this.$input.prop(this.CssClassName.IS_DISABLED,e),t&&this.triggerEvent(P.CONST.EVENT_CHANGE,{disabled:e},!0))},isChecked:function(){return!!this.options.checked},getCheckboxName:function(){return this.options.name},disable:function(){this.setDisabled(!0)}}),P.modules.Checkbox.prototype.className="Checkbox",goog.provide("P.modules.CheckboxGroup"),goog.require("P.Module"),P.modules.CheckboxGroup=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onInputChange),this.checkboxModules=this.getChildrenByModuleName("Checkbox");var e={};_.each(this.options.items,function(t){var o=t.name;e[o]={name:o,label:t.label}}),this._checkboxes=e},onInputChange:function(e){e.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0)},getValue:function(){var e=[],t=this._checkboxes,o=0;return _.each(this.checkboxModules,function(n){var a=n.getCheckboxName();n.isChecked()&&(e[o++]={name:a,label:t[a].label})}),e}}),P.modules.CheckboxGroup.prototype.className="CheckboxGroup",goog.provide("P.modules.ClippedPinVisualObject"),goog.require("P.Module"),P.modules.ClippedPinVisualObject=P.Module.extend({}),P.modules.ClippedPinVisualObject.prototype.className="ClippedPinVisualObject",goog.provide("P.modules.CloseupAboutPinCard"),goog.require("P.Module"),P.modules.CloseupAboutPinCard=P.Module.extend({}),P.modules.CloseupAboutPinCard.prototype.className="CloseupAboutPinCard",goog.provide("P.modules.CloseupContent"),goog.require("P.Module"),goog.require("P.experienceUtil"),goog.require("P.genConst"),P.modules.CloseupContent=P.Module.extend({getPin:function(){return this.getChildById("pin")},showEditModal:function(){var e=this.getPin();return e.showEditModal()},changeCloseupContent:function(e){var t="/pin/"+e+"/";this.navigate(t)},emptyCloseupImage:function(e,t){var o=this.getChildById("pin");o&&o.emptyPaddedPin(e,t)},addTutorials:function(){this.getPin()&&P.experienceUtil.launchPlacedExperience(P.genConst.Placement.WEB_PIN_CLOSEUP,{pin_id:this.data.id})}}),P.modules.CloseupContent.prototype.className="CloseupContent",goog.provide("P.modules.CloseupFlashlight"),goog.require("P.genConst"),goog.require("P.Module"),P.modules.CloseupFlashlight=P.Module.extend({events:{click:"_onClick"},CssClassName:{HIDDEN:"hidden",NO_DISPLAY:"noDisplay",HIDE_CLOSEUP:"hideCloseup"},onCreated:function(){this.options.state_hideCloseupAnimate=!1,this.options.state_ImgElHidden=!1},onContentReady:function(){this._changeViewType();var e=this.options.img_options,t;t=e?this.options.img_options.width:this.data.images.orig.width;var o=this.$(".flashlightImageContainer");o.width(t),this._animatePin(),this.setupScrollBar(),this._setupCropper()},updateDom:function(){if(this.$(".imageContainer").toggleClass(this.CssClassName.HIDDEN,!!this.options.state_ImgElHidden),this.options.state_hideCloseupAnimate){var e=this;this.$(".Closeup").animate({opacity:0},1,function(){e.$(".Closeup").addClass(e.CssClassName.HIDDEN)})}},onRemoved:function(){P.context.instanceLogger.getInstance().addViewToContext(this.previousView)},_changeViewType:function(){var e=P.context.instanceLogger.getInstance();this.previousView=e.getViewFromContext();var t={view_type:P.genConst.ViewType.FLASHLIGHT,view_parameter:P.genConst.ViewParameterType.PIN_FLASHLIGHT_RESULTS};e.addViewToContext(t)},_setupCropper:function(){var e=this.getChildByModuleName("FlashlightEnabledImage");e.setupCropper()},_setupAnimation:function(){var e=this.$(".imageContainer"),t=e.offset().top,o=this.$(".flashlightContentContainer"),n=o.offset().top,a=this.$(".flashlightImage");a.css("top",t-n+"px")},_animatePin:function(){this.updateOptionsAndDom({state_ImgElHidden:!0}),this._setupAnimation(),this.updateOptionsAndDom({state_ImgElHidden:!1}),this.updateOptionsAndDom({state_hideCloseupAnimate:!0}),this.$el.find(".flashlightImage").css("top","0")},_onClick:function(e){var t=e.target;!t||t!==this.$el[0]&&t!==this.$(".closeupFlashlightContainer")[0]||(e.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CLOSE,this,!0))},setupScrollBar:function(){o.e(14,function(){o(199);var e=$(".flashlightImageContainer"),t=$(".closeupResultsContainer");e.simplebar(),t.simplebar()})}}),P.modules.CloseupFlashlight.prototype.className="CloseupFlashlight",goog.provide("P.modules.CloseupFlashlightResults"),goog.require("P.Module"),P.modules.CloseupFlashlightResults=P.Module.extend({onContentReady:function(){this.options.state_selectedAnnotations={},this.options.state_cropData=null,this.options.state_lockFlashlightResults=!1;var e={};e[P.CONST.PUBSUB_TOPIC_FLASHLIGHT_CROPPER_CHANGED]=this.onCropperChanged,e[P.CONST.PUBSUB_TOPIC_ANNOTATION_UNSELECTED]=this.onAnnotationRemovedByUser,e[P.CONST.PUBSUB_TOPIC_ANNOTATION_SELECTED]=this.onSelectAnnotation,e[P.CONST.PUBSUB_TOPIC_ANNOTATIONS_ADDED_ENDED]=this.onAnnotationAddedEnded,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},_updateVisualModule:function(e,t){if(this.$(".visuallySimilarContainer")){var o=this.getChildById("visuallySimilar");if(!e)return void(o&&o.fadeOut(function(){o.destroy()}));var n={name:"VisuallySimilar",id:"visuallySimilar",options:e};this.showLoading(),P.moduleFactory.load(n).then(function(e){e.render().then(function(){this.getChildrenByModuleName("VisuallySimilar").forEach(function(e){this.removeChild(e)}.bind(this)),this.hideLoading(),this.insertChild(e,this.$(".visuallySimilarContainer")),e.fadeIn()}.bind(this))}.bind(this))}},onCropperChanged:function(e,t,o){if(!this.options.state_lockFlashlightResults){this.options.state_lockFlashlightResults=!0;var n=null;o&&(n={pin_id:o.pinId,crop:o.crop},this.options.state_cropData=o),this.options.state_selectedAnnotations={},this._updateVisualModule(n,"VisualLiveSearchResource")}},onAnnotationRemovedByUser:function(e,t,o){if(!this.options.state_lockFlashlightResults){this.options.state_lockFlashlightResults=!0;var n=o;if(n){var a=n.options.annotation;delete this.options.state_selectedAnnotations[a]}var r=null;r=this.options.state_cropData?{pin_id:this.options.state_cropData.pinId,crop:this.options.state_cropData.crop,text_filters:Object.keys(this.options.state_selectedAnnotations)}:{text_filters:this.options.state_selectedAnnotations},this._updateVisualModule(r,"VisualLiveSearchResource")}},onSelectAnnotation:function(e,t,o){if(!this.options.state_lockFlashlightResults){this.options.state_lockFlashlightResults=!0;var n=o;if(n){var a=n.options.annotation;this.options.state_selectedAnnotations[a]=!0}var r=null;r=this.options.state_cropData?{pin_id:this.options.state_cropData.pinId,crop:this.options.state_cropData.crop,text_filters:Object.keys(this.options.state_selectedAnnotations)}:{text_filters:this.options.state_selectedAnnotations},this._updateVisualModule(r,"VisualLiveSearchResource")}},onAnnotationAddedEnded:function(e,t,o){this.options.state_lockFlashlightResults=!1}}),P.modules.CloseupFlashlightResults.prototype.className="CloseupFlashlightResults",goog.provide("P.modules.CloseupLinkModule"),goog.require("P.Module"),P.modules.CloseupLinkModule=P.Module.extend({}),P.modules.CloseupLinkModule.prototype.className="CloseupLinkModule",goog.provide("P.modules.CloseupRelatedPins"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.resourceFactory");var u="annotationButton";P.modules.CloseupRelatedPins=P.Module.extend({events:{"click .moreRelatedPins":"switchToNextRelatedPinsSet"},getOwnedScrollables:function(){return"relatedPinsGrid"===this.options.view_type?this.$(".pinGridWrapper"):$()},onContentReady:function(){"relatedPinsGrid"!==this.options.view_type&&"slides"!==this.options.view_type&&this.destroyIfEmpty(),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onTypeClick),"slides"===this.options.view_type&&(this.currentSet=0,this.$relatedPinsSets=this.$(".relatedPinsBottom"),this.NUMBER_OF_RELATED_PIN_SETS=this.extraData.NUMBER_OF_RELATED_PIN_SETS,this.NUMBER_OF_PINS_PER_SET=this.extraData.NUMBER_OF_PINS_PER_SET)},switchToNextRelatedPinsSet:function(){var e=(this.currentSet+1)%this.NUMBER_OF_RELATED_PIN_SETS,t=this.$relatedPinsSets.children().eq(this.currentSet),o=t.children(),n=this.$relatedPinsSets.children().eq(e),a=n.children();t.fadeOut(300,function(){n.css("display","flex").show(),a.each(function(e){var t=$(this);setTimeout(t.removeClass.bind(t,"invisible"),100*(e+1))}),o.addClass("invisible")}),this.currentSet=e,P.util.trackRegisterAction("pin_closeup_more_related_pins_click")},isEmpty:function(){if(!this.contentReady)return!1;var e=this.getChildById("relatedPinsFeed");return!e||!e.hasItems()},getGrid:function(){return this.getChildById("relatedPinsFeed")},hideGrid:function(){this.getGrid().hide()},showGrid:function(){this.getGrid().show()},onTypeClick:function(e){var t=e.target;if(t.options.class_name===u&&!t.isActive()){_.each(this.getChildrenByModuleName("Button"),function(e){e.setActive(e===t)}),t.showLoading();var o=t.hideLoading.bind(t);t.options.annotation?this.showAnnotatedPins(t.options.annotation,o):this.showRelatedPins(o)}},showRelatedPins:function(e){this.updateRelatedPinsGrid(P.resourceFactory.instance.create("RelatedPinFeedResource",{pin:this.options.pin_id}),e)},showAnnotatedPins:function(e,t){this.updateRelatedPinsGrid(P.resourceFactory.instance.create("InterestsFeedResource",{interest:e}),t)},updateRelatedPinsGrid:function(e,t){var o=this.getGrid();this.$el.css("height",this.$el.height()),o.emptyItems(),o.setItemsResource(e);var n=function(){(t||function(){})(),this.$el.css("height","auto")}.bind(this);o.renderItems(n,n)}}),P.modules.CloseupRelatedPins.prototype.className="CloseupRelatedPins",goog.provide("P.modules.CloseupTitleCard"),goog.require("P.Module"),P.modules.CloseupTitleCard=P.Module.extend({}),P.modules.CloseupTitleCard.prototype.className="CloseupTitleCard",goog.provide("P.modules.ConfirmDialog"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.timer"),P.modules.ConfirmDialog=P.Module.extend({events:{"click .cancelButton":"onCloseClick","click .confirm":"onConfirmClick","change #confirmCheckbox":"onConfirmCheckboxChange"},returnData:null,onContentReady:function(){var e=this.$("form");e&&(this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(e,this.formConfig),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated));var t=this.options.auto_close_delay_ms;t&&this.closeOnDelay(t)},onConfirmCheckboxChange:function(){this.$("#confirmCheckbox").is(":checked")?this.$(".confirm").removeAttr("disabled"):this.$(".confirm").attr("disabled","disabled")},onSubmitValidated:function(e){e.errors[0]||(this.formData={},_.each(this.returnData,function(e){this.formData[e]=this.form.getValue(e)}.bind(this)),this.confirm())},onCloseClick:function(e){return this.triggerEvent(P.CONST.EVENT_DIALOG_BUTTON_CLICKED,e.currentTarget,!0),this.close(),!1},close:function(){this.triggerEvent(P.CONST.EVENT_CLOSE,this),this.destroy()},closeOnDelay:function(e){this.closeTimer&&clearTimeout(this.closeTimer),this.closeTimer=P.timer.setTimeout(function(){this.closeTimer=null,this.destroy()}.bind(this),e)},open:function(){this.triggerEvent(P.CONST.EVENT_OPEN,this)},onConfirmClick:function(e){return this.triggerEvent(P.CONST.EVENT_DIALOG_BUTTON_CLICKED,e.currentTarget,!0),this.confirm(),!1},confirm:function(){this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_CONFIRM,this,!0),this.destroy()},setPrimaryButtonText:function(e){this.$(".primary .buttonText").text(e)},onDestroyed:function(){this.closeTimer&&clearTimeout(this.closeTimer)}}),P.modules.ConfirmDialog.prototype.className="ConfirmDialog",goog.provide("P.modules.ContactTile"),goog.require("P.Module"),P.modules.ContactTile=P.Module.extend({}),P.modules.ContactTile.prototype.className="ContactTile",goog.provide("P.modules.ContactsList"),goog.require("P.Module"),P.modules.ContactsList=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_IMAGE_BLOCK_CLICKED,this.onListItemClick);var e={};e[P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED]=this.onSocialNetworkUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},onListItemClick:function(e){var t=$(e.target),o=e.data.network;if(o){var n={success:function(){t.parents("li").remove()}};P.SocialNetworkSettingsManager.instance().handleConnect(o,!0,n)}else this.triggerEvent(P.CONST.EVENT_CONTACT_SELECTED,e.data,!0)},onSocialNetworkUpdated:function(){this.renderExistingData()}}),P.modules.ContactsList.prototype.className="ContactsList",goog.provide("P.modules.ConversationEventMessage"),goog.require("P.Module"),P.modules.ConversationEventMessage=P.Module.extend({}),P.modules.ConversationEventMessage.prototype.className="ConversationEventMessage",goog.provide("P.modules.ConversationListItem"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.genConst"),goog.require("P.resourceFactory"),P.modules.ConversationListItem=P.Module.extend({events:{click:"onListItemClick"},CssClassName:{ACTIVE:"active",ANIMATING_OUT:"animatingOut",ANIMATED_OUT:"animatedOut",UNREAD:"unread"},onListItemClick:function(e){var t=this.getChildById("hideConversation");if(t){var o=$(e.target);if(o.closest(t.getContent()).length){var n={conversation_id:this.data.id};this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,!0,!0);var a=P.resourceFactory.instance.create("ConversationResource",n);a.callDelete({showError:!1});var r=this.$el;return r.addClass(this.CssClassName.ANIMATING_OUT),void r.one("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(){r.addClass(this.CssClassName.ANIMATED_OUT),window.setTimeout(function(){this.destroy(),this.remove(),this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,!1,!0),P.conversationsManager.instance.removeConversationById(this.data.id),P.conversationsManager.instance.logContextEvent(P.genConst.EventType.CONVERSATION_HIDE,this.data.id,null,r),this.data.unread>0&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,this.data.unread)}.bind(this),200)}.bind(this))}}var i=this.data;if(this.triggerEvent(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,i,!0),this.options.open_conversation_on_click){this.data.unread&&this.triggerEvent(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,null,!0),this.$el.removeClass(this.CssClassName.UNREAD);var s=this.getChildById("conversationHead").getContent();P.conversationsManager.instance.addConversation(i,!0,s),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}},setActive:function(e){this.$el.toggleClass(this.CssClassName.ACTIVE,e)},isActive:function(){return this.$el.hasClass(this.CssClassName.ACTIVE)},getUsers:function(){return this.data.users},getUserIds:function(){return _.pluck(this.getUsers(),"id")},getOtherUsers:function(){var e=this.getUsers();return _.reject(e,function(e){return e.id===P.user.instance.get("id")})},getEmails:function(){return this.data.emails},getFirstUser:function(){var e=this.getOtherUsers();return e.length>0?e[0]:{id:this.getEmails()[0]}}}),P.modules.ConversationListItem.prototype.className="ConversationListItem",goog.provide("P.modules.ConversationMessage"),goog.require("P.Module"),P.modules.ConversationMessage=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_PIN_DELETED,this.onAttachedObjectDeleted),this.childListen(P.CONST.EVENT_BOARD_DELETED,this.onAttachedObjectDeleted)},onAttachedObjectDeleted:function(e){this.$(".msgObjectSent").remove(),this.destroy()}}),P.modules.ConversationMessage.prototype.className="ConversationMessage",goog.provide("P.modules.ConversationMessages"),goog.require("P.Module"),goog.require("P.modules.ConversationMessage"),goog.require("P.ModuleRenderType"),goog.require("P.i18n"),goog.require("P.resourceFactory");var d=5;P.modules.ConversationMessages=P.Module.extend({CssClassName:{EMPTY:"empty",HAS_OBJECT:"hasObject"},onCreated:function(){this._clientMessages=[]},onContentReady:function(){this.triggerEvent(P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL,null,!0),this._lastMessage=this.data[this.data.length-1],this.resource.set("peek",!1)},appendTextMessage:function(e,t){var o=this._createMessageWrapper(),n={is_own_message:!0,text:e,pending:!0},a=new P.modules.ConversationMessage({options:n});a.render().then(function(){this._appendMessage(o,a),t&&t()}.bind(this))},_appendMessage:function(e,t){t.getContent().appendTo(e),e.appendTo(this.$el),this.removeEmptyState(),this._clientMessages.push(t)},removeEmptyState:function(){this.$(".emptyState").remove(),this.$el.removeClass(this.CssClassName.EMPTY)},_deleteClientMessage:function(e){if(!e.destroyed){var t=e.getParentElement();e.destroy(),t.remove()}},_deleteAllClientMessages:function(){this._clientMessages.forEach(function(e){this._deleteClientMessage(e)}.bind(this)),this._clientMessages=[]},deleteLastClientMessage:function(){this._deleteClientMessage(this._clientMessages[this._clientMessages.length-1]),this._clientMessages.pop()},_createMessageWrapper:function(){return $('<li class="messageWrapper"></li>')},getBottomPosition:function(e){var t=this.children[this.children.length-e],o=t.getContent(),n=o.parent(),a=n.position().top;return a},fetchPrevMessages:function(e,t,o){if(this.acquireRenderLock()){var n=function(){this.releaseRenderLock(),this.setPreventEmpty(!0),o&&o()}.bind(this);this.resetLastMessageTime(),this.renderAdditional(P.ModuleRenderType.PREPEND).then(e,t).fin(n)}},fetchNewMessages:function(e,t,o){if(this.acquireRenderLock()){var n=this.resource,a=P.resourceFactory.instance.clone(this.resource);a.resetBookmark(),this._lastMessage?(a.set("last_message_id",this._lastMessage.id),a.set("page_size",e+d)):a.set("page_size",e),a.set("peek",t||!1),this.setResource(a),this.setPreventEmpty(!0),this.setLastMessageTime(),this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.data.length&&(this._lastMessage=this.data[this.data.length-1]),this._deleteAllClientMessages(),o&&o()}.bind(this)).fin(function(){this.releaseRenderLock(),this.setResource(n)}.bind(this))}},setPreventEmpty:function(e){this.options.prevent_empty=e},setLastMessageTime:function(){this._lastMessage&&(this.options.last_message_time=this._lastMessage.created_at)},resetLastMessageTime:function(){this.options.last_message_time=0},renderMessages:function(e){this.acquireRenderLock()&&(this.setPreventEmpty(!0),this.resetLastMessageTime(),this.render().then(function(){this._deleteAllClientMessages(),e&&e()}.bind(this)).fin(function(){this.releaseRenderLock()}.bind(this)))},markMessagesAsRead:function(e){var t=P.resourceFactory.instance.clone(this.resource);t.resetBookmark(),t.set("page_size",e),t.set("peek",!1),t.callGet()},acquireRenderLock:function(){return this._rendering?!1:(this._rendering=!0,!0)},releaseRenderLock:function(){this._rendering=!1},appendObjectMessage:function(e,t){var o=$('<li class="messageWrapper"></li>'),n={is_own_message:!0,pending:!0},a=new P.modules.ConversationMessage({options:n});a.render().then(function(){this._appendMessage(o,a),a.getContent().append(e).addClass(this.CssClassName.HAS_OBJECT).appendTo(o),t&&t()}.bind(this))},updateTimestamps:function(){var e=this.getChildrenByModuleName("ConversationMessage");e.forEach(function(e){var t=e.getParentElement().next(".timeSeparator");t.length&&t.text(P.i18n.getHumanizedTimesince(e.data.created_at))})}}),P.modules.ConversationMessages.prototype.className="ConversationMessages",goog.provide("P.modules.ConversationPopup"),goog.require("P.modules.ConversationMessages"),goog.require("P.genConst"),goog.require("P.preventScrollMixin");var c=220,p=35;P.modules.ConversationPopup=P.Module.extend({mixins:[P.preventScrollMixin],events:{"click .convosHeader":"onHeaderClick"},CssClassName:{VISIBLE:"visible"},getConversationsManager:function(){return this.getParentByModuleName("ActiveConversations").getConversationsManager()},onCreated:function(){this._unseenMessageCount=0},onHeaderClick:function(){this.getConversationsManager().closeConversationById(this.options.id)},onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onInputEnterPressed),this.childListen(P.CONST.EVENT_TEXT_INPUT_RESIZED,this.onInputSizeChanged),this.childListen(P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL,this.onConversationMessagesReady),this.startPreventingScroll(),this.listen(this,P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN,this.onShownInDropdown),this.onMessagesScroll=this.onMessagesScroll.bind(this),this.onMessagesScroll=_.throttle(this.onMessagesScroll,200),this.scrollToLatest(),this._scrollListener=this.listen(this.getConversationMessagesList(),"scroll",this.onMessagesScroll)},onConversationMessagesReady:function(){this.options.peek&&this.data.unread&&(this._shouldMarkAsReadOnOpen=!0),this.showEmailSentIfNecessary(),this.scrollToLatest()},showEmailSentIfNecessary:function(){var e=this.data.emails||[],t=1===e.length&&e[0]===P.user.instance.get("email"),o=this.$(".ConversationMessage").length;
if(e.length>0&&!t&&o>0&&3>=o){var n=this.$(".emailSentText");n.show()}},getConversationMessagesList:function(){return this.$(".conversationMessagesList")},getConversationMessagesModule:function(){return this.getChildByModuleName("ConversationMessages")},onInputSizeChanged:function(e){if("textField"===e.target.id){var t=this.getChildById("textField").getHeight(),o=this.$(".messagesContainer");o.css("bottom",t+"px"),this.isScrolledToBottom()&&this.scrollToLatest()}},startPreventingScroll:function(){var e=this.getConversationMessagesModule();e&&this.startPreventScroll(this.getConversationMessagesList(),this.$(".messagesContent"))},_getSpinner:function(){return this.$(".spinner")},setUnseenMessageCount:function(e){this._unseenMessageCount=this._unseenMessageCount+e},onMessagesScroll:function(e){if(this._unseenMessageCount){var t=this.getConversationMessagesModule(),o=t.getBottomPosition(this._unseenMessageCount);o<=this.getConversationMessagesList().height()&&(this._unseenMessageCount=Math.max(this._unseenMessageCount-1,0),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,1),this.triggerEvent(P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE,null,!0))}if(this.getConversationMessagesList().scrollTop()<=c){this._getSpinner().addClass(this.CssClassName.VISIBLE);var n=this.getConversationMessagesModule(),a=n.getHeight();n.fetchPrevMessages(function(){var e=n.getHeight();e!==a&&(this.startPreventingScroll(),this.getConversationMessagesList().scrollTop(e-a))}.bind(this),null,function(){this._getSpinner().removeClass(this.CssClassName.VISIBLE)}.bind(this))}},onShownInDropdown:function(e){var t=this.$(".ConversationMessages");t.off("click",$.proxy(this._focusInput,this)),t.on("click",$.proxy(this._focusInput,this)),this.scrollToLatest();var o=this.getConversationMessagesModule();o&&(o.updateTimestamps(),this._shouldMarkAsReadOnOpen&&(o.markMessagesAsRead(this.data.unread),this._shouldMarkAsReadOnOpen=!1))},getDropTarget:function(){return this.$(".dropTarget")},scrollToLatest:function(){this.getConversationMessagesModule()&&(this.getConversationMessagesList().scrollTop(this.getConversationMessagesModule().getHeight()),this.startPreventingScroll())},setDropTargetText:function(e){var t=this.getDropTarget(),o=t.find("p");o.text(e)},focus:function(){return this._focusInput()},_focusInput:function(){var e=this.getChildById("textField");e&&e.focus()},onInputEnterPressed:function(e){e.stopPropagation();var t=$.trim(e.target.getValue());t.length&&(this.sendMessage(t,null),this.clearInput())},clearInput:function(){var e=this.getChildById("textField");e.setValue("")},showDropTarget:function(){this.getDropTarget().addClass(this.CssClassName.VISIBLE)},hideDropTarget:function(){this.getDropTarget().removeClass(this.CssClassName.VISIBLE)},sendMessage:function(e,t){if(e||!_.isEmpty(t)){var o=this.options.id,n={};if(e&&(n.text=e),t){var a=t.data;n.object_type=a.type,n.object_id=a.id}if(P.user.instance&&!P.user.instance.isWriteBanned()){var r=this.getConversationMessagesModule(),i=this.isScrolledToBottom()?this.scrollToLatest.bind(this):function(){};t?r.appendObjectMessage(t.getContent().clone(),i):r.appendTextMessage(e,i)}var s=this.getConversationsManager();s.sendMessageToConversation(o,n).then(function(){this.fetchNewMessages(1),this.focus(),s.logContextEvent(P.genConst.EventType.CONVERSATION_MESSAGE_SEND,o,t?t.data.id:null,this.$el)}.bind(this),function(e){this.getConversationMessagesModule().deleteLastClientMessage()}.bind(this))}},isScrolledToBottom:function(){var e=this.getConversationMessagesList(),t=this.getConversationMessagesModule(),o=e.scrollTop(),n=e.height(),a=t.getHeight(),r=o+n+p;return r>=a},fetchNewMessages:function(e,t){var o=this.getConversationMessagesModule();if(o){var n=this.isScrolledToBottom();t&&(this._shouldMarkAsReadOnOpen=!0),o.fetchNewMessages(e,t,function(){this.showEmailSentIfNecessary(),n?this.scrollToLatest():this.ensureScrollbarFlash()}.bind(this))}},ensureScrollbarFlash:function(){var e=this.getConversationMessagesList();e.flashScrollbar()},renderMessages:function(){var e=this.getConversationMessagesModule();e&&e.renderMessages(function(){this.showEmailSentIfNecessary(),this.scrollToLatest()}.bind(this))},onButtonClick:function(e){var t=e.target;("closeChatButton"===t.id||"joinToReplyButton"===t.id)&&(this.getConversationsManager().closeConversationById(this.options.id),e.stopPropagation())}}),P.modules.ConversationPopup.prototype.className="ConversationPopup",goog.provide("P.modules.ConversationsList"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.timer"),P.modules.ConversationsList=P.Module.extend({onCreated:function(){this._preventRenderOnChange=!1,this.childListen(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,this.onPreventConversationsRenderingOnChange),this.childListen(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,this.onUnreadListItemClick)},onPreventConversationsRenderingOnChange:function(e){this._preventRenderOnChange=e.data},onUnreadListItemClick:function(e){var t=e.target.data.id,o=this.model.getData(),n=_.find(o,function(e){return e.id===t});if(n){var a=_.indexOf(o,n);n.unread=0,o[a]=n;var r=o.slice(0);this.model.set(r),this.renderExistingData()}},onContentReady:function(){var e=!this.options.no_rerender;e&&!this.modelListener&&(this.modelUpdateHandler=_.debounce(this.onCollectionAddRemoveChange.bind(this),100),this.initialModel=this.model,this.modelListener=this.initialModel.on("add change remove",this.modelUpdateHandler)),this.data.length||this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY,null,!0)},onRemovedFromDom:function(){this.modelListener&&this.modelUpdateHandler&&this.model.off("add change remove",this.modelUpdateHandler)},onCollectionAddRemoveChange:function(e,t){this.options.no_rerender||this._preventRenderOnChange||this._fetchingMore||(this.model!==this.initialModel&&(this.model=this.initialModel,this.resource.resetBookmark()),this.renderExistingData())},setListItemWithUserId:function(e,t){var o=this.getChildById("list");if(o){var n=o.children;_.each(n,function(o,a){_.each(o.data.users,function(o){o.id===e&&n[a].setActive(t)}),_.each(o.data.emails,function(o){o===e&&n[a].setActive(t)})})}},fetchMore:function(){this._fetchingMore||this.resource.atEnd()||(this.resource.get("bookmarks")||this.resource.setBookmarks(P.conversationsManager.instance.getConversationsBookmarks()),this._fetchingMore=!0,this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){P.timer.setTimeout(function(){this._fetchingMore=!1}.bind(this),200)}.bind(this)))}}),P.modules.ConversationsList.prototype.className="ConversationsList",goog.provide("P.modules.ConversationsListDropdown"),goog.require("P.Module");var m="conversationList";P.modules.ConversationsListDropdown=P.Module.extend({onCreated:function(){this.onConversationsScroll=this.onConversationsScroll.bind(this),this.onConversationsScroll=_.throttle(this.onConversationsScroll,200)},onContentReady:function(){this._scrollListener=this.listen(this.$(".convosContent"),"scroll",this.onConversationsScroll)},onConversationsScroll:function(e){var t=$(e.target).scrollTop(),o=this._getList(),n=o.getHeight();n-t<=this.$(".convosContent").height()+10&&o.fetchMore()},_getList:function(){return this.getChildById(m)}}),P.modules.ConversationsListDropdown.prototype.className="ConversationsListDropdown",goog.provide("P.modules.CsrfErrorPage"),goog.require("P.Module"),P.modules.CsrfErrorPage=P.Module.extend({}),P.modules.CsrfErrorPage.prototype.className="CsrfErrorPage",goog.provide("P.modules.DeactivateAccount"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.validator"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.DeactivateAccount=P.Module.extend({events:{"change input":"onChange"},onContentReady:function(){var e={reason:[P.validator.Required()]};this.form=new P.Form(this.$("form"),e),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.submitButton=this.getChildById("submitButton"),this.submitButton.disable()},onButtonClick:function(e){var t=e.target;"deleteButton"===t.id&&this.deleteAccountConfirm()},onSubmitValidated:function(e){e.errors[0]||this.deactivateAccount()},onChange:function(e){this.submitButton.enable();var t=$(e.target);this._reason=t.attr("value"),this.hideShowDetails()},hideAll:function(){this.$(".hiddenText").hide(),this.$(".hiddenTextArea").hide()},hideShowDetails:function(){switch(this.hideAll(),this._reason){case"emails":this.$("#emailSettings").show();break;case"other":this.$("#otherText").show();break;case"hacked":this.$("#resetPassword").show();break;case"noInterestingPins":this.$("#explore").show(),this.$("#exploreBox").show();break;case"break":this.$("#access").show();break;case"secondAccount":this.$("#infoMultipleAccounts").show();break;case"businessAccountWanted":this.$("#businessLink").show();break;case"dislike":this.$("#dislikeText").show(),this.$("#dislikeBox").show();break;case"understand":this.$("#understandText").show(),this.$("#understandBox").show();break;case"privacy":this.$("#privacyText").show(),this.$("#privacyBox").show()}},deactivateAccount:function(){this.submitButton.showLoading();var e={user_id:P.user.instance.id,reason:this.$('input:radio[name="reason"]:checked').val()};"other"===e.reason?e.explanation=this.$('textarea[name="otherText"]').val():"privacy"===e.reason?e.explanation=this.$('textarea[name="privacyTextBox"]').val():"dislike"===e.reason?e.explanation=this.$('textarea[name="dislikeTextBox"]').val():"explore"===e.reason?e.explanation=this.$('textarea[name="exploreTextBox"]').val():"understand"===e.reason&&(e.explanation=this.$('textarea[name="understandTextBox"]').val());var t=P.user.instance.get("email"),o={name:"ConfirmDialog",options:{template:"deactivate_account_success",view_type:"mediumWide",email:t}},n=P.resourceFactory.instance.create("DeactivateAccountResource",e);n.callCreate().fin(function(e){P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(e,P.CONST.EVENT_DESTROYED,this.successCancel)}.bind(this))}.bind(this)).fail(function(e){P.errorUtil.showError(e.message)}).always(function(e){this.submitButton.hideLoading()}.bind(this))},successCancel:function(){this.navigate("/"),this.destroy()},deleteAccountConfirm:function(){var e={name:"ConfirmDialog",options:{email:P.user.instance.get("email"),is_partner:P.user.instance.get("is_partner"),template:"delete_account_confirm",view_type:"mediumWide"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(e,P.CONST.EVENT_CONFIRM,this.deleteAccount)}.bind(this))},deleteAccount:function(){var e={name:"ConfirmDialog",options:{template:"delete_account_success",view_type:"mediumWide"}},t={user_id:P.user.instance.id},o=P.resourceFactory.instance.create("DeleteAccountResource",t);o.callUpdate().fin(function(t){P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.destroy),this.listen(e,P.CONST.EVENT_DESTROYED,this.successCancel)}.bind(this))}.bind(this)).fail(function(e){P.errorUtil.showError(e.message)})}}),P.modules.DeactivateAccount.prototype.className="DeactivateAccount",goog.provide("P.modules.DiscoverFriends"),goog.require("P.Module"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),P.modules.DiscoverFriends=P.Module.extend({onCreated:function(){this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this._onAnchorLinkSelected)},onContentReady:function(){this.$menu=this.$(".friendsMenu"),this.$menuFiller=this.$(".friendsMenuFiller"),this.$menuFiller.hide()},_calculateTopOffsets:function(){this.initialMenuTop=this._getMenuTopPosition(),this.minimumMenuTop=this.$(".header").position().top},_getCurrentScrollTop:function(){return this.getScrollableElement().scrollTop()},_getMenuTopPosition:function(){var e=this.$menu.position();return e&&e.top?e.top:0},_onScroll:function(){var e=this._getCurrentScrollTop();this.initialMenuTop||this._calculateTopOffsets();var t=this.initialMenuTop-e;t<this.minimumMenuTop?this.$menu.hasClass("fixed")||(this.$menu.addClass("fixed"),this.$menuFiller.show()):this.$menu.hasClass("fixed")&&(this.$menu.removeClass("fixed"),this.$menuFiller.hide())},_onAnchorLinkSelected:function(e){var t=e.data.id;if(t){var o={event_type:P.genConst.EventType.ANCHOR_LINKS_VIEW,element:e.data.element_type},n=P.context.instanceEvent.fromPlainObject(o);P.context.instanceLogger.getInstance().addEvent(n)}}}),P.modules.DiscoverFriends.prototype.className="DiscoverFriends",goog.provide("P.modules.DiscoveryTile"),goog.require("P.Module"),P.modules.DiscoveryTile=P.Module.extend({events:{"click .dismiss":"onDismissClick"},onDismissClick:function(e){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}}),P.modules.DiscoveryTile.prototype.className="DiscoveryTile",goog.provide("P.modules.Domain"),goog.require("P.Module"),P.modules.Domain=P.Module.extend({getLoggingObjectIdStr:function(){return this.data.id}}),P.modules.Domain.prototype.className="Domain",goog.provide("P.modules.DomainFeedPage"),goog.require("P.Module"),P.modules.DomainFeedPage=P.Module.extend({onContentReady:function(){this.checkGridContent()},checkGridContent:function(){var e=this.getChildById("feedGrid");e&&!e.hasItems()&&this.$(".noData").show()}}),P.modules.DomainFeedPage.prototype.className="DomainFeedPage",goog.provide("P.modules.DomainVerify"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.DomainVerify=P.Module.extend({events:{"click .helpText a":"onClickType","click .downloadLink":"onClickDownload"},onCreated:function(){this.METATAG="metatag",this.FILENAME="filename",this.verificationType=this.METATAG},onContentReady:function(){this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),[]),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.downloadButton=this.getChildById("downloadButton"),this.downloadButton&&this.listen(this.downloadButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickDownload)},onClickType:function(){this.swapVerificationType()},onClickDownload:function(){P.util.downloadFile("/website/verify/download/")},onSubmitValidated:function(e){e.errors[0]||this.verifyDomain()},swapVerificationType:function(){this.$(".filename, .metaTag").toggle(),this.verificationType===this.METATAG?this.verificationType=this.FILENAME:this.verificationType=this.METATAG},verifyDomain:function(){var e=this.getChildById("submitButton");e.showLoading();var t=P.user.instance.attributes.domain_url,o=P.i18n._("Looks like we had trouble connecting to your website. Please try again later."),n=P.resourceFactory.instance.create("DomainVerifyResource",{type:this.verificationType}),a=P.resourceFactory.instance.create("DomainResource",{field_set_key:"owner",domain:t});return n.callUpdate().then(function(){return a.callGet({retries:2,retryAfter:1e3,showError:!1})},function(){P.errorUtil.showError(o)}).then(function(){return this.isInModal()?(P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_USER_UPDATED),P.pubSub.instance.publish(P.user.instance.attributes.id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),this.destroy()):this.navigate("/"),!0}.bind(this),function(){var e=P.i18n._("We're still working on confirming your site. Please sit tight, sometimes it takes up to an hour.");P.errorUtil.showError(e)}).fin(function(){e.hideLoading()})}}),P.modules.DomainVerify.prototype.className="DomainVerify",goog.provide("P.modules.DomainVerifyByLink"),goog.require("P.Module"),goog.require("P.genConst"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.genConst"),P.modules.DomainVerifyByLink=P.Module.extend({onContentReady:function(){var e="",t,o="",n="";null!==this.options.domain?(e=P.string.format(P.i18n._("Congratulations! Check out your analytics page to see how  popular your Pins are on Pinterest.")),o=P.i18n._("Go To Analytics"),n=P.i18n._("Website verified")):(e=P.string.format(P.i18n._("Oops! We weren't able to verify your website. Write to us at the help center for more information.")),o=P.i18n._("Go to the help center"),n=P.i18n._("Trouble verifying your website")),t={name:"ConfirmDialog",options:{body_message:e,button_text:o,template:"generic",title:n}},P.moduleFactory.load(t).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.onConfirmClick)}.bind(this))},onConfirmClick:function(){var e="";e=null===this.options.domain?"/_/_/help/":P.genConst.Settings.ANALYTICS_SITE_URL,this.navigate(e)}}),P.modules.DomainVerifyByLink.prototype.className="DomainVerifyByLink",goog.provide("P.modules.DrawerNav"),goog.require("P.Module"),P.modules.DrawerNav=P.Module.extend({onContentReady:function(){}}),P.modules.DrawerNav.prototype.className="DrawerNav",goog.provide("P.modules.DrawerSideNav"),goog.require("P.Module"),P.modules.DrawerSideNav=P.Module.extend({}),P.modules.DrawerSideNav.prototype.className="DrawerSideNav",goog.provide("P.modules.Dropdown2"),goog.require("P.dom"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.Dropdown2=P.Module.extend({CssClassName:{VISIBLE:"visible"},onCreated:function(){this._renderedContent=!1},initHovering:function(){},slideIn:function(){return this.show()},render:function(){return Promise.resolve()},show:function(){return this.$el.insertBefore(this.options.anchor),this.$el.addClass(this.CssClassName.VISIBLE),this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0),this._removeBodyListener(),this._bodyListener=this.listen($(document),"mousedown",this._onMouseDown),this._renderedContent?Promise.resolve():(this._renderedContent=!0,P.moduleFactory.load(this.options.module).then(function(e){this.appendChild(e),e.render().then(function(){P.dom.deferDomManipulation(function(){e.focus()})})}.bind(this)))},hide:function(){this._removeBodyListener(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),this.$el.removeClass(this.CssClassName.VISIBLE)},_removeBodyListener:function(){this._bodyListener&&(this.removeListener(this._bodyListener),this._bodyListener=null)},_onMouseDown:function(e){e.preventDefault(),e.stopPropagation();var t=this.options.mouse_close_mode;switch(t){case"never":break;case"always":this.hide();break;default:var o=$(e.target).closest(this.$el).length>0||$(e.target).closest(this.options.anchor).length>0;o||this.hide()}},getContentModule:function(){return this.children[0]},isVisible:function(){return this.$el.hasClass(this.CssClassName.VISIBLE)},hideDropdown:function(){},showDropdown:function(){}}),P.modules.Dropdown2.prototype.className="Dropdown2",goog.provide("P.modules.Echo"),goog.require("P.Module"),P.modules.Echo=P.Module.extend({}),P.modules.Echo.prototype.className="Echo",goog.provide("P.modules.Editorial"),goog.require("P.Module"),P.modules.Editorial=P.Module.extend({}),P.modules.Editorial.prototype.className="Editorial",goog.provide("P.modules.EmailContact"),goog.require("P.Module"),P.modules.EmailContact=P.Module.extend({events:{"click .check":"_onClickCheck",click:"_onClick"},CssClassName:{DISABLED:"disabled"},_onClickCheck:function(e){e.stopPropagation()},_onClick:function(){this.getChildById("check").setChecked(!this.isChecked(),!0)},setChecked:function(e){this.getChildById("check").setChecked(e,!1)},isChecked:function(){return this.getChildById("check").isChecked()},setDisabled:function(e){this.getChildById("check").setDisabled(e,!1),$(this.el).toggleClass(this.CssClassName.DISABLED,e)},getEmail:function(){return this.options.email_contact.id}}),P.modules.EmailContact.prototype.className="EmailContact",goog.provide("P.modules.EmailInviteMerchandising"),goog.require("P.Module"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),P.modules.EmailInviteMerchandising=P.Module.extend({events:{"click .seeAllFriends":"_onSeeAllFriendsClick"},onCreated:function(){this.inviteSrc=this.options.invite_src||"homefeed_invite_merch",this.addFriendsURL=P.genConst.Settings.FRIEND_CENTER_ADD_FRIENDS_URL+"?invite_src="+this.inviteSrc},onContentReady:function(){this.childListen(P.CONST.EVENT_DISMISS,this._onDismiss),this.childListen(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,this._onSocialNetworkConnect);var e={};e[P.CONST.PUBSUB_TOPIC_FRIEND_IMPORT_COMPLETED]=this._handleFriendImportCompleted,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),e[P.CONST.PUBSUB_TOPIC_VIEW_EVENT_INITIALIZED]=this._logMerchandisingViewEvent,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING,e),this._onContactsChange()},_onContactsChange:function(){var e=this.$(".content .list");0===e.children().length&&this._onNoContacts()},_onNoContacts:function(){this.$(".upsell").addClass("slideIn")},_logMerchandisingViewEvent:function(){var e={event_type:P.genConst.EventType.VIEW_DISCOVER_FRIEND_MERCHANDISING,view_type:P.genConst.ViewType.FEED,view_parameter:P.genConst.ViewParameterType.FEED_HOME,component:P.genConst.ComponentType.DISCOVER_FRIEND_MERCHANDISING_INVITE_FRIENDS},t=P.context.instanceEvent.fromPlainObject(e);P.context.instanceLogger.getInstance().addEvent(t)},_onSocialNetworkConnect:function(e){this.showLoading(!0,this.$(".upsell"));var t=e.data.network,o=P.SocialNetworkSettingsManager.instance(),n={username:P.user.instance.attributes.username},a={resourceOptions:n};o.pollForFriends(t,a)},_handleFriendImportCompleted:function(e,t,o){this.hideLoading(),o.error||this._redirectToFriendCenter()},_redirectToFriendCenter:function(){this.navigate(this.addFriendsURL,this.$el,P.genConst.ForceRefreshType.PAGE,{})},_onSeeAllFriendsClick:function(e){this._redirectToFriendCenter()},_onDismiss:function(e){"contact"===e.target.id&&(e.target.destroy(),this._onContactsChange())}}),P.modules.EmailInviteMerchandising.prototype.className="EmailInviteMerchandising",goog.provide("P.modules.EmailVerificationError"),goog.require("P.Module"),P.modules.EmailVerificationError=P.Module.extend({}),P.modules.EmailVerificationError.prototype.className="EmailVerificationError",goog.provide("P.modules.Embed"),goog.require("P.Module"),P.modules.Embed=P.Module.extend({onContentReady:function(){$("head").append($("<script></script>").attr({async:!0,src:"//assets.pinterest.com/js/pinit.js"}));var e=this.$(".sampleCode textarea");e.focus(),e.select()}}),P.modules.Embed.prototype.className="Embed",goog.provide("P.modules.EmbedBoard"),goog.require("P.modules.Embed"),P.modules.EmbedBoard=P.modules.Embed.extend({}),P.modules.EmbedBoard.prototype.className="EmbedBoard",goog.provide("P.modules.EmbedPinner"),goog.require("P.modules.Embed"),P.modules.EmbedPinner=P.modules.Embed.extend({}),P.modules.EmbedPinner.prototype.className="EmbedPinner",goog.provide("P.modules.EmptyConversations"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.EmptyConversations=P.Module.extend({onContentReady:function(){var e=this.getChildrenByModuleName("ConversationHead");_.each(e,function(e){this.listen(e,P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,this.onConversationHeadClick)}.bind(this)),(!this.data||this.data.length<3)&&this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS,null,!0)},onConversationHeadClick:function(e){var t=e.target;t.showLoading();var o=t.getUserIds(),n=P.resourceFactory.instance.create("ConversationsResource",{user_ids:o});n.callCreate().then(function(e){var o=e.resource_response.data;P.conversationsManager.instance.addConversation(o),t.hideLoading(),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.render()}.bind(this))}}),P.modules.EmptyConversations.prototype.className="EmptyConversations",goog.provide("P.modules.EmptyHomeFeedFallback"),goog.require("P.Module"),P.modules.EmptyHomeFeedFallback=P.Module.extend({}),P.modules.EmptyHomeFeedFallback.prototype.className="EmptyHomeFeedFallback",goog.provide("P.modules.EmptyStateCard"),goog.require("P.Module");var h={FOOTER:"footer",HEADER:"header",CENTER_CONTENT:".centerContent",ACTION_BUTTON:".actionButton"};P.modules.EmptyStateCard=P.Module.extend({_hideItem:function(e){this.$el.find(e).hide()},_showItem:function(e){this.$el.find(e).show()},_setVisibility:function(e,t){return t?this._showItem(e):this._hideItem(e)},setHeaderIsVisible:function(e){var t=h.HEADER;this._setVisibility(t,e)},setCenterContentIsVisible:function(e){var t=h.CENTER_CONTENT;this._setVisibility(t,e)},setFooterIsVisible:function(e){var t=h.FOOTER;this._setVisibility(t,e)},setActionButtonIsVisible:function(e){var t=h.ACTION_BUTTON;this._setVisibility(t,e)}}),P.modules.EmptyStateCard.prototype.className="EmptyStateCard",goog.provide("P.modules.EmptyStateCardProfileBoards"),goog.require("P.modules.EmptyStateCard"),P.modules.EmptyStateCardProfileBoards=P.modules.EmptyStateCard.extend({}),P.modules.EmptyStateCardProfileBoards.prototype.className="EmptyStateCardProfileBoards",goog.provide("P.modules.EmptyStateCardProfileFollowers"),goog.require("P.modules.EmptyStateCard"),P.modules.EmptyStateCardProfileFollowers=P.modules.EmptyStateCard.extend({}),P.modules.EmptyStateCardProfileFollowers.prototype.className="EmptyStateCardProfileFollowers",goog.provide("P.modules.EmptyStateCardProfileFollowing"),goog.require("P.modules.EmptyStateCard"),P.modules.EmptyStateCardProfileFollowing=P.modules.EmptyStateCard.extend({}),P.modules.EmptyStateCardProfileFollowing.prototype.className="EmptyStateCardProfileFollowing",goog.provide("P.modules.EuCookieBar"),goog.require("P.Module"),P.modules.EuCookieBar=P.Module.extend({events:{"click .cookieButton":"onClickGotIt","click .learnMore":"onClickLearnMore","click .privacyPolicy":"onClickPrivacy"},onClickGotIt:function(e){P.user.instance.isAuthenticated()?(P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_EU_COOKIE_BANNER),P.util.trackRegisterAction("auth_eu_cookie_banner_dismissed")):(Cookie.set(P.CONST.COOKIE_SUPPRESS_EU_COOKIE_BANNER,"true"),P.util.trackRegisterAction("unauth_eu_cookie_banner_dismissed")),this.hide()},onClickLearnMore:function(e){P.user.instance.isAuthenticated()?P.util.trackRegisterAction("auth_eu_cookie_banner_learnmore"):P.util.trackRegisterAction("unauth_eu_cookie_banner_learnmore")},onClickPrivacy:function(e){P.util.trackRegisterAction("auth_eu_cookie_banner_privacy")}}),P.modules.EuCookieBar.prototype.className="EuCookieBar",goog.provide("P.modules.EvalFeedPage"),goog.require("P.Module"),P.modules.EvalFeedPage=P.Module.extend({}),P.modules.EvalFeedPage.prototype.className="EvalFeedPage",goog.provide("P.modules.FBOCloseupMweb"),goog.require("P.Module");var g=60,f=200;P.modules.FBOCloseupMweb=P.Module.extend({onContentReady:function(){this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),this.$closeupContainer=this.$(".closeupContainer"),this.scrollElement=this.getScrollableElement(),this.$facebookActionBar=this.$(".FacebookShareActionBar"),this.$facebookShareBanner=this.$(".FacebookShareBanner"),P.context.instance.is_mobile_agent&&this.extraData&&this.extraData.fb_browser_upsell_share&&["enabled","employee"].indexOf(P.experiments.instance.v2GetGroup("fb_browser_upsell_pin_share"))&&this.$closeupContainer.css("margin-top","130px")},getPin:function(){return this.getChildByModuleName("Pin")},_onScroll:function(){var e=this.scrollElement.scrollTop();e>g?(this.$facebookActionBar.addClass("fbShareActionBarDocked"),this.$closeupContainer.addClass("dock"),e>f&&(this.$facebookShareBanner.fadeIn(300),this.$facebookActionBar.fadeOut(300))):f>e&&(this.$facebookShareBanner.fadeOut(300),this.$facebookActionBar.fadeIn(300),g>e&&(this.$facebookActionBar.removeClass("fbShareActionBarDocked"),this.$closeupContainer.removeClass("dock")))}}),P.modules.FBOCloseupMweb.prototype.className="FBOCloseupMweb",goog.provide("P.modules.FBOPinListContainerWeb"),goog.require("P.Module"),P.modules.FBOPinListContainerWeb=P.Module.extend({getPin:function(){var e=this.getChildByModuleName("FBOPinListWeb");return e.getPin()}}),P.modules.FBOPinListContainerWeb.prototype.className="FBOPinListContainerWeb",goog.provide("P.modules.FBOPinListHeaderWeb"),goog.require("P.Module"),P.modules.FBOPinListHeaderWeb=P.Module.extend({}),P.modules.FBOPinListHeaderWeb.prototype.className="FBOPinListHeaderWeb",goog.provide("P.modules.FBOPinListPinWeb"),goog.require("P.Module"),P.modules.FBOPinListPinWeb=P.Module.extend({events:{"click .roundedPin a":"onClickRoundedPin","click .source a":"onClickSource","click .pinner a":"onClickPinner"},onClickRoundedPin:function(){return P.util.trackRegisterAction("pinlist_rounded_pin"),!1},onClickSource:function(){return P.util.trackRegisterAction("pinlist_source"),!1},onClickPinner:function(){return P.util.trackRegisterAction("pinlist_pinner"),!1}}),P.modules.FBOPinListPinWeb.prototype.className="FBOPinListPinWeb",goog.provide("P.modules.FBOPinListSideBarWeb"),goog.require("P.Module"),P.modules.FBOPinListSideBarWeb=P.Module.extend({events:{"click .trendingStoryLink":"onClickStory"},onClickStory:function(e){return P.util.trackRegisterAction("pinlist_trending_story"),this._logContextEvent(e),!1}}),P.modules.FBOPinListSideBarWeb.prototype.className="FBOPinListSideBarWeb",goog.provide("P.modules.FBOPinListWeb"),goog.require("P.Module"),P.modules.FBOPinListWeb=P.Module.extend({getPin:function(){return this.getChildByModuleName("PaddedPin")}}),P.modules.FBOPinListWeb.prototype.className="FBOPinListWeb",goog.provide("P.modules.FBOTrendingImageWeb"),goog.require("P.Module"),P.modules.FBOTrendingImageWeb=P.Module.extend({}),P.modules.FBOTrendingImageWeb.prototype.className="FBOTrendingImageWeb",goog.provide("P.modules.FacebookContact"),goog.require("P.Module"),P.modules.FacebookContact=P.Module.extend({events:{click:"_onClick"},_onClick:function(e){this.getChildById("invite").showLoading(),P.Invite.userInviteFacebook(this.options.facebook_contact.id,this._onInvite.bind(this))},_onInvite:function(e){this.getChildById("invite").hideLoading(),e&&this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)}}),P.modules.FacebookContact.prototype.className="FacebookContact",goog.provide("P.modules.FacebookShareActionBar"),goog.require("P.Module"),P.modules.FacebookShareActionBar=P.Module.extend({}),P.modules.FacebookShareActionBar.prototype.className="FacebookShareActionBar",goog.provide("P.modules.FacebookShareActionBarUpsellExp"),goog.require("P.Module"),P.modules.FacebookShareActionBarUpsellExp=P.Module.extend({}),P.modules.FacebookShareActionBarUpsellExp.prototype.className="FacebookShareActionBarUpsellExp",goog.provide("P.modules.FacebookShareBanner"),goog.require("P.Module"),P.modules.FacebookShareBanner=P.Module.extend({}),P.modules.FacebookShareBanner.prototype.className="FacebookShareBanner",goog.provide("P.modules.FacebookShareButton"),goog.require("P.FbUtil"),goog.require("P.genConst"),goog.require("P.modules.Button"),P.modules.FacebookShareButton=P.modules.Button.extend({onClick:function(){return P.user.instance.isWriteBanned()?P.writeban.showWriteBanned(this):(P.FbUtil.shareFb({object_id:this.options.object_id,object_type:this.options.object_type,dialog_options:this.options.dialog_options,ga_category:this.options.ga_category}),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)),!1}}),P.modules.FacebookShareButton.prototype.className="FacebookShareButton",goog.provide("P.modules.FacebookShareButtonExp"),goog.require("P.FbUtil"),goog.require("P.Module"),P.modules.FacebookShareButtonExp=P.Module.extend({events:{click:"onClick"},onClick:function(e){return P.util.trackRegisterAction("facebook_share_exp_"+this.options.log_element_type),this._logContextEvent(e),P.user.instance.isWriteBanned()?P.writeban.showWriteBanned(this):(P.FbUtil.shareFb({object_id:this.options.object_id,
object_type:this.options.object_type,dialog_options:this.options.dialog_options,ga_category:this.options.ga_category}),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)),!1}}),P.modules.FacebookShareButtonExp.prototype.className="FacebookShareButtonExp",goog.provide("P.modules.FacebookShareNag"),goog.require("P.Module"),P.modules.FacebookShareNag=P.Module.extend({onContentReady:function(){this.$facebookShareNagContainer=this.$(".facebookShareNagContainer"),this.$facebookShareNagContainer.delay(2e3).fadeIn(500)}}),P.modules.FacebookShareNag.prototype.className="FacebookShareNag",goog.provide("P.modules.FacebookShareUnauthCloseupWeb"),goog.require("P.Module"),P.modules.FacebookShareUnauthCloseupWeb=P.Module.extend({getPin:function(){return this.getChildByModuleName("Pin")}}),P.modules.FacebookShareUnauthCloseupWeb.prototype.className="FacebookShareUnauthCloseupWeb",goog.provide("P.modules.FastFollowHeader"),goog.require("P.Module");var b="followPageProgress";P.modules.FastFollowHeader=P.Module.extend({stepProgress:function(e){var t=this.getChildById(b);t&&t.moveStep(e)}}),P.modules.FastFollowHeader.prototype.className="FastFollowHeader",goog.provide("P.modules.FastFollowSidebar"),goog.require("P.Module"),P.modules.FastFollowSidebar=P.Module.extend({events:{"click .followPageSidebarCategory":"onCategoryClick"},CssClassName:{EXPAND:"expand",SELECTED:"selected"},onCreated:function(){var e={};e[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.toggleShowMoreCategories)},onCategoryClick:function(e){var t=$(e.currentTarget);if(t.length){var o=t.attr("data-category");o.length&&(this.highlightCategory(o),this.triggerEvent(P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED,o,!0))}},onSearchQueryUpdated:function(e,t,o){var n=o||"";this.unhighlightCategory(),this.triggerEvent(P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED,n,!0)},unhighlightCategory:function(){this.$("."+this.CssClassName.SELECTED).removeClass(this.CssClassName.SELECTED)},highlightCategory:function(e){this.unhighlightCategory(),this.$("[data-category="+e+"]").addClass(this.CssClassName.SELECTED)},toggleShowMoreCategories:function(e){return this.$el.toggleClass(this.CssClassName.EXPAND),!1}}),P.modules.FastFollowSidebar.prototype.className="FastFollowSidebar",goog.provide("P.modules.FeedPage"),goog.require("P.Module"),P.modules.FeedPage=P.Module.extend({onAddedToDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY,this.options.feed)},_resetCategory:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY,null)},onRemoved:function(){this._resetCategory()},onEmpty:function(){this._resetCategory()}}),P.modules.FeedPage.prototype.className="FeedPage",goog.provide("P.modules.Field"),goog.require("P.Module"),P.modules.Field=P.Module.extend({events:{"focus input":"onInputFocus","blur input":"onInputBlur","keyup input":"onInputKeyup","keydown input":"onInputKeydown","textchange input":"onTextchange"},onContentReady:function(){this.$input=this.$("input"),this._value=this.options.value||"",this._field=this.getChildById("input"),this.options.currency_symbol&&this.formatAsCurrency()},onInputFocus:function(e){if(this.options.currency_symbol){var t=$(e.currentTarget);t.length&&t.val((this._value||"").toString())}},onInputBlur:function(e){this.options.currency_symbol&&this.formatAsCurrency()},formatAsCurrency:function(){if(this.$input.length){var e=this.$input.val(),t=parseFloat(e),o=P.number.quantize(t,2);this._value=o,this.$input.val(o?o.toFixed(2):e)}},disable:function(){this.$input.attr({disabled:""})},enable:function(){this.$input.removeAttr("disabled")},isDisabled:function(){return this.$input.is(":disabled")},onInputKeydown:function(e){},onInputKeyup:function(e){},onTextchange:function(e){this.triggerEvent(P.CONST.EVENT_INPUT_TEXT_CHANGED,{value:this._field.getValue()},!0)},setValue:function(e){this._field.setValue(e),this.options.currency_symbol&&(this._value=e)},getValue:function(){return this.options.currency_symbol?this._value.toString()||"0":this._field.getValue()},setPlaceholder:function(e){this.$input.attr("placeholder",e)}}),P.modules.Field.prototype.className="Field",goog.provide("P.modules.FillHomeFeed"),goog.require("P.Module"),P.modules.FillHomeFeed=P.Module.extend({}),P.modules.FillHomeFeed.prototype.className="FillHomeFeed",goog.provide("P.modules.FindFriendsContent"),goog.require("P.Module"),goog.require("P.ExperienceManager"),goog.require("P.SocialConnect"),P.modules.FindFriendsContent=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),P.ExperienceManager.instance.refreshPlacedExperiences()},onButtonClick:function(e){var t=e.target,o=null;switch(t.id){case"facebookConnectButton":o=P.SocialConnect.FACEBOOK;break;case"twitterConnectButton":o=P.SocialConnect.TWITTER;break;default:return}this.startNetworkConnect(o)},getGrid:function(){return this.getChildById("friendGrid")},startNetworkConnect:function(e){var t;switch(e){case P.SocialConnect.FACEBOOK:t=this.getChildById("facebookConnectButton");break;case P.SocialConnect.TWITTER:t=this.getChildById("twitterConnectButton");break;default:return}t.showLoading();var o=P.SocialNetworkSettingsManager.instance(),n={success:function(){var n=_.isUndefined(this.options.exclude_following)?!0:this.options.exclude_following,a={username:this.options.username,exclude_following:n},r={success:function(o){t.hideLoading(),this.resource=o,this.render().then(function(){this.triggerEvent(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,{network:e},!0)}.bind(this))}.bind(this),error:function(){t.hideLoading(),this.hideLoading(),this.render()}.bind(this),resourceOptions:a};o.pollForFriends(e,r)}.bind(this),error:function(){t.hideLoading(),this.hideLoading()}.bind(this)};o.handleConnect(e,!0,n)}}),P.modules.FindFriendsContent.prototype.className="FindFriendsContent",goog.provide("P.modules.FindFriendsNotConnected"),goog.require("P.Module"),P.modules.FindFriendsNotConnected=P.Module.extend({}),P.modules.FindFriendsNotConnected.prototype.className="FindFriendsNotConnected",goog.provide("P.modules.FindFriendsRep"),goog.require("P.Module"),P.modules.FindFriendsRep=P.Module.extend({events:{click:"onClick"},onClick:function(e){P.user.instance.isLimitedLogin()&&(e.stopPropagation(),e.preventDefault(),P.limitedLogin.showLogin(this))}}),P.modules.FindFriendsRep.prototype.className="FindFriendsRep",goog.provide("P.modules.FindFriendsWhosHere"),goog.require("P.Module"),P.modules.FindFriendsWhosHere=P.Module.extend({}),P.modules.FindFriendsWhosHere.prototype.className="FindFriendsWhosHere",goog.provide("P.modules.FlagBase"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.validator"),P.modules.FlagBase=P.Module.extend({events:{"change input":"onReportReasonSelected"},CssClassName:{CLASS_VISIBLE:"visible"},ModuleName:{BLOCK_AND_UNFOLLOW_FORM:"BlockAndUnfollowForm"},onContentReady:function(){var e=this.getChildById("nextButton");e&&(e.disable(),this.listen(e,P.CONST.EVENT_BUTTON_CLICK,this.onNextStep));var t=this.getChildById("backButton");t&&this.listen(t,P.CONST.EVENT_BUTTON_CLICK,this.onBackStep);var o=this.$("form"),n={reason:[P.validator.Required()]},a={prevalidate:!0};this.form=new P.Form(o,n,a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(e){if(!e.errors[0]){var t=this.$("form :checked"),o=t.attr("value"),n=t.data("category"),a=this.getNextModalName(t),r=this.isAgainstPolicies(n),i=this.isReportingPin(o,n),s=_.extend({},this.options);s.flagReasonCategory=n,s.flagReason=o,s.isAgainstPolicies=r,s.isReportingPin=i,s.detailedReasons?s.detailedReasons.push(o):s.detailedReasons=[o],this.flag(a,s)}},onReportReasonSelected:function(){var e=this.$("form :checked"),t=e.length?e.attr("value"):"",o=this._getProceedButton(e);"nextButton"===o.id?this.getChildById("submitButton").hide():this.getChildById("nextButton").hide(),o.show(),o.enable(),this.showPolicyLinkeBaseOnReason(t)},showPolicyLinkeBaseOnReason:function(e){var t=["nudity","hurtfulContent","gore"],o=t.indexOf(e);-1!==o&&(this.$(".helpText > .visible").toggleClass(this.CssClassName.CLASS_VISIBLE,!1),this.$(".helpText").children().eq(o).toggleClass(this.CssClassName.CLASS_VISIBLE,!0))},showNextModal:function(e,t){var o={name:e,options:t};e===this.ModuleName.BLOCK_AND_UNFOLLOW_FORM?(o.resource=this.getResource(),this.addContentSpecificModalOptions(o.options)):e===this.ModuleName.CONFIRM_DIALOG&&(o.options.template="block_and_unfollow",o.options.fluid=!0),P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.destroy()}.bind(this))},addContentSpecificModalOptions:function(e){},onNextStep:function(e){var t=this.$("form :checked"),o=t.attr("value"),n=this.getNextModalName(t),a=_.extend({},this.options);a.flagReason=o,a.detailedReasons?a.detailedReasons.push(o):a.detailedReasons=[o],this.showNextModal(n,a)},onBackStep:function(e){this.options.detailedReasons.pop(),this.options.flagReason=_.last(this.options.detailedReasons);var t={name:this.toString(),options:this.options};P.moduleFactory.load(t).then(function(e){this.showInModal(e),this.destroy()}.bind(this))},isTerminalReason:function(e){return!!e.data("is-terminal-reason")},isReportingPin:function(e,t){var o=["nudity","spam","hate-speech","self-harm"],n=["harassingMeOrMyChild","gore"];return-1!==o.indexOf(t)||-1!==n.indexOf(e)},isAgainstPolicies:function(e){var t=["spam","nudity","attacks","hate-speech","self-harm"];return-1!==t.indexOf(e)},getNextModalName:function(e){return this.isTerminalReason(e)?this.ModuleName.BLOCK_AND_UNFOLLOW_FORM:this.toString()},_getProceedButton:function(e){return e&&this.isTerminalReason(e)?this.getChildById("submitButton"):this.getChildById("nextButton")}}),P.modules.FlagBase.prototype.className="FlagBase",goog.provide("P.modules.FlagComment"),goog.require("P.modules.FlagBase"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.FlagComment=P.modules.FlagBase.extend({ModuleName:{BLOCK_AND_UNFOLLOW_FORM:"BlockAndUnfollowComment",CONFIRM_DIALOG:"ConfirmDialog"},getResource:function(){return{name:"PinResource",options:{id:this.options.pin_id,field_set_key:"flag_comment"}}},flag:function(e,t){var o=this.getChildById("submitButton");o.showLoading();var n={pin_id:t.pin_id,comment_id:t.comment_id,reason:t.flagReasonCategory};P.ga.trackEvent(P.CONST.GA_CATEGORY_COMMENT_FLAG,P.CONST.GA_ACTION_CLICK_SUBMIT,"flagReason",n.reason);var a=P.resourceFactory.instance.create("CommentFlagResource",n);return a.callCreate().then(function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_COMMENT_FLAG,P.CONST.GA_ACTION_SUCCESS),this.showNextModal(e,t)}.bind(this),function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_COMMENT_FLAG,P.CONST.GA_ACTION_ERROR)}).fin(function(){o.hideLoading()})}}),P.modules.FlagComment.prototype.className="FlagComment",goog.provide("P.modules.FlagConversation"),goog.require("P.Module"),goog.require("P.modules.FlagBase"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.FlagConversation=P.modules.FlagBase.extend({ModuleName:{BLOCK_AND_UNFOLLOW_FORM:"BlockAndUnfollowMessage",CONFIRM_DIALOG:"ConfirmDialog"},getResource:function(){return{name:"ConversationResource",options:{conversation_id:this.options.conversation.id,ignore_bookmark:!0,field_set_key:"flag_conversation"}}},addContentSpecificModalOptions:function(e){var t=e.conversation.users;e.anyPinnerFollowedByMe=_.some(t,function(e){return e.explicitly_followed_by_me})},flag:function(e,t){var o=this.getChildById("submitButton");o.showLoading();var n={conversation_id:t.conversation.id,reason:t.flagReason};P.ga.trackEvent(P.CONST.GA_CATEGORY_CONVERSATION_FLAG,P.CONST.GA_ACTION_CLICK_SUBMIT,"flagReason",n.reason);var a=P.resourceFactory.instance.create("ConversationReportResource",n);return a.callCreate().then(function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_COMMENT_FLAG,P.CONST.GA_ACTION_SUCCESS),this.showNextModal(e,t)}.bind(this),function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_COMMENT_FLAG,P.CONST.GA_ACTION_ERROR)}).fin(function(){o.hideLoading()})}}),P.modules.FlagConversation.prototype.className="FlagConversation",goog.provide("P.modules.FlagCsr"),goog.require("P.modules.FlagBase"),goog.require("P.ga"),goog.require("P.app"),goog.require("P.resourceFactory"),P.modules.FlagCsr=P.modules.FlagBase.extend({ModuleName:{CONFIRM_DIALOG:"ConfirmDialog"},getNextModalName:function(e){return this.isTerminalReason(e)?this.ModuleName.CONFIRM_DIALOG:this.toString()},flag:function(e,t){var o=this.getChildById("submitButton");o.showLoading();var n="Unlabeled",a=null,r=null,i=P.app.instance.backgroundModule;i&&(n=i.className,"SearchPage"===n&&(a=i.options.scope,r=i.options.query),a=void 0!==a?a:null,r=void 0!==r?r:null);var s={csr_id:t.csr_id,reason:t.flagReasonCategory,source:n,sourceDetail1:a,sourceDetail2:r,detailedReasons:t.detailedReasons};P.ga.trackEvent(P.CONST.GA_CATEGORY_CSR_FLAG,P.CONST.GA_ACTION_CLICK_SUBMIT,"flagReason",s.detailedReasons);var l=P.resourceFactory.instance.create("CSRFlagResource",s);l.callCreate().then(function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_CSR_FLAG,P.CONST.GA_ACTION_SUCCESS),this.showNextModal(e,t)}.bind(this),function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_CSR_FLAG,P.CONST.GA_ACTION_ERROR)}).fin(function(){o.hideLoading()})}}),P.modules.FlagCsr.prototype.className="FlagCsr",goog.provide("P.modules.FlagPin"),goog.require("P.modules.FlagBase"),goog.require("P.ga"),goog.require("P.app"),goog.require("P.resourceFactory"),P.modules.FlagPin=P.modules.FlagBase.extend({ModuleName:{BLOCK_AND_UNFOLLOW_FORM:"BlockAndUnfollowPin",CONFIRM_DIALOG:"ConfirmDialog"},getNextModalName:function(e){var t=e.attr("value"),o=e.data("category");return"other"===o?this.ModuleName.CONFIRM_DIALOG:this.isTerminalReason(e)||"ignoreThisPin"===t?this.ModuleName.BLOCK_AND_UNFOLLOW_FORM:this.toString()},getResource:function(){return{name:"PinResource",options:{id:this.options.pin_id,field_set_key:"flag_pin"}}},flag:function(e,t){var o=this.getChildById("submitButton");o.showLoading();var n="Unlabeled",a=null,r=null,i=P.app.instance.backgroundModule,s=0,l="BoardPage";i&&(n=i.className,"SearchPage"===n?(a=i.options.scope,r=i.options.query):n===l?(a=i.options.tab,s=i.getNumPinsFlagged()):"FeedPage"===n?a=i.options.feed:"DomainFeedPage"===n&&(a=i.options.feed_item_type,r=i.options.domain),a=void 0!==a?a:null,r=void 0!==r?r:null);var u={pin_id:t.pin_id,reason:t.flagReasonCategory,source:n,sourceDetail1:a,sourceDetail2:r,detailedReasons:t.detailedReasons};P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_FLAG,P.CONST.GA_ACTION_CLICK_SUBMIT,"flagReason",u.detailedReasons);var d=P.resourceFactory.instance.create("PinFlagResource",u);d.callCreate().then(function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_FLAG,P.CONST.GA_ACTION_SUCCESS),this.showNextModal(e,t),n===l?P.pubSub.instance.publish(this.options.board_id,P.CONST.PUBSUB_TOPIC_PIN_FLAGGED,{}):P.pubSub.instance.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_FLAGGED,P.CONST.FeedbackType.REPORT)}.bind(this),function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_FLAG,P.CONST.GA_ACTION_ERROR)}).fin(function(){o.hideLoading()})}}),P.modules.FlagPin.prototype.className="FlagPin",goog.provide("P.modules.FlashbuyButton"),goog.require("P.modules.Button"),P.modules.FlashbuyButton=P.modules.Button.extend({onClick:function(e){this.triggerEvent(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_CROP_BUTTON_PRESSED,{commerce:!0},!0)}}),P.modules.FlashbuyButton.prototype.className="FlashbuyButton",goog.provide("P.modules.FlashlightAnnotation"),goog.require("P.Module"),P.modules.FlashlightAnnotation=P.Module.extend({events:{"click .selectedFlashlightAnnotation":"onClose","click .unselectedFlashlightAnnotation":"onSelect"},onClose:function(e){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_ANNOTATION_UNSELECTED,this),e.stopPropagation()},onSelect:function(e){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_ANNOTATION_SELECTED,this),e.stopPropagation()}}),P.modules.FlashlightAnnotation.prototype.className="FlashlightAnnotation",goog.provide("P.modules.FlashlightHeader"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.FlashlightHeader=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_ANNOTATIONS_ADDED]=this.onAnnotationsAdded,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},onAnnotationsAdded:function(e,t,o){var n={name:"AnnotationResults",id:"annotationResults",options:{annotations:o.annotations,selected_annotations:o.query_filters,search_identifier:o.search_identifier}},a=this.getChildByModuleName("AnnotationResults");a?a.fadeOut(function(){a.destroy()}):this.addingAnnotations=!1,P.moduleFactory.load(n).then(function(e){e.render().then(function(){this.hideLoading(),this.insertChild(e,this.$(".flashlightAnnotationsContainer")),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_ANNOTATIONS_ADDED_ENDED,!0)}.bind(this))}.bind(this))}}),P.modules.FlashlightHeader.prototype.className="FlashlightHeader",goog.provide("P.modules.FlashlightResults"),goog.require("P.Module"),P.modules.FlashlightResults=P.Module.extend({onContentReady:function(){var e=this.data.search_identifier;P.context.instanceLogger.getInstance().addSearchIdentifier(e),this.data&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_ANNOTATIONS_ADDED,this.data)}}),P.modules.FlashlightResults.prototype.className="FlashlightResults",goog.provide("P.modules.FollowingSwitcher"),goog.require("P.Module"),P.modules.FollowingSwitcher=P.Module.extend({onContentReady:function(){this.listen(this.getChildById("navFollowedInterests"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick),this.listen(this.getChildById("navFollowedPinners"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick),this.listen(this.getChildById("navFollowedBoards"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick)},onButtonTabClick:function(e){var t=e.target.id,o=this.getChildById("navFollowedInterests"),n=this.getChildById("navFollowedPinners"),a=this.getChildById("navFollowedBoards");o.setSelected("navFollowedInterests"===t),n.setSelected("navFollowedPinners"===t),a.setSelected("navFollowedBoards"===t),this.triggerEvent(P.CONST.EVENT_REFRESH_FOLLOWING_GRID,{following_tab:t},!0)}}),P.modules.FollowingSwitcher.prototype.className="FollowingSwitcher",goog.provide("P.modules.FooterButtons"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.genConst"),P.modules.FooterButtons=P.Module.extend({CssClassName:{GUIDE_IS_RECOMMENDED:"guideIsRecommended",GUIDE_WAS_RECOMMENDED:"guideWasRecommended",HAS_GUIDES:"hasGuides",TRIGGER_ACTIVE:"triggerActive",VISIBLE:"visible"},onContentReady:function(){this.options.hidden||window.setTimeout(function(){0!==this.$("addButtonWrapper").children().length?this.setVisible(!0):this.appendAddPinButton()}.bind(this),2e3);var e={};e[P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE]=this.onTutorialTriggerActive,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e);var t={};t[P.CONST.PUBSUB_TOPIC_DEEP_LINK]=this.onNavigate,t[P.CONST.PUBSUB_TOPIC_IGNORE_EXTENSION_NAG]=this.resetAddPinButton,t[P.CONST.PUBSUB_TOPIC_APPEND_TO_MAIN_MODULE]=this.hideIfBottomBanner,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,t),this.childListen(P.CONST.EVENT_TRIGGER_FLYOUT_CLICKED,this.onTriggerFlyoutClicked),this.childListen(P.CONST.EVENT_TUTORIAL_TRIGGER_CLICKED,this.onTriggerClicked),this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,_.throttle(this.onScroll,100))},hideIfBottomBanner:function(e,t,o){"BottomBanner"===o.module.toString(!1,!1)&&(this.options.hidden=!0,this.options.hiddenFlag=!0,this.setVisible(!1))},resetAddPinButton:function(){var e=this.getChildByModuleName("ShowModalButton");e&&(e.destroy(),this.appendAddPinButton())},appendAddPinButton:function(){var e=P.browserExtension.instance.isExtensionInstalled(),t=Cookie.get(P.CONST.COOKIE_SUPPRESS_EXTENSION_NAG),o;o=e||t?{name:"DropdownButton",id:"addPinDropdownButton",options:{borderless:!0,has_icon:!0,class_name:"addPinFooter footerIcon",text:_("Add Pin"),show_text:!1,log_element_type:P.genConst.ElementType.PIN_UPLOAD_BUTTON,dropdown_options:{fixed:!0,prefetch:!0,position_point:"LEFT_BOTTOM"},submodule:{name:"AddPin",options:{dropdown_style:!0}}}}:{name:"ShowModalButton",id:"addPinDropdownButton",options:{borderless:!0,has_icon:!0,class_name:"addPinFooter footerIcon",text:_("Add Pin"),show_text:!1,log_element_type:P.genConst.ElementType.PIN_UPLOAD_BUTTON,submodule:{name:"BrowserButtonUpsell",options:{extension_installed:!1,suppress:!0}}}},o&&P.moduleFactory.load(o).then(function(e){e.render().then(function(){this.insertChild(e,this.$(".addButtonWrapper")),this.setVisible(!0)}.bind(this))}.bind(this))},onTriggerClicked:function(){this.tutorialInfo&&(this.$el.hasClass(this.CssClassName.GUIDE_IS_RECOMMENDED)&&this.$el.removeClass(this.CssClassName.GUIDE_IS_RECOMMENDED).addClass(this.CssClassName.GUIDE_WAS_RECOMMENDED),this.$el.find(".userEducationTutorialButton").addClass(this.CssClassName.TRIGGER_ACTIVE))},onTriggerFlyoutClicked:function(){this.onTriggerClicked(),this.tutorialInfo.showFlyout=!1,this.tutorialInfo.display_data.trigger="automatic",P.ExperienceTutorialManager.instance().startTutorial(this.tutorialInfo)},onTutorialTriggerActive:function(e,t,o){if(this.tutorialInfo=o,!this.tutorialInfo)return void this.$el.removeClass(this.CssClassName.HAS_GUIDES);if(this.$el.addClass(this.CssClassName.HAS_GUIDES),o.showFlyout){var n={name:"UserEducationTriggerCard",options:{guide:o}};this.flyout&&(this.flyout.destroy(),this.flyout=null),P.moduleFactory.load(n).then(function(e){this.flyout=e,e.render().then(function(){this.appendChild(e),this.setVisible(!0),this.$el.removeClass(this.CssClassName.GUIDE_WAS_RECOMMENDED).addClass(this.CssClassName.GUIDE_IS_RECOMMENDED),window.setTimeout(function(){this.dismissOnScroll=!0}.bind(this),3e3)}.bind(this))}.bind(this))}else this.setVisible(!0)},onNavigate:function(){this.$el.removeClass(this.CssClassName.GUIDE_IS_RECOMMENDED).removeClass(this.CssClassName.GUIDE_WAS_RECOMMENDED),this.dismissOnScroll=!1,this.$el.find(".moreFooter").removeClass(this.CssClassName.TRIGGER_ACTIVE),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,null),this.options.hiddenFlag=!1,this.setVisible(!0)},onScroll:function(){this.dismissOnScroll&&(this.onTriggerClicked(),this.dismissOnScroll=!1)},setVisible:function(e){e&&!this.visible?this.options.hiddenFlag||(this.visible=!0,this.$el.addClass(this.CssClassName.VISIBLE)):!e&&this.visible&&(this.visible=!1,this.$el.removeClass(this.CssClassName.VISIBLE))}}),P.modules.FooterButtons.prototype.className="FooterButtons",goog.provide("P.modules.FormItemGroup"),goog.require("P.Module"),P.modules.FormItemGroup=P.Module.extend({}),P.modules.FormItemGroup.prototype.className="FormItemGroup",goog.provide("P.modules.FriendBoardRecommendationTile"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.toastsManager"),P.modules.FriendBoardRecommendationTile=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BOARD_FOLLOW,this._onBoardFollow),this.childListen(P.CONST.EVENT_DISMISS,this.onDismiss)},_onBoardFollow:function(e){var t={name:"ActionSuccessToast",id:"boardFollowSuccessToast",options:{view_type:"boardFollow"},data:this.data};P.moduleFactory.load(t).then(function(e){P.toastsManager.instance.addToast(e)})},onDismiss:function(e){var t=e.currentTarget;if(!this.isBoardFollowed()&&"recommendationTile"===t.id){var o=this._extractBoardData(t);this._deleteBoardRecommendation(o)}this._removeSelf()},isBoardFollowed:function(){var e=this.children[0].getChildByModuleName("Board").getChildByModuleName("BoardFollowButton");return e.getState()},_removeSelf:function(){this.fadeOut(this.destroy.bind(this))},_extractBoardData:function(e){return e.options.modules[1].data},_deleteBoardRecommendation:function(e){var t={board_ids:[e.id]},o=P.resourceFactory.instance.create("SocialDiscoverySuggestionResource",t);return o.callDelete()}}),P.modules.FriendBoardRecommendationTile.prototype.className="FriendBoardRecommendationTile",goog.provide("P.modules.FriendBoardRecommendationTiles"),goog.require("P.Module"),P.modules.FriendBoardRecommendationTiles=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_DISMISS,this.onDismiss),this.data&&0!==this.data.length||P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_FRIEND_CENTER_NO_RECS)},onCreated:function(){var e={};e[P.CONST.PUBSUB_TOPIC_FRIEND_IMPORT_COMPLETED]=this.handleFriendImportCompleted,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},handleFriendImportCompleted:function(e,t,o){o.error||this.render()},onDismiss:function(){this.resource.options.page_size=1,this._fetchMore()},_fetchMore:function(){return this.pendingMoreRequest?void setTimeout(function(){this._fetchMore()}.bind(this),500):(this.pendingMoreRequest=!0,void this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.pendingMoreRequest=!1}.bind(this)))}}),P.modules.FriendBoardRecommendationTiles.prototype.className="FriendBoardRecommendationTiles",goog.provide("P.modules.FriendCenter"),goog.require("P.Module"),P.modules.FriendCenter=P.Module.extend({}),P.modules.FriendCenter.prototype.className="FriendCenter",goog.provide("P.modules.FriendCenterEmptyMerchandising"),goog.require("P.Module"),P.modules.FriendCenterEmptyMerchandising=P.Module.extend({onContentReady:function(){if(this.data&&this.data.length>0){var e=Math.floor(Math.random()*this.data.length);this.interest=this.data[e],this.interest.name&&this.updateOptionsAndDom({state_interestName:this.interest.name})}},onCreated:function(){this.options.state_interestName=""},updateDom:function(){this.$(".highlight").html(this.options.state_interestName)}}),P.modules.FriendCenterEmptyMerchandising.prototype.className="FriendCenterEmptyMerchandising",goog.provide("P.modules.FriendCenterMerchandising"),goog.require("P.Module"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),P.modules.FriendCenterMerchandising=P.Module.extend({events:{"click .suggestionContent":"onSuggestionClick"},onCreated:function(){this.inviteSrc=this.options.invite_src||"homefeed_friend_center_merch",this.recommendationsURL=P.genConst.Settings.FRIEND_CENTER_RECOMMENDATIONS_URL+"?invite_src="+this.inviteSrc},onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,this._onSocialNetworkConnect);var e=this.$(".FriendBoardRecommendationTile");if(e.length){var t=P.genConst.ComponentType.DISCOVER_FRIEND_MERCHANDISING_BOARD_RECS;this.$el.attr("data-component-type",t)}var o={};o[P.CONST.PUBSUB_TOPIC_FRIEND_IMPORT_COMPLETED]=this._handleFriendImportCompleted,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,o),o[P.CONST.PUBSUB_TOPIC_VIEW_EVENT_INITIALIZED]=this._logMerchandisingViewEvent,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING,o)},onSuggestionClick:function(e){this._redirectToFriendCenter()},onButtonClick:function(e){var t=e.target,o=t.id;switch(o){case"friendCenterBtn":this._redirectToFriendCenter();break;case"moreNetworkConnectionsBtn":this._onTransitionClick()}},_onSocialNetworkConnect:function(e){this.showLoading(!0);var t=e.data.network,o=P.SocialNetworkSettingsManager.instance(),n={username:P.user.instance.attributes.username},a={resourceOptions:n};o.pollForFriends(t,a)},_onTransitionClick:function(){this.$(".networkConnectContainer").addClass("slideIn")},_handleFriendImportCompleted:function(e,t,o){o.error||this._redirectToFriendCenter()},_redirectToFriendCenter:function(){this.navigate(this.recommendationsURL,this.$el,P.genConst.ForceRefreshType.PAGE,{})},_logMerchandisingViewEvent:function(){var e={event_type:P.genConst.EventType.VIEW_DISCOVER_FRIEND_MERCHANDISING,view_type:P.genConst.ViewType.FEED,view_parameter:P.genConst.ViewParameterType.FEED_HOME,component:parseInt(this.$el.attr("data-component-type"),10)},t=P.context.instanceEvent.fromPlainObject(e);P.context.instanceLogger.getInstance().addEvent(t)}}),P.modules.FriendCenterMerchandising.prototype.className="FriendCenterMerchandising",goog.provide("P.modules.FriendsToFollow"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.FriendsToFollow=P.Module.extend({friendIdsUsed:[],friendsUnused:[],usersToReplace:[],usersDismissing:[],onContentReady:function(){this.friendIdsUsed=this.extraData.friendIdsUsed,this.invite_mode="invites"===this.options.mode,this.list=this.getChildByModuleName("List"),this.destroyIfEmpty()||(this.childListen(P.CONST.EVENT_DISMISS,this.onChildDismiss),this.childListen(P.CONST.EVENT_USER_FOLLOW,this.onChildActionTaken),this.childListen(P.CONST.EVENT_INVITE_USER,this.onChildActionTaken)),this.invite_mode&&P.fb.ensureInit(function(){},P.user.instance)},onChildDismiss:function(e){var t=e.target,o;this.invite_mode?(o=P.resourceFactory.instance.create("UserInviteSuggestionResource",{}),o.set("hash_id",t.getUserId())):(o=P.resourceFactory.instance.create("UserFriendSuggestionResource",{}),o.set("user_id",t.getUserId())),o.callDelete(),this.dismissUser(t)},onChildActionTaken:function(e){var t=e.target;window.setTimeout(function(){if(this.dismissUser(t),this.invite_mode){var e=P.resourceFactory.instance.create("UserInviteSuggestionResource",{});e.set("hash_id",t.getUserId()),e.callDelete()}}.bind(this),500)},requestMoreFriendsIfNeeded:function(){var e=this.friendsUnused,t=this.usersDismissing.length+this.usersToReplace.length;e.length>=t||this.resource.xhr||(this.resource.resetBookmark(),this.invite_mode?this.resource.options.excluded_hash_ids=this.friendIdsUsed:this.resource.options.excluded_user_ids=this.friendIdsUsed,this.resource.callGet().then(function(e){var t=e.resource_response.data;for(this.friendsUnused=t;this.usersToReplace.length;){var o=this.usersToReplace.shift();this.replaceUser(o)}}.bind(this)))},dismissUser:function(e){e&&(this.usersDismissing.push(e),e.fadeOut(function(){this.usersDismissing=_.without(this.usersDismissing,e),this.friendsUnused.length?this.replaceUser(e):(this.usersToReplace.push(e),this.requestMoreFriendsIfNeeded())}.bind(this)))},getHeaderElement:function(){return this.$(".memoTitle")},replaceUser:function(e){var t=e.$el.parent(),o=this.friendsUnused.pop();return o?(this.invite_mode?(e.options.contact_info=o,this.friendIdsUsed.push(o.hash_id)):(e.resource.options.user_id=o.id,this.friendIdsUsed.push(o.id)),void e.render().then(function(){e.show(),this.list.removeChild(e),t.remove(),this.list.$el.append(t),this.list.insertChild(e,t),e.fadeIn()}.bind(this))):(this.list.removeChild(e),void t.remove())}}),P.modules.FriendsToFollow.prototype.className="FriendsToFollow",goog.provide("P.modules.GplusConnectButton"),goog.require("P.modules.Button"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.errorUtil"),goog.require("P.resourceFactory");var k=function(){return P.i18n._("Oops! Log in with your Pinterest email and password first, then follow <a href='{{ help_link }}'>these instructions</a> to link your account to Google+.")},y=180,v="postmessage",w="signup";P.modules.GplusConnectButton=P.modules.Button.extend({events:{click:"onClick"},onContentReady:function(){this.readyForConnect=!1,P.gapi.get(function(e){e.signin.render(this.$el.get(0),{scope:this.extraData.gplusScope,clientid:this.extraData.gplusClientId,apppackagename:this.extraData.gplusAppPackageName,redirecturi:v,accesstype:"offline",cookiepolicy:"single_host_origin",callback:function(e){this.readyForConnect&&this.onSignInCallback(e),this.readyForConnect=!0}.bind(this)})}.bind(this))},onClick:function(){P.util.trackRegisterAction("register_gplus_click"),this.triggerEvent(P.CONST.EVENT_GPLUS_BUTTON_CLICKED,this,!0)},onSignInCallback:function(e){var t={gplus_id_token:e.id_token},o=e.status;P.util.trackRegisterAction("register_gplus_attempt"),
o.signed_in&&P.user.instance.login(t).then(function(){this.showLoading(),this.onLoginSuccess(e)}.bind(this),function(t){this.onLoginError(t,e)}.bind(this))},onLoginSuccess:function(e){P.util.trackRegisterAction("register_gplus_success"),window.location.reload()},onLoginError:function(e,t){if(e.api_error_code===y){var o=P.string.format(k(),{help_link:this.extraData.gplusErrorLink});P.errorUtil.showHtmlError(o)}else this.options.action===w&&(P.storage.sessionStorage.setItem(P.CONST.SESSION_GPLUS_CODE,t.code),P.storage.sessionStorage.setItem(P.CONST.SESSION_GPLUS_REDIRECT_URI,v),P.resourceFactory.instance.create("UserRegisterResource",{gplus_code:t.code,gplus_redirect_uri:v}).callCreate({showError:!1}).then(this.onLoginSuccess))}}),P.modules.GplusConnectButton.prototype.className="GplusConnectButton",goog.provide("P.modules.GridFooter"),goog.require("P.Module"),P.modules.GridFooter=P.Module.extend({events:{"click .gridError .Button":"onTryAgainClick"},CssClassName:{SHOW_GRID_LOADING:"showGridLoading"},onContentReady:function(){this.options.state_isShown=!1,this.options.state_isGridLoading=!1,this.options.state_isGridError=!1},updateDom:function(){this.options.state_isShown&&this.$el.css("display","block"),this.$el.toggleClass(this.CssClassName.SHOW_GRID_LOADING,this.options.state_isGridLoading),this.options.state_isGridError?this.$el.find(".gridError").css("display","block"):this.$el.find(".gridError").css("display","none")},onTryAgainClick:function(e){this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,e,!0)},show:function(){this.updateOptionsAndDom({state_isShown:!0})},showError:function(){this.updateOptionsAndDom({state_isGridError:!0})},hideError:function(){this.updateOptionsAndDom({state_isGridError:!1})},showGridLoading:function(){this.updateOptionsAndDom({state_isGridLoading:!0})},hideGridLoading:function(){this.updateOptionsAndDom({state_isGridLoading:!1})}}),P.modules.GridFooter.prototype.className="GridFooter",goog.provide("P.modules.GridItems"),goog.require("P.conversationsUtil"),goog.require("P.dom"),goog.require("P.logging"),goog.require("P.Module"),goog.require("P.timer"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),goog.require("P.preventScrollMixin"),goog.require("P.resourceFactory");var T=P.logging.getLogger("SortManager"),E=P.CONST.MIN_COLUMNS,x=3e3,O=1e3,C=1e3,S="gridSortable",F="Pin",N=1e4,I={UP:0,DOWN:1},A=function(e){var t=parseInt(e.replace("px",""),10);return isNaN(t)?0:t},R=function(e){this.childModule=e,this.top=null,this.height=null,this.bottom=null,this.$itemWrapper=e.getParentElement().closest(".item"),this.columnIndex=null,this.inDom=!0,this.impressionReported=!1,this.impressionStart=null};R.prototype={log:P.logging.getLogger("ItemInfo"),_logHeightError:_.throttle(function(){},1e3),_logHeightRecovery:_.throttle(function(){this.log.warn("recovered from unexpected height value")},1e3),_calculateHeight:function(){this.height=this.$itemWrapper.height(),this.height<=0&&(this.$itemWrapper.appendTo(this.$itemWrapper.parent()),this.height=this.$itemWrapper.height(),this.height<=0?this._logHeightError():this._logHeightRecovery())},ensureHeightCalculated:function(){null===this.height&&this._calculateHeight()},recalculateHeight:function(){this.inDom?this._calculateHeight():this.log.debug("Cannot calculate height because this item is not inDom")},setPosition:function(e,t){this.top=e,this.bottom=t},hasPosition:function(){return null!==this.top}};var B=function(){};B.prototype={resizeGrid:function(){},onChildContentChanged:function(e){},onChildDimsChanged:function(e){},onChildRendered:function(e){},onChildAdded:function(e){},positionGridChildren:function(e){},empty:function(){},recalculateItemMeasurements:function(){},positionGrid:function(){},hideAndShowItems:function(e,t,o,n,a){},onChildRemoved:function(e,t){},getFilledHeight:function(){},logImpressions:function(e,t){},flushImpressions:function(){},logInitialImpressions:function(e,t){}};var M=function(e,t){this.gridItems=e,this.options=t,this.shortestColumnIndex=0,this.columnLengths=[],this.childCidToItemInfo={},_.each(this.gridItems.children,function(e){this.childCidToItemInfo[e.cid]=new R(e)}.bind(this)),this._flushItemsToShow=this._flushItemsToShow.bind(this),this._flushItemsToHide=this._flushItemsToHide.bind(this),this.lastKnownItemInfosInViewport=[],this._itemsToHide={},this._itemsToShow={},this._ITEMS_TO_HIDE_THRESHOLD=50,this.viewableHeightMultiplier=t.viewableHeightMultiplier||2};M.prototype={getFilledHeight:function(){return this.columnLengths[this.shortestColumnIndex]},onChildRendered:function(e){this._reflowOnChildChanged(e)},onChildAdded:function(e){this.childCidToItemInfo[e.cid]=new R(e)},onChildRemoved:function(e,t){if(!this.gridItems.isEmptying){t.remove();var o=this.childCidToItemInfo[e.cid],n=o.columnIndex;delete this.childCidToItemInfo[e.cid],this._reflowColumnContent(n)}},empty:function(){this.childCidToItemInfo={}},recalculateItemMeasurements:function(){for(var e in this.childCidToItemInfo)this.childCidToItemInfo[e].recalculateHeight()},onChildContentChanged:function(e){this._reflowOnChildChanged(e)},onChildDimsChanged:function(e){this._reflowOnChildChanged(e,!1)},_reflowOnChildChanged:function(e,t){var o=this.childCidToItemInfo[e.cid];o.recalculateHeight(),this._reflowColumnContent(o.columnIndex,t)},_reflowColumnContent:function(e,t){void 0===t&&(t=this.gridItems.extraData.reflow_all),t?this.positionGrid():this._repositionItemsInColumn(e)},_calculateNumColumns:function(){var e=this.options.minimum_num_columns||E;if(!this.itemWidth)return e;this.gridItems.extraData.centered||this.gridItems.$el.css("width","auto");var t=this.gridItems.getWidth(!1),o=Math.floor((t+1)/this.itemWidth);return Math.max(e,o)},_positionItemInColumn:function(e,t){if(this.gridItems.isReady()){var o=this.childCidToItemInfo[e.cid],n=o.$itemWrapper;t=Math.max(0,t),t=Math.min(this.columnLengths.length-1,t);var a=this.columnLengths[t];n.css({top:a+"px",left:t*this.itemWidth+"px",visibility:"visible"}),o.columnIndex=t;var r=o.height+this.topBuffer+this.bottomBuffer,i=a+r;o.setPosition(a,i),this.columnLengths[t]=i,this._setShortestColumnIndex()}},_positionItem:function(e){var t;if(this.gridItems.isReady()){if(0===this.columnLengths.length){if(!this.itemWidth){var o=this.childCidToItemInfo[e.cid],n=o.childModule.$el,a=o.$itemWrapper,r=["padding-left","padding-right","border-left-width","border-right-width","margin-left","margin-right"],i=n.css(r),s=a.css(r),l=n.width();for(t=0;t<r.length;t++){var u=r[t];l+=A(i[u]),l+=A(s[u])}this.itemWidth=l;var d=a.css("margin-top"),c=a.css("padding-top"),p=a.css("margin-bottom"),m=a.css("padding-bottom");this.topBuffer=A(d)+A(c),this.bottomBuffer=A(p)+A(m)}var h=this._calculateNumColumns();this.gridItems.extraData.centered||this.gridItems.$el.css("width",h*this.itemWidth),this.columnLengths=new Array(h);var g=this.options.initial_column_lengths;if(g)for(t=0;t<g.length;t++)this.columnLengths[t]=g[t];this._setShortestColumnIndex()}var _=this.shortestColumnIndex;this._positionItemInColumn(e,_)}},_setShortestColumnIndex:function(){this.shortestColumnIndex=0;for(var e=0;e<this.columnLengths.length;e++)this.columnLengths[e]=this.columnLengths[e]||0,this.columnLengths[e]<this.columnLengths[this.shortestColumnIndex]&&(this.shortestColumnIndex=e)},_repositionItemsInColumn:function(e){if(this.gridItems.isReady()){this.columnLengths[e]=0;var t=_.filter(this.childCidToItemInfo,function(t){return t.columnIndex===e}),o=_.sortBy(t,function(e){return e.top});_.each(o,function(t){this._positionItemInColumn(t.childModule,e)}.bind(this)),this.resizeContainer()}},resizeGrid:function(){var e=this.columnLengths.length,t=this._calculateNumColumns();e!==t&&(this.positionGridChildren(),this.gridItems.rearrangeItems(!0),this.gridItems.scheduleImpressionLogging())},resizeContainer:function(){var e=Math.max.apply(Math,this.columnLengths);this.gridItems.$el.css("height",e+"px"),this.gridItems.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},positionGrid:function(){this.gridItems.contentReady&&(this.positionGridChildren(),this.gridItems.rearrangeItems(),this.gridItems.scheduleImpressionLogging())},positionGridChildren:function(e){this.gridItems.contentReady&&(e||(this.columnLengths=[]),_.each(this.gridItems.children,function(e){var t=this.childCidToItemInfo[e.cid];t.ensureHeightCalculated()}.bind(this)),_.each(this.gridItems.children,function(t){var o=this.childCidToItemInfo[t.cid];e&&o.hasPosition()||this._positionItem(o.childModule)}.bind(this)),this.resizeContainer())},hideAndShowItems:function(e,t,o,n,a){var r;for(r in this.childCidToItemInfo){var i=this.childCidToItemInfo[r],s=i.$itemWrapper[0];i.bottom<n?e&&i.inDom&&(t||o!==I.DOWN||(this._itemsToHide[r]=s,delete this._itemsToShow[r],i.inDom=!1)):i.top>a?e&&i.inDom&&(t||o!==I.UP||(this._itemsToHide[r]=s,delete this._itemsToShow[r],i.inDom=!1)):i.inDom||(this._itemsToShow[r]=s,delete this._itemsToHide[r],i.inDom=!0)}Object.keys(this._itemsToShow).length&&P.dom.deferDomManipulation(this._flushItemsToShow),Object.keys(this._itemsToHide).length>this._ITEMS_TO_HIDE_THRESHOLD&&P.dom.deferDomManipulation(this._flushItemsToHide)},_flushItemsToShow:function(){var e;this.gridItems.log.debug("_flushItemsToShow: showing ",Object.keys(this._itemsToShow).length);var t=document.createDocumentFragment();for(e in this._itemsToShow)t.appendChild(this._itemsToShow[e]);this.gridItems.$el[0].appendChild(t),this._itemsToShow={}},_flushItemsToHide:function(){var e;this.gridItems.log.debug("_flushItemsToHide: hiding ",Object.keys(this._itemsToHide).length);for(e in this._itemsToHide){var t=this._itemsToHide[e];t.parentNode&&t.parentNode.removeChild(t)}this._itemsToHide={}},logImpressions:function(e,t){var o=this._getItemsInViewport(e,t),n=_.difference(this.lastKnownItemInfosInViewport,o);this.lastKnownItemInfosInViewport=o,this._reportImpressions(n)},logInitialImpressions:function(e,t){var o=this._getItemsInViewport(e,t),n=_.intersection(this.knownItemInfosInLastInterval,o);this.knownItemInfosInLastInterval=o,this._reportImpressions(n)},_getItemsInViewport:function(e,t){var o=[];return _.each(this.childCidToItemInfo,function(n){var a=n.top+this.topBuffer,r=n.bottom-this.bottomBuffer,i=!(a>=t||e>=r);i&&(o.push(n),null==n.impressionStart&&(n.impressionStart=Date.now()))}.bind(this)),o},flushImpressions:function(){this._reportImpressions(this.lastKnownItemInfosInViewport)},_reportImpressions:function(e){function t(e){if(void 0!==e&&null!==e){var t=new Image;t.src=e.url,t.onload=function(){t=null}}}if(!this.options.disable_impression_logging){for(var o=_.filter(e,function(e){return!e.impressionReported}),n=[],a=0;a<o.length;a++){var r=o[a],i=r.childModule.data?r.childModule.data.view_tags:[];if(r.childModule.className===F){var s=r.childModule.getLoggingObjectIdStr();if(s){var l=r.childModule.getGridIndex();n.push({time:1e6*r.impressionStart,pinIdStr:s,endTime:1e6*Date.now(),yPosition:r.top,columnIndex:r.columnIndex,slotIndex:l}),r.impressionReported=!0}i?i.forEach(t):r.log.debug("view_tags field is missing")}}if(n.length){var u=this.options.impression_event_type||P.genConst.EventType.PIN_IMPRESSION_ONE_PIXEL,d=P.context.instanceEvent.fromEventType(u);d.setPinImpressions(n),this.options.impression_metadata&&d.updateAuxData(this.options.impression_metadata),P.context.instanceLogger.getInstance().addEvent(d)}}}};var D=function(e,t){this.gridItems=e,this.options=t,this.viewableHeightMultiplier=2};D.prototype={resizeGrid:function(){},onChildContentChanged:function(){},onChildDimsChanged:function(){},onChildRendered:function(){},onChildAdded:function(e){},positionGridChildren:function(){},empty:function(){},recalculateItemMeasurements:function(){},positionGrid:function(){this.gridItems.isReady()&&this.gridItems._requestMoreItemsIfNeeded()},hideAndShowItems:function(e,t,o,n,a){},onChildRemoved:function(e,t){t.remove(),this.gridItems.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},getFilledHeight:function(){var e=this.gridItems.getWidth(!1),t=this.gridItems.children.length;if(0===t)return 0;var o=this.gridItems.children[0],n=o.$el.outerWidth(!0),a=o.$el.outerHeight(!0),r=Math.floor(e/n),i=Math.ceil(t/r),s=t%r!==0,l=i*a;return s&&(l-=a),l},logImpressions:function(){},flushImpressions:function(){},logInitialImpressions:function(){}};var V=function(e,t){this.gridItems=e,this.options=t,this.childCidToItemInfo={},_.each(this.gridItems.children,function(e){this.childCidToItemInfo[e.cid]=new R(e)}.bind(this))};V.prototype={resizeGrid:function(){},onChildContentChanged:function(){},onChildDimsChanged:function(){},onChildRendered:function(){},onChildAdded:function(e){this.childCidToItemInfo[e.cid]=new R(e),this.resizeContainer()},onChildRemoved:function(e,t){this.resizeContainer()},positionGridChildren:function(){this.gridItems.isReady()&&this.resizeContainer()},empty:function(){},recalculateItemMeasurements:function(){},positionGrid:function(){this.gridItems.isReady()&&(this.resizeContainer(),this.resetGridChildrenPosition(),this.gridItems._requestMoreItemsIfNeeded())},resizeContainer:function(){var e=0;_.each(this.gridItems.children,function(t){var o=this.childCidToItemInfo[t.cid],n=o.childModule;n.data&&!n.$el.is(":hidden")&&(e+=n.getWidth()+P.CONST.PIN_MARGIN)}.bind(this)),this.gridItems.$el.css("width",e+"px")},hideAndShowItems:function(e,t,o,n,a){},getFilledHeight:function(){},getFilledWidth:function(){return this.gridItems.getWidth(!1)},resetGridChildrenPosition:function(){_.each(this.gridItems.children,function(e){var t=this.childCidToItemInfo[e.cid];this._resetItemPosition(t.childModule)}.bind(this))},_resetItemPosition:function(e){var t=this.childCidToItemInfo[e.cid],o=t.$itemWrapper;o.css({left:"",top:""})},logImpressions:function(){},flushImpressions:function(){},logInitialImpressions:function(){}};var W=function(e,t){var o=this;this.gridItems=e,t||(t={}),this.draggableOptions=_.extend({appendTo:$(".App"),cursor:"move",distance:3,handle:".draggable",helper:"clone",opacity:.35,scroll:!1,revert:!1,zIndex:O,drag:function(e,t){var o=parseInt($(this).data("startingScrollTop"),10);t.position.top-=o;var n=e.clientX-t.position.left,a=window.pageYOffset+e.clientY-t.position.top,r=t.helper.height(),i=t.helper.width(),s=n/i*100,l=a/r*100,u=""+s+"% "+l+"%";t.helper.css("transformOrigin",u)},start:function(e,t){var n=o.gridItems.getChildByElement($(e.target).find(".Module"));n&&P.conversationsUtil.setDraggedObject(n),$(this).data("startingScrollTop",window.pageYOffset-P.CONST.PIN_MARGIN)},stop:function(e,t){var o=parseInt($(this).data("startingScrollTop"),10);P.conversationsUtil.setDraggedObject(null),t.position.top-=o}},t),this.gridItems.$(".item").draggable(this.draggableOptions)};W.prototype={enable:function(){void 0!==$.fn.draggable&&this.gridItems.$(".item").draggable("enable")},disable:function(){void 0!==$.fn.draggable&&this.gridItems.$(".item").draggable("disable")},disableForModule:function(e){void 0!==$.fn.draggable&&e.getParentElement().draggable("disable")},onChildAdded:function(e){e.getParentElement().draggable(this.draggableOptions)}};var j=function(e,t){this.gridItems=e,t||(t={}),this.droppableOptions=_.extend({tolerance:"pointer"},t),this.gridItems.$(".item").droppable(this.droppableOptions)};j.prototype={enable:function(){void 0!==$.fn.droppable&&this.gridItems.$(".item").droppable("enable")},disable:function(){void 0!==$.fn.droppable&&this.gridItems.$(".item").droppable("disable")},disableForModule:function(e){void 0!==$.fn.droppable&&e.getParentElement().droppable("disable")},onChildAdded:function(e){var t=e.getParentElement();t.droppable(this.droppableOptions)}};var U=function(e,t,o,n){this.gridItems=e,t||(t={}),t=_.extend({containment:"parent",cursor:"move",helper:"clone",items:"."+S,tolerance:"pointer",zIndex:C},t),this.gridItems.$el.sortable(t),this.childModuleName=o,this.idFn=n,this._setSortableMetadata(),this._hasNewElements=!0};U.prototype={_setSortableMetadata:function(){_.each(this.gridItems.getChildrenByModuleName(this.childModuleName),function(e){this._addSortableItemClass(e)}.bind(this))},_addSortableItemClass:function(e){var t=e.getParentElement();t.addClass(S)},onChildAdded:function(e){this._addSortableItemClass(e),this._hasNewElements=!0},getSortOrder:function(){var e=this.idFn,t=[];return this._hasNewElements&&(_.each(this.gridItems.getChildrenByModuleName(this.childModuleName),function(t){t.$el.attr("data-sort-id")||t.$el.attr("data-sort-id",e(t))}),this._hasNewElements=!1),_.each(this.gridItems.$el.find("."+this.childModuleName),function(e){var o=$(e).attr("data-sort-id");o?t.push(o):T.error("child module's data-sort-id is null or undefined",{boardHtml:e.parentNode.innerHTML})}),t}};var z=P.Module.extend({events:{"click .trackActiveItem .item":"onTrackItemClick","click .itemClickMask":"onItemMaskClick"},CssClassName:{ACTIVE_ITEM:"activeItem",HAS_SCROLL:"hasScroll",ITEM:"item",LOADING_ITEMS:"loadingItems"},mixins:[P.preventScrollMixin],onChildNavigate:function(e){var t=e.currentTarget;this.updateActiveItem(t.getParentElement())},onItemMaskClick:function(e){this.options.item_click_mask_options.log_element_type&&this._logContextEvent(e);var t=$(e.currentTarget),o=t.next(),n=this.getChildByElement(o[0]);return n?void this.triggerEvent(P.CONST.EVENT_GRID_ITEM_SELECTED,{module:n},!0):void this.log.error("cannot find selected child module.")},onTrackItemClick:function(e){var t=e.currentTarget;this.updateActiveItem($(t))},updateActiveItem:function(e){var t=this.$(".activeItem");t.removeClass(this.CssClassName.ACTIVE_ITEM),e.addClass(this.CssClassName.ACTIVE_ITEM)},setActiveItemById:function(e){for(var t=this.children||[],o=0;o<t.length;o++){var n=t[o];n.data&&n.data.id===e&&this.updateActiveItem(n.$el.parent())}},onCreated:function(){this._scrollListener=null,this._scrollStopListener=null,this.alreadyInitialized=!1,this.scrollTop=0,this.lastScrollTop=null,this.viewableHeight=null,this.lastTopBorder=null,this.lastBottomBorder=null,this.layoutManager=null,this.initialImpressionLoggingInterval=null,this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_DIMS_CHANGED,this.onChildDimsChanged);var e={};e[P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED]=function(){this.layoutManager&&this.layoutManager.flushImpressions()}.bind(this),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},initializeSortManager:function(e,t,o){this.sortManager=new U(this,e,t,o)},initializeDragManager:function(e){this.dragManager=new W(this,e)},enableDragging:function(){this.dragManager&&this.dragManager.enable()},disableDragging:function(){this.dragManager&&this.dragManager.disable()},disableDraggingForChildModule:function(e){this.dragManager&&this.dragManager.disableForModule(e)},initializeDropManager:function(e){this.dropManager=new j(this,e)},enableDropping:function(){this.dropManger&&this.dropManager.enable()},disableDropping:function(){this.dropManger&&this.dropManager.disable()},disableDroppingForChildModule:function(e){this.dropManager&&this.dropManager.disableForModule(e)},getSortOrder:function(e,t){return this.sortManager?this.sortManager.getSortOrder(e,t):void 0},getChildModuleAtIndex:function(e,t){var o=this.children[e];return o&&o.className===t?o:null},getChildren:function(){return this.children},onOptionsChanged:function(e,t){this._setScrollableElement(),this.alreadyInitialized=!1},onResourceChanged:function(e,t){this.alreadyInitialized=!1},prependChildItem:function(e){var t=0;this.children.length>0&&this.children[0].options.anchored&&(t=1);var o;this.children.length>t&&(o=this.children[t].$el.parent()),this.insertChildBefore(e,this.$el,t,o),this.layoutManager.positionGrid()},prependNewItems:function(e,t){var o=0,n=P.resourceFactory.instance.clone(this.resource);n.resetBookmark(),n.set("prepend",!1),n.set("page_size",e);var a=new z({resource:n});this.children.length>0&&this.children[0].options.anchored&&(o=1),a.options=this.options,a.render().then(function(){_.each(a.children.reverse(),function(e){e.remove(),this.insertChild(e,this.$el,o)}.bind(this)),this.layoutManager.positionGrid(),t&&t()}.bind(this))},requestMoreItems:function(){this.isReady()&&this._requestMoreItems()},requestMoreItemsIfNeeded:function(){this.isReady()&&this._requestMoreItemsIfNeeded()},hasMoreItems:function(){return this.resource&&!this.resource.atEnd()},_triggerIfItemsEnd:function(){this.hasMoreItems()||this.triggerEvent(P.CONST.EVENT_ITEMS_END,null,!0)},setPageSize:function(e){this.resource&&this.resource.set("page_size",e)},setHasScroll:function(e){this.$el.toggleClass(this.CssClassName.HAS_SCROLL,e)},onAddedToDom:function(){this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize),this.navigateListener=this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this._setUpGrid(),this.isReady()&&this.layoutManager.recalculateItemMeasurements(),this.onResize()},onResize:function(){this.isReady()&&this.layoutManager.resizeGrid()},hasItems:function(){return this.children.length>0},onContentReady:function(){this.$el.removeClass(this.CssClassName.LOADING_ITEMS);var e=this.options.layout;"fixed_height"===e?this.layoutManager=new D(this,this.options):"row_layout"===e?this.layoutManager=new V(this,this.options):this.layoutManager=new M(this,this.options),this._setUpGrid(),this._triggerIfItemsEnd(),this.initialImpressionLoggingInterval=P.timer.setInterval(this.scheduleInitialImpressions.bind(this),N)},onRemovedFromDom:function(){this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_SITE),P.timer.clearInterval(this.initialImpressionLoggingInterval),this.initialImpressionLoggingInterval=null,this._scrollListener&&(this.removeListener(this._scrollListener),this._scrollListener=null),this._scrollStopListener&&(this.removeListener(this._scrollStopListener),this._scrollStopListener=null),this.stopPreventScroll(),this.layoutManager&&this.layoutManager.flushImpressions(),this.navigateListener&&this.removeListener(this.navigateListener),this.resizeListener&&this.removeListener(this.resizeListener)},onChildContentChanged:function(e){e.stopPropagation();var t=e.currentTarget;this.isReady()&&(this.layoutManager.onChildContentChanged(t),this.rearrangeItems(!0),this.scheduleImpressionLogging())},onChildDimsChanged:function(e){e.stopPropagation();var t=e.currentTarget;this.isReady()&&this.layoutManager.onChildDimsChanged(t)},onChildRendered:function(e){this.isReady()&&this.layoutManager.onChildRendered(e)},onChildAdded:function(e){e&&e.data&&(e.data.grid_index=this.children.length-1);var t=e.getParentElement();if(!t.hasClass(this.CssClassName.ITEM)){var o=$("<div></div>").addClass(this.CssClassName.ITEM);o.insertBefore(e.$el),o.append(e.$el),t=o}this.layoutManager&&this.layoutManager.onChildAdded(e),this.dragManager&&this.dragManager.onChildAdded(e),this.dropManager&&this.dropManager.onChildAdded(e),this.sortManager&&this.sortManager.onChildAdded(e)},onChildRemoved:function(e,t){this.layoutManager&&this.layoutManager.onChildRemoved(e,t)},empty:function(){this.isEmptying=!0,P.Module.prototype.empty.call(this),this.alreadyInitialized=!1,this.contentReady=!1,this.layoutManager&&this.layoutManager.empty(),this.isEmptying=!1},handleError:function(e){this.pendingMoreRequest?this.$(".errorMessage").remove():P.Module.prototype.handleError.call(this,e)},_setUpGrid:function(){this._setScrollableElement(),this.isReady()&&!this.alreadyInitialized&&(this.layoutManager.positionGrid(),this.alreadyInitialized=!0,this._computeScrollableHeightAndOffset())},_setScrollableElement:function(){var e=_.throttle(this._onScroll,16),t=_.debounce(this._onScrollStop,2e3);this._scrollListener&&(this.removeListener(this._scrollListener),this._scrollListener=null),this._scrollStopListener&&(this.removeListener(this._scrollStopListener),this._scrollStopListener=null),this.scrollableElement=this.getScrollableElement(),this.options.scrollable&&(this._scrollListener=this.listen(this.scrollableElement,"scroll",e),this._scrollStopListener=this.listen(this.scrollableElement,"scroll",t)),this._preventDefaultIfNeeded()},isReady:function(){return this.inDom&&this.contentReady},rearrangeItems:function(e){this._requestMoreItemsIfNeeded(),this._hideAndShowItems(e)},positionGrid:function(){this.layoutManager.positionGrid()},_onScroll:function(e){this.lastScrollTop=this.scrollTop,this.scrollTop=this.getScrollableElement().scrollTop(),this.lastScrollTop!==this.scrollTop&&(this.rearrangeItems(!0),this.scheduleImpressionLogging(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_SCROLL_CHANGE))},_onScrollStop:function(e){this.layoutManager._flushItemsToHide&&P.dom.deferDomManipulation(this.layoutManager._flushItemsToHide)},scheduleImpressionLogging:function(){this._impressionLoggingScheduled||(this._impressionLoggingScheduled=!0,P.dom.deferDomManipulation(function(){this._impressionLoggingScheduled=!1;var e=this.scrollTop-this.offsetFromScrollElement,t=e+this.viewableHeight;this.layoutManager.logImpressions(e,t)}.bind(this)))},scheduleInitialImpressions:function(){var e=this.scrollTop-this.offsetFromScrollElement,t=e+this.viewableHeight;this.layoutManager.logInitialImpressions(e,t)},_hideAndShowItems:function(e){if(this.extraData.virtualize){e=e||!1;var t=!this.lastScrollTop||this.scrollTop>=this.lastScrollTop?I.DOWN:I.UP,o=this.scrollTop-this.offsetFromScrollElement,n=o+this.viewableHeight,a=o-x,r=n+x,i=null===this.lastTopBorder||null===this.lastBottomBorder||o<this.lastTopBorder||n>this.lastBottomBorder;(i||e)&&(this.layoutManager.hideAndShowItems(e,this.pendingMoreRequest,t,a,r),this.lastTopBorder=a,this.lastBottomBorder=r)}},onRendered:function(){this._requestMoreItemsIfNeeded(),P.Module.prototype.onRendered()},_computeScrollableHeightAndOffset:function(){this.viewableHeight=this.scrollableElement.height(),this.offsetFromScrollElement=this.$el.positionAncestor(this.scrollableElement).top},_requestMoreItemsIfNeeded:function(){if(this.isReady()&&this.options.scrollable&&!this.pendingMoreRequest&&!this.hasError&&this.hasMoreItems()){if(this._computeScrollableHeightAndOffset(),this.layoutManager instanceof M||this.layoutManager instanceof D){var e=this.offsetFromScrollElement+this.layoutManager.getFilledHeight();if(e-(this.viewableHeight+this.scrollTop)>this.layoutManager.viewableHeightMultiplier*this.viewableHeight)return}else if(this.layoutManager instanceof V){var t=this.layoutManager.getFilledWidth(),o=this.parent.scrollLeft,n=P.Viewport.width;if(t>o+n)return}this._requestMoreItems()}},_requestMoreItems:function(e){_.isUndefined(e)&&(e=2),this.pendingMoreRequest||(this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0),this.pendingMoreRequest=!0,this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.layoutManager.positionGridChildren(!0),this.pendingMoreRequest=!1,this.hasError&&(this.triggerEvent(P.CONST.EVENT_ERROR_RESOLVED,null,!0),this.hasError=!1),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0),this._requestMoreItemsIfNeeded(),this._triggerIfItemsEnd(),this.scheduleImpressionLogging()}.bind(this),function(){e>0?this._requestMoreItems(e-1):(this.hasError=!0,this.triggerEvent(P.CONST.EVENT_ERROR,null,!0),this._triggerIfItemsEnd())}.bind(this)))},_preventDefaultIfNeeded:function(){this.options.prevent_default_scroll&&this.startPreventScroll(this.scrollableElement,this.$el)},switchLayoutManager:function(e){this.$el.css({height:"",width:""}),"fixedHeightLayout"===e?this.layoutManager=new D(this,this.options):"rowLayout"===e?this.layoutManager=new V(this,this.options):this.layoutManager=new M(this,this.options),this.positionGrid()},reorderChildModule:function(e,t){var o=this.children.indexOf(e);this.children.splice(o,1);var n=this.children.indexOf(t);this.children.splice(n,0,e),this.layoutManager.positionGridChildren()}});P.modules.GridItems=z,P.modules.GridItems.prototype.className="GridItems",goog.provide("P.modules.GroupBoardEmailSettings"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.GroupBoardEmailSettings=P.Module.extend({onCreated:function(){this.childListen("change",this.onChildChange)},onSubmitValidated:function(e){return this.save(),!1},save:function(){var e={},t=[];this.$form.find("input[name=collab_board_email]:checked").each(function(){t.push(this.value)}),e.email_collaborative_board_ids=t;var o=this.getChildById("submitButton"),n=P.resourceFactory.instance.create("UserSettingsResource",e);o.showLoading(),n.callUpdate().then(function(){this.destroy()}.bind(this)).fin(function(){o.hideLoading()})},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var e={};this.$form=this.$("form"),this.form=new P.Form(this.$form,e),this.listen(this.form,"submitValidated",this.onSubmitValidated)},onChildChange:function(e){var t=e.target;if("toggleAll"===t.id){var o;o=t.isChecked()?function(e){e.setChecked(!0)}:function(e){e.setChecked(!1)};var n=this.getChildrenByModuleName("Checkbox");_.each(n,o)}}}),P.modules.GroupBoardEmailSettings.prototype.className="GroupBoardEmailSettings",goog.provide("P.modules.GroupBoardInviteLanding"),goog.require("P.Module"),P.modules.GroupBoardInviteLanding=P.Module.extend({}),P.modules.GroupBoardInviteLanding.showBoardRepModal=function(e,t,o){var n={name:"GroupBoardInviteLanding",options:{inviter_user_id:t},resource:{name:"BoardResource",options:{board_id:e,field_set_key:"grid_item"}}};P.moduleFactory.load(n).then(function(e){P.modalManager.get().createAndShowModal(e,{can_dismiss:!1,modal_style:"fullScreen"})})},P.modules.GroupBoardInviteLanding.prototype.className="GroupBoardInviteLanding",goog.provide("P.modules.GroupBoardUserAppJoin"),goog.require("P.Module"),P.modules.GroupBoardUserAppJoin=P.Module.extend({}),P.modules.GroupBoardUserAppJoin.prototype.className="GroupBoardUserAppJoin",goog.provide("P.modules.HeaderBase"),goog.require("P.Module"),P.modules.HeaderBase=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW]=this.onMainModuleChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,e)},onMainModuleChange:function(e,t,o){var n=o,a=["LoginPage","UserRegisterPage"],r=this.options.main_module.name;this.options.main_module.name=n.className,this.options.main_module.options=_.clone(n.options),(r===n.className||-1===a.indexOf(n.className)&&-1===a.indexOf(r))&&(P.user.instance.isAuthenticated()||"HomePage"!==r&&"HomePage"!==n.className)||(r=n.className,this.render());var i=["InterestFeedPage","BoardPage","Closeup"];if(!P.user.instance.isAuthenticated()&&(-1!==i.indexOf(r)||-1!==i.indexOf(n.className))){var s=this.getChildByModuleName("KLPBar");s&&s.render()}}}),P.modules.HeaderBase.prototype.className="HeaderBase",goog.provide("P.modules.HelpMenu"),goog.require("P.Module"),P.modules.HelpMenu=P.Module.extend({}),P.modules.HelpMenu.prototype.className="HelpMenu",goog.provide("P.modules.HeroBasicWrapper"),goog.require("P.Module"),P.modules.HeroBasicWrapper=P.Module.extend({}),P.modules.HeroBasicWrapper.prototype.className="HeroBasicWrapper",goog.provide("P.modules.HeroHelperBase"),goog.require("P.Module"),goog.require("P.ga"),goog.require("P.timer"),goog.require("P.ExperienceManager");var H="close",G=1e3;P.modules.HeroHelperBase=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick),this.resource?(this.placementId=this.resource.options.placement_id,this.experienceId=this.resource.options.experience_id):(this.placementId=this.options.placement_id,this.experienceId=this.options.experience_id);var e=this.data;e&&(e.experience_id&&(this.experienceId=e.experience_id),e.id&&(this.placedExperienceId=e.id)),this.setExperienceViewed()},hide:function(){this.fadeOut(function(){this.destroy()}.bind(this))},dismiss:function(e){P.ga.trackEvent("hero_helper_"+this.options.type,P.CONST.GA_ACTION_CLICK_CLOSE),this.dismissPlacedExperience(),e||this.hide()},complete:function(e){P.ga.trackEvent("hero_helper_"+this.options.type,P.CONST.GA_ACTION_CLICK_CONFIRM),this.completePlacedExperience(),e||(this.options.delay_hide?P.timer.setTimeout(function(){this.hide()}.bind(this),G):this.hide());
},setExperienceViewed:function(){P.ga.trackEvent("hero_helper_"+this.options.type,"viewed");var e=P.ExperienceManager.instance;this.placedExperienceId?e.viewPlacedExperienceId(this.placedExperienceId):e.viewPlacedExperience(this.placementId,this.experienceId)},completePlacedExperience:function(){var e=P.ExperienceManager.instance;return this.placedExperienceId?e.completePlacedExperienceId(this.placedExperienceId):e.completePlacedExperience(this.placementId,this.experienceId)},dismissPlacedExperience:function(){var e=P.ExperienceManager.instance;return this.placedExperienceId?e.dismissPlacedExperienceId(this.placedExperienceId):e.dismissPlacedExperience(this.placementId,this.experienceId)},onButtonClick:function(e){},_onButtonClick:function(e){this.onButtonClick(e);var t=e.target;t.id===H&&this.dismiss()}}),P.modules.HeroHelperBase.prototype.className="HeroHelperBase",goog.provide("P.modules.HeroInstallApp"),goog.require("P.Form"),goog.require("P.modules.HeroHelperBase"),goog.require("P.resourceFactory");var K="install_app";P.modules.HeroInstallApp=P.modules.HeroHelperBase.extend({onContentReady:function(){this.formListener&&this.removeListener(this.formListener);var e;e={phoneNumber:[P.validator.Required(),P.validator.PhoneNumber()]},this.form=new P.Form(this.$("form"),e),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.installAppButton=this.getChildById(K),P.modules.HeroHelperBase.prototype.onContentReady.call(this)},onSubmitValidated:function(e){e.errors[0]||this.installAppSms()},onSuccess:function(){this.complete(),this.installAppButton.hideLoading(),this.installAppButton.setText(this.options.sent_text),this.installAppButton.disable()},onFailure:function(){this.installAppButton.hideLoading()},installAppSms:function(){var e=this.form.getValue("phoneNumber"),t=this.form.getValue("country"),o=P.resourceFactory.instance.create("SmsAppInstall",{number:e,country:t});this.installAppButton.showLoading(),o.callCreate({showError:!1}).then(function(){this.onSuccess()}.bind(this),function(){this.onFailure()}.bind(this))}}),P.modules.HeroInstallApp.prototype.className="HeroInstallApp",goog.provide("P.modules.HeroPinFromEmail"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroPinFromEmail=P.modules.HeroHelperBase.extend({onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.call(this),$(window).on("load",setTimeout(this.toggleVisibility.bind(this),300))},toggleVisibility:function(){this.$el.fadeIn()}}),P.modules.HeroPinFromEmail.prototype.className="HeroPinFromEmail",goog.provide("P.modules.HeroPinItButton"),goog.require("P.browserExtension"),goog.require("P.modules.HeroHelperBase"),goog.require("P.genConst"),goog.require("P.resourceFactory");var Y="pinitButton",q=500;P.modules.HeroPinItButton=P.modules.HeroHelperBase.extend({onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.call(this),$(window).on("load",setTimeout(this.toggleNagVisibility.bind(this),q))},toggleNagVisibility:function(){P.browserExtension.instance.isExtensionInstalled()?(this.setExtensionInstalledUserState(!0),this.dismiss()):(this.$el.fadeIn(),P.context.instanceLogger.getInstance().logCustomViewEvent(P.genConst.ViewType.SAVE,P.genConst.ViewParameterType.EXTENSION_UPSELL_NAG))},setExtensionInstalledUserState:function(e){var t={state:"INSTALLED_PIN_EXTENSION",value:e?1:0},o=P.resourceFactory.instance.create("UserStateResource",t);o.callCreate()},onButtonClick:function(e){var t=e.target;t.id===Y&&P.browserExtension.instance.handleExtensionInstall(function(){this.setExtensionInstalledUserState(!0),this.complete()}.bind(this))}}),P.modules.HeroPinItButton.prototype.className="HeroPinItButton",goog.provide("P.modules.HeroPinItWeb"),goog.require("P.modules.HeroHelperBase"),goog.require("P.util");var J="pinitButton";P.modules.HeroPinItWeb=P.modules.HeroHelperBase.extend({onButtonClick:function(e){var t=e.target;t.id===J&&(P.util.changeWindowLocation(this.extraData.url,this.extraData.newWindow),this.complete(!0))}}),P.modules.HeroPinItWeb.prototype.className="HeroPinItWeb",goog.provide("P.modules.HeroPlacePinsExamples"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroPlacePinsExamples=P.modules.HeroHelperBase.extend({}),P.modules.HeroPlacePinsExamples.prototype.className="HeroPlacePinsExamples",goog.provide("P.modules.HeroVerifyWebsite"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroVerifyWebsite=P.modules.HeroHelperBase.extend({}),P.modules.HeroVerifyWebsite.prototype.className="HeroVerifyWebsite",goog.provide("P.modules.HomePage"),goog.require("P.Module"),P.modules.HomePage=P.Module.extend({}),P.modules.HomePage.prototype.className="HomePage",goog.provide("P.modules.IframeEmbed"),goog.require("P.Module"),P.modules.IframeEmbed=P.Module.extend({}),P.modules.IframeEmbed.prototype.className="IframeEmbed",goog.provide("P.modules.Image"),goog.require("P.Module"),P.modules.Image=P.Module.extend({onContentReady:function(){var e=this.$el.find("img");if(this.options.lazy_load&&e.attr("src",this.options.src),this.options.error_notification)switch(e.data("load-state")){case"pending":e.on("error",function(){this._onImageError()}.bind(this));break;case"error":this._onImageError()}},_onImageError:function(){this.triggerEvent(P.CONST.EVENT_IMAGE_LOAD_ERROR,null,!0)}}),P.modules.Image.prototype.className="Image",goog.provide("P.modules.ImageBlock"),goog.require("P.Module"),P.modules.ImageBlock=P.Module.extend({events:{click:"onClick"},onClick:function(){this.triggerEvent(P.CONST.EVENT_IMAGE_BLOCK_CLICKED,this.data,!0)}}),P.modules.ImageBlock.prototype.className="ImageBlock",goog.provide("P.modules.ImageCrop"),goog.require("P.Module"),P.modules.ImageCrop=P.Module.extend({events:{"mousedown .drag":"onStartDrag","touchstart .drag":"onStartDrag"},CssClassName:{IMAGE_AREA:"in"},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){_.defaults(this.options,{size:{width:222,height:150},padding:60}),this.$holder=this.$(".holder"),this.$bg=this.$(".bg"),this.$help=this.$(".help"),this.$frame=this.$(".frame"),this.$mask=this.$(".mask"),this.$spinner=this.$(".spinner"),this.$holder.show().css("height",this.options.size.height+2*this.options.padding),this.options.help_text&&this.$help.html(this.options.help_text),this._positionIfReady()},_positionIfReady:function(){if(!this._positioned&&this.inDom&&this.contentReady){this._positioned=!0;var e=this._frameBounds={left:this.$holder.width()/2-this.options.size.width/2,width:this.options.size.width,top:this.options.padding,height:this.options.size.height};e.ratio=e.height/e.width,this.$frame.css(e);var t=this.$mask.children();t.eq(0).css({top:0,left:0,right:0,height:e.top}),t.eq(1).css({top:e.top,left:e.left+e.width,right:0,height:e.height}),t.eq(2).css({top:e.top+e.height,left:0,right:0,bottom:0}),t.eq(3).css({top:e.top,left:0,width:e.left,height:e.height}),this.options.image_url&&this.setImage(this.options.image_url)}},initImage:function(){if(!this.$img.height()||!this.$img.width())return void _.delay(this.initImage.bind(this),200);var e=this._imageBounds={nativeWidth:this.$img.width(),nativeHeight:this.$img.height()};e.ratio=e.nativeHeight/e.nativeWidth,this.$img.addClass(this.CssClassName.IMAGE_AREA),this._fitImage(),this._centerImage(),this._hideSpinner()},onStartDrag:function(e){var t="touchstart"===e.type;t?this._mousePosition={x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}:this._mousePosition={x:e.pageX,y:e.pageY},this._startPosition={x:parseInt(this.$bg.css("left"),10),y:parseInt(this.$bg.css("top"),10)},$("body").on({"mousemove.ImageCrop touchmove.ImageCrop":this.onDragging.bind(this),"mouseup.ImageCrop touchend.ImageCrop":this.onStopDragging}),e.preventDefault()},onDragging:function(e){e.preventDefault();var t="touchmove"===e.type,o=t?e.originalEvent.changedTouches[0]:e,n=o.pageX-this._mousePosition.x,a=o.pageY-this._mousePosition.y,r={top:this._startPosition.y+a,left:this._startPosition.x+n};this._clampValues(r),this.$bg.css(r)},onStopDragging:function(e){$("body").off("mousemove.ImageCrop mouseup.ImageCrop touchmove.ImageCrop touchend.ImageCrop")},_clampValues:function(e){e.top=Math.min(e.top,this._frameBounds.top),e.left=Math.min(e.left,this._frameBounds.left),e.top+this._imageBounds.height<this._frameBounds.top+this._frameBounds.height&&(e.top=this._frameBounds.top+this._frameBounds.height-this._imageBounds.height+1),e.left+this._imageBounds.width<this._frameBounds.left+this._frameBounds.width&&(e.left=this._frameBounds.left+this._frameBounds.width-this._imageBounds.width+1)},setImage:function(e){this._showSpinner(),this.$img=$("<img>",{src:e}),this.$bg.empty().append(this.$img),this.initImage()},_fitImage:function(){var e;e=this._imageBounds.ratio>=this._frameBounds.ratio?this._frameBounds.width/this._imageBounds.nativeWidth:this._frameBounds.height/this._imageBounds.nativeHeight,this._scaleImage(e)},_centerImage:function(){var e=this.$holder.height(),t=this.$holder.width();this.$bg.css({top:e/2-this.$bg.height()/2+1,left:t/2-this.$bg.width()/2+1})},_scaleImage:function(e){var t=this._imageBounds.width=this._imageBounds.nativeWidth*e,o=this._imageBounds.height=this._imageBounds.nativeHeight*e;this.$img.css({width:t,height:o})},_showSpinner:function(){this.$spinner.show()},_hideSpinner:function(){this.$spinner.hide()},getCropData:function(){var e={x:-1*(parseInt(this.$bg.css("left"),10)-parseInt(this._frameBounds.left,10)),y:-1*(parseInt(this.$bg.css("top"),10)-parseInt(this._frameBounds.top,10))},t=this.$img.width()/this._imageBounds.nativeWidth,o={crop_x:e.x,crop_y:e.y,nativeHeight:this._imageBounds.nativeHeight,nativeWidth:this._imageBounds.nativeWidth,height:this.options.size.height,width:this.options.size.width,scale:t};return o}}),P.modules.ImageCrop.prototype.className="ImageCrop",goog.provide("P.modules.ImageUploader"),goog.require("P.Module"),goog.require("P.url"),goog.require("P.i18n"),goog.require("P.errorUtil"),P.modules.ImageUploader=P.Module.extend({CssClassName:{IS_SELECTED:"selected"},onCreated:function(){this.onUploaderSubmit=this.onUploaderSubmit.bind(this),this.onUploaderComplete=this.onUploaderComplete.bind(this),this.onUploaderProgress=this.onUploaderProgress.bind(this),this.onUploaderError=this.onUploaderError.bind(this)},enable:function(){this.getButton().enable()},disable:function(){this.getButton().disable()},select:function(){this._setSelected(!0)},_setSelected:function(e){this.$el.toggleClass(this.CssClassName.IS_SELECTED,e)},deselect:function(){this._setSelected(!1)},onContentReady:function(){this.ensureUploader()},getUploadUrl:function(){return P.url.absolutify("/upload-image/")},getFileNameElement:function(){return this.$fileName||(this.$fileName=this.$(".uploaderProgress").find("span")),this.$fileName},getButton:function(){return this.getChildById("upload")},ensureUploader:function(){o.e(15,function(){var e=o(200);this.uploader=new e.FineUploaderBasic({debug:Pc.DEBUG,button:this.getButton().$el.get(0),multiple:!1,request:{endpoint:this.getUploadUrl(),inputName:"img",forceMultipart:!0,customHeaders:{"X-CSRFToken":P.csrf.getCSRFToken()}},callbacks:{onUpload:this.onUploaderSubmit,onComplete:this.onUploaderComplete,onProgress:this.onUploaderProgress,onError:this.onUploaderError,showAlert:function(e){this.log.debug(e)}.bind(this)}})}.bind(this))},onUploaderSubmit:function(e,t){this.getButton().showLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_START),this.log.debug("UploaderSubmit",arguments)},onUploaderComplete:function(e,t,o){o.success&&(this.getButton().hideLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_SUCCESS,o,!0),this.getFileNameElement().text(o.filename),this.log.debug("UploaderComplete",arguments))},onUploaderProgress:function(e,t,o,n){var a=Math.round(o/n*100);this.triggerEvent(P.CONST.EVENT_UPLOAD_PROGRESS,{loaded:o,total:n,percent:a}),this.getFileNameElement().text(a+"%"),this.log.debug("UploaderProgress",arguments)},resetFileNameElement:function(){this.getFileNameElement().text("")},onUploaderError:function(e,t,o){this.getButton().hideLoading(),this.log.debug("UploaderError",arguments),o===P.CONST.RESPONSE_CODE_REQUEST_TOO_LARGE?P.errorUtil.showError(P.i18n._("Oops! That file is too big. Please make it smaller and try again.")):P.errorUtil.showError(P.i18n._("Oops! Uploading that image didn't work. Please try again.")),this.resetFileNameElement()}}),P.modules.ImageUploader.prototype.className="ImageUploader",goog.provide("P.modules.ImagesFeedPage"),goog.require("P.Module"),P.modules.ImagesFeedPage=P.Module.extend({onContentReady:function(){this.imagesGrid=this.getChildById("imagesGrid"),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged);var e=this.getChildById("domainPinsGrid");e&&0===e.children.length?e.destroy():this.$(".domainPinsHolder").css("visibility","visible")},onChildContentChanged:function(){this.imagesGrid&&!this.imagesGrid.hasItems()&&(this.resource=null,this.render())}}),P.modules.ImagesFeedPage.prototype.className="ImagesFeedPage",goog.provide("P.modules.ImportantImage"),goog.require("P.Module"),P.modules.ImportantImage=P.Module.extend({}),P.modules.ImportantImage.prototype.className="ImportantImage",goog.provide("P.modules.InlineHoverButton"),goog.require("P.Module"),P.modules.InlineHoverButton=P.Module.extend({}),P.modules.InlineHoverButton.prototype.className="InlineHoverButton",goog.provide("P.modules.InlineSignup"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.url"),goog.require("P.SocialConnect"),P.modules.InlineSignup=P.Module.extend({onContentReady:function(){this.multiStepSignupSetup(),this.loginButton=this.getChildById("loginButton"),this.facebookConnectButton=this.getChildById("facebookConnectButton"),this.facebookConnectButton&&this.listen(this.facebookConnectButton,P.CONST.FACEBOOK_LOGIN_FAILURE,this.onFacebookLoginFailure),this.childListen(P.CONST.EVENT_USER_REGISTER,this.onRegisterSuccess),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_FACEBOOK_REQUIRE_EMAIL,this.showFacebookTooltip),this.listen(this,P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},multiStepSignupSetup:function(){this.facebookTooltip=this.$(".facebookTooltip"),this.tosFooter=this.$(".outerTermsOfServiceFooter"),this.groupSeparatorDiv=this.$(".groupSeparatorDark"),this.step1Bottom=this.$(".step1Bottom"),this.childListen("toggleMultiStep",function(e){this.$el.toggleClass("secondStep"),this.titleText&&this.setHeader(e)}),this.groupSeparatorDiv.show(),this.step1Bottom.show(),this.tosFooter.show(),P.util.trackRegisterAction("register_multi_screen_username_pass_loaded")},setMultiStepHeader:function(e,t){this.$title=this.$(e),this.titleText=t},setHeader:function(e){this.$title.css({opacity:0}).html(e.data.step1?this.titleText.step1:this.titleText.step2).animate({opacity:1},P.CONST.TRANSITION_DELAY)},onRegisterSuccess:function(e){this.options.open_new_window_on_success?(e.stopPropagation(),P.util.changeWindowLocation("/",!0),window.close()):(e.stopPropagation(),P.util.changeWindowLocation("/"))},onChildNavigate:function(e){if(this.options.next&&e.data&&-1!==e.data.url.indexOf("/login/")){var t=P.url.getQueryStringParams();t.next=this.options.next,this.options.auto_follow&&(t.auto_follow=this.options.auto_follow),e.data.url=P.url.appendQueryString(e.data.url,t)}},showFacebookTooltip:function(e){this.facebookTooltip.fadeIn(500)},onFacebookLoginFailure:function(e){e.stopPropagation(),P.util.trackRegisterAction("contextual_signup_join_facebook"),this.facebookConnectButton.showLoading(),P.UserRegistration.fetchNetworkData(P.SocialConnect.FACEBOOK).then(function(e){this.log.debug("FB data:",e),this.facebookConnectButton.hideLoading()}.bind(this))}}),P.modules.InlineSignup.prototype.className="InlineSignup",goog.provide("P.modules.Input"),goog.require("P.Module"),P.modules.Input=P.Module.extend({onContentReady:function(){this._value=this.options.value||"",this.options.placeholder&&this.$el.placeholder()},setValue:function(e){this.$el.val(e)},getValue:function(){return this.$el.val()},focus:function(){this.$el.focus()},clear:function(){this.setValue("")},clearPlaceholder:function(){this.options.placeholder&&(this.$el.attr("placeholder",""),this.$el.val(""))},restorePlaceholder:function(){this.options.placeholder&&this.$el.attr("placeholder",this.options.placeholder)},setCursorPosition:function(e){this.$el[0].setSelectionRange(e,e)}}),P.modules.Input.prototype.className="Input",goog.provide("P.modules.Interest"),goog.require("P.Module"),P.modules.Interest=P.Module.extend({events:{"click .interestWrapper":"onInterestImageClick","click .wholeInterestMask":"onInterestImageClick"},CssClassName:{IS_CHECKED:"checked",HIDDEN:"hidden"},onContentReady:function(){this.followButton=this.getChildByModuleName("InterestFollowButton"),this.homefeedSetupViewFollowButton=this.getChildByModuleName("MockInterestFollowButton"),this.isFollowed=this.data.is_followed,this.followButton&&this.listen(this.followButton,P.CONST.EVENT_BUTTON_CLICK,this.onFollowButtonClick),this.homefeedSetupViewFollowButton&&this.listen(this.homefeedSetupViewFollowButton,P.CONST.EVENT_BUTTON_CLICK,this.onHomefeedSetupViewFollowButtonClick);var e=this.data.id;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onInterestFollowOrUnfollow,t[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onInterestFollowOrUnfollow,this.pubsubSubscribe(e,t)}},onFollowButtonClick:function(){this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,this.data,!0),this.toggleVisualState()},onHomefeedSetupViewFollowButtonClick:function(){this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,this.data,!0),this.toggleVisualState()},onInterestImageClick:function(){this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,this.data,!0),this.toggleVisualState();var e=this.$(".interestWrapper");e.is("div")&&(this.followButton&&this.followButton.toggleFollow(),this.homefeedSetupViewFollowButton&&this.homefeedSetupViewFollowButton.toggleState())},onInterestFollowOrUnfollow:function(e,t){if(this.followButton&&"homefeedSetupView"!==this.options.view_type){var o=this.followButton.options.followed;this.setVisualState(o)}},setVisualState:function(e){this._updateFollowState(e),this.options.show_mask&&this.$(".wholeInterestMask").toggle(e),this.options.checkable&&this.$(".selectCheck").toggleClass(this.CssClassName.IS_CHECKED,e)},showOverflowMask:function(e){var t=this.$(".overflowMask");if(t&&e){var o=t.find(".text");o&&o.text(e)}t.show();var n=this.$(".interestWrapper");n.addClass(this.CssClassName.HIDDEN),n.css("box-shadow","none")},_updateFollowState:function(e){this.isFollowed=e;var t=this.isFollowed?P.CONST.EVENT_INTEREST_FOLLOW:P.CONST.EVENT_INTEREST_UNFOLLOW,o=_.extend({},this.data,{is_followed:this.isFollowed});this.triggerEvent(t,o,!0)},toggleVisualState:function(){this.setVisualState(!this.isFollowed)}}),P.modules.Interest.prototype.className="Interest",goog.provide("P.modules.InterestFeedPage"),goog.require("P.Module"),goog.require("P.unauthUsage"),P.modules.InterestFeedPage=P.Module.extend({CssClassName:{BACKWARDS:"backwards"},_hexToRGB:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:150,g:156,b:157}},onContentReady:function(){P.user.instance.isAuthenticated()||(Cookie.set(P.CONST.COOKIE_LAST_UNAUTH_INTEREST_ID,this.data.id),P.unauthUsage.logUrl());var e=this.$(".interestHeaderBackground");if(e.length){var t="left",o=e.attr("style").replace("background-color: ","");e.hasClass(this.CssClassName.BACKWARDS)&&(t="right");var n=this._hexToRGB(o),a=n.r,r=n.g,i=n.b,s="rgba("+a+","+r+","+i+",1) 0%,",l=s+" rgba("+a+","+r+","+i+",0) 17%,",u=l+" rgba("+a+","+r+","+i+",0) 17%,",d=u+" rgba("+a+","+r+","+i+",1) 35%,",c=d+" rgba("+a+","+r+","+i+",1) 100%",p="background: linear-gradient(to "+t+", "+c+");";this.$(".bgGradient").attr("style","background-color: "+o+";"+p),this.$(".rightImage").delay(1e3).animate({opacity:.7},{duration:500})}}}),P.modules.InterestFeedPage.prototype.className="InterestFeedPage",goog.provide("P.modules.InterestRecommendationsModule"),goog.require("P.Module"),P.modules.InterestRecommendationsModule=P.Module.extend({}),P.modules.InterestRecommendationsModule.prototype.className="InterestRecommendationsModule",goog.provide("P.modules.InternationalSubdomains"),goog.require("P.Module"),P.modules.InternationalSubdomains=P.Module.extend({}),P.modules.InternationalSubdomains.prototype.className="InternationalSubdomains",goog.provide("P.modules.InviteButtonEmail"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.toastsManager"),P.modules.InviteButtonEmail=P.Module.extend({events:{"click .btn":"onButtonClick"},CssClassName:{INVITE_DISABLED:"inviteDisabled"},onContentReady:function(){this.data&&(this.email=this.data.id,this.enabled=!0)},disableInvite:function(){this.enabled=!1,this.$el.addClass(this.CssClassName.INVITE_DISABLED)},_onInvite:function(e){if(e){var t={recipients:this.email};this.triggerEvent(P.CONST.EVENT_INVITE_USER,t,!0);var o={name:"ActionSuccessToast",id:"inviteSuccessToast",options:{view_type:"inviteContact"},data:this.data};P.moduleFactory.load(o).then(function(e){P.toastsManager.instance.addToast(e)})}},onButtonClick:function(){return this.email&&this.enabled&&(this.disableInvite(),P.Invite.userInviteEmail(this.email,this._onInvite.bind(this))),!1}}),P.modules.InviteButtonEmail.prototype.className="InviteButtonEmail",goog.provide("P.modules.InviteButtonFacebook"),goog.require("P.Module"),P.modules.InviteButtonFacebook=P.Module.extend({onContentReady:function(){this.inviteButton=this.getChildById("facebookInvite"),this.listen(this.inviteButton,P.CONST.EVENT_BUTTON_CLICK,this.onFacebookInvite)},onFacebookInvite:function(){P.Invite.userInviteFacebook(null,function(){})}}),P.modules.InviteButtonFacebook.prototype.className="InviteButtonFacebook",goog.provide("P.modules.InviteContact"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.toastsManager"),goog.require("P.resourceFactory"),P.modules.InviteContact=P.Module.extend({events:{click:"onContactClick","click .dismiss":"onDismissClick"},CssClassName:{DISABLED:"disabled",INVITED:"invited"},onContentReady:function(){this.data&&(this.email=this.data.id)},onDismissClick:function(e){var t=$(e.currentTarget.parentElement);return t.hasClass(this.CssClassName.DISABLED)?!1:(this._deleteContact(t),!1)},onContactClick:function(e){var t=$(e.currentTarget);return t.hasClass(this.CssClassName.DISABLED)?!1:(this.email&&(t.addClass(this.CssClassName.INVITED),this._onContactDisabled(t),P.Invite.userInviteEmail(this.email,function(e){e&&this._onInviteSuccess()}.bind(this))),!1)},_onInviteSuccess:function(){var e={recipients:this.email};this.triggerEvent(P.CONST.EVENT_INVITE_USER,e,!0);var t={name:"ActionSuccessToast",id:"inviteSuccessToast",options:{view_type:"inviteContact"},data:{id:this.email}};P.moduleFactory.load(t).then(function(e){P.toastsManager.instance.addToast(e)})},_deleteContact:function(e){var t={emails:[this.email]},o=P.resourceFactory.instance.create("UserAddressBookRecommendationsResource",t);return o.callDelete().then(function(){this._onContactDisabled(e)}.bind(this))},_onContactDisabled:function(e){return e.addClass(this.CssClassName.DISABLED),new Promise(function(e,t){setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),e()}.bind(this),500)}.bind(this))}}),P.modules.InviteContact.prototype.className="InviteContact",goog.provide("P.modules.InviteListBase"),goog.require("P.Module"),goog.require("P.TypeaheadProvider");var X=2500,Z=["google","yahoo","microsoft","invitability"];P.modules.InviteListBase=P.Module.extend({events:{"click .inviteAllLabel":"_onClickInviteAll",'textchange input[type="text"]':"_onTextChange"},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.scrollableElement=this.$(".inviteContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this._onInviteScroll),this.inviteList=this.getChildById("inviteList"),this.emptyResultsFooter=this.$(".emptyResultsFooterContainer"),this.sendButton=this.getChildById("inviteButton"),this.options.checkable&&(this.inviteAllCheck=this.getChildById("inviteAllCheck")),this._reset()},_reset:function(){this.checkedContacts={},this.options.checkable&&(this.sendButton.setEnabled(!1),this.childListen(P.CONST.EVENT_CHANGE,this._onChange)),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onClick),this._onInviteScroll=this._onInviteScroll.bind(this),this._onInviteScroll=_.throttle(this._onInviteScroll,200);var e={name:"invite",tags:this.options.network,count:50};this.typeahead=new P.TypeaheadProvider(e),this.typeahead.prefetch(),this.listen(this.typeahead,P.CONST.EVENT_DATA,this.onTypeaheadData)},_onInviteScroll:function(){if(!this.rendering&&this._searchIsEmpty()){var e=this.$(".List");if(e.position()){var t=e.height()+e.position().top-this.scrollableElement.height();X>=t&&this._fetchMore()}return!1}},_onChange:function(e){var t=e.target;if("inviteAllCheck"===t.id)this._onToggleInviteAll(e);else{for(var o=0,n=0;n<this.inviteList.children.length;n++){var a=this.inviteList.children[n];this.checkedContacts[a.getEmail()]=a.isChecked(),o+=a.isChecked()?1:0}this._searchIsEmpty()&&this.inviteAllCheck.setChecked(o===this.inviteList.children.length,!1);var r=0;for(var i in this.checkedContacts)this.checkedContacts[i]&&r++;this.sendButton.setEnabled(r>0)}},_onClick:function(e){"inviteButton"===e.target.id&&this._onClickInvite(e)},_fetchMore:function(){return this.inviteList.options.item_options.checkedAll=this.inviteAllChecked(),this.resource.atEnd()?void this.removeListener(this._scrollListener):(this.rendering=!0,void this.getChildById("inviteList").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1}.bind(this)))},_onTextChange:function(e){this._filterResults()},onTypeaheadData:function(e){if(!this._searchIsEmpty()&&this._getSearchText()===e.term){var t=[];_.each(e.items,function(e){var o=$.extend({},e);$.inArray(this.options.network,Z)>=0&&(o.id_type="email"),this.options.checkable&&(this.checkedContacts[o.id]|=this.inviteAllChecked(),o.checked=this.checkedContacts[o.id]),t.push(o)}.bind(this)),this.inviteList.options.items=t,this.inviteList.resource=null,this.inviteList.render(),t.length?this.emptyResultsFooter.hide():this.emptyResultsFooter.show()}},_filterResults:function(e){this._searchIsEmpty()?(this.inviteList.resource||this.inviteList.renderAbort(),this.emptyResultsFooter.hide(),this.inviteList.resource=this.resource,delete this.inviteList.options.items,this.inviteList.render().then(function(){this._searchIsEmpty()&&(this.options.checkable&&_.each(this.inviteList.children,function(e){e.setChecked(this.checkedContacts[e.getEmail()],!1)}.bind(this)),e&&e())}.bind(this))):this.typeahead.search(this._getSearchText(),function(){})},_getSearchText:function(){return this.$("input[type='text']").val().toLowerCase()},_searchIsEmpty:function(){var e=this._getSearchText();return!e||""===e},inviteAllChecked:function(){return this.options.checkable&&this.inviteAllCheck.isChecked()},_onClickInvite:function(e){this.sendInvitesClicked()},_onToggleInviteAll:function(e){this._getSearchText()?(this.$("input[type='text']").val(""),this._filterResults(function(){this._toggleInviteAll()}.bind(this))):this._toggleInviteAll()},_onClickInviteAll:function(){this.inviteAllCheck.setChecked(!this.inviteAllChecked()),this._onToggleInviteAll()},_toggleInviteAll:function(){var e=this.inviteAllChecked();_.each(this.inviteList.children,function(t){this.checkedContacts[t.getEmail()]=e,t.setChecked(e)}.bind(this)),this.sendButton.setEnabled(e)},getCheckedContacts:function(){return this.checkedContacts},sendInvitesClicked:function(){}}),P.modules.InviteListBase.prototype.className="InviteListBase",goog.provide("P.modules.InviteListEmail"),goog.require("P.modules.InviteListBase"),goog.require("P.string"),goog.require("P.resourceFactory"),P.modules.InviteListEmail=P.modules.InviteListBase.extend({onContentReady:function(){P.modules.InviteListBase.prototype.onContentReady.apply(this,arguments),this.sendInvitationEmailModule=this.getChildById("sendInvitationEmailModule")},onTypeaheadData:function(e){P.modules.InviteListBase.prototype.onTypeaheadData.apply(this,arguments);var t=e.term,o=P.string.isEmailAddress(t);this.sendInvitationEmailModule.options={text_value:t,is_valid_email:o},this.sendInvitationEmailModule.render()},sendInvitesClicked:function(){var e,t=[],o="invitability"===this.options.network;if(this.inviteAllChecked()&&!o)e=P.resourceFactory.instance.create("BulkNetworkInviteResource",{network:this.options.network});else{var n=this.getCheckedContacts();for(var a in n)n[a]&&t.push(a);var r=this.inviteAllChecked()&&o;if(e=P.resourceFactory.instance.create("UserMultiInviteResource",{emails:t,invite_all:r}),!this.inviteAllChecked()&&o){var i=P.resourceFactory.instance.create("InviteSentLogResource",{emails_invited:t});i.callCreate()}}this.sendButton.showLoading(),this._triggerInviteEventWithData(e,t)},_triggerInviteEventWithData:function(e,t){e.callCreate().then(function(){this.sendButton.hideLoading(),this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)}.bind(this))}}),P.modules.InviteListEmail.prototype.className="InviteListEmail",goog.provide("P.modules.InviteListFacebook"),goog.require("P.Module"),goog.require("P.modules.InviteListBase"),P.modules.InviteListFacebook=P.modules.InviteListBase.extend({onContentReady:function(){P.modules.InviteListBase.prototype.onContentReady.apply(this,arguments),P.fb.ensureInit(function(){},P.user.instance)}}),P.modules.InviteListFacebook.prototype.className="InviteListFacebook",goog.provide("P.modules.InviteModal"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),P.modules.InviteModal=P.Module.extend({}),P.modules.InviteModal.showInviteModal=function(e,t){var o={name:"InviteModal",options:{page:t},resource:{name:"UserResource",options:{user_id:e}}};P.moduleFactory.load(o).then(function(e){P.modalManager.get().createAndShowModal(e,{can_dismiss:!1})})},P.modules.InviteModal.prototype.className="InviteModal",goog.provide("P.modules.InvitePanelEmail"),goog.require("P.Module"),goog.require("P.validator"),goog.require("P.moduleFactory"),goog.require("P.toastsManager"),P.modules.InvitePanelEmail=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_ITEM_SELECTED,this._onChildItemSelected),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this._onChildEnterPressed),this.childListen(P.CONST.EVENT_CONTACT_SELECTED,this._onRecentContactSelected)},_onChildItemSelected:function(e){var t=e.data.item,o=t.attributes;this._inviteUser(o),e.stopPropagation()},_onRecentContactSelected:function(e){var t=e.data.type;"emailcontact"===t&&this._inviteEmail(e.data.email_address),e.stopPropagation()},_onItemSelected:function(){var e=this.getChildById("typeaheadField");e.reset(),this.showLoading(!0)},_onChildEnterPressed:function(e){var t=this.getChildById("typeaheadField"),o=t.getField(),n=new P.validator.Validator(o,[P.validator.Length({min:1}),P.validator.Email()]);n.validate(this._handleEmailValidation.bind(this)),e.stopPropagation()},_handleEmailValidation:function(e){var t=this.getChildById("typeaheadField"),o=t.getValue();e.errors&&0!==e.errors.length||this._inviteEmail(o)},_onInvited:function(e){if(this.hideLoading(),e){var t={name:"ActionSuccessToast",id:"inviteSuccessToast",options:{view_type:"inviteContact"},data:{id:this.email}};P.moduleFactory.load(t).then(function(e){P.toastsManager.instance.addToast(e)})}},_inviteEmail:function(e){this.email=e,this._onItemSelected(),P.Invite.userInviteEmail(e,this._onInvited.bind(this))},_inviteUser:function(e){var t=e.email;this._onItemSelected(),this._inviteEmail(t)}}),P.modules.InvitePanelEmail.prototype.className="InvitePanelEmail",goog.provide("P.modules.InviteTiles"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.toastsManager"),P.modules.InviteTiles=P.Module.extend({onCreated:function(){var e={};e[P.CONST.PUBSUB_TOPIC_FRIEND_CENTER_NO_RECS]=this.handleRecommendationsEmpty,
e[P.CONST.PUBSUB_TOPIC_FRIEND_IMPORT_COMPLETED]=this.handleFriendImportCompleted,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.childListen(P.CONST.EVENT_DISMISS,this.onDismiss),this.childListen(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,this.onSocialNetworkConnect),this.pendingMoreRequest=!1},onContentReady:function(){this.scrollableElement||(this.contacts=this.data,this.scrollableElement=this.getScrollableElement(),this.scrollListener=this.listen(this.scrollableElement,P.CONST.EVENT_SCROLL,this._onScroll))},CssClassName:{NO_RECS:"noRecs"},PAGE_SIZE:50,HEIGHT_BEFORE_BOTTOM_FOR_FETCHING_MORE:800,handleRecommendationsEmpty:function(){this.$el.addClass(this.CssClassName.NO_RECS)},onSocialNetworkConnect:function(e){var t=e.data.network,o=P.SocialNetworkSettingsManager.instance(),n={username:P.user.instance.attributes.username},a={resourceOptions:n};o.pollForFriends(t,a)},_fetchMore:function(){this.resource.options.page_size=this.PAGE_SIZE;var e=this.resource.getLatestBookmark();return e&&this.resource.setBookmarks([e]),this.pendingMoreRequest=!0,this.options.only_show_contacts=!0,new Promise(function(e,t){this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.pendingMoreRequest=!1,this.options.only_show_contacts=!1,e()}.bind(this),function(){this.pendingMoreRequest=!1,this.options.only_show_contacts=!1,t()}.bind(this))}.bind(this))},_getHeightBeforeBottomReached:function(){var e=this.scrollableElement.scrollTop(),t=this.scrollableElement.height();return $(document).height()-e-t},_onScroll:function(){this.resource&&this.resource.atEnd()||this.pendingMoreRequest||this._getHeightBeforeBottomReached()<this.HEIGHT_BEFORE_BOTTOM_FOR_FETCHING_MORE&&this._fetchMore()},handleFriendImportCompleted:function(e,t,o){if(!o.error){var n=o.network;return this.render().then(function(){var e={name:"ActionSuccessToast",options:{view_type:"contactsAdded"},data:{network:n}};P.moduleFactory.load(e).then(function(e){P.toastsManager.instance.addToast(e)})})}},onDismiss:function(e){var t=e.currentTarget;t.fadeOut(t.destroy.bind(t))}}),P.modules.InviteTiles.prototype.className="InviteTiles",goog.provide("P.modules.KLPBar"),goog.require("P.Module"),P.modules.KLPBar=P.Module.extend({onContentReady:function(){this.isEmpty()?P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_KLP_BAR,P.CONST.PUBSUB_TOPIC_KLP_BAR_HIDDEN):(this.show(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_KLP_BAR,P.CONST.PUBSUB_TOPIC_KLP_BAR_SHOWN))}}),P.modules.KLPBar.prototype.className="KLPBar",goog.provide("P.modules.Label"),goog.require("P.Module"),P.modules.Label=P.Module.extend({}),P.modules.Label.prototype.className="Label",goog.provide("P.modules.LanguageDropdown"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.url"),P.modules.LanguageDropdown=P.Module.extend({events:{"click .language":"onClick"},onClick:function(e){var t=$(e.currentTarget),o=P.url.appendQueryString(t.attr("data-url"),P.url.getQueryStringParams());return P.util.trackRegisterAction("language_dropdown_clicked"),this.navigate(o,null,P.genConst.ForceRefreshType.PAGE),!1}}),P.modules.LanguageDropdown.prototype.className="LanguageDropdown",goog.provide("P.modules.LanguageMenu"),goog.require("P.Module"),P.modules.LanguageMenu=P.Module.extend({}),P.modules.LanguageMenu.prototype.className="LanguageMenu",goog.provide("P.modules.LikeButton"),goog.require("P.modules.Button"),goog.require("P.util"),goog.require("P.url"),goog.require("P.i18n"),P.modules.LikeButton=P.modules.Button.extend({CssClassName:_.extend(P.modules.Button.prototype.CssClassName,{UNLIKE:"unlike",LIKE:"like"}),ButtonText:{UNLIKE:P.i18n._("Unlike"),LIKE:P.i18n._("Like")},onClick:function(){this.ensureAuthentication()&&this._toggle()},getAuthRedirectUrl:function(){return P.user.instance.isAuthenticated()?void P.util.changeWindowLocation(P.url.getRegisterUrl({action:"like"}),!1):P.signupModalManager.showInlineSignupModalOnButtonClick("LikeButton")},setState:function(e){var t=this.$el;this.options.liked=e,t.toggleClass(this.CssClassName.UNLIKE,e),e?this.options.show_text?this.$(".buttonText").html(this.ButtonText.UNLIKE):this.setAccessibilityText(this.ButtonText.UNLIKE):this.options.show_text?this.$(".buttonText").html(this.ButtonText.LIKE):this.setAccessibilityText(this.ButtonText.LIKE)},getLikeResource:function(e){throw new Error("must be overridden")},onOptimisticToggle:function(e){},onToggleSuccess:function(e){},_toggle:function(){var e=!this.options.liked,t=this.getLikeResource(e);if(t){var o=e?t.callCreate():t.callDelete();this.options.optimistic?(this.setState(e),this.onOptimisticToggle(e),o.then(function(){this.onToggleSuccess(e)}.bind(this),function(){this.setState(!e)}.bind(this))):(this.showLoading(),o.then(function(){this.setState(e),this.onToggleSuccess(e)}.bind(this)).fin(function(){this.hideLoading()}.bind(this)))}}}),P.modules.LikeButton.prototype.className="LikeButton",goog.provide("P.modules.LikeCount"),goog.require("P.Module"),P.modules.LikeCount=P.Module.extend({}),P.modules.LikeCount.prototype.className="LikeCount",goog.provide("P.modules.List"),goog.require("P.Module"),P.modules.List=P.Module.extend({events:{"click li":"onItemClick"},onItemClick:function(e){this.triggerEvent(P.CONST.EVENT_LIST_ITEM_CLICK,e.target,!1)},onChildRemoved:function(e,t){t.remove()},hasMoreItems:function(){return this.resource&&!this.resource.atEnd()},requestMoreItems:function(){this._requestMoreItems()},_requestMoreItems:function(e){_.isUndefined(e)&&(e=2),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0),this.renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0)}.bind(this),function(){e>0&&this._requestMoreItems(e-1),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_ERROR,null,!0)}.bind(this))},setPageSize:function(e){this.resource&&this.resource.set("page_size",e)}}),P.modules.List.prototype.className="List",goog.provide("P.modules.LoginBase"),goog.require("P.CONST"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.url"),goog.require("P.ga"),goog.require("P.i18n"),goog.require("P.errorUtil"),goog.require("P.validator"),goog.require("P.errorUtil"),goog.require("P.router"),goog.require("P.resourceFactory"),goog.require("P.SocialConnect"),P.modules.LoginBase=P.Module.extend({events:{},onContentReady:function(){var e=P.url.getQueryStringParams().message;if(e){var t;"reactivate"===e?t=P.i18n._("Your account has been reactivated! Please log in to continue."):"permanent_account_closure"===e&&(t=P.i18n._("Thanks for giving Pinterest a try. Your account will be closed soon.")),this.showError(t)}this.setupForm(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.getChildById("facebookLogin")&&this.listen(this.getChildById("facebookLogin"),P.CONST.EVENT_BUTTON_CLICK,this.facebookConnect),this.getChildById("twitterLogin")&&this.listen(this.getChildById("twitterLogin"),P.CONST.EVENT_BUTTON_CLICK,this.twitterConnect),this.getChildById("rakutenLogin")&&this.listen(this.getChildById("rakutenLogin"),P.CONST.EVENT_BUTTON_CLICK,this.rakutenConnect),this.getChildById("emailSignup")&&this.listen(this.getChildById("emailSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onEmailSignup),this.getChildById("facebookSignup")&&this.listen(this.getChildById("facebookSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onFacebookSignup),this.getChildById("twitterSignup")&&this.listen(this.getChildById("twitterSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onTwitterSignup),this.getChildById("rakutenSignup")&&this.listen(this.getChildById("rakutenSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onRakutenSignup),P.util.trackRegisterAction("register_landing")},setupForm:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{username_or_email:[P.validator.Required(),P.validator.Email()],password:[P.validator.Required()]},{})},onSubmitValidated:function(e){if(!e["errors[0]"]){var t=this.form.getValue("username_or_email");this.login({username_or_email:t,password:this.form.getValue("password")}).then(void 0,function(e){if(this.showError(e.message),e.api_error_code===P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE){var o=P.util.getResetPasswordOneClickUrl({username_or_email:t});this.navigate(o)}}.bind(this))}},twitterConnect:function(e){e.stopPropagation(),this.connect(P.SocialConnect.TWITTER,this.onTwitterConnectSuccess.bind(this))},facebookConnect:function(e){e.stopPropagation(),this.connect(P.SocialConnect.FACEBOOK,this.onFacebookConnectSuccess.bind(this))},rakutenConnect:function(e){e.stopPropagation(),this.connect(P.SocialConnect.RAKUTEN,this.onRakutenConnectSuccess.bind(this))},onEmailSignup:function(e){P.util.trackRegisterAction("register_email")},onFacebookSignup:function(e){e.stopPropagation(),P.util.trackRegisterAction("register_facebook_attempt"),this.facebookConnect(e)},onTwitterSignup:function(e){e.stopPropagation(),P.util.trackRegisterAction("register_twitter_attempt"),this.twitterConnect(e)},onRakutenSignup:function(e){e.stopPropagation(),P.util.trackRegisterAction("register_rakuten_attempt"),this.rakutenConnect(e)},onFacebookConnectSuccess:function(e){this.login({facebook_id:e.id,facebook_token:e.access_token}).then(void 0,this.registerWithFacebook.bind(this))},registerWithFacebook:function(e){if(this.options.register){var t=this.getChildById("facebookSignup");t.showLoading(),P.UserRegistration.fastTrackSocialRegistration(P.SocialConnect.FACEBOOK).then(function(){var e="/";this.options.auto_follow_interest&&(e=P.url.appendQueryString(e,{auto_follow_interest:this.options.auto_follow_interest})),P.util.changeWindowLocation(e,!1)}.bind(this),function(e){e instanceof P.errorUtil.NoEmailProvidedError?(this.rerequestFacebookEmail=!0,this.triggerEvent(P.CONST.EVENT_FACEBOOK_REQUIRE_EMAIL,null,!0)):this.navigate("/join/register/facebook/")}.bind(this)).fin(function(){t.hideLoading()})}else P.errorUtil.showError(e.message)},onTwitterConnectSuccess:function(e){P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_ID,e.id),P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_TOKEN,e.oauth_token),P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_TOKEN_SECRET,e.oauth_secret),P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_FIRST_NAME,e.first_name),P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_LAST_NAME,e.last_name),P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_USERNAME,e.screen_name),P.storage.sessionStorage.setItem(P.CONST.SESSION_TWITTER_IMAGE_URL,e.image_url),this.options.register?this.navigate("/join/register/twitter/"):this.login({twitter_id:e.id,twitter_token:e.oauth_token,twitter_token_secret:e.oauth_secret}).then(void 0,function(e){P.errorUtil.showError(e.message)})},onRakutenConnectSuccess:function(e){P.storage.sessionStorage.setItem(P.CONST.SESSION_RAKUTEN_ID,e.id),P.storage.sessionStorage.setItem(P.CONST.SESSION_RAKUTEN_TOKEN,e.access_token),P.storage.sessionStorage.setItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN,e.refresh_token),P.storage.sessionStorage.setItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME,e.first_name),P.storage.sessionStorage.setItem(P.CONST.SESSION_RAKUTEN_GENDER,e.gender),P.storage.sessionStorage.setItem(P.CONST.SESSION_RAKUTEN_EMAIL,e.email),this.login({rakuten_id:e.id,rakuten_token:e.access_token,rakuten_refresh_token:e.refresh_token}).then(void 0,function(e){if(this.options.register){var t=this.getChildById("rakutenSignup");t.showLoading(),P.UserRegistration.fastTrackSocialRegistration(P.SocialConnect.RAKUTEN).then(function(){P.util.changeWindowLocation("/",!1)},function(){this.navigate("/join/register/rakuten/")}.bind(this)).fin(function(){t.hideLoading()})}else P.errorUtil.showError(e.message)}.bind(this))},showError:function(e){this.$("#errorMessage").html(_.escape(e)),this.$(".loginError").show()},connect:function(e,t){return P.SocialConnect.instance().connect(e,{success:function(e){t(e)},error:function(e){e.alertedUpstream||P.errorUtil.showError(P.i18n.commonStrings.connectError)},rerequest_facebook_email:"facebook"===e&&this.rerequestFacebookEmail}),!1},createAutoFollowResource:function(e,t,o){var n=P.resourceFactory.instance.create(e,t);n.callCreate({showError:!1}).then(function(){P.ga.trackEvent(o,P.CONST.GA_ACTION_SUCCESS)},function(){P.ga.trackEvent(o,P.CONST.GA_ACTION_ERROR)})},autoFollow:function(e){var t=P.router.instance.resolve(e);if(t){var o=t.resource.options,n={UserProfilePage:{resourceName:"UserAutoFollowResource",GACategory:"user_auto_follow",resourceOptions:{username:o.username}},BoardPage:{resourceName:"BoardAutoFollowResource",GACategory:"board_auto_follow",resourceOptions:{username_and_slug:o.username+"/"+o.slug}},InterestFeedPage:{resourceName:"InterestFollowResource",GACategory:"interest_auto_follow",resourceOptions:{interest_list:"favorited",interest_id:o.interest}}};if(t.module in n){var a=n[t.module];this.createAutoFollowResource(a.resourceName,a.resourceOptions,a.GACategory)}}},login:function(e){var t=this.getChildById("loginButton");t&&t.showLoading();var o=P.storage.sessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW);return P.user.instance.login(e).then(function(){this.showLoading(!0),this.options.auto_follow&&this.autoFollow(this.options.next),this.redirect(o)}.bind(this)).fin(function(){t&&t.hideLoading()})},redirect:function(e){var t="/";e&&(e.invite_follow_user?t="/"+e.invite_follow_user+"/":e.invite_follow_board&&(t="/"+e.invite_follow_board+"/"),P.storage.sessionStorage.removeItem(P.CONST.SESSION_KEY_INVITE_FOLLOW));var o=this.options.next||this.options.prev||t;this.options.auto_follow&&(o=P.url.appendQueryString(o,{auto_follow:"true"})),P.util.navigateAfterLoginStatusChange(o)}}),P.modules.LoginBase.prototype.className="LoginBase",goog.provide("P.modules.LoginPage"),goog.require("P.Module"),goog.require("P.windowUtil"),P.modules.LoginPage=P.Module.extend({onAddedToDom:function(){this.resizeWindow(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onContentReady:function(){this.resizeWindow(),P.user.instance.setLoginContainer("login_page")},resizeWindow:function(){this.contentReady&&this.inDom&&P.windowUtil.contain()}}),P.modules.LoginPage.prototype.className="LoginPage",goog.provide("P.modules.LogoutAppUpsell"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.validator"),goog.require("P.resourceFactory"),P.modules.LogoutAppUpsell=P.Module.extend({onAddedToDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onRemovedFromDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onContentReady:function(){this.setupForm(),this.$("form input").first().focus()},setupForm:function(){var e={phone_or_email:[P.validator.PhoneNumber()]};this.form=new P.Form(this.$("form"),e),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.sendButton=this.getChildById("submit_button")},onSubmitValidated:function(e){e.errors&&e.errors.length||this.installAppSms()},onFailure:function(){this.sendButton.hideLoading()},onSuccess:function(){this.$(".dialogInput").hide("fast"),this.$(".dialogSuccess").show("fast")},installAppSms:function(){var e=this.form.getValue("phone_or_email"),t=P.resourceFactory.instance.create("SmsAppInstall",{number:e});this.sendButton.showLoading(),t.callCreate({showError:!1}).then(this.onSuccess.bind(this),this.onFailure.bind(this))}}),P.modules.LogoutAppUpsell.prototype.className="LogoutAppUpsell",goog.provide("P.modules.LogoutPage"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.resourceFactory"),P.modules.LogoutPage=P.Module.extend({events:{},onContentReady:function(){this.logout()},logout:function(){var e=P.resourceFactory.instance.create("UserSessionResource",{disable_auth_failure_redirect:!0}),t=this.options.next||"/";t=P.url.appendQueryString(t,{logged_out:!0}),e.callDelete().then(function(){P.util.trackRegisterAction("logout"),P.storage.sessionStorage.clear(),P.storage.localStorage.clear(),P.user.instance.logout().then(function(){P.util.navigateAfterLoginStatusChange(t)})})}}),P.modules.LogoutPage.prototype.className="LogoutPage",goog.provide("P.modules.Map"),goog.require("P.Module"),goog.require("P.templateLoad"),goog.require("P.timer"),goog.require("P.url"),goog.require("P.MarkerOptions"),goog.require("P.resourceFactory");var Q="pk.eyJ1IjoicGludGVyZXN0IiwiYSI6ImdQSE45XzgifQ.4HhVEoWGNG2ZXxTC1x56kQ",ee=70,te="world",oe="focusOn",ne="board_page",ae="closeup",re="app/common/modules/do/rich-pins/place/Map/",ie=re+"markerPopup.nunjucks",se=re+"markerCluster.nunjucks",le=re+"marker.nunjucks",ue=re+"addToMapToast.nunjucks",de=17,ce=270,pe=3e3,me=500,he=300;P.modules.Map=P.Module.extend({CssClassName:{FADE_OUT_NOT_ACTIONABLE:"fadeOut notActionable",FADE_OUT_UP:"fadeOutUp",HIGHLIGHTED_MARKER_ICON:"highlightedMarkerIcon",TOP_ZINDEX:"topZIndex"},inDesktopPlaceBoard:function(){return this.options.in_desktop_place_board},setup:function(){if(this.map)this.triggerEvent(P.CONST.EVENT_MAP_READY,null,!0);else{var e=this.options.map_id,t=this.options.geocode_query;if(t){var o={query:t},n=P.resourceFactory.instance.create("GeocodeResource",o);n.call("get",{}).then(function(t){var o=t.resource_response.data,n=o.length>0?o[0]:te;this._prepareMap(e,n)}.bind(this),function(t){this._prepareMap(e,null)}.bind(this))}else this._prepareMap(e,null)}},_prepareMap:function(e,t){this._generateMap(e,t),this._initializeMapHandlers(),this._paddingTopLeft=L.point(0,0),this._checkForAndZoomToPin(),this.triggerEvent(P.CONST.EVENT_MAP_READY,null,!0)},_isBoardView:function(){return this.options.view_type===ne},_isCloseupView:function(){return this.options.view_type===ae},_checkForAndZoomToPin:function(){var e=P.url.getQueryStringParams();this._isBoardView()&&e[oe]&&this.markerLayerPromise.then(function(){var t=e[oe];this.openPopupForPin(t)}.bind(this))},resizeMap:function(){var e=this.$el,t=this.map.getSize().x,o=this.map.getSize().y;(e.width()>t||e.height()>o)&&this.map.invalidateSize({pan:!1})},addMarkerToCloseupMap:function(e){P.templateLoad.promise.then(function(){var t={pin:e,highlighted:!0,animated:!1},o=this._generateMarker(t);if(this.options.show_popup_marker){var n=this._generatePopup(t);o.bindPopup(n,{closeButton:!!t.animated,autoPan:!0,maxWidth:P.CONST.PIN_WIDTH,minWidth:P.CONST.PIN_WIDTH})}else o.on("click",function(t){var o={};o[oe]=e.getPinId();var n=e.getBoardUrl(),a=P.url.appendQueryString(n,o);this.navigate(a,null,P.genConst.ForceRefreshType.PAGE,o)}.bind(this));var a=this.map;o.addTo(a);var r=o.getLatLng();a.setView(r,15),this.options.show_popup_marker&&o.openPopup()}.bind(this))},replaceToastWithDefaultPopup:function(e){var t=e._source,o=t.options;o.template=ie;var n=this._generatePopup(o);t.bindPopup(n,{closeButton:!1,autoPan:!1,maxWidth:ce,minWidth:ce})},addMarkerToMap:function(e){P.templateLoad.promise.then(function(){var t=this._generateMarker(e),o=e.placeholder?this.placeholderMarkerLayer:this.markerLayer;if(!e.placeholder){e.animated&&(e.template=ue),_.extend(t.options,e),this.inDesktopPlaceBoard()&&t.on("click",function(e){var t=e.target.pin_id;this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,t,!0)}.bind(this));var n=this._generatePopup(e);t.bindPopup(n,{closeButton:!!e.animated,autoPan:!1,maxWidth:P.CONST.PIN_WIDTH,minWidth:P.CONST.PIN_WIDTH})}t.addTo(o),e.placeholder?t._bringToFront():this.map.fire("moveend")}.bind(this))},toggleTranslucentMarkers:function(e){var t=this.markerLayer.getLayers();_.each(t,function(t){var o=this.markerLayer.getVisibleParent(t);o&&$(o._icon).toggleClass(this.CssClassName.FADE_OUT_NOT_ACTIONABLE,e)}.bind(this))},_generateMarker:function(e){var t=e.pin,o=e.highlighted,n=e.animated,a=e.coordinates||t.getCoordinates&&t.getCoordinates(),r=e.name,i=e.placeholder,s={highlighted:o,animated:n,placeholder:i,pin:t};r&&(s.name=r);var l,u;if(t){l=t.getPinId();var d=t.getPlaceData();d&&(u=d.id)}"place"in e&&(u=e.place.id);var c=this._generateDivIcon(s),p=L.marker(a,{icon:c,riseOnHover:!0,pin_id:l,place:u});return l&&(p.pin_id=l),p},_generatePopup:function(e){var t=e.pin,o=e.name||t.getPlaceName(),n=t.getPlaceData()||e,a=e.template||ie,r=P.nunjucks.render(a,{name:o,place:n,url:n.url,is_modular_closeup:this.options.show_popup_marker});return r},_generateDivIcon:function(e){var t=this._getDivIconOptions(e),o=L.divIcon(t);return o},clearMarkers:function(){this.markerLayer.clearLayers()},getCityBoundsFromCenter:function(e){var t=.05;return this.makeLatLngBoundsFromLatLngAndPadding(e,t)},makeLatLngBoundsFromLatLngAndPadding:function(e,t){var o=L.latLng(e.lat-t,e.lng-t),n=L.latLng(e.lat+t,e.lng+t);return L.latLngBounds(o,n)},getCenter:function(){var e=this.map&&this.map.getCenter();return e?e:null},setPaddingTopLeft:function(e){this._paddingTopLeft=e},getZoom:function(){return this.map?this.map.getZoom():null},getBounds:function(){return this.map?this.map.getBounds():null},zoomToAndHighlightMarkerForPinId:function(e){this.map.once("moveend",function(){this.highlightMarkerForPinId(e)}.bind(this)),this.fitViewToMarkerForPinId(e)},highlightMarkerForPinId:function(e){this._setHighlightMarkerForPinId(e,!0)},showOnlyPlaceholderMarkerAtIndex:function(e){var t=this.placeholderMarkerLayer.getLayers();_.each(t,function(t,o){o!==e?$(t._icon).hide():$(t._icon).show()})},showAllPlaceholderMarkers:function(){var e=this.placeholderMarkerLayer.getLayers();_.each(e,function(e,t){$(e._icon).show()})},unHighlightMarkerForPinId:function(e){var t=this.getMarkerForPin(e);t&&(this._setHighlightMarkerForPinId(e,!1),t.closePopup())},removeMarkerForPinId:function(e){var t=this.getMarkerForPin(e);t&&this.markerLayer.removeLayer(t)},_setHighlightMarkerForPinId:function(e,t){var o=this.getMarkerForPin(e);if(this.markerLayer){var n=this.markerLayer.getVisibleParent(o);t?this.highlightMarker(n):this.unHighlightMarker(n)}},unHighlightMarker:function(e){var t=this.markerLayer.getVisibleParent(e),o=this._getIconElement(t);o.removeClass(this.CssClassName.HIGHLIGHTED_MARKER_ICON),this._highlightedPinMarker=null},_getIconElement:function(e){var t=$(e._icon);return t.find(".markerCluster, .markerIcon").first()},highlightMarker:function(e){var t=this.markerLayer.getVisibleParent(e),o=this._getIconElement(t);o.addClass(this.CssClassName.HIGHLIGHTED_MARKER_ICON),this._highlightedPinMarker=t},_setHighlightMarker:function(e,t,o){P.templateLoad.promise.then(function(){var n=this._generateDivIcon({highlighted:t,animated:!1,placeholder:o});e.setIcon(n),e._highlighted=t,t&&e._bringToFront()}.bind(this))},getHighlightedMarker:function(){return this._highlightedPinMarker},_initializeMapHandlers:function(){this._isBoardView()&&(this.markerLayerPromise.then(function(){this.markerLayer.on("mousedown",function(e){this._triggerBodyMousedown()}.bind(this)),this.markerLayer.on("popupopen",function(e){var t=e.popup;this.onPopupOpen(t)}.bind(this)),this.markerLayer.on("popupclose",function(e){var t=e.popup;this.onPopupClose(t)}.bind(this)),this.markerLayer.on("clusterclick",function(e){this.onClusterClick()}.bind(this))}.bind(this)),this.map.on("click",function(e){this.triggerEvent(P.CONST.EVENT_MAP_CLICK,null,!0)}.bind(this)),this.map.on("mousedown",function(e){this._triggerBodyMousedown()}.bind(this)),this.map.on("dragend",function(e){this.onDragEnd()}.bind(this)),this.map.on("zoomend",function(e){this.onZoomEnd()}.bind(this)))},onClusterClick:function(e){this.closeAllMarkerPopups(),this.triggerEvent(P.CONST.EVENT_MAP_CLUSTER_CLICK,e,!0)},onPopupOpen:function(e){var t=e._wrapper,o=e._source,n=o._icon,a=this.clientRectToBounds(t.getBoundingClientRect()),r=this.clientRectToBounds(n.getBoundingClientRect()),i=this.mergeBounds(a,r);this.ensureBoundsInSafeBounds(i);var s=o.options.pin_id;this.triggerEvent(P.CONST.EVENT_MAP_POPUP_OPENED,s,!0),o._bringToFront(),$(n).addClass(this.CssClassName.TOP_ZINDEX)},onPopupClose:function(e){var t=e._source,o=t._icon,n=t.__parent,a=this.markerLayer.getVisibleParent(n);t.options.animated&&(this.replaceToastWithDefaultPopup(e),t.options.animated=!1),this.unHighlightMarker(t),a&&"unspiderfy"in a&&t===this._singleMarkerSpiderfied?(this._singleMarkerSpiderfied=null,a.unspiderfy(),P.timer.setTimeout(function(){a._group._unspiderfyLayer(t),this.unHighlightMarker(a)}.bind(this),180)):this.unHighlightMarker(t),this.resetPinButtons(),$(o).removeClass(this.CssClassName.TOP_ZINDEX)},getSafeZonePaddingTopLeft:function(){return this._paddingTopLeft},unHighlightPlaceholderMarker:function(e){var t=this.placeholderMarkerLayer.getLayers()[e];t&&this._setHighlightMarker(t,!1,!0)},getSafeZonePaddingBottomRight:function(){var e=ee,t=ee;return L.point(e,t)},clientRectToBounds:function(e){var t=L.point(e.left,e.top),o=L.point(e.right,e.bottom);return L.bounds(t,o)},inflateBounds:function(e,t){var o=L.bounds(e.min.clone(),e.max.clone());return o.min.x-=t,o.min.y-=t,o.max.x+=t,o.max.y+=t,o},mergeBounds:function(e,t){var o=Math.min(e.min.x,t.min.x),n=Math.min(e.min.y,t.min.y),a=Math.max(e.max.x,t.max.x),r=Math.max(e.max.y,t.max.y);return L.bounds(L.point(o,n),L.point(a,r))},ensureBoundsInSafeBounds:function(e){var t=this.getSafeZoneBounds(),o=5,n=this.inflateBounds(t,-1*o),a=0;e.min.x<n.min.x?a=e.min.x-n.min.x:e.max.x>n.max.x&&(a=e.max.x-n.max.x);var r=0;e.min.y<n.min.y?r=e.min.y-n.min.y:e.max.y>n.max.y&&(r=e.max.y-n.max.y),(0!==a||0!==r)&&this.panBy(L.point(a,r))},getRawView:function(){return{center:this.map.getCenter(),zoom:this.map.getZoom()}},setRawView:function(e){this.map.setView(e.center,e.zoom)},panTo:function(e){this.setView(e,this.map.getZoom())},setView:function(e,t){var o=this.getSafeZonePaddingTopLeft(),n=this.getSafeZonePaddingBottomRight(),a=n.subtract(o).divideBy(2),r=this.map.project(e,t),i=this.map.unproject(r.add(a),t);this.map.setView(i,t)},panBy:function(e){this.map.panBy(e)},fitBounds:function(e){var t=this.getSafeZonePaddingTopLeft(),o=this.getSafeZonePaddingBottomRight();this.map.fitBounds(e,{paddingTopLeft:t,paddingBottomRight:o})},fitQuery:function(e){var t={query:e},o=P.resourceFactory.instance.create("GeocodeResource",t);o.call("get",{}).then(function(e){var t=e.resource_response.data;t.length>0?this.fitLocation(t[0]):this.fitWorld()}.bind(this),this.fitWorld)},fitLocation:function(e){var t=e.bounds;if(t){var o=L.latLng(t.sw.latitude,t.sw.longitude),n=L.latLng(t.ne.latitude,t.ne.longitude);this.fitBounds(L.latLngBounds(o,n))}else{var a=e.longitude,r=e.latitude;this.map.setView([r,a],12)}},fitWorld:function(){this.map.fitWorld().panTo([40.58,-36.91])},fitViewToMarkerForPinId:function(e){var t=this.getMarkerForPin(e);t&&this.fitViewToMarker(t)},fitViewToMarker:function(e){var t=e.getLatLng(),o=this.markerLayer.getVisibleParent(e);if(e===o||this.getZoom()===de)this.map.panTo(t),this.map.fire("moveend");else{var n=this.getZoomToFitMarker(e);this.map.setView(t,n)}},getZoomToFitMarker:function(e){var t=this.getZoom(),o=this.markerLayer.getVisibleParent(e),n=[];for(n.push(o);de>t;){t++;for(var a=[],r=0;r<n.length;r++){for(var i=n[r],s=i._markers,l=0;l<s.length;l++)if(s[l]===e)return t;a=a.concat(i._childClusters)}n=a}return de},getMinZoomToCover:function(e,t){for(var o=L.CRS.EPSG3857,n=1;de>=n;n++){var a=L.latLng(90,-180),r=L.latLng(-90,180),i=o.latLngToPoint(a,n),s=o.latLngToPoint(r,n),l=s.x-i.x,u=s.y-i.y,d=l>e&&u>t;if(d)return n}return de},getMinZoom:function(e){var t=$(e),o=t.width(),n=t.height();return this.getMinZoomToCover(o,n)},updateMinZoom:function(){var e=this.map.getContainer(),t=this.getMinZoom(e);this.map.options.minZoom=t,this.map._updateZoomLevels()},zoomIn:function(){this.map.zoomIn()},zoomOut:function(){this.map.zoomOut()},zoomIntoBounds:function(){var e=this.markerLayer.getLayers(),t=e.length,o=0,n=0;if(_.each(e,function(e){var t=e.getLatLng();o+=t.lat,n+=t.lng}),0!==t){var a=L.latLng(o/t,n/t);this.map.setView(a,this.map.getZoom()+1,{animate:!0,duration:.4})}else this.zoomIn()},zoomOutOfBounds:function(e){var t=this.map.getSize().y-e,o=this.map.getSize().x-this.getWidth(),n=L.point(o,t),a=this.markerLayer.getLayers().length;if(0!==a){var r=this.markerLayer.getBounds();this.map.fitBounds(r,{paddingBottomRight:n,duration:.4})}else this.zoomOut()},getAttributionElement:function(){return this.$(".attribution")},_generateMap:function(e,t){var o="",n=this._isBoardView();o=n?"mapbox_board_page":"mapbox_closeup";var a=this.$("#"+o)[0],r=this.getMinZoom(document.getElementById(o)),i={detectRetina:!0};$(".ielt9").length||(i.format="png64"),L.mapbox.accessToken=Q,this.map=L.mapbox.map(a,e,{maxZoom:de,minZoom:r,worldCopyJump:!0,keyboard:!1,zoomControl:!1,attributionControl:!1,inertiaThreshold:75,inertiaDeceleration:5e3,tileLayer:i}),this.markerLayerPromise=P.templateLoad.promise.then(function(){this.markerLayer=new L.MarkerClusterGroup({mapModule:this,showCoverageOnHover:!1,removeOutsideVisibleBounds:!1,maxClusterRadius:65,iconCreateFunction:function(e){e=e;var t=e.getAllChildMarkers(),o=t[0].options.pin,n=null,a=e.getChildCount();o&&(n=o.getImageUrl("236x"));var r={};return r.markerClusterPinImage=n,r.clusterChildCount=a,new L.DivIcon({html:P.nunjucks.render(se,r),iconSize:[52,74],iconAnchor:[24,66]})}}).addTo(this.map),this.placeholderMarkerLayer=L.featureGroup().addTo(this.map)}.bind(this)),this.map.scrollWheelZoom.disable(),n?P.context.instance.is_mobile_agent||(new L.Control.CustomMapZoomControl).addTo(this.map):new L.Control.Zoom({position:"bottomright"}).addTo(this.map),t&&(t===te?this.fitWorld():this.fitLocation(t))},onResize:function(){this.updateMinZoom()},addPermanentMarker:function(e){var t=e.pin,o=t.getId();this.addMarkerToMap(e),P.timer.setTimeout(function(){this.inDesktopPlaceBoard()?this.triggerEvent(P.CONST.EVENT_PIN_PLACE_ADDED,o,!0):(this.openPopupForPin(o),P.timer.setTimeout(function(){var e=this.getMarkerForPin(o),t=this.$(".leaflet-popup-content-wrapper, .leaflet-popup-tip-container");t.addClass(this.CssClassName.FADE_OUT_UP),P.timer.setTimeout(function(){e.closePopup(),t.removeClass(this.CssClassName.FADE_OUT_UP)}.bind(this),he)}.bind(this),pe))}.bind(this),me)},clearPlaceholderMarkers:function(){this.placeholderMarkerLayer.clearLayers()},setPlaceholderMarkers:function(e,t){this.clearPlaceholderMarkers();for(var o=0,n=e.length;n>o;o++){var a=e[o];this.addMarkerToMap(a)}t&&this.fitViewToPlaceholderMarkers()},clearPlaceholderHighlights:function(){_.each(this.placeholderMarkerLayer.getLayers(),function(e){this._setHighlightMarker(e,!1,!0)}.bind(this))},highlightPlaceholderMarker:function(e){var t=this.placeholderMarkerLayer.getLayers()[e];if(t){this._setHighlightMarker(t,!0,!0);var o=this.getSafeZoneBounds(),n=t.getLatLng(),a=this.map.latLngToContainerPoint(n);if(!o.contains(a)){var r=this.map.getZoom();this.setView(n,r)}}},onAddedToDom:function(){var e=this.setup.bind(this);o.e(16,function(){o(202),e()})},fitViewToPlaceholderMarkers:function(){this.fitViewToMarkers(!0)},fitViewToPinMarkers:function(){this.fitViewToMarkers(!1)},closeAllMarkerPopups:function(e){var t=this.markerLayer.getLayers();_.each(t,function(e){e.closePopup()})},fitViewToMarkers:function(e){P.templateLoad.promise.then(function(){if(this.map){var t=e?this.placeholderMarkerLayer:this.markerLayer,o=t.getBounds();o&&!_.isEmpty(o)&&(this.fitBounds(o),e||this._ensureMarkersAreInBounds())}}.bind(this))},_ensureMarkersAreInBounds:function(){var e=this.markerLayer.getLayers();if(e.length){var t=this.getSafeZoneBounds(),o=!1;if(_.each(e,function(e){var n=e.getLatLng(),a=this.map.latLngToContainerPoint(n);t.contains(a)&&(o=!0)}.bind(this)),!o){var n=this.markerLayer.getLayers()[0];this.panTo(n.getLatLng())}}},resetPinButtons:function(){this.triggerEvent(P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON,null,!0)},getSafeZoneBounds:function(){var e=this.getSafeZonePaddingTopLeft(),t=this.map.getSize().subtract(this.getSafeZonePaddingBottomRight());return L.bounds(e,t)},getSafeZoneLatLngBounds:function(){var e=this.getSafeZonePaddingTopLeft(),t=this.map.getSize().subtract(this.getSafeZonePaddingBottomRight()),o=this.map.containerPointToLatLng(e),n=this.map.containerPointToLatLng(t);
return new L.LatLngBounds(o,n)},openPopupForMarker:function(e){var t=this.markerLayer.getVisibleParent(e);if(t&&"getChildCount"in t&&t.getChildCount()>1){var o=this.map.latLngToLayerPoint(e._latlng);o.y+=10;var n=t._generatePointsCircle(1,o);t._animationSpiderfy([e],n),this._singleMarkerSpiderfied=e}e.openPopup()},openPopupForPin:function(e){var t=this.getMarkerForPin(e);this.openPopupForMarker(t)},getMarkerForPin:function(e){if(this.markerLayer){var t=_.find(this.markerLayer.getLayers(),function(t){return t.pin_id===e});return t}},onCreated:function(){this._pinIdToMarkerIndex={},this._highlightedPinMarker=null,this.resizeListener=null,this._mapCardinalDirectionToNearestMoreMarker={}},_getDivIconOptions:function(e){var t=e.highlighted,o=e.animated,n=e.placeholder,a=[0,-55],r="markerIconWrapper";o&&(r+=" animated");var i="markerIcon";t&&(i+=" highlightedMarkerIcon");var s,l,u,d,c;n?(i+=" placeholder",s=9,l=9,u=[s,l],d=[s/2,l/2]):(i+=" pin",s=52,l=70,u=[s,l],d=[17,70],c=e.pin);var p={iconSize:[s,l],iconAnchor:[s/2,l],popupAnchor:a,pin:c},m=null;c&&!n&&(m="getImageUrl"in c?c.getImageUrl("236x"):c.images["236x"].url);var h={};return h.markerWrapperClassName=r,h.markerClassName=i,h.pinImage=[m],p.html=P.nunjucks.render(le,h),p},addMarkersToMap:function(e){_.each(e,function(e){var t=e.getCoordinates&&e.getCoordinates();if(t){var o={pin:e,highlighted:!1,animated:!1};this.addMarkerToMap(o)}}.bind(this))},_triggerBodyMousedown:function(){$("body").trigger("mousedown")},onDragEnd:function(){this.triggerEvent(P.CONST.EVENT_MAP_DRAG_END,null,!0)},onZoomEnd:function(){this.triggerEvent(P.CONST.EVENT_MAP_ZOOM_END,null,!0)},disableMapControls:function(){this.map.boxZoom.disable(),this.map.dragging.disable(),this.map.touchZoom.disable(),this.map.doubleClickZoom.disable(),this.inDesktopPlaceBoard()&&this.map.scrollWheelZoom.disable(),this.map.tap&&this.map.tap.disable(),this.$(".mapbox").find(".leaflet-control-zoom").hide()},enableMapControls:function(){this.map.boxZoom.enable(),this.map.dragging.enable(),this.map.touchZoom.enable(),this.map.doubleClickZoom.enable(),this.inDesktopPlaceBoard()&&this.map.scrollWheelZoom.enable(),this.map.tap&&this.map.tap.enable(),this.$(".mapbox").find(".leaflet-control-zoom").show()}}),P.modules.Map.prototype.className="Map",goog.provide("P.modules.MobileLandingPage"),goog.require("P.Module"),P.modules.MobileLandingPage=P.Module.extend({}),P.modules.MobileLandingPage.prototype.className="MobileLandingPage",goog.provide("P.modules.MockInterestFollowButton"),goog.require("P.modules.Button"),P.modules.MockInterestFollowButton=P.modules.Button.extend({toggleState:function(){this.setState(!this.options.followed),this.trigger("toggleFollow")},setState:function(e){this.options.text=this.options[e?"unfollow_text":"follow_text"],this.options.followed=e,this.renderExistingData()},getState:function(){return this.options.followed},onClick:function(e){return P.modules.Button.prototype.onClick.call(this,e),this.toggleState(),!1}}),P.modules.MockInterestFollowButton.prototype.className="MockInterestFollowButton",goog.provide("P.modules.ModalManager"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.modalManager"),P.modules.ModalManager=P.Module.extend({onCreated:function(){P.modalManager.set(this),this._onKeyup=this._onKeyup.bind(this),this._animatedElement=null,this.childListen(P.CONST.EVENT_DESTROYED,this._onModalDestroyed),this.childListen(P.CONST.EVENT_DISMISS,this._onModalDismiss)},showModal:function(e,t,o){t&&t.only_modal&&this.hasModals()||(e.moduleOpener=o,this.appendChild(e),e.show(),1===this.children.length&&this._addListeners(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,{moduleName:"Modal",action:P.CONST.ViewActions.OPEN}))},hasModals:function(){return this.children.length>=1},removeModal:function(e){e.animateOutAndDestroy()},removeAllModals:function(e){this.children.forEach(function(t){var o=t;(e||o.getCanDismiss())&&o.destroy()})},createAndShowModal:function(e,t,o){if(t&&t.only_modal&&this.hasModals())return Promise.resolve();var n={name:"Modal",options:t};return P.moduleFactory.load(n).then(function(n){return n.render().then(function(){n.setSubmodule(e).then(function(){e.focus()}),this.showModal(n,t,o)}.bind(this))}.bind(this))},_onModalDismiss:function(e){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,{moduleName:"Modal",action:P.CONST.ViewActions.CLOSE});var t=e.target.parent;this.removeModal(t)},_onModalDestroyed:function(e){this.children.length||this._removeListeners()},_addListeners:function(){$(document).on("keyup",this._onKeyup)},_removeListeners:function(){$(document).off("keyup",this._onKeyup)},getTopModal:function(){if(!this.hasModals())return null;var e=this.children[this.children.length-1];return e||null},removeTopModal:function(){if(this.hasModals()){var e=this.children.pop();e.animateOutAndDestroy()}},removeModalWithAnimation:function(e,t,o){return new Promise(function(n,a){var r={queue:!1};o&&(r.duration=o);var i=e.$(".modalContent"),s=i.offset(),l=$(t),u=l.offset(),d=l.height(),c=l.width();if(!u||!s||!i)return e.destroy(),void n(void 0);var p=u.left+c/2,m=u.top+d/2,h=[i.css({left:s.left,position:"fixed",top:s.top}).animate({left:p,top:m,height:"0px",width:"0px",opacity:"0"},r),e.$(".inModal").animate({height:"0px",opacity:"0",width:"0px"},r)];$.when.apply($,h).always(function(){e.destroy(),n(void 0)})})},_onKeyup:function(e){if(e.keyCode===P.util.keyCode.ESCAPE){var t=this.getTopModal();t&&t.getCanDismiss()&&this.removeModal(t)}},setAnimatedModule:function(e){this._animatedModule&&this._animatedModule.destroy(),this._animatedModule=e,e&&e.getContent().addClass("animatingToModal")},getAnimatedModule:function(){return this._animatedModule}}),P.modules.ModalManager.prototype.className="ModalManager",goog.provide("P.modules.ModalTrigger"),goog.require("P.Module"),P.modules.ModalTrigger=P.Module.extend({showModalSubmodule:function(){return P.util.showModalSubmodule(this)}}),P.modules.ModalTrigger.prototype.className="ModalTrigger",goog.provide("P.modules.ModuleCycler"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.templateLoad"),P.modules.ModuleCycler=P.Module.extend({events:{"click .navigation .rightArrow":"showNextModule","click .navigation .leftArrow":"showPreviousModule"},CssClassName:{DISABLED:"disabled"},MAX_MODULE_QUEUE_SIZE:3,onCreated:function(){this.modules=this.options.modules,this._setSelectedIndex(this.options.selected_index||0),this.nextModuleChildEvent=this.options.next_module_child_event,this.wraparound=this.options.wraparound||!1,this.showNavigation=this.options.show_navigation||!1,this.cycleInterval=this.options.cycle_interval||0,this.modulePromises=[],this._moduleIndexQueue=[],this._handleModuleLoadedFnQueue=[]},onContentReady:function(){this.nextModuleChildEvent&&this.childListen(this.nextModuleChildEvent,this.showNextModule),this.children.length>0?this.currentModule=this.children[0]:this.log.error("No modules were loaded in ModuleCycler"),this.$leftArrow=this.$(".navigation .leftArrow"),this.$rightArrow=this.$(".navigation .rightArrow"),this._updateNavigationDisplayState(),this.cycleInterval>0&&(this.interval=setInterval(this.showNextModule.bind(this),1e3*this.cycleInterval))},onDestroyed:function(){this.interval&&clearInterval(this.interval),this._moduleIndexQueue=[]},_getModuleIndex:function(e){return this.wraparound?P.util.mod(e,this.modules.length):e},_getModulePromiseAtIndex:function(e){if(0>e||e>=this.modules.length)return null;var t=this.modulePromises[e];if(t)return t;var o=this.modules[e];return t=P.templateLoad.promise.then(function(){return P.moduleFactory.load(o)}),this.modulePromises[e]=t,t},getNavigatedIndex:function(){return this._moduleIndexQueue.length>0?this.getNextIndexToShow():this.selectedIndex},showNextModule:function(e){e&&e.stopPropagation();var t=this._getModuleIndex(this.getNavigatedIndex()+1);return this.showModuleAtIndex(t)},showPreviousModule:function(e){e&&e.stopPropagation();var t=this._getModuleIndex(this.getNavigatedIndex()-1);return this.showModuleAtIndex(t)},_setSelectedIndex:function(e){this.selectedIndex=this._getModuleIndex(e)},_handleModuleShown:function(){if(0!==this._moduleIndexQueue.length){var e=this._moduleIndexQueue.shift();if(this._setSelectedIndex(e),this._handleModuleLoadedFnQueue.length>0){var t=this._handleModuleLoadedFnQueue.shift();t()}}},_handleModuleLoaded:function(e,t){var o=this.currentModule;if(this.getNextIndexToShow()===e)o.fadeOut(function(){this.removeChild(o),this.appendChild(t),this.currentModule=t,t.fadeIn(this._handleModuleShown.bind(this))}.bind(this));else{var n=function(){this._handleModuleLoaded(e,t)}.bind(this);this._handleModuleLoadedFnQueue.push(n)}},getNextIndexToShow:function(){var e=this._moduleIndexQueue.length;return e>0?this._moduleIndexQueue[e-1]:null},showModuleAtIndex:function(e){var t=this._getModulePromiseAtIndex(e);if(!t||this._moduleIndexQueue.length>=this.MAX_MODULE_QUEUE_SIZE)return null;this._moduleIndexQueue.push(e),this._updateNavigationDisplayState();var o=function(t){t.renderExistingData().then(function(){this._handleModuleLoaded(e,t)}.bind(this))}.bind(this);return t.then(o)},hasNext:function(){return this.wraparound?this.modules.length>0:this.getNextIndexToShow()<this.modules.length-1},hasPrevious:function(){return this.wraparound?this.modules.length>0:this.getNextIndexToShow()>0&&this.modules.length>1},_updateNavigationDisplayState:function(){this.contentReady&&this.showNavigation&&(this.hasPrevious()?this.$leftArrow.removeClass(this.CssClassName.DISABLED):this.$leftArrow.addClass(this.CssClassName.DISABLED),this.hasNext()?this.$rightArrow.removeClass(this.CssClassName.DISABLED):this.$rightArrow.addClass(this.CssClassName.DISABLED))}}),P.modules.ModuleCycler.prototype.className="ModuleCycler",goog.provide("P.modules.MultiInviter"),goog.require("P.Module"),goog.require("P.timer"),P.modules.MultiInviter=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this._onInviteSent)},_onInviteSent:function(e){this.$(".inviteConfirm").show(),P.timer.setTimeout(function(){this.$(".inviteConfirm").hide()}.bind(this),2e3)}}),P.modules.MultiInviter.prototype.className="MultiInviter",goog.provide("P.modules.MultiInviterEmail"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.validator"),goog.require("P.SocialConnect"),P.modules.MultiInviterEmail=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick),this.listen(this,P.CONST.EVENT_TAB_SELECTED,this._onTabSelected)},_onTabSelected:function(e){"fallback_tab_index"in this.options&&!this.getContent().find("div.inviteContent li").length&&(this.empty(),this.triggerEvent(P.CONST.EVENT_DATA_EMPTY,this.options.fallback_tab_index,!0)),this.options.network||this.$(".emailInput").focus()},onContentReady:function(){if(P.Module.prototype.onContentReady.apply(this,arguments),!this.options.network){this.emailInviteButton=this.getChildById("invite"),this.gmailConnect=this.getChildById("gmailConnect"),this.yahooConnect=this.getChildById("yahooConnect"),this.microsoftConnect=this.getChildById("microsoftConnect");var e={email:[P.validator.Required(),P.validator.Email()]};this.form=new P.Form(this.$("form"),e),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated)}},_onSubmitValidated:function(e){if(!e.errors[0]){this.emailInviteButton.showLoading();var t=this.form.getValue("email");this.$(".emailInput").val(""),P.Invite.userInviteEmail(t,function(e){this.emailInviteButton.hideLoading(),e&&this.triggerEvent(P.CONST.EVENT_INVITE_USER,{recipients:[t]},!0)}.bind(this))}},_onButtonClick:function(e){var t=e.target,o=null;switch(t.id){case"gmailConnect":o=P.SocialConnect.GOOGLE;break;case"yahooConnect":o=P.SocialConnect.YAHOO;break;case"microsoftConnect":o=P.SocialConnect.MICROSOFT;break;default:return}t.showLoading(!0);var n=P.SocialNetworkSettingsManager.instance(),a={success:function(){var e={username:P.user.instance.attributes.username,filter:"not_on_pinterest"},a={success:function(e){this.render()}.bind(this),error:function(){t.hideLoading()},resourceOptions:e};n.pollForFriends(o,a)}.bind(this),error:function(){t.hideLoading()}};n.handleConnect(o,!0,a)}}),P.modules.MultiInviterEmail.prototype.className="MultiInviterEmail",goog.provide("P.modules.MultiInviterFacebook"),goog.require("P.Module"),P.modules.MultiInviterFacebook=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onClick)},_onClick:function(e){var t=e.target;if("connectFacebook"===t.id){var o=this.getChildById("connectFacebook"),n=P.SocialNetworkSettingsManager.instance(),a={success:function(){var e={username:P.user.instance.attributes.username,filter:"not_on_pinterest"},t={success:function(e){this.options.reloadAll===!0?window.location.reload():this.render()}.bind(this),error:function(){o.hideLoading()},resourceOptions:e};n.pollForFriends("facebook",t)}.bind(this),error:function(){o.hideLoading()}};o.showLoading(),n.handleConnect("facebook",!0,a)}}}),P.modules.MultiInviterFacebook.prototype.className="MultiInviterFacebook",goog.provide("P.modules.MultipleSelectButton"),goog.require("P.Module"),P.modules.MultipleSelectButton=P.Module.extend({onContentReady:function(){this._button=this.getChildById("button"),this.childListen(P.CONST.EVENT_CHANGE,this.onCheckboxChanged)},onCheckboxChanged:function(e){var t=e.target,o=t.getValue(),n=[];_.each(o,function(e){n.push(e.label)}),this._button.setText(n.join(", ")),e.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CHANGE,o,!0)}}),P.modules.MultipleSelectButton.prototype.className="MultipleSelectButton",goog.provide("P.modules.NagBase"),goog.require("P.Module"),goog.require("P.ga"),P.modules.NagBase=P.Module.extend({events:{"click .nagClose":"onCloseButtonClick"},clickHandler:function(){return null},onCloseButtonClick:function(){this.destroy(),P.ga.trackEvent("nag",P.CONST.GA_ACTION_CLICK_CLOSE,"type",this.extraData.type)},onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_NAG_UPDATED]=this.onActionSaved,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e),this.updateOptionsAndDom({state_message:this.data.message})},updateDom:function(){this.$(".message").html(this.options.state_message)},onCreated:function(){this.options.state_message=""},onActionSaved:function(e,t,o){this.updateNagMessage(o)},updateNagMessage:function(e){this.updateOptionsAndDom({state_message:e})},resourceCall:function(e,t,o){var n=o.success,a=o.error;this.xhr=$.ajax({cache:!1,url:e,data:{},dataType:"json",type:"get"===t?"get":"post",success:n,error:a})}}),P.modules.NagBase.prototype.className="NagBase",goog.provide("P.modules.NagEmail"),goog.require("P.modules.NagBase"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.resourceFactory"),P.modules.NagEmail=P.modules.NagBase.extend({events:{"click .message a":"handleLinkClick"},onCreated:function(){this.successMessage=P.i18n._("Thanks! You should receive a confirmation email soon.")},handleLinkClick:function(e){switch(e.target.id){case"cancelEmailUpdate":this.cancelEmailUpdate();break;case"editEmail":this.updateEmail();break;case"removeBounce":this.removeBounce();break;case"resendEmail":this.resendConfirmEmail();break;case"resendEmailUpdate":this.resendUpdatedEmailAddressEmail()}return!1},removeBounce:function(e){var t=P.resourceFactory.instance.create("UserSettingsResource",{email_bounced:!1});t.callUpdate().then(function(e){var t=P.i18n._("Got it! Make sure your inbox isn't full so that our emails can find their way to you.");this.updateNagMessage(t)}.bind(this))},updateEmail:function(e){this.showLoading();var t={name:"UserEditEmail",resource:{name:"UserSettingsResource",options:{}}};P.moduleFactory.load(t).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this))},cancelEmailUpdate:function(e){var t=P.resourceFactory.instance.create("CancelEmailUpdateResource");t.callCreate().then(function(){this.updateNagMessage(P.i18n._("Thanks! Your email address change was cancelled."))}.bind(this))},resendUpdatedEmailAddressEmail:function(e){var t=P.resourceFactory.instance.create("ResendEmailUpdateEmailResource");t.callCreate().then(function(){this.updateNagMessage(this.successMessage)}.bind(this))},resendConfirmEmail:function(e){var t=P.resourceFactory.instance.create("ResendVerificationEmailResource");t.callCreate().then(function(){this.updateNagMessage(this.successMessage)}.bind(this))}}),P.modules.NagEmail.prototype.className="NagEmail",goog.provide("P.modules.NagNoScript"),goog.require("P.Module"),P.modules.NagNoScript=P.Module.extend({}),P.modules.NagNoScript.prototype.className="NagNoScript",goog.provide("P.modules.NagPolicy"),goog.require("P.modules.NagBase"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.timer"),goog.require("P.resourceFactory"),P.modules.NagPolicy=P.modules.NagBase.extend({events:{"click .policy":"clickHandler"},clickHandler:function(e){var t={name:"ConfirmDialog",options:{template:"pin_policy"}};return P.moduleFactory.load(t).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,function(){this.savePolicyConfirmation()})}.bind(this)),!1},onActionSaved:function(e,t,o){P.modules.NagBase.prototype.onActionSaved.apply(this,arguments),P.timer.setTimeout(function(){this.parent.render()}.bind(this),2e3)},savePolicyConfirmation:function(){var e=P.resourceFactory.instance.create("ConfirmGuidelinesResource",{});e.callUpdate().then(function(){this.updateNagMessage(P.i18n._("Thanks for confirming!"))}.bind(this),function(e){this.log.debug(e)}.bind(this))}}),P.modules.NagPolicy.prototype.className="NagPolicy",goog.provide("P.modules.NagSearch"),goog.require("P.Module"),P.modules.NagSearch=P.Module.extend({}),P.modules.NagSearch.prototype.className="NagSearch",goog.provide("P.modules.NagSecurity"),goog.require("P.modules.NagBase"),goog.require("P.i18n"),goog.require("P.resourceFactory"),P.modules.NagSecurity=P.modules.NagBase.extend({onContentReady:function(){this.showWriteBanned()},events:{"click .resetPassword":"clickHandler"},clickHandler:function(e){var t=function(e){var t=P.i18n._("Thanks! You should receive a password reset email soon.");this.updateNagMessage(t)}.bind(this),o=P.resourceFactory.instance.create("UserResetPasswordResource",{username_or_email:P.user.instance.attributes.username});return o.callCreate({showError:!1}).then(t),!1},showWriteBanned:function(){P.user.instance.isWriteBanned()&&P.writeban.showWriteBanned(this)}}),P.modules.NagSecurity.prototype.className="NagSecurity",goog.provide("P.modules.Nags"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.Nags=P.Module.extend({onContentReady:function(){this.nagHeight=0,this.visible=!1;var e={};e[P.CONST.PUBSUB_TOPIC_NAG_STATE]=this.onNagStateChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e);var t={};if(t[P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW]=this.onMainModuleChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,t),this.nagHeight=this.$el.height(),this.notifyNag(!0),this.noGiftWrap=!1,this.parent){var o=this.parent.getChildByModuleName("BoardPage")||this.parent.getChildByModuleName("InterestFeedPage");this.noGiftWrap=o&&o.data&&o.data.no_gift_wrap}this.pickNagLogic()},onDestroyed:function(){this.notifyNag(!1)},pickNagLogic:function(){var e=!P.user.instance.isAuthenticated(),t=this.options.main_module_name,o=this.options.referrer,n=P.url.getEntryUrl(),a=!1;n&&(a=n.indexOf("?ptrf=fbopl_e")>-1),"Closeup"===t&&e&&(o.indexOf("facebook")>-1||a)||this._loadUnauthBannerIfNeeded()},_loadUnauthBannerIfNeeded:function(){var e=!!Cookie.get(P.CONST.COOKIE_GIFT_WRAP_HOLDOUT);!this.extraData.show_banner||this.noGiftWrap||e||this.loadUnauthBanner()},onNagStateChange:function(e,t,o){this.$el.toggle(o),o?this.notifyNag(!0):this.notifyNag(!1)},onMainModuleChange:function(e,t,o){var n=o;this.options.main_module_name!==n.className&&(this.options.main_module_name=n.className,this.render())},loadUnauthBanner:function(){P.moduleFactory.load({name:"UnauthBanner",id:"unauthBanner",resource:{name:"InspiredWallResource",options:{pick_story_from_url:!0}}}).then(function(e){var t=this.appendChild.bind(this,e);e.render().then(t)}.bind(this))},notifyNag:function(e){e!==this.visible&&(P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_TOGGLE,{height:this.nagHeight,visible:e}),this.visible=e)}}),P.modules.Nags.prototype.className="Nags",goog.provide("P.modules.NavigateButton"),goog.require("P.modules.Button"),goog.require("P.util"),goog.require("P.ga"),P.modules.NavigateButton=P.modules.Button.extend({CssClassName:P.modules.Button.prototype.CssClassName,getNavigateUrl:function(e){return this.options.url},onClick:function(e){this.options.ga_category&&P.ga.trackEvent(this.options.ga_category,P.CONST.GA_ACTION_CLICK),this._logContextEvent(e),e.stopPropagation(),e.preventDefault();var t=this.getNavigateUrl();return t&&-1!==t.indexOf("/login")&&"home_page"!==P.util.getInitModuleName()&&"login_page"!==P.util.getInitModuleName()&&"landing_page_analytics"!==P.util.getInitModuleName()?P.signupModalManager.showInlineSignupModalOnButtonClick("LoginButton"):(t&&-1!==t.indexOf("/login")&&(t=P.url.appendQueryString(t,{referrer:P.util.getInitModuleName()})),P.modules.Button.prototype.onClick.call(this,e),this.options.force_refresh===P.genConst.ForceRefreshType.PAGE?void P.util.changeWindowLocation(t,!1):void this.navigate(t,this.$el,this.options.force_refresh,{pinId:this.options.safe_link_pin_id,useNewTab:this.options.use_new_tab}))},getLoggingObjectIdStr:function(){return this.options.log_obj_id?this.options.log_obj_id:P.modules.Button.prototype.getLoggingObjectIdStr.call(this)}}),P.modules.NavigateButton.prototype.className="NavigateButton",goog.provide("P.modules.NetworkNotifications"),goog.require("P.Module"),goog.require("P.preventScrollMixin");var ge=300;P.modules.NetworkNotifications=P.Module.extend({events:{"click .networkNotifItem":"onNetworkNotificationClick"},CssClassName:{UNSEEN:"unseen"},mixins:[P.preventScrollMixin],onCreated:function(){this.onNetworkNotificationsScroll=this.onNetworkNotificationsScroll.bind(this),this.onNetworkNotificationsScroll=_.throttle(this.onNetworkNotificationsScroll,200)},onContentReady:function(){this.scrollableElement=this.$(".networkNotifContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this.onNetworkNotificationsScroll),this.startPreventScroll(this.scrollableElement,this.$(".NetworkNotificationItems")),this.parent&&this.listen(this.parent,P.CONST.EVENT_DROPDOWN_HIDE,this.onHide)},onHide:function(){this.$(".unseen").removeClass(this.CssClassName.UNSEEN)},onNetworkNotificationsScroll:function(e){if(!this.rendering){var t=this.$(".NetworkNotificationItems"),o=t.height()+t.position().top-this.scrollableElement.height();return ge>=o&&this.fetchMore(),!1}},onNetworkNotificationClick:function(e){var t=$(e.target),o=$(e.currentTarget),n=o.attr("data-url");return t.is("a")?!0:void(n&&this.navigate(n))},fetchMore:function(){if(!this.rendering){if(this.resource.atEnd())return void this.removeListener(this._scrollListener);this.rendering=!0,this.appendLoadingItem(),this.getChildById("items").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1,this.removeLoadingItem(),this.addHeadersToChildContent()}.bind(this))}},addHeadersToChildContent:function(){this.$(".NetworkNotificationItems").trigger("addHeaders")},appendLoadingItem:function(){this.$(".NetworkNotificationItems").trigger("appendLoadingItem")},removeLoadingItem:function(){this.$(".NetworkNotificationItems").trigger("removeLoadingItem")}}),P.modules.NetworkNotifications.prototype.className="NetworkNotifications",goog.provide("P.modules.NetworkStoryActorInfoOverride"),goog.require("P.Module"),P.modules.NetworkStoryActorInfoOverride=P.Module.extend({}),P.modules.NetworkStoryActorInfoOverride.prototype.className="NetworkStoryActorInfoOverride",goog.provide("P.modules.NetworkStoryInfoBar"),goog.require("P.Module"),P.modules.NetworkStoryInfoBar=P.Module.extend({}),P.modules.NetworkStoryInfoBar.prototype.className="NetworkStoryInfoBar",goog.provide("P.modules.NetworkStoryLandingPage"),goog.require("P.Module"),P.modules.NetworkStoryLandingPage=P.Module.extend({}),P.modules.NetworkStoryLandingPage.prototype.className="NetworkStoryLandingPage",goog.provide("P.modules.NewYearsAnimation"),goog.require("P.Module"),P.modules.NewYearsAnimation=P.Module.extend({events:{"click .mask":"playVideo"},CssClassName:{ANIMATE:"animate"},onContentReady:function(){this.video=this.$("video"),this.audio=this.$("audio"),this.$el.removeClass(this.CssClassName.ANIMATE),this.button=this.$(".play"),this.mask=this.$(".mask");var e=this;this.video.on("canplaythrough",{button:this.button},function(){e.button.css({opacity:.8}),e.mask.css({"pointer-events":"auto"})}),this.video.get(0).readyState>3&&(this.button.css({opacity:.8}),e.mask.css({"pointer-events":"auto"})),setTimeout(function(){e.button.css({opacity:.8}),e.mask.css({"pointer-events":"auto"})},1e3)},onRemovedFromDom:function(){this.resetVideo()},resetVideo:function(e){this.button.show();var t=this.video.get(0),o=this.audio.get(0);this.$el.removeClass(this.CssClassName.ANIMATE),o.pause(),o.currentTime=0,t.pause(),t.currentTime=0,t.load()},playVideo:function(){this.scaleToFit(),this.$el.addClass(this.CssClassName.ANIMATE),this.button.hide(),this.video.get(0).play(),this.audio.get(0).play();var e=this;this.video.on("playing",function(){e.video.css("visibility","visible")}),this.video.get(0).addEventListener("ended",function(){e.video.get(0).play()},!1)},scaleToFit:function(){var e=.8,t=this.$el.height()*e,o=this.$el.width()*e;this.$(".scaleToFit").each(function(){var e=$(this).children(":first"),n=Math.min(t/e.height(),o/e.width());$(this).css({transform:"scale("+n.toString()+")"})})}}),P.modules.NewYearsAnimation.prototype.className="NewYearsAnimation",goog.provide("P.modules.NewYearsEmbedPage"),goog.require("P.Module"),P.modules.NewYearsEmbedPage=P.Module.extend({}),P.modules.NewYearsEmbedPage.prototype.className="NewYearsEmbedPage",goog.provide("P.modules.NotificationItemBalanced"),goog.require("P.Module"),P.modules.NotificationItemBalanced=P.Module.extend({}),P.modules.NotificationItemBalanced.prototype.className="NotificationItemBalanced",goog.provide("P.modules.NotificationLoadingItem"),goog.require("P.Module"),P.modules.NotificationLoadingItem=P.Module.extend({onContentReady:function(){this.showLoading(!1)}}),P.modules.NotificationLoadingItem.prototype.className="NotificationLoadingItem",goog.provide("P.modules.NotificationSettings"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.resourceFactory");var _e="emailGlobalToggle";P.modules.NotificationSettings=P.Module.extend({CssClassName:{DISABLED:"emailDisabled",EMAIL_SETTINGS:"emailSettings"},onContentReady:function(){this.$form=this.$("form");var e=new P.Form(this.$form,[]);this.listen(e,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange)},updateResource:function(){var e={},t={};this.$(".pushNotifSettings input[type=checkbox]").each(function(){var e=$(this),o=e.attr("name");t[o.substr(5)]=e.is(":checked")?"anyone":"none"}),e.push_settings=JSON.stringify(t),e.filter_settings=this.$("input[name=filter_settings]:checked").val();var o=P.resourceFactory.instance.create("NotificationSettingsResource",e);return o.callUpdate()},onSubmitValidated:function(){this.showLoading(!0);var e=this.updateResource();return this.isInModal()&&(e=e.then(function(){this.destroy()}.bind(this))),e.fin(this.hideLoading.bind(this)),!1},onChildChange:function(e){var t=e.target;t.id===_e&&(t.isChecked()?this.setEmailsEnabled(!0):this.confirmDisableEmails())},confirmDisableEmails:function(){var e={name:"ConfirmDialog",options:{template:"disable_emails_confirm"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e);var t=this.listen(e,P.CONST.EVENT_DESTROYED,function(e){var t=this.getChildById(_e);t.setChecked(!0)});this.listen(e,P.CONST.EVENT_CONFIRM,function(e){this.setEmailsEnabled(!1),this.removeListener(t)})}.bind(this))},setEmailsEnabled:function(e){var t=P.resourceFactory.instance.create("UserSettingsResource",{email_enabled:e}),o=this.$("."+this.CssClassName.EMAIL_SETTINGS);o.toggleClass(this.CssClassName.DISABLED,!e),t.callUpdate()}}),P.modules.NotificationSettings.prototype.className="NotificationSettings",goog.provide("P.modules.Notifications"),goog.require("P.Module"),goog.require("P.preventScrollMixin");var fe=300;P.modules.Notifications=P.Module.extend({events:{"click .notificationItem":"onNotificationClick"},mixins:[P.preventScrollMixin],onCreated:function(){this.onNotificationsScroll=this.onNotificationsScroll.bind(this),this.onNotificationsScroll=_.throttle(this.onNotificationsScroll,200)},onContentReady:function(){this.scrollableElement=this.$(".notifContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this.onNotificationsScroll);var e=this.$(".NotificationItems");this.startPreventScroll(this.scrollableElement,e)},onNotificationClick:function(e){var t=$(e.target),o=$(e.currentTarget),n=o.attr("data-url");return t.is("a")?!0:void(n&&this.navigate(n))},onNotificationsScroll:function(e){if(!this.rendering){var t=this.getChildById("items").$el,o=t.height()+t.position().top-this.scrollableElement.height();return fe>=o&&this.fetchMore(),!1}},fetchMore:function(){if(!this.rendering){if(this.resource.atEnd())return void this.removeListener(this._scrollListener);this.rendering=!0,this.appendLoadingItem(),this.getChildById("items").renderAdditional(P.ModuleRenderType.APPEND).then(function(){this.rendering=!1,this.removeLoadingItem()}.bind(this))}},appendLoadingItem:function(){this.$(".NotificationItems").trigger("appendLoading")},removeLoadingItem:function(){this.$(".NotificationItems").trigger("removeLoading")}}),P.modules.Notifications.prototype.className="Notifications",goog.provide("P.modules.NotificationsConversationsButton"),goog.require("P.Module"),goog.require("P.timer"),goog.require("P.resourceFactory");var be=0,ke=1,ye=2;P.modules.NotificationsConversationsButton=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_SEGMENTED_CONTROLLER_SHOW]=this.onSegmentedTabsShow,e[P.CONST.PUBSUB_TOPIC_NETWORK_STORY_DROPDOWN_SHOW]=this.onNetworkStoryView,e[P.CONST.PUBSUB_TOPIC_NOTIFICATION_DROPDOWN_SHOW]=this.onNotificationView,e[P.CONST.PUBSUB_TOPIC_CONVERSATION_DROPDOWN_SHOW]=this.onConversationView,e[P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT]=this.onConversationUnreadCount,e[P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE]=this.onConversationUnreadCountDecrease,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.unseenNetworkNotifCount=0,this.unseenNotificationsCount=0,this.unseenConversationsCount=0,this.data&&(this.unseenNetworkNotifCount=this.data.network_story_count,isNaN(this.unseenNetworkNotifCount)&&(this.unseenNetworkNotifCount=0),this.unseenNotificationsCount=this.data.notification_unseen_count,isNaN(this.unseenNotificationsCount)&&(this.unseenNotificationsCount=0),this.updateBadgeCount()),this.listen(P.Updater.instance(),"notifications_count",function(e){this.unseenNotificationsCount=e,this.updateBadgeCount()}),this.listen(P.Updater.instance(),"network_notifications_count",function(e){this.unseenNetworkNotifCount=e,this.updateBadgeCount()})},onDropdownShow:function(e){var t=e.target.getContentModule()._getSegmentedController();t&&this.selectDefaultTabToShow(t)},onSegmentedTabsShow:function(e,t,o){this.isMobile()&&this.selectDefaultTabToShow(o)},onNetworkStoryView:function(e,t,o){if(0!==this.unseenNetworkNotifCount){var n=P.resourceFactory.instance.create("NetworkStoryBadgeResource",{});n.callDelete({showError:!1
})}this.unseenNetworkNotifCount=0,this.updateBadgeCount(),P.storage.localStorage.setItem(P.CONST.LOCALSTORAGE_SELECTED_NOTIFICATION_TAB,0)},onNotificationView:function(e,t,o){if(0!==this.unseenNotificationsCount){var n=P.resourceFactory.instance.create("NotificationBadgeResource",{});n.callDelete({showError:!1})}this.unseenNotificationsCount=0,this.updateBadgeCount(),P.storage.localStorage.setItem(P.CONST.LOCALSTORAGE_SELECTED_NOTIFICATION_TAB,1)},onConversationView:function(e,t,o){P.storage.localStorage.setItem(P.CONST.LOCALSTORAGE_SELECTED_NOTIFICATION_TAB,2)},onConversationUnreadCount:function(e,t,o){0!==this.unseenConversationsCount&&0===o&&P.conversationsManager.instance.deleteConversationBadgeCount(),this.unseenConversationsCount=o,this.updateBadgeCount()},onConversationUnreadCountDecrease:function(e,t,o){var n=Math.max(0,this.unseenConversationsCount-o);this.onConversationUnreadCount(e,t,n)},updateBadgeCount:function(){var e=this.unseenNotificationsCount+this.unseenNetworkNotifCount;this.isMobile()||(e+=this.unseenConversationsCount,P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_SET_BADGE,this.unseenConversationsCount)),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NETWORK_STORY_SET_BADGE,this.unseenNetworkNotifCount),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NOTIFICATION_SET_BADGE,this.unseenNotificationsCount);var t=this.getButton();t&&t.setBadgeCount(e),P.Title.instance().setPrefixCount(e)},getTabToShow:function(){var e=-1;return!this.isMobile()&&this.unseenConversationsCount>0?e=ye:this.unseenNotificationsCount>0?e=ke:this.unseenNetworkNotifCount>0&&(e=be),-1===e&&(e=P.storage.localStorage.getItem(P.CONST.LOCALSTORAGE_SELECTED_NOTIFICATION_TAB),null==e&&(e=be)),e===ye&&this.isMobile()&&(e=be),e},isMobile:function(){return P.context.instance.is_mobile_agent},getButton:function(){if(!this._button){var e=this.getChildrenByModuleName(Pc.siteConst.PRESENTER_BUTTON_MODULE_NAME);e.length>0&&(this._button=e[0])}return this._button},selectDefaultTabToShow:function(e){var t=this.getTabToShow();e.onButtonSelected(this.getTabToShow()),this.updateBadgeCount(),t===ke?P.timer.setTimeout(function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NOTIFICATION_DROPDOWN_SHOW,{})},1500):t===be&&P.timer.setTimeout(function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NETWORK_STORY_DROPDOWN_SHOW,{})},1500)}}),P.modules.NotificationsConversationsButton.prototype.className="NotificationsConversationsButton",goog.provide("P.modules.NuxImagesFeedPage"),goog.require("P.Module"),P.modules.NuxImagesFeedPage=P.Module.extend({}),P.modules.NuxImagesFeedPage.prototype.className="NuxImagesFeedPage",goog.provide("P.modules.NuxModalInstallExtension"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.genConst"),P.modules.NuxModalInstallExtension=P.Module.extend({onContentReady:function(){P.modules.NuxModalStepBase.prototype.onContentReady.call(this);var e=this.getChildById("installButton");e&&this.listen(e,P.CONST.EVENT_BUTTON_CLICK,this.onInstallButtonClick),P.context.instanceLogger.getInstance().logCustomViewEvent(P.genConst.ViewType.SAVE,P.genConst.ViewParameterType.EXTENSION_UPSELL_NUX)},onInstallButtonClick:function(){P.util.trackRegisterAction("browser_extension_install_clicked"),P.browserExtension.instance.handleExtensionInstall(this._goToNextStep)},_goToNextStep:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},_skipInstall:function(){P.util.trackRegisterAction("browser_extension_skipped"),this._goToNextStep()}}),P.modules.NuxModalInstallExtension.prototype.className="NuxModalInstallExtension",goog.provide("P.modules.NuxModalInstallExtensionFirefox"),goog.require("P.modules.NuxModalInstallExtension"),goog.require("P.timer"),P.modules.NuxModalInstallExtensionFirefox=P.modules.NuxModalInstallExtension.extend({onContentReady:function(){P.modules.NuxModalInstallExtension.prototype.onContentReady.call(this),this.installButton=this.getChildById("installButton"),this.continueButton=this.getChildById("continueButton"),this.listen(this.continueButton,P.CONST.EVENT_BUTTON_CLICK,this._goToNextStep),this.continueButton.hide()},onInstallButtonClick:function(){P.browserExtension.instance.handleExtensionInstall(function(){}),this.installButton.hide(),this.continueButton.show(),this.$(".optionalSkip").hide(),this.continueButton.showLoading(!0),P.timer.setTimeout(function(){this.continueButton.hideLoading()}.bind(this),3e3)}}),P.modules.NuxModalInstallExtensionFirefox.prototype.className="NuxModalInstallExtensionFirefox",goog.provide("P.modules.NuxModalInstallExtensionSafari"),goog.require("P.modules.NuxModalInstallExtension"),goog.require("P.i18n"),P.modules.NuxModalInstallExtensionSafari=P.modules.NuxModalInstallExtension.extend({onContentReady:function(){P.modules.NuxModalInstallExtension.prototype.onContentReady.call(this),this.installButton=this.getChildById("installButton"),this.continueButton=this.getChildById("continueButton"),this.listen(this.continueButton,P.CONST.EVENT_BUTTON_CLICK,this._goToNextStep),this.continueButton.hide()},openSafariExtensionWindow:function(){var e=window.open("https://extensions.apple.com/details/?id=com.pinterest.extension-HWZFLG9PNK","_blank");e&&e.focus()},onInstallButtonClick:function(){this.installButton.hide(),this.continueButton.show(),this.$(".optionalSkip").hide(),this.$(".extensionUpsellWrapper").hide(),this.$(".headerTitle").text(P.i18n._('In the new tab, click on "Install Now"')),this.$(".headerSubTitle").hide(),this.$(".opensInNewTab").css("visibility","hidden"),this.$(".extensionUpsellSafariAfterInstallWrapper").show(),this.openSafariExtensionWindow()}}),P.modules.NuxModalInstallExtensionSafari.prototype.className="NuxModalInstallExtensionSafari",goog.provide("P.modules.NuxPinCreate"),goog.require("P.Module"),P.modules.NuxPinCreate=P.Module.extend({}),P.modules.NuxPinCreate.prototype.className="NuxPinCreate",goog.provide("P.modules.NuxProgressBase"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.tutorialUtil"),P.modules.NuxProgressBase=P.Module.extend({CssClassName:{HIDDEN:"hidden"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.options.auto_follow_interest&&this.autoFollowInterest(this.options.auto_follow_interest);var e={};e[P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT]=this.triggerNextEvent,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e)},endMandatoryFlow:function(){},setStepTexts:function(e){},initializeProgress:function(e){this.module=e?e.module:null,P.tutorialUtil.isTutorialActive()||this.tutorialManager.startTutorial(this.getNuxTutorialName(),{renderModule:!1}),this.tutorialManager.setProgressModule(this)},onContentReady:function(){this.tutorialManager=P.TutorialManager.instance(),this.$header1=this.$(".headerTitle1"),this.$header2=this.$(".headerTitle2"),this.$skip=this.$(".skip"),this.nextButton=this.getChildById("nextButton"),this.progressData=this.extraData?this.extraData.progressData:null,this.nextStep(1),this.initializeProgress()},nextStep:function(e){this.currentStep=e,this.setStepTexts(e)},onButtonClick:function(e){var t=e.target;t&&("previousButton"===t.id?(e.stopPropagation(),this.triggerPreviousEvent()):"nextButton"===t.id&&(e.stopPropagation(),this.triggerNextEvent()))},getNextButton:function(){return this.nextButton},_handleSkipButton:function(e){this.$skip&&(e&&!_.isEmpty(e)?(this.$skip.removeClass(this.CssClassName.HIDDEN),this.$skip.bind("click",function(){this._launchSkipConfirmDialog(e)}.bind(this))):this.$skip.addClass(this.CssClassName.HIDDEN))},_updateHeaders:function(e,t){e&&this.$header1.html(e),t&&this.$header2.html(t)},_launchSkipConfirmDialog:function(e){var t={name:"ConfirmDialog",options:{button_text:e.button_text,dismiss_button_text:e.dismiss_button_text,body_message:e.body_message,title:e.title,template:"generic"}};P.moduleFactory.load(t).then(function(e){this.showInModal(e,{mask_type:"dark",can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CONFIRM,function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!1)})}.bind(this))},getNuxTutorialName:function(){return this.extraData?this.extraData.tutorialName:"interestsNuxMweb"},getNuxTutorialStep:function(){return this.currentStep?this.currentStep:1},triggerPreviousEvent:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!1)},triggerNextEvent:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!1)}}),P.modules.NuxProgressBase.prototype.className="NuxProgressBase",goog.provide("P.modules.NuxProgressMweb"),goog.require("P.modules.NuxProgressBase"),goog.require("P.i18n"),goog.require("P.genConst"),goog.require("P.app"),P.modules.NuxProgressMweb=P.modules.NuxProgressBase.extend({onCreated:function(){P.modules.NuxProgressBase.prototype.onCreated.call(this);var e={};e[P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT]=this.updateFollowButton,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e)},onContentReady:function(){this.$progressWrapper=this.$(".nuxProgress"),this.$progressFooterWrapper=this.$(".progressFooterWrapper"),P.modules.NuxProgressBase.prototype.onContentReady.call(this)},endMandatoryFlow:function(){return P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_MOBILE_EVERYTHING_FEED_TAKEOVER,P.genConst.Experience.WEB_MOBILE_NUX_INTERESTS)?P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_MOBILE_EVERYTHING_FEED_TAKEOVER,P.genConst.Experience.WEB_MOBILE_NUX_INTERESTS):Promise.resolve()},setStepTexts:function(e){var t,o,n,a,r;if(this.progressData){var i=this.progressData[this.getNuxTutorialName()];if(i){var s=i.steps;if(s){var l=s[e];if(l){if(l.hideHeader)return this.$progressWrapper.hide(),void this.$progressFooterWrapper.hide();t=l.buttonText,o=l.header1,n=l.header2,a=l.skip_data,r=l.disableButton,this.$progressWrapper.show(),this.$progressFooterWrapper.show()}}}}this.$skip&&(this.$skip.unbind(),this._handleSkipButton(a)),t&&(r&&this.getNextButton().disable(),this.getNextButton().setText(t),this.getNextButton().show()),this._updateHeaders(o,n)},onRemoved:function(){P.app.instance.showInterstitial()},updateFollowButton:function(e,t,o){var n=o,a=n.total,r=5-a,i="";r>0?(i=P.string.format(P.i18n._("Follow {{ numToFollow }} more"),{numToFollow:r}),this.getNextButton().setText(i),this.getNextButton().disable()):(i=P.i18n._("Follow"),this.getNextButton().setText(i),this.getNextButton().enable())}}),P.modules.NuxProgressMweb.prototype.className="NuxProgressMweb",goog.provide("P.modules.NuxTutorial"),goog.require("P.Module"),P.modules.NuxTutorial=P.Module.extend({}),P.modules.NuxTutorial.prototype.className="NuxTutorial",goog.provide("P.modules.OAuthDialog"),goog.require("P.Module"),goog.require("P.windowUtil"),P.modules.OAuthDialog=P.Module.extend({events:{},onContentReady:function(){this.resizeWindowToFit()},onChildRemoved:function(e){this.children.length?this.resizeWindowToFit():window.close()},resizeWindowToFit:function(){P.windowUtil.shrinkWrap()}}),P.modules.OAuthDialog.prototype.className="OAuthDialog",goog.provide("P.modules.OAuthErrorPage"),goog.require("P.Module"),P.modules.OAuthErrorPage=P.Module.extend({}),P.modules.OAuthErrorPage.prototype.className="OAuthErrorPage",goog.provide("P.modules.OAuthPageBase"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.util"),goog.require("P.timer"),goog.require("P.validator"),goog.require("P.resourceFactory");var ve=2e3;P.modules.OAuthPageBase=P.Module.extend({getOAuthResource:function(e){var t=_.extend(this.resource.copyOptions(!0),e);return P.resourceFactory.instance.create("OAuthAuthorizationResource",t)},makeAuthorizationDecision:function(e,t,o){var n=this.getOAuthResource({authorized:e});n.callCreate().then(function(e){this.tryRedirect(e.resource_response.data,o)}.bind(this)).fin(function(){t&&t.hideLoading()})},tryRedirect:function(e,t){if(e.redirect){var o=e.redirect_uri,n={};e.access_token?(o+="#",n={access_token:e.access_token,expires_at:e.expires_at,token_type:e.token_type}):e.code&&(o+="?",n={code:e.code}),e.state&&(n.state=e.state),o+=$.param(n),t?(this.showRedirectScreen(),P.timer.setTimeout(function(){P.util.changeWindowLocation(o)},ve)):P.util.changeWindowLocation(o)}},onContentReady:function(){this.setupForm(),this.$("form input").first().focus()},setupForm:function(){if(0!==this.$(".standardForm").length){var e={username_or_email:[P.validator.Required(),P.validator.Email()],password:[P.validator.Required()]};this.loginForm=new P.Form(this.$("form"),e),this.loginFormListener=this.listen(this.loginForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)}},onSubmitValidated:function(e){e.errors&&e.errors.length||P.user.instance.login(this.loginForm.getData()).then(function(){this.authorizeApp()}.bind(this),function(e){if(this.$(".loginError").html(e.message).show(),e.api_error_code===P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE){var t=P.util.getResetPasswordOneClickUrl({username_or_email:this.loginForm.email});this.navigate(t)}}.bind(this))},authorizeApp:function(){var e=this.getChildById("authorizeButton");e.showLoading(),this.makeAuthorizationDecision(!0,e,!0)},onAuthorizeButtonClicked:function(e){this.loginForm?this.loginForm.onSubmit(e):this.authorizeApp()},showRedirectScreen:function(){this.$(".body").hide(),this.$(".loading").show()}}),P.modules.OAuthPageBase.prototype.className="OAuthPageBase",goog.provide("P.modules.OffsitePage"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),P.modules.OffsitePage=P.Module.extend({onContentReady:function(){var e=function(){window.close()};if(P.user.instance.isWriteBanned())P.writeban.showWriteBanned(this),this.listen(this,P.CONST.EVENT_DISMISS,e);else{var t={name:"ConfirmDialog",options:{template:"offsite_warning",sanitized_url:this.options.sanitized_url,redirect_status:this.options.redirect_status,offsite_message:this.options.offsite_message}};P.moduleFactory.load(t).then(function(t){t.render().then(function(){P.modalManager.get().createAndShowModal(t),t.on(P.CONST.EVENT_CONFIRM,function(){window.location.replace(this.options.sanitized_url),t.off(P.CONST.EVENT_DESTROYED,e)}.bind(this)),t.on(P.CONST.EVENT_DESTROYED,e)}.bind(this))}.bind(this))}}}),P.modules.OffsitePage.prototype.className="OffsitePage",goog.provide("P.modules.OffsiteWork"),goog.require("P.Module"),P.modules.OffsiteWork=P.Module.extend({}),P.modules.OffsiteWork.prototype.className="OffsiteWork",goog.provide("P.modules.OrderItem"),goog.require("P.Module"),P.modules.OrderItem=P.Module.extend({}),P.modules.OrderItem.prototype.className="OrderItem",goog.provide("P.modules.OrderView"),goog.require("P.Module"),P.modules.OrderView=P.Module.extend({}),P.modules.OrderView.prototype.className="OrderView",goog.provide("P.modules.PagedCollection"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.Spinner"),P.modules.PagedCollection=P.Module.extend({CssClassName:{LOADING:"loading"},onContentReady:function(){this._moreItemsButtonClickListener&&this.removeListener(this._moreItemsButtonClickListener),this._moreItemsButtonClickListener=this.listen(this.getMoreItemsButton(),P.CONST.EVENT_BUTTON_CLICK,this._onMoreItemsButtonClick)},_onMoreItemsButtonClick:function(e){e.stopPropagation(),this.requestMore()},getMoreItemsContainer:function(){return this.$el.children(".moreItemsContainer")},getMoreItemsButton:function(){return this.getChildById("moreItems")},_hasBorderedButton:function(){var e=this.getMoreItemsButton();return e&&!e.options.borderless},showMoreItemsLoading:function(){if(this._hasBorderedButton())this.getMoreItemsButton().showLoading();else if(!this._moreItemsSpinner){var e=this.getMoreItemsContainer();e.addClass(this.CssClassName.LOADING),this._moreItemsSpinner=new P.Spinner({size:P.Spinner.Size.SMALL}),this._moreItemsSpinner.spin(e)}},hideMoreItemsLoading:function(){this._hasBorderedButton()?this.getMoreItemsButton().hideLoading():this._moreItemsSpinner&&(this.getMoreItemsContainer().removeClass(this.CssClassName.LOADING),this._moreItemsSpinner.stop(),this._moreItemsSpinner=null)},requestMore:function(){}}),P.modules.PagedCollection.prototype.className="PagedCollection",goog.provide("P.modules.PartnerPerformanceHero"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),goog.require("P.genConst"),goog.require("P.context.instanceEvent"),P.modules.PartnerPerformanceHero=P.modules.HeroHelperBase.extend({onContentReady:function(){this._logDisplayState()},_logDisplayState:function(){var e="",t=this.$(".performanceStatsAnalytics");if(t.length>0){var o=t.find(".performanceStatsHighlight"),n=o.text().trim().replace(/[\d,\.]+\s+/,"").charAt(0);e+=n+":";var a=this.$(".performanceStatsTrend");if(a.length>0){var r=a.find(".performanceDeltaIndicator");e+=9652===r.text().trim().charCodeAt(0)?"u":"d"}else e+="x"}else e+="x";e+="-";var i=this.$(".partnerPerformanceTopPins");if(i.length>0){var s=i.find("li");e+=s.length+":";for(var l=0;l<s.length;++l){l>0&&(e+=",");var u=s.eq(l).find(".topPinInfo").text().trim();e+="."===u.charAt(0)?"0":"n",e+=u.match(/clickthrough/)?"c":u.match(/repin/)?"r":"i",e+=u.match(/rate/)?"r":"c"}}else e+="x";var d={component:P.genConst.ComponentType.PARTNER_PERFORMANCE_MODULE,element:P.genConst.ElementType.PARTNER_PERFORMANCE_STATS,event_type:P.genConst.EventType.VIEW,view_type:P.genConst.ViewType.FEED,view_parameter:P.genConst.ViewParameterType.FEED_HOME},c=P.context.instanceEvent.fromPlainObject(d);c.updateAuxData({value:e}),P.context.instanceLogger.getInstance().addEvent(c)}}),P.modules.PartnerPerformanceHero.prototype.className="PartnerPerformanceHero",goog.provide("P.modules.PartnerPerformanceHeroPins"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.PartnerPerformanceHeroPins=P.modules.HeroHelperBase.extend({}),P.modules.PartnerPerformanceHeroPins.prototype.className="PartnerPerformanceHeroPins",goog.provide("P.modules.PartnerPerformanceHeroStats"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.PartnerPerformanceHeroStats=P.modules.HeroHelperBase.extend({}),P.modules.PartnerPerformanceHeroStats.prototype.className="PartnerPerformanceHeroStats",goog.provide("P.modules.PasswordResetOneClick"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.PasswordResetOneClick=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onResetPassword)},onSuccess:function(){this.$(".message").hide(),this.$(".successMessage").show()},onResetPassword:function(e){if("resetPasswordButton"===e.target.id){var t={username_or_email:this.options.username_or_email},o=P.resourceFactory.instance.create("UserResetPasswordResource",t),n=this.getChildById("resetPasswordButton");n.showLoading(),o.callCreate({showError:!1}).then(function(){this.onSuccess()}.bind(this)).fin(function(){n.hideLoading()})}}}),P.modules.PasswordResetOneClick.prototype.className="PasswordResetOneClick",goog.provide("P.modules.PickerItemCreate"),goog.require("P.Module"),P.modules.PickerItemCreate=P.Module.extend({setCreateName:function(e){this.$(".createName").text(e)}}),P.modules.PickerItemCreate.prototype.className="PickerItemCreate",goog.provide("P.modules.PinActionBar"),goog.require("P.Module"),goog.require("P.Sticky"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.resourceFactory");var Pe="likesButton",we="repinsButton",Te="pinItButton",Le="repinCount",Ee="likeCount";P.modules.PinActionBar=P.Module.extend({CssClassName:{ACTION_LEFT_ROUNDED:"leftRounded"},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var e=this.options.pin_id;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this.onPinLiked,t[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this.onPinUnliked,t[P.CONST.PUBSUB_TOPIC_PIN_REPINNED]=this.onPinRepinned,this.pubsubSubscribe(e,t)}this.childListen(P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.onCloseupIncrementButtonHide),this.childListen(P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.onCloseupIncrementButtonShow),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,function(e){e.data.contextualResource||(e.data.contextualResource=this.getContextualResource())})},onAddedToDom:function(){P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_PIN_CLOSEUP,P.genConst.Experience.WEB_PIN_CLOSEUP_LITE)&&this.showSavePinTooltip()},removeDropdowns:function(){var e=this.getDropdowns();_.each(e,function(e){e.hide()})},showSavePinTooltip:function(){var e=this.getChildById("pinItButton"),t=P.i18n._("<strong>Want to save this Pin for yourself?</strong> Go ahead and Pin It.");this.extraData.unauthPinCloseupDisplayData&&this.extraData.unauthPinCloseupDisplayData.copy&&(t=this.extraData.unauthPinCloseupDisplayData.copy);var o={name:"Dropdown",options:{anchor:e.$el,class_name:"large",fixed:!1,position_point:"BOTTOM_LEFT",text:t}};P.moduleFactory.load(o).then(function(e){e.render().then(function(){$("body").append(e.$el),e.fadeIn()})})},getDropdowns:function(){var e=this.getChildrenByModuleName("Dropdown")||[],t=this.getChildrenByModuleName("DropdownButton");return _.each(t,function(t){var o=t.getDropdown();e.push(o)}),e},areDropdownsShowing:function(){for(var e=this.getDropdowns(),t=0;t<e.length;t++){var o=e[t];if(o.isShowing())return!0}return!1},getContextualResource:function(){return P.resourceFactory.instance.create("PinResource",{id:this.options.pin_id})},showRepinModal:function(){var e=this.getChildById(Te);e.showModalSubmodule()},getLoadingSpinnerOptions:function(){return null},onPinRepinned:function(e,t,o){if(this.options.is_modular_closeup){if(o.board&&"secret"!==o.board.privacy){var n=void 0!==this.options.repinCount?this.options.repinCount+1:this.data.repin_count+1;this.updateOptionsAndDom({repinCount:n})}}else{var a=this.getChildById(we);o.board&&"secret"!==o.board.privacy&&a&&a.increment()}},onPinLiked:function(){if(this.options.is_modular_closeup){var e=void 0!==this.options.likeCount?this.options.likeCount+1:this.data.like_count+1;this.updateOptionsAndDom({likeCount:e})}else{var t=this.getChildById(Pe);t&&t.increment()}},onPinUnliked:function(){if(this.options.is_modular_closeup){var e=void 0!==this.options.likeCount?this.options.likeCount-1:this.data.like_count-1;this.updateOptionsAndDom({likeCount:e})}else{var t=this.getChildById(Pe);t&&t.decrement()}},onCloseupIncrementButtonHide:function(e){var t=e.data,o=this.getChildById(t);o.$el.removeClass(this.CssClassName.ACTION_LEFT_ROUNDED)},onCloseupIncrementButtonShow:function(e){var t=e.data,o=this.getChildById(t);o.$el.addClass(this.CssClassName.ACTION_LEFT_ROUNDED)},setDropdownsFixed:function(e){var t=this.getDropdowns();_.each(t,function(t){var o=_.clone(t.options);o.fixed=e,t.setOptions(o),t.positionModule()})},updateSticky:function(e){this._sticky||(this._sticky=new P.Sticky(this.$el,e),this.listen(this._sticky,P.CONST.EVENT_STICKY_FIXED,function(e){this.setDropdownsFixed(e)}))},unsticky:function(){this._sticky&&this._sticky.unSticky()},getLoggingObjectIdStr:function(){return this.options.pin_id},triggerPinItButton:function(){var e=this.getChildById("pinItButton");e&&e.onClick()},updateDom:function(){var e=this.$("."+Ee);e.text(this.options.likeCount);var t=this.$("."+Le);t.text(this.options.repinCount)}}),P.modules.PinActionBar.prototype.className="PinActionBar",goog.provide("P.modules.PinActionDropdown"),goog.require("P.Module"),P.modules.PinActionDropdown=P.Module.extend({}),P.modules.PinActionDropdown.prototype.className="PinActionDropdown",goog.provide("P.modules.PinBookmarklet"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.windowUtil"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.PinBookmarklet=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_IMAGE_LOAD_ERROR,this._onImageError)},onContentReady:function(){this.resizeWindowToFit(),this._isPinFave()&&window.opener.postMessage("pinterestReady","*")},onAddedToDom:function(){this._windowMessageListener=this.listen($(window),"message",this.onWindowMessage)},onRemovedFromDom:function(){this._windowMessageListener&&(this.removeListener(this._windowMessageListener),this._windowMessageListener=null)},_parseDataUri:function(e){var t=/^data:(.+\/.+);(.+),(.*)$/,o=e.match(t);return o?{contentType:o[1],encoding:o[2],payload:o[3]}:null},onWindowMessage:function(e){var t=e.originalEvent.data;if(t&&"pinImageData"===t.type){var o=t.dataUri;if(!o)return void P.errorUtil.showError(P.i18n._("Missing image data"));var n=this._parseDataUri(o);if(!n)return void P.errorUtil.showError(P.i18n._("Invalid image data uri"));if("base64"!==n.encoding)return void P.errorUtil.showError(P.i18n._("The image data URI uses an unsupported encoding"));var a=P.resourceFactory.instance.create("ImagePreviewResource",{content_type:n.contentType,base64_payload:n.payload});a.callCreate().then(function(e){var t=e.resource_response.data.image_url;this._setImage(t)}.bind(this))}},_isPinFave:function(){return!this.options.image_url&&this.options.is_pin_fave&&window.opener},_setImage:function(e){this.options.image_url=e;var t=this.getChildById("pinCreate");t.setImage(e)},_onImageError:function(e){if(this.options.is_from_external&&!this._isPinFave()){var t=this.getChildById("pinCreate");P.errorUtil.showError(P.i18n._("Invalid image data uri"),function(){t.destroy()})}},onChildRemoved:function(e){this.children.length?this.resizeWindowToFit():window.close()},onChildAdded:function(e){var t=this.$(".pinningBG");"pinSuccess"===e.id&&t.length&&t.remove()},onChildNavigate:function(e){var t=!0;P.util.changeWindowLocation(e.data.url,t),window.close()},resizeWindowToFit:function(){P.windowUtil.shrinkWrap()}}),P.modules.PinBookmarklet.prototype.className="PinBookmarklet",goog.provide("P.modules.PinComment"),goog.require("P.Module"),P.modules.PinComment=P.Module.extend({onCreated:function(){this.childListen("commentDeleteSuccess",this.onPinCommentDelete)},onPinCommentDelete:function(){this.$el.slideUp(300,function(){this.destroy()}.bind(this))}}),P.modules.PinComment.prototype.className="PinComment",goog.provide("P.modules.PinCommentList"),goog.require("P.Module"),goog.require("P.genConst"),goog.require("P.resourceFactory"),P.modules.PinCommentList=P.Module.extend({events:{},onCreated:function(){},onContentReady:function(){var e=this.options.pin_id;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this.onPinCommentCreated,t[P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_NEXT_PAGE_REQUESTED]=this.fetchMore,this.pubsubSubscribe(e,t)}},fetchMore:function(){this.resource||(this.resource=P.resourceFactory.instance.create("PinCommentListResource",{field_set_key:this.options.field_set_key,pin_id:this.options.pin_id})),this.resource.options.page_size=P.genConst.Settings.API_MAX_PAGE_SIZE,this.resource.getLatestBookmark()||this.resource.setBookmarks([this.options.bookmark]),this.renderAdditional(P.ModuleRenderType.PREPEND).then(function(){this.resource.atEnd()&&P.pubSub.instance.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_LAST_PAGE_REACHED)}.bind(this))},populateComment:function(e){var t=this.getChildById("pinCommentField");t.setValue(e),t.focus()},onPinCommentCreated:function(){this.options.count++,this.render()}}),P.modules.PinCommentList.prototype.className="PinCommentList",goog.provide("P.modules.PinCommentsPage"),goog.require("P.Module"),P.modules.PinCommentsPage=P.Module.extend({events:{"click .showMore":"onShowMore","mousedown .content":"onTextAreaMouseDown","keydown .content":"onTextAreaPossiblyResized","mouseup .content":"onTextAreaPossiblyResized","click .pinUserCommentBox textarea":"showCommenter"},CssClassName:{HIDDEN:"hidden"},onCreated:function(){this.commentContentHeight=null,this.options.state_hideShowMoreLink=!1},onContentReady:function(){var e=this.options.pin_id;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_LAST_PAGE_REACHED]=this.onLastPageReached,this.pubsubSubscribe(e,t)}this._visible=!0},updateDom:function(){this.$(".showMore").toggleClass(this.CssClassName.HIDDEN,this.options.state_hideShowMoreLink)},onLastPageReached:function(){this.updateOptionsAndDom({state_hideShowMoreLink:!0})},toggle:function(){this._visible?this.hide():this.show(),this._visible=!this._visible},onShowMore:function(e){e.stopPropagation(),e.preventDefault(),P.pubSub.instance.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENTS_NEXT_PAGE_REQUESTED)},onTextAreaMouseDown:function(){this.commentContentHeight=this.$(".content").height()},onTextAreaPossiblyResized:function(){if(null!==this.commentContentHeight){var e=this.$(".content").height();this.commentContentHeight!==e&&(this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0),this.commentContentHeight=e)}},showCommenter:function(){this.options.is_modular_closeup&&this.$(".pinUserCommentBox .commenterWrapper").addClass("show")}}),P.modules.PinCommentsPage.prototype.className="PinCommentsPage",goog.provide("P.modules.PinCount"),goog.require("P.Module"),P.modules.PinCount=P.Module.extend({onContentReady:function(){if(this.options.can_update_count&&this.data.id){var e={};"UserResource"===this.resource.name&&(e[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onCountUpdated),e[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onCountUpdated,e[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onCountUpdated,this.pubsubSubscribe(this.data.id,e)}},onCountUpdated:function(e,t,o){var n=1e3;t===P.CONST.PUBSUB_TOPIC_PIN_DELETED&&(n=0),setTimeout(this.render.bind(this),n)}}),P.modules.PinCount.prototype.className="PinCount",goog.provide("P.modules.PinCreateSuccess"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.url"),goog.require("P.ga"),goog.require("P.timer"),goog.require("P.ExperienceManager"),goog.require("P.genConst");var xe=2e3,Oe=3e3,Ce=1e4,Se=Ce,Fe=1e3,Ne="installExtensionButton",Ie="cancelInstallButton",Ae="dismissAllPromos";P.modules.PinCreateSuccess=P.Module.extend({CssClassName:{NO_BODY:"noBody"},onContentReady:function(){var e=P.url.getQueryStringParams().guid;e&&P.util.logWidgetEvent({guid:e,pin_id:this.options.pin_id});var t=xe,o=!1,n=this.getChildById("successBoard");if(n&&n.hasBoard()){t=Ce,o=!0;var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onBoardFollow,this.pubsubSubscribe(n.getBoardId(),a)}this.options.is_bulk_action&&(t=Oe);var r=this.getChildById("successPromo");if(r&&!r.isValid())return void this.destroy();var i=this.getChildById(Ne);i&&(t=Se,this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onInstallExtensionButtonClick),this._viewExtensionUpsellExperience());var s=this.getChildById(Ie);s&&this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onGotItButtonClick);var l=this.getChildById(Ae);l&&this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onDismissAllPromosButtonClick),s&&this._viewWebPinSuccessExperience(P.genConst.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL),o||this.$el.addClass(this.CssClassName.NO_BODY),P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_PIN_SUCCESS,P.genConst.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)&&"bookmarklet"===this.options.method&&(t=Ce),this.options.auto_close&&this.closeOnDelay(t),P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_PIN_CLOSEUP,P.genConst.Experience.WEB_PIN_CLOSEUP_LITE)},closeOnDelay:function(e){this.closeTimer&&clearTimeout(this.closeTimer),this.closeTimer=P.timer.setTimeout(function(){this.closeTimer=null,this.options.is_csr&&window.parent.postMessage("navigate",P.CONST.PIN_IT_DOMAIN),this.destroy()}.bind(this),e)},onInstallExtensionButtonClick:function(e){var t=e.target;t.id===Ne&&this._completeExtensionUpsellExperience()},onGotItButtonClick:function(e){var t=e.target,o;t.id===Ie&&(o=P.genConst.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL),this._completeWebPinSuccessExperience(o)},onDismissAllPromosButtonClick:function(e){var t=e.target;t.id===Ae&&this._completeWebPinSuccessExperience(P.genConst.Experience.WEB_PIN_SUCCESS_NEW_EXTENSION_UPSELL);
},_viewWebPinSuccessExperience:function(e){if(e){var t=P.ExperienceManager.instance.constructPlacedExperienceId(P.genConst.Placement.WEB_PIN_SUCCESS,e);P.ExperienceManager.instance.viewPlacedExperienceId(t)}},_completeWebPinSuccessExperience:function(e){e&&P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_PIN_SUCCESS,e)},onBoardFollow:function(){this.closeOnDelay(Fe)},onDestroyed:function(){"pin_create_ignition"===this.options.action&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},_viewExtensionUpsellExperience:function(){P.ga.trackEvent("web_pin_success_extension_upsell","viewed"),P.context.instanceLogger.getInstance().logCustomViewEvent(P.genConst.ViewType.SAVE,P.genConst.ViewParameterType.EXTENSION_UPSELL_NAG_PIN_CREATE)},_completeExtensionUpsellExperience:function(){P.ga.trackEvent("web_pin_success_extension_upsell","completed"),P.context.instanceLogger.getInstance().logCustomViewEvent(P.genConst.ViewType.SAVE,P.genConst.ViewParameterType.EXTENSION_INSTALLED)}}),P.modules.PinCreateSuccess.prototype.className="PinCreateSuccess",goog.provide("P.modules.PinCreateSuccessBoard"),goog.require("P.Module"),P.modules.PinCreateSuccessBoard=P.Module.extend({onContentReady:function(){this.hasBoard||this.hide()},hasBoard:function(){return!!this.getChildById("board")},getBoardId:function(){return this.extraData.boardId}}),P.modules.PinCreateSuccessBoard.prototype.className="PinCreateSuccessBoard",goog.provide("P.modules.PinCreateSuccessBulkAction"),goog.require("P.Module"),P.modules.PinCreateSuccessBulkAction=P.Module.extend({hasBoard:function(){return!!this.getChildById("board")},getBoardId:function(){return this.extraData.boardId}}),P.modules.PinCreateSuccessBulkAction.prototype.className="PinCreateSuccessBulkAction",goog.provide("P.modules.PinCreateSuccessExtensionNag"),goog.require("P.Module"),P.modules.PinCreateSuccessExtensionNag=P.Module.extend({}),P.modules.PinCreateSuccessExtensionNag.prototype.className="PinCreateSuccessExtensionNag",goog.provide("P.modules.PinCreateSuccessToast"),goog.require("P.Module"),goog.require("P.timer");var Re=3e3;P.modules.PinCreateSuccessToast=P.Module.extend({onContentReady:function(){this.closeOnDelay(Re)},closeOnDelay:function(e){P.timer.setTimeout(function(){this.destroy()}.bind(this),e)}}),P.modules.PinCreateSuccessToast.prototype.className="PinCreateSuccessToast",goog.provide("P.modules.PinDeleteCommentButton"),goog.require("P.modules.InlineHoverButton"),goog.require("P.moduleFactory"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.PinDeleteCommentButton=P.modules.InlineHoverButton.extend({events:{click:"onClick"},showConfirmation:function(){var e={name:"ConfirmDialog",options:{template:"delete_comment"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.onDeleteConfirm)}.bind(this))},onDeleteConfirm:function(){P.ga.trackEvent("comment_delete",P.CONST.GA_ACTION_CLICK_SUBMIT);var e={pin_id:this.options.pin_id,comment_id:this.options.comment_id},t=P.resourceFactory.instance.create("PinCommentResource",e);t.callDelete().then(function(){P.ga.trackEvent("comment_delete",P.CONST.GA_ACTION_SUCCESS),this.triggerEvent("commentDeleteSuccess",this,!0),P.pubSub.instance.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED)}.bind(this),function(){P.ga.trackEvent("comment_delete",P.CONST.GA_ACTION_ERROR)})},onClick:function(){P.ga.trackEvent("comment_delete",P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()}}),P.modules.PinDeleteCommentButton.prototype.className="PinDeleteCommentButton",goog.provide("P.modules.PinDescriptionComment"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.util"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.PinDescriptionComment=P.Module.extend({events:{"focus .content":"onFocusCommentInput","keypress .content":"onKeypressCommentInput","click .addComment":"addComment"},getPinCommentInputValue:function(){return this.getChildById("pinCommentField").getValue()},getAddCommentButton:function(){return this.getChildById("addCommentButton")},addComment:function(e){P.ga.trackEvent("comment_create",P.CONST.GA_ACTION_CLICK_SUBMIT);var t=this.getPinCommentInputValue(),o=this._getCommentFieldMaxLength();if(!(t&&o&&t.length>o)){var n=this.options.pin_id,a=P.resourceFactory.instance.create("PinCommentResource",{pin_id:n,text:t}),r=this.getAddCommentButton();r.showLoading(),this.getChildById("pinCommentField").reset(),P.resourceCache.instance.callCreate(a).then(function(){P.ga.trackEvent("comment_create",P.CONST.GA_ACTION_SUCCESS),P.pubSub.instance.publish(n,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED)}).fin(function(){r.hideLoading()})}},onFocusCommentInput:function(){var e=this.$el.find(".addComment");this.options.type&&"closeup"===this.options.type?e.css("display","block"):e.show(),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},onKeypressCommentInput:function(e){e.which===P.util.keyCode.ENTER&&(this.addComment(),e.preventDefault())},_getCommentFieldMaxLength:function(){var e=this.getChildByModuleName("TextField");return e.options.maxlength}}),P.modules.PinDescriptionComment.prototype.className="PinDescriptionComment",goog.provide("P.modules.PinDupWarning"),goog.require("P.Module"),P.modules.PinDupWarning=P.Module.extend({onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var e=this.data&&this.data.pinned_to_board&&!_.isEmpty(this.data.pinned_to_board);e?this.triggerDupeDetected():this.model&&this.listenToOnce(this.model,"change:pinned_to_board",function(){this.renderExistingData().then(function(){this.triggerDupeDetected()}.bind(this))}.bind(this))},triggerDupeDetected:function(){this.triggerEvent(P.CONST.EVENT_DUPE_DETECTED,null,!0)},isDupe:function(){return this.data&&_.keys(this.data).length}}),P.modules.PinDupWarning.prototype.className="PinDupWarning",goog.provide("P.modules.PinEdit"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.ga"),goog.require("P.i18n"),goog.require("P.resourceFactory"),P.modules.PinEdit=P.Module.extend({_onButtonClick:function(e){var t=e.target;switch(t.id){case"submitButton":P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_SUBMIT);break;case"cancelButton":P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_CANCEL);break;case"deleteButton":P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()}},savePin:function(){var e=this.data.id,t=this.pinForm.getData();t.id=e;var o=P.resourceFactory.instance.create("PinResource",t);this.showLoading(!0),o.callUpdate().then(function(o){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_SUCCESS);var n=o.resource_response.data;if(!this.refreshOnSave&&this.isInModal()){P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_PIN_UPDATED,n);var a=t.board_id,r=this.data.board.id;a!==r&&(P.pubSub.instance.publish(a,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.pubSub.instance.publish(r,P.CONST.PUBSUB_TOPIC_PIN_DELETED)),this.destroy()}else{var i="/pin/"+e+"/";this.navigate(i)}}.bind(this),function(e){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))},onDeleteConfirm:function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_CLICK_SUBMIT),this.deletePin()},deletePin:function(){var e=this.data.id,t={id:e},o=P.resourceFactory.instance.create("PinResource",t);this.showLoading(!0),o.callDelete().then(function(){if(P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_SUCCESS),P.pubSub.instance.publish(this.data.board.id,P.CONST.PUBSUB_TOPIC_PIN_DELETED),P.pubSub.instance.publish(this.data.pinner.id,P.CONST.PUBSUB_TOPIC_PIN_DELETED),!this.refreshOnSave&&this.isInModal())P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_PIN_DELETED),this.destroy();else{var t=this.data.board.url;this.navigate(t)}}.bind(this),function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))},onContentReady:function(){if(P.autologin.checkForAutologin()){var e=P.i18n._("To edit your Pin, please take a second to confirm it's really you.");return P.autologin.showLoginErrorDialog(this,e),void this.destroy()}this.pinForm=this.getChildById("pinForm"),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onPlaceTypeaheadItemSelected),this.refreshOnSave=!1,this.listen(this.pinForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick)},onPlaceTypeaheadItemSelected:function(e){var t=e.data.item,o=t.get("id");this.$(".pinPlaceId").val(o)},onSubmitValidated:function(e){var t=e.data;t.errors[0]||(this.needConfirm()?this.showPrivacyChangeConfirmation():this.savePin())},needConfirm:function(){var e=this.data.board.privacy,t=this.pinForm.getBoardPicker(),o=t.getSelectedBoardPrivacy();return e===P.CONST.BoardPrivacy.SECRET&&o===P.CONST.BoardPrivacy.PUBLIC},showConfirmation:function(){var e={name:"ConfirmDialog",options:{template:"delete_pin",ga_category:P.CONST.GA_CATEGORY_PIN_DELETE}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.onDeleteConfirm)}.bind(this))},showPrivacyChangeConfirmation:function(){var e={name:"ConfirmDialog",options:{template:"change_pin_privacy"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,function(){P.ga.trackEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_CONFIRM),this.savePin()})}.bind(this))}}),P.modules.PinEdit.prototype.className="PinEdit",goog.provide("P.modules.PinFeedbackConfirmation"),goog.require("P.Module"),P.modules.PinFeedbackConfirmation=P.Module.extend({animateIn:function(){this.$el.transition({transform:"rotateY(0deg)"},500)}}),P.modules.PinFeedbackConfirmation.prototype.className="PinFeedbackConfirmation",goog.provide("P.modules.PinFeedbackDialog"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.validator"),goog.require("P.genConst"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.PinFeedbackDialog=P.Module.extend({events:{"change input":"onChange","click .radioOption":"onClickOption"},CssClassName:{SELECTED:"selected"},onContentReady:function(){var e={reason:[P.validator.Required()]};this.form=new P.Form(this.$("form"),e),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.submitButton=this.getChildById("submitButton"),this.submitButton.disable()},onSubmitValidated:function(e){e.errors[0]||this.sendPinFeedback()},onClickOption:function(e){var t=$(e.currentTarget).find("input");t.prop("checked","checked"),t.change()},onChange:function(e){this.submitButton.enable();var t=$(e.target).parent();this._selected&&this._selected.removeClass(this.CssClassName.SELECTED),t.addClass(this.CssClassName.SELECTED),this._selected=t},sendPinFeedback:function(){this.submitButton.showLoading();var e=this.$('[name="reason"]:checked').val(),t={complaint_reason:P.genConst.RecommendationComplaintReason[e],pin_id:this.options.pin_id,feedback_type:this.options.feedback_type};this.options.rec_reason_id&&(t.through_id=this.options.through_id,t.rec_reason_id=this.options.rec_reason_id);var o=P.resourceFactory.instance.create("PinFeedbackResource",t);o.callUpdate().fin(function(e){this.destroy(),this.triggerEvent(P.CONST.EVENT_PIN_FEEDBACK_SUBMITTED,this,!0)}.bind(this)).fail(function(e){P.errorUtil.showError(e.message)}).always(function(e){this.submitButton.hideLoading()}.bind(this))}}),P.modules.PinFeedbackDialog.prototype.className="PinFeedbackDialog",goog.provide("P.modules.PinFlagCommentButton"),goog.require("P.modules.InlineHoverButton"),goog.require("P.moduleFactory"),goog.require("P.ga"),P.modules.PinFlagCommentButton=P.modules.InlineHoverButton.extend({events:{click:"onClick"},showReasonModal:function(){var e={name:"FlagComment",options:{pin_id:this.options.pin_id,comment_id:this.options.comment_id,user_id:this.options.user_id,commenter:this.options.commenter}};P.moduleFactory.load(e).then(function(e){this.showInModal(e)}.bind(this))},onClick:function(){P.ga.trackEvent("comment_flag",P.CONST.GA_ACTION_OPEN_MODAL),this.showReasonModal()}}),P.modules.PinFlagCommentButton.prototype.className="PinFlagCommentButton",goog.provide("P.modules.PinInfo"),goog.require("P.Module"),goog.require("P.timer"),P.modules.PinInfo=P.Module.extend({HIDE_DELAY:100,events:{"click .hidePin":"hidePin","click .reportPin":"reportPin"},CssClassName:{HIDDEN:"hidden"},hidePin:function(e,t){e="string"==typeof e?e:P.CONST.FeedbackType.HIDE,t=t||!1;var o=this.options.pin_id;this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.timer.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0);var n=t?P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_UNFOLLOW:P.CONST.PUBSUB_TOPIC_PIN_HIDDEN;P.pubSub.instance.publish(o,n,e)}.bind(this),this.HIDE_DELAY)},reportPin:function(){var e="FlagPin",t={name:e,options:{pin_id:this.options.pin_id,user_id:this.options.user_id}};P.moduleFactory.load(t).then(function(e){this.showInModal(e),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}.bind(this))}}),P.modules.PinInfo.prototype.className="PinInfo",goog.provide("P.modules.PinItLandingSignup"),goog.require("P.modules.InlineSignup"),goog.require("P.util"),goog.require("P.url"),goog.require("P.windowUtil"),P.modules.PinItLandingSignup=P.modules.InlineSignup.extend({CssClassName:_.extend(P.modules.InlineSignup.prototype.CssClassName,{HAS_IMAGE:"hasImage"}),onContentReady:function(){this.setupSavePinitLanding(),P.windowUtil.shrinkWrap(),P.util.trackRegisterAction("pin_it_landing_view")},setupSavePinitLanding:function(){var e=P.url.getQueryStringParams(this.options.next),t=e.media,o=this.$(".savePinImg").get(0);o&&(o.src=t,this.$(".savePinText").addClass(this.CssClassName.HAS_IMAGE))}}),P.modules.PinItLandingSignup.prototype.className="PinItLandingSignup",goog.provide("P.modules.PinLikeButton"),goog.require("P.modules.LikeButton"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.PinLikeButton=P.modules.LikeButton.extend({getLikeResource:function(e){var t="PinLikeResource2";return P.resourceFactory.instance.create(t,{pin_id:this.options.pin_id,source_interest_id:this.options.source_interest_id})},_getGACategory:function(e){return e?"pin_like":"pin_unlike"},onClick:function(){var e=!this.options.liked;P.modules.LikeButton.prototype.onClick.call(this);var t=this._getGACategory(e);P.ga.trackEvent(t,P.CONST.GA_ACTION_CLICK)},onToggleSuccess:function(e){var t=this._getGACategory(e),o=e?P.CONST.PUBSUB_TOPIC_PIN_LIKED:P.CONST.PUBSUB_TOPIC_PIN_UNLIKED;P.ga.trackEvent(t,P.CONST.GA_ACTION_SUCCESS),P.pubSub.instance.publish(this.options.pin_id,o)}}),P.modules.PinLikeButton.prototype.className="PinLikeButton",goog.provide("P.modules.PinPicksDetail"),goog.require("P.Module"),goog.require("P.util"),P.modules.PinPicksDetail=P.Module.extend({events:{},onContentReady:function(){P.util.trackRegisterAction("pin_picks_visit")}}),P.modules.PinPicksDetail.prototype.className="PinPicksDetail",goog.provide("P.modules.PinPreview"),goog.require("P.Module"),P.modules.PinPreview=P.Module.extend({setImage:function(e){this.options.image_url=e,this.showLoading(!0);var t=function(){this.hideLoading()}.bind(this),o=this.$("img").get(0);o&&(o.onerror=o.onload=t,o.src=e)}}),P.modules.PinPreview.prototype.className="PinPreview",goog.provide("P.modules.PinfluencerOptOutConfirmationPage"),goog.require("P.Module"),P.modules.PinfluencerOptOutConfirmationPage=P.Module.extend({}),P.modules.PinfluencerOptOutConfirmationPage.prototype.className="PinfluencerOptOutConfirmationPage",goog.provide("P.modules.PinsCarousel"),goog.require("P.Module"),P.modules.PinsCarousel=P.Module.extend({}),P.modules.PinsCarousel.prototype.className="PinsCarousel",goog.provide("P.modules.PintreeEst"),goog.require("P.Module"),P.modules.PintreeEst=P.Module.extend({}),P.modules.PintreeEst.prototype.className="PintreeEst",goog.provide("P.modules.PlacesBoardExamples"),goog.require("P.Module"),P.modules.PlacesBoardExamples=P.Module.extend({}),P.modules.PlacesBoardExamples.prototype.className="PlacesBoardExamples",goog.provide("P.modules.PlainSignupModal"),goog.require("P.modules.InlineSignup"),goog.require("P.util"),P.modules.PlainSignupModal=P.modules.InlineSignup.extend({events:{"click .closeModal":"closeModal"},CssClassName:_.extend(P.modules.InlineSignup.prototype.CssClassName,{SECOND_STEP:"secondStep"}),onContentReady:function(){P.util.trackRegisterAction("plain_signup_modal_view"),P.modules.InlineSignup.prototype.onContentReady.call(this)},closeModal:function(){this.triggerEvent(P.CONST.EVENT_CLOSE_SIGNUP_OVERLAY,null,!0)}}),P.modules.PlainSignupModal.prototype.className="PlainSignupModal",goog.provide("P.modules.PositionModule"),goog.require("P.dom"),goog.require("P.Module");var Be="positionModuleCaret",Me=5,De=P.CONST.PositionPoint,Ve=P.CONST.PositionPointFlag,We={};We[Ve.FLAG_HORIZONTAL_LEFT]="positionLeft",We[Ve.FLAG_HORIZONTAL_RIGHT]="positionRight",We[Ve.FLAG_VERTICAL_TOP]="positionTop",We[Ve.FLAG_VERTICAL_BOTTOM]="positionBottom",We[Ve.FLAG_VERTICAL_CENTER]="positionCenter",P.modules.PositionModule=P.Module.extend({CssClassName:{ABSOLUTE_CENTER:"absoluteCenter",BIG_CARET:"bigCaret",DEFAULT_CARET:"defaultCaret",POSITION_FIXED:"positionFixed",POSITION_MODULE:"PositionModule",POSITION_MODULE_ELEMENT:"positionModuleElement",POSITION_MODULE_FIXED:"positionModuleFixed"},positionMode:P.CONST.PositionMode.ANCHORED,onCreated:function(){this._allowPositioning=!0;var e=this.positionModule.bind(this);this.childListen(P.CONST.EVENT_CONTENT_CHANGED,e),this.listen(this,P.CONST.EVENT_DIMS_CHANGED,e),this.listen(this,P.CONST.EVENT_NAVIGATE,e),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,e),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,e)},getPositionMode:function(){return P.CONST.PositionMode[this.options.position_mode]||this.positionMode},onOptionsChanged:function(){this.updateFixed()},getPositionElement:function(){return this.$el},getPositionAnchor:function(){return $(this.options.anchor)},getPositionPoint:function(){return De[this.options.position_point]||De.BOTTOM_LEFT},getPositionFixed:function(){return!!this.options.fixed},getPositionCaret:function(){return this.getCaret()},getCaret:function(){return this.$("."+Be)},_getPositionType:function(){return this.getPositionFixed?"fixed":"absolute"},positionModuleAtAnchor:function(e,t){P.dom.deferDomManipulation(function(){var o=this.getPositionElement();o.addClass(this.CssClassName.POSITION_MODULE_ELEMENT),o.toggleClass(this.CssClassName.POSITION_FIXED,this.getPositionFixed()),_.each(We,function(e){o.removeClass(e)}),t=P.Positioning.positionElementAtAnchor(o,e,t,this.getPositionFixed(),this.options.force_in_viewport,!1),_.each(We,function(e,n){t&n&&o.addClass(We[n])})}.bind(this)),this.positionCaret(e,t)},positionCaret:function(e,t){P.dom.deferDomManipulation(function(){var o=this.$("."+Be);if(o.length){var n=P.CONST.PositionPointFlag,a=this.getPositionElement();if(this.options.largeCaret?a.addClass(this.CssClassName.BIG_CARET):a.addClass(this.CssClassName.DEFAULT_CARET),this.options.caret_style?o.addClass(this.options.caret_style+"CaretStyle"):o.attr("class",Be),this.options.right_position_caret)return void o.css("right","7px");var r="left",i="outerWidth",s="width";t&n.FLAG_HORIZONTAL&&(r="top",i="outerHeight",s="height");var l=0,u=t&(n.FLAG_HORIZONTAL_CENTER|n.FLAG_VERTICAL_CENTER),d=o[s]()>e[s]()-Me;d&&!u&&(l=(o[s]()-e[s]())/2+Me,(t&n.FLAG_VERTICAL_RIGHT||t&n.FLAG_HORIZONTAL_BOTTOM)&&(l=-l));var c=a.offset()[r],p=c+a[i](),m=e.offset()[r],h=m+e[i](),g=c;m>g&&(g=m);var _=p;_>h&&(_=h);var f=(g+_)/2-o[i]()/2+l,b={};if(b[r]=f,o.offset(b),l){var k=parseInt(a.css(r),10);a.css(r,k-l)}}}.bind(this))},_setAllowPositioning:function(e){this._allowPositioning&&e&&this._positionModule(),this._allowPositioning=e},positionModule:function(){this._allowPositioning&&this._positionModule()},_positionModule:function(){this.cleanPositionModuleElement();var e=!1;this.getPositionMode()===P.CONST.PositionMode.MANUAL?this._positionManually():this.getPositionMode()===P.CONST.PositionMode.ANCHORED?this.positionModuleAtAnchor(this.getPositionAnchor(),this.getPositionPoint()):e=!0,this._positionAbsoluteCenter(e)},_positionAbsoluteCenter:function(e){this.$el.toggleClass(this.CssClassName.ABSOLUTE_CENTER,e)},_positionManually:function(){P.dom.deferDomManipulation(function(){var e=this.getPositionElement();e.addClass(this.CssClassName.POSITION_MODULE_ELEMENT),e.toggleClass(this.CssClassName.POSITION_FIXED,this.getPositionFixed())}.bind(this))},cleanPositionModuleElement:function(){P.dom.deferDomManipulation(function(){var e=this.getPositionElement();e.removeClass(this.CssClassName.POSITION_MODULE_ELEMENT),e.css({top:"",left:"",margin:""})}.bind(this))},updateFixed:function(){P.dom.deferDomManipulation(function(){this.$el.toggleClass(this.CssClassName.POSITION_MODULE_FIXED,this.getPositionFixed())}.bind(this))},toggleFixed:function(){P.dom.deferDomManipulation(function(){var e=this.getPositionElement();e.toggleClass(this.CssClassName.POSITION_MODULE_FIXED,!e.hasClass(this.CssClassName.POSITION_MODULE_FIXED))}.bind(this))},renderContainer:function(){this.empty();var e=this.$el;if(e.addClass(this.CssClassName.POSITION_MODULE),e.addClass(this.options.class_name),this.updateFixed(),this.options.view_type&&e.addClass(this.options.view_type),!this.options.hide_caret){var t=$('<span class="'+Be+'"></span>');e.prepend(t)}}}),P.modules.PositionModule.prototype.className="PositionModule",goog.provide("P.modules.Product"),goog.require("P.Module"),P.modules.Product=P.Module.extend({}),P.modules.Product.prototype.className="Product",goog.provide("P.modules.ProductDetailsPage"),goog.require("P.Module"),P.modules.ProductDetailsPage=P.Module.extend({}),P.modules.ProductDetailsPage.prototype.className="ProductDetailsPage",goog.provide("P.modules.ProductsPage"),goog.require("P.Module"),P.modules.ProductsPage=P.Module.extend({}),P.modules.ProductsPage.prototype.className="ProductsPage",goog.provide("P.modules.ProductsPageHeader"),goog.require("P.Module"),P.modules.ProductsPageHeader=P.Module.extend({}),P.modules.ProductsPageHeader.prototype.className="ProductsPageHeader",goog.provide("P.modules.Progress"),goog.require("P.Module"),P.modules.Progress=P.Module.extend({events:{"click li":"onStepClick"},CssClassName:{IS_ACTIVE:"active"},moveStep:function(e){this.setStep(this.options.current_step+e)},setStep:function(e){0>e||e>this.options.steps||(this.options.current_step=e,this._localRender(),e===this.options.steps&&this.triggerEvent(P.CONST.EVENT_PROGRESS_COMPLETED,null,!0))},setMiniStepProgress:function(e,t){var o=this.getChildrenByModuleName("ProgressMinistep"),n=0;_.each(o,function(o){o.options.ministep_type===e&&(t>n?(o.setActive(),n++):o.setInactive())})},updateStepWidths:function(){var e=this.$el.width(),t=this.$el.find("li").length;if(t>1){var o=Math.floor(e/t);o&&this.$el.find("li").width(o+"px")}},_localRender:function(){var e=this.$el.children("li"),t=parseInt(this.options.current_step,10),o=this.options.highlight_current_only;$.each(e,function(e,n){$(n).toggleClass(this.CssClassName.IS_ACTIVE,o&&t===e+1||!o&&t>=e+1)}.bind(this))},onStepClick:function(e){if(this.options.allow_jump_to_any_step){var t=$(e.target).data("step-id");String(t)!==String(this.options.current_step)&&(this.setStep(t),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_GO_TO_STEP,Number(t)))}}}),P.modules.Progress.prototype.className="Progress",goog.provide("P.modules.ProgressMinistep"),goog.require("P.Module"),P.modules.ProgressMinistep=P.Module.extend({CssClassName:{IS_ACTIVE:"active"},setActive:function(){var e=this.$el.children("li");e.hasClass(this.CssClassName.IS_ACTIVE)||e.addClass(this.CssClassName.IS_ACTIVE)},setInactive:function(){var e=this.$el.children("li");e.hasClass(this.CssClassName.IS_ACTIVE)&&e.removeClass(this.CssClassName.IS_ACTIVE)}}),P.modules.ProgressMinistep.prototype.className="ProgressMinistep",goog.provide("P.modules.PromotedPinFeedback"),goog.require("P.Module"),goog.require("P.timer"),goog.require("P.genConst"),goog.require("P.resourceFactory"),P.modules.PromotedPinFeedback=P.Module.extend({events:{"click .notInterested":"notInterested","click .seenBefore":"seenBefore","click .offensive":"offensive","click .dislikePromo":"dislikePromo"},_sendFeedback:function(e){this.showLoading();var t={complaint_reason:P.genConst.RecommendationComplaintReason[e],pin_id:this.options.pin_id,feedback_type:this.options.feedback_type,promoted:!0},o=P.resourceFactory.instance.create("PinFeedbackResource",t);o.callUpdate().then(function(e){P.timer.setTimeout(function(){this.hideLoading(),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubSub.instance.publish(this.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN,"hidePin")}.bind(this),100)}.bind(this))},notInterested:function(){this._sendFeedback("NOT_INTERESTED")},seenBefore:function(){this._sendFeedback("SEEN_IT_BEFORE")},offensive:function(){this._sendFeedback("OFFENSIVE")},dislikePromo:function(){this._sendFeedback("OTHER_REASON")}}),P.modules.PromotedPinFeedback.prototype.className="PromotedPinFeedback",goog.provide("P.modules.Pulser"),goog.require("P.Module");var je=[{transition:{scale:.5,opacity:1}},{transition:{scale:.6,opacity:1},time:200,timingFunction:"cubic-bezier(0, 0.55, 0.55, 1.0)"},{transition:{scale:.4},time:200,timingFunction:"cubic-bezier(0, 0.55, 0.55, 1.0)"},{transition:{scale:.8,opacity:0},time:1400,timingFunction:"cubic-bezier(0, 0.5, 0, 1)"}];P.modules.Pulser=P.Module.extend({events:{click:"_onClick"},CssClassName:{FIXED:"fixed"},onContentReady:function(){this._positionPulser(),this.$(".pulserImage").css(je[0].transition),this.options.fixed&&this.$el.addClass(this.CssClassName.FIXED),this.$el.css("visibility","visible"),this._playAnimation(),window.setInterval(this._playAnimation.bind(this),2e3),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this._positionPulser),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this._positionPulser)},_positionPulser:function(){var e=this.options.anchor;e&&P.Positioning.positionElementAtAnchor(this.$el,$(e),P.CONST.PositionPoint.CENTER_CENTER,!!this.options.fixed,!1,!!this.options.append_to)},_onClick:function(){this.triggerEvent(P.CONST.EVENT_PULSER_CLICKED,null,!0)},_playAnimation:function(){var e=this.$(".pulserImage");e.css(je[0].transition),je.slice(1).forEach(function(t){e=e.transition(t.transition,t.time,t.timingFunction).delay()})}}),P.modules.Pulser.prototype.className="Pulser",goog.provide("P.modules.PushNotificationSettings"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.PushNotificationSettings=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var e=new P.Form(this.$form,{});this.listen(e,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(){var e={},t={};this.$(".pushNotifSettings input[type=checkbox]").each(function(){var e=$(this),o=e.attr("name");t[o.substr(5)]=e.is(":checked")?"anyone":"none"}),e.push_settings=JSON.stringify(t);var o=P.resourceFactory.instance.create("NotificationSettingsResource",e);this.showLoading(!0),o.callUpdate().then(function(){this.isInModal()&&this.destroy()}.bind(this)).fin(function(){this.hideLoading()}.bind(this))}}),P.modules.PushNotificationSettings.prototype.className="PushNotificationSettings",goog.provide("P.modules.RadioButton"),goog.require("P.Module"),P.modules.RadioButton=P.Module.extend({CssClassName:{FANCY_SELECTED:"fancySelected"},onContentReady:function(){this.$input=this.$("input"),this.input=this.$input[0],this.listen(this.$input,"change",this._onChange),this.listen(this.$input,"click",this._onClick)},_onClick:function(e){this._logContextEvent(e),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,e,!0)},_onChange:function(e){this.triggerEvent(P.CONST.EVENT_CHANGE,e,!0),this.refreshLayout()},refreshLayout:function(){this.options.fancy&&this.$el.toggleClass(this.CssClassName.FANCY_SELECTED,this.input.checked)}}),P.modules.RadioButton.prototype.className="RadioButton",goog.provide("P.modules.RadioGroup"),goog.require("P.Module"),P.modules.RadioGroup=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onChildChanged),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildClicked)},onChildClicked:function(e){e.stopPropagation(),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,e,!0)},onChildChanged:function(e){e.stopPropagation();var t=this.getChildrenByModuleName("RadioButton");_.each(t,function(e){e.refreshLayout()}),this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0)},getCurrentLabel:function(){var e=this.getCheckedRadioButton();return e?e.parents("label").find(".labelContent").text():null},getCheckedRadioButton:function(){return this.$("input:checked")},val:function(){var e=this.getCheckedRadioButton();return e?e.attr("value"):void 0}}),P.modules.RadioGroup.prototype.className="RadioGroup",goog.provide("P.modules.RecFeedPage"),goog.require("P.Module"),P.modules.RecFeedPage=P.Module.extend({}),P.modules.RecFeedPage.prototype.className="RecFeedPage",goog.provide("P.modules.RecipeFeedPage"),goog.require("P.Module"),P.modules.RecipeFeedPage=P.Module.extend({}),P.modules.RecipeFeedPage.prototype.className="RecipeFeedPage",goog.provide("P.modules.RelatedBoards"),goog.require("P.Module"),P.modules.RelatedBoards=P.Module.extend({events:{"click .relatedBoard":"_onBoardClicked"},_onBoardClicked:function(e){this._clickedBoardId=$(e.currentTarget).data("boardId")},getLoggingObjectIdStr:function(){return this._clickedBoardId}}),P.modules.RelatedBoards.prototype.className="RelatedBoards",goog.provide("P.modules.RelatedEditorials"),goog.require("P.Module"),P.modules.RelatedEditorials=P.Module.extend({onContentReady:function(){this.destroyIfEmpty()}}),P.modules.RelatedEditorials.prototype.className="RelatedEditorials",goog.provide("P.modules.RelatedInterestsSection"),goog.require("P.Module"),P.modules.RelatedInterestsSection=P.Module.extend({}),P.modules.RelatedInterestsSection.prototype.className="RelatedInterestsSection",goog.provide("P.modules.RelatedItemsCarousel"),goog.require("P.Module"),P.modules.RelatedItemsCarousel=P.Module.extend({}),P.modules.RelatedItemsCarousel.prototype.className="RelatedItemsCarousel",goog.provide("P.modules.RelatedItemsSlideshow"),goog.require("P.Module"),P.modules.RelatedItemsSlideshow=P.Module.extend({CssClassName:{STATIC:"static"},stopAnimation:function(){this.$(".pinInfo").fadeOut(),this.$el.addClass(this.CssClassName.STATIC)},onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_SIGNUP_CONTINUE_CLICKED]=this.stopAnimation,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)}}),P.modules.RelatedItemsSlideshow.prototype.className="RelatedItemsSlideshow",goog.provide("P.modules.RelatedPinInfo"),goog.require("P.modules.PinInfo"),goog.require("P.timer"),P.modules.RelatedPinInfo=P.modules.PinInfo.extend({events:_.extend(P.modules.PinInfo.prototype.events,{"click .stopShowing":"stopShowing"}),stopShowing:function(e){var t=this.options.pin_id,o=$(e.target).closest(".stopShowing");this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.timer.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),"board"===o.attr("data-object-type")?P.pubSub.instance.publish(t,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_BOARD,P.CONST.FeedbackType.DOWNVOTE_BOARD):"pin"===o.attr("data-object-type")?P.pubSub.instance.publish(t,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_PIN,P.CONST.FeedbackType.DOWNVOTE_PIN):"interest"===o.attr("data-object-type")&&P.pubSub.instance.publish(t,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_INTEREST,P.CONST.FeedbackType.DOWNVOTE_INTEREST)}.bind(this),this.HIDE_DELAY)}}),P.modules.RelatedPinInfo.prototype.className="RelatedPinInfo",
goog.provide("P.modules.RelatedRecipe"),goog.require("P.Module"),P.modules.RelatedRecipe=P.Module.extend({}),P.modules.RelatedRecipe.prototype.className="RelatedRecipe",goog.provide("P.modules.RemovePinDialog"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.RemovePinDialog=P.Module.extend({events:{"click .openPinFeedback":"openPinFeedback"},CssClassName:{SUBMITTED:"submitted"},openPinFeedback:function(){var e={pin_id:this.options.pin_id,feedback_type:this.options.feedback_type},t=this.options.recommendation_reason,o=this.options.through_id;t&&o&&(e.through_id=o,e.recommendation_reason=t),e.promoter=this.options.promoter;var n={name:"PinFeedbackDialog",options:e};return P.moduleFactory.load(n).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_PIN_FEEDBACK_SUBMITTED,this.onFeedbackSubmitted)}.bind(this))},onFeedbackSubmitted:function(){this.getContent().addClass(this.CssClassName.SUBMITTED)}}),P.modules.RemovePinDialog.prototype.className="RemovePinDialog",goog.provide("P.modules.RemoveUserFromBoardDialog"),goog.require("P.modules.ConfirmDialog"),goog.require("P.i18n"),P.modules.RemoveUserFromBoardDialog=P.modules.ConfirmDialog.extend({events:{"click [name=ban]":"onBanClick"},onContentReady:function(){this.returnData=["ban"],P.modules.ConfirmDialog.prototype.onContentReady.call(this)},onBanClick:function(e){var t=$(e.target),o=t.is(":checked")?P.i18n._("Block Pinner"):P.i18n._("Remove Pinner");this.setPrimaryButtonText(o)}}),P.modules.RemoveUserFromBoardDialog.prototype.className="RemoveUserFromBoardDialog",goog.provide("P.modules.RepinsLikesFeedPage"),goog.require("P.Module"),P.modules.RepinsLikesFeedPage=P.Module.extend({}),P.modules.RepinsLikesFeedPage.prototype.className="RepinsLikesFeedPage",goog.provide("P.modules.ReportBug"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.url"),goog.require("P.validator"),goog.require("P.errorUtil"),goog.require("P.resourceFactory");var Ue='[name="metadata"]';P.modules.ReportBug=P.Module.extend({getMetadata:function(){return this.$(Ue).val()},onContentReady:function(){var e=this.getChildById("uploader");this.listen(e,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(e,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError),this.imageUrl=null;var t={title:[P.validator.Required()],description:[P.validator.Required()]};this.setMetadata(),this.form=new P.Form(this.$("form"),t),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(){this.reportBug()},setMetadata:function(){var e=window.navigator.userAgent,t=P.url.getCurrentUrl(),o=P.experiments.instance.getDebugInfo();this.$(Ue).val("\n\n\n\n----------------------------------\nuserAgent: "+e+"\ncurrentURL: "+t+"\nexperiments: "+o+"\nusername: "+P.user.instance.get("username")+"\n\n")},reportBug:function(){var e=this.$("form").serializeArray(),t=this.getChildById("submitButton"),o={};_.each(e,function(e){o[e.name]=e.value}),o.description=o.description+this.getMetadata(),this.imageUrl&&(o.image_url=this.imageUrl),t.showLoading();var n=P.resourceFactory.instance.create("ReportErrorResource",o);n.callCreate().then(function(e){var t=e.resource_response.data,o={name:"ConfirmDialog",options:{template:"report_bug",task_url:"https://jira.pinadmin.com/browse/"+t.key+"?filter=15009",class_name:"reportBug"}};P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.destroy)}.bind(this))}.bind(this)).fin(function(){t.hideLoading()})},onUploadSuccess:function(e){this.imageUrl=e.data.image_url},onUploadError:function(e){P.errorUtil.showError(P.i18n.commonStrings.defaultErrorMessage)}}),P.modules.ReportBug.prototype.className="ReportBug",goog.provide("P.modules.ReportedContent"),goog.require("P.Module"),goog.require("P.i18n"),P.modules.ReportedContent=P.Module.extend({onContentReady:function(){this.$(".toggler").click(function(){$(this).next().children(":first").toggle("blind",function(){var e=$(this).parent().prev();e.text()===P.i18n._("Less")?e.text(P.i18n._("More info ...")):e.text(P.i18n._("Less"))})}),this.$(".reportedContentUrl").focusout(function(){var e=this.$(".reportedContentUrl").val(),t=/pinterest.com\/web-result\//.test(e);if(t!==this.options.strikeDisabled){var o=this.$("input[name=strike]").is(":checked"),n=this.$("input[name=remove_all]").is(":checked");this.updateOptionsAndDom({initial_value:e,strikeDisabled:t,strikeChecked:o,removeAllChecked:n})}}.bind(this))},updateDom:function(){this.renderExistingData()}}),P.modules.ReportedContent.prototype.className="ReportedContent",goog.provide("P.modules.ResetPasswordPage"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.validator"),goog.require("P.resourceFactory");var ze="resetPasswordSubmit";P.modules.ResetPasswordPage=P.Module.extend({onContentReady:function(){if(this.data.is_link_valid){var e={new_password:[P.validator.Required(),P.validator.ContainsOnlyAscii({message:P.i18n.commonStrings.asciiPasswordError}),P.validator.Password()],new_password_confirm:[P.validator.Required(),P.validator.EqualTo({targetFieldName:"new_password",message:P.i18n._("Passwords don't match")})]};this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),e),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)}},onSubmitValidated:function(e){var t=this.getChildById(ze);e.errors[0]||(t.showLoading(!0),this.resetPassword())},resetPassword:function(){this.hideLoading(!0);var e={new_password:this.form.getValue("new_password"),new_password_confirm:this.form.getValue("new_password_confirm")},t=$.extend(_.clone(this.options),e),o=P.resourceFactory.instance.create("ResetPasswordFromEmailResource",t);o.callUpdate().then(function(e){var t=e.resource_response.data;if(t.password_changed){var o={name:"ConfirmDialog",options:{template:"change_password_success"}},n=function(){P.util.changeWindowLocation("/login/",!1)};P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,n)}.bind(this))}}.bind(this)).fin(function(){var e=this.getChildById(ze);e.hideLoading()}.bind(this))}}),P.modules.ResetPasswordPage.prototype.className="ResetPasswordPage",goog.provide("P.modules.RichPinHeading"),goog.require("P.Module"),P.modules.RichPinHeading=P.Module.extend({}),P.modules.RichPinHeading.prototype.className="RichPinHeading",goog.provide("P.modules.RightHeader"),goog.require("P.Module"),P.modules.RightHeader=P.Module.extend({}),P.modules.RightHeader.prototype.className="RightHeader",goog.provide("P.modules.SXSEvaluation"),goog.require("P.synchronizeScroll"),goog.require("P.Module"),goog.require("P.util"),goog.require("P.resourceFactory"),P.modules.SXSEvaluation=P.Module.extend({events:{"change #subjects":"subjectChange"},onContentReady:function(){this._listener||(this._listener=this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this._pickTreatment=this.getChildById("pickTreatment"),this._pickControl=this.getChildById("pickControl"),this._pickNone=this.getChildById("pickNone"),this._lockSxSButton=this.getChildById("lockSxS"),this.setIframes(),this._isLockedSxS=!0,this.sizeIframe(),$(window).resize(function(){this.sizeIframe()}.bind(this))},onButtonClick:function(e){var t=e.target;t===this._pickTreatment?this.setScore(1):t===this._pickControl?this.setScore(-1):t===this._pickNone?this.setScore(0):t===this._lockSxSButton&&this.toggleLockSxS()},setIframes:function(){var e=this.$("#sxs_control"),t=this.$("#sxs_treatment");e.prop("src",this.$("#control_url").val()),t.prop("src",this.$("#treatment_url").val()),e.on("load",function(){this.setSxSLock(!0)}.bind(this)),t.on("load",function(){this.setSxSLock(!0)}.bind(this))},setScore:function(e){var t={};t.score=e,t.token=this.$("#token").val(),t.selected_subject_id=this.$("#selected_subject_id").val();var o=P.resourceFactory.instance.create("SXSEvaluationResource",t);o.callUpdate().then(function(e){this.render()}.bind(this))},subjectChange:function(e){var t=this.$("#subjects").val(),o=this.$("#token").val(),n=window.location.href.split("?")[0];n+="?token="+o+"&subject_id="+t,P.util.changeWindowLocation(n)},setSxSLock:function(e){this._isLockedSxS=e;var t=this.$("#sxs_control, #sxs_treatment").contents();e?(P.synchronizeScroll.start(t),this._lockSxSButton.setText("Unlock SxS")):(P.synchronizeScroll.stop(t),this._lockSxSButton.setText("Lock SxS"))},toggleLockSxS:function(){this.setSxSLock(!this._isLockedSxS)},sizeIframe:function(){var e=.85*$(window).height();this.$(".iframeContainer").css("height",e)}}),P.modules.SXSEvaluation.prototype.className="SXSEvaluation",goog.provide("P.modules.SXSPinIds"),goog.require("P.synchronizeScroll"),goog.require("P.Module"),P.modules.SXSPinIds=P.Module.extend({events:{"change #subjects":"subjectChange"},onContentReady:function(){this._listener||(this._listener=this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this._lockSxSButton=this.getChildById("lockSxS"),this.setIframes(),this._isLockedSxS=!0},onButtonClick:function(e){var t=e.target;t===this._lockSxSButton&&this.toggleLockSxS()},setIframes:function(){var e=this.$("#sxs_control"),t=this.$("#sxs_treatment");e.prop("src",this.$("#control_url").val()),t.prop("src",this.$("#treatment_url").val()),e.on("load",function(){this.setSxSLock(!0)}.bind(this)),t.on("load",function(){this.setSxSLock(!0)}.bind(this))},setSxSLock:function(e){this._isLockedSxS=e;var t=this.$("#sxs_control, #sxs_treatment").contents();e?(P.synchronizeScroll.start(t),this._lockSxSButton.setText("Unlock SxS")):(P.synchronizeScroll.stop(t),this._lockSxSButton.setText("Lock SxS"))},toggleLockSxS:function(){this.setSxSLock(!this._isLockedSxS)}}),P.modules.SXSPinIds.prototype.className="SXSPinIds",goog.provide("P.modules.SeamlessOverlay"),goog.require("P.Module"),P.modules.SeamlessOverlay=P.Module.extend({showOverlay:function(){this.$el.fadeIn()},hideOverlay:function(){this.$el.fadeOut()}}),P.modules.SeamlessOverlay.prototype.className="SeamlessOverlay",goog.provide("P.modules.SearchGuidesBar"),goog.require("P.Module");var He=125,Ge=3,Ke=2;P.modules.SearchGuidesBar=P.Module.extend({events:{"click .guidesContainer li":"onGuideClick","click .navigator.left em":"onLeftNavigatorClick","click .navigator.right em":"onRightNavigatorClick"},getOwnedScrollables:function(){return this.$(".guidesSlider")},onCreated:function(){this.$guidesSlider=this.$(".guidesSlider"),this.$guidesContainer=this.$(".guidesContainer"),this.currentGuideIndex=0,this.totalGuides=this.options.num_guides,this.state={};var e=this.totalGuides*He;this.$guidesContainer.css("width",e+"px"),this.$leftNav=this.$(".navigator.left"),this.$rightNav=this.$(".navigator.right"),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.onBodyColumnChange),this.scrollLeft=0,this.onSliderScroll=this.onSliderScroll.bind(this),this.$guidesSlider.on("scroll",this.onSliderScroll)},onBodyColumnChange:function(){this.updateNavigators()},onContentReady:function(){this.isReady()&&this.updateNavigators()},onAddedToDom:function(){this.isReady()&&(this.updateNavigators(),this.state.guideSelected=!1)},isReady:function(){return this.inDom&&this.contentReady},onSliderScroll:function(e){this.scrollLeft=e.target.scrollLeft,this.currentGuideIndex=Math.floor(this.scrollLeft/He),this.updateNavigators()},onGuideClick:function(e){var t=$(e.currentTarget),o=t.children().first(),n=o.attr("data-term"),a=o.attr("data-term-position"),r=o.attr("data-dominant-color"),i=o.attr("data-guide-index");this.state.guideSelected||(this.state.guideSelected=!0,P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED,{term:n,position:a,color:r,index:i}))},onLeftNavigatorClick:function(e){this.$guidesSlider.animate({scrollLeft:this.scrollLeft-Ge*He},300)},onRightNavigatorClick:function(e){this.$guidesSlider.animate({scrollLeft:this.scrollLeft+Ge*He},300)},updateNavigators:function(){0===this.scrollLeft?this.hideLeftNavigator():this.showLeftNavigator();var e=P.Viewport.numColumns*Ke;this.totalGuides-this.currentGuideIndex>e?this.showRightNavigator():this.hideRightNavigator()},hideLeftNavigator:function(){this.$leftNav.hide()},showLeftNavigator:function(){this.$leftNav.show()},hideRightNavigator:function(){this.$rightNav.hide()},showRightNavigator:function(){this.$rightNav.show()}}),P.modules.SearchGuidesBar.prototype.className="SearchGuidesBar",goog.provide("P.modules.SearchPage"),goog.require("P.Module"),goog.require("P.url"),goog.require("P.router"),P.modules.SearchPage=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},_updateSearchOptions:function(){this.searchOptions=_.pick(this.options,"query","scope","boost")},onChildNavigate:function(e){var t=e.data.url;if(!P.url.isOffsiteUrl(t)){var o=P.router.instance.resolve(t);if(o&&"SearchPage"===o.module){var n=P.router.instance.resolve(t).options;return this.setOptions(n),this.publishSearchChange(),void(e.data.handled=!0)}}},onContentReady:function(){this.publishSearchChange(),this.contentReady=!0},onAdded:function(){this.contentReady&&this.publishSearchChange()},publishSearchChange:function(){this._updateSearchOptions();var e=this.searchOptions||{},t,o=P.url.getQueryStringParams();this.data.typo&&this.data.typo.corrected&&(t=this.data.typo.correction),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,t||o.auto_correction_disabled?P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED_FORCE_UPDATE:P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,t||e.query||""),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED,e.scope||""),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED,e.boost||"")}}),P.modules.SearchPage.prototype.className="SearchPage",goog.provide("P.modules.SearchPageContent"),goog.require("P.Module"),P.modules.SearchPageContent=P.Module.extend({events:{}}),P.modules.SearchPageContent.prototype.className="SearchPageContent",goog.provide("P.modules.SearchPinInfo"),goog.require("P.modules.PinInfo"),goog.require("P.resourceFactory"),P.modules.SearchPinInfo=P.modules.PinInfo.extend({events:_.extend(P.modules.PinInfo.prototype.events,{"click .reportUnrelatedPin":"reportUnrelatedPin"}),reportUnrelatedPin:function(){var e={pin_id:this.options.pin_id,query:this.options.query,pin_type:this.options.pin_type};P.resourceFactory.instance.create("SearchPinFeedbackResource",e).callUpdate(),this.hidePin(P.CONST.FeedbackType.HIDE)}}),P.modules.SearchPinInfo.prototype.className="SearchPinInfo",goog.provide("P.modules.SearchScopeBar"),goog.require("P.Module"),P.modules.SearchScopeBar=P.Module.extend({}),P.modules.SearchScopeBar.prototype.className="SearchScopeBar",goog.provide("P.modules.SearchScopeSelector"),goog.require("P.Module"),P.modules.SearchScopeSelector=P.Module.extend({events:{'change input[name="scope"]':"onScopeChange"},queryStringWithoutFacets:function(){var e=window.location.search;return e=e.replace(/&fc=[^&]*/,""),e=e.replace(/\?fc=[^&]*&?/,"?")},navigateToScope:function(e){var t=this.queryStringWithoutFacets();P.user.instance.isAuthenticated()||"my_pins"!==e||this.navigate("/join/"),this.navigate("/search/"+e+"/"+t)},navigateToFacet:function(e,t){var o=this.queryStringWithoutFacets();t&&(o+=(""===o?"?":"&")+"fc="+t),this.navigate("/search/"+e+"/"+o)},onScopeChange:function(e){var t=$(e.currentTarget),o=t.val();if(o!==this.options.scope){var n=t.attr("data-url")||o;this.navigateToScope(n)}}}),P.modules.SearchScopeSelector.prototype.className="SearchScopeSelector",goog.provide("P.modules.SegmentedController"),goog.require("P.Module"),goog.require("P.trackingTimer"),goog.require("P.moduleFactory");var Ye=300;P.modules.SegmentedController=P.Module.extend({CssClassName:{ACTIVE_SEGMENT:"activeSegment"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onContentReady:function(){this.activeSegment={index:null,module:null},P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEGMENTED_CONTROLLER_SHOW,this)},resetActiveButton:function(){var e=this.getButtons();_.each(e,function(e){e.getContent().removeClass(this.CssClassName.ACTIVE_SEGMENT),e.enable()}.bind(this))},onButtonClick:function(e){var t=e.target;if(t.isSegmentedControlButton()){var o=this.getButtons();this.onButtonSelected(_.indexOf(o,t))}},onButtonSelected:_.throttle(function(e){this.makeActiveModuleFromIndex(e)},Ye),getActiveModule:function(){return this.activeSegment.module},makeActiveModuleFromIndex:function(e){var t=this.getModules()[e];this.makeActiveModule(t),this.makeActiveButtonFromIndex(e)},makeActiveButtonFromIndex:function(e){var t=this.getButtons()[e];this.resetActiveButton(),t.getContent().addClass(this.CssClassName.ACTIVE_SEGMENT),this.activeSegment.index=e},makeActiveModule:function(e){var t=this.parent.className;P.trackingTimer.instance.start(t,"ClickToRender",e.name),this.activeSegment.module&&this.activeSegment.module.remove(),this.showLoading(),P.moduleFactory.load(e).then(function(o){o.render().then(function(){var n=_.indexOf(this.getModules(),e);if(n===this.activeSegment.index){var a=this.$(".content");this.hideLoading(),this.activeSegment.module&&this.activeSegment.module.remove(),P.trackingTimer.instance.end(t,"ClickToRender",Pc.reportInteractionTimings),this.activeSegment.module=o,this.insertChild(o,a)}}.bind(this))}.bind(this))},getModules:function(){return this.options.modules},getButtons:function(){return this.getChildrenByModuleName("Button")},getSelectedTab:function(){return this.activeSegment.index}}),P.modules.SegmentedController.prototype.className="SegmentedController",goog.provide("P.modules.Select"),goog.require("P.Module"),P.modules.Select=P.Module.extend({}),P.modules.Select.prototype.className="Select",goog.provide("P.modules.SelectButton"),goog.require("P.Module"),goog.require("P.modules.RadioGroup"),P.modules.SelectButton=P.Module.extend({onContentReady:function(){this.$button=this.$("button"),this.buttonModule=this.getChildById("button"),this.selectedValue=this.options.value,this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChange),this.childListen(P.CONST.EVENT_CHANGE,this.onChange)},onChange:function(e){var t=e.target,o=t.getCurrentLabel()||this.options.text;this.selectedValue=t.val()||this.options.value,this.buttonModule.setText(o),this.buttonModule.getDropdown().hide()},disable:function(){this.$button.prop("disabled",!0)},enable:function(){this.$button.removeProp("disabled")}}),P.modules.SelectButton.prototype.className="SelectButton",goog.provide("P.modules.SelectList"),goog.require("P.Module"),goog.require("P.dom"),goog.require("P.moduleFactory"),goog.require("P.util"),P.modules.SelectList=P.Module.extend({events:{"click .item":"_onClickItem","mouseenter .item":"_onHoverItemStart","mouseleave .item":"_onHoverItemEnd",keydown:"_onKeydown"},CssClassName:{IS_HIDDEN:"hidden",IS_SELECTED:"selected",ITEM:"item"},onCreated:function(){this._itemVisibilityFn=null},onContentReady:function(){var e=this.getSelectedItemElement();e.length>0&&this._selectItem(e)},appendItem:function(e,t,o){return void 0===o&&(o=-1),this._appendItem(e,!!t,o)},removeItem:function(e){var t=this._getItemModule(e);e.remove(),t&&t.remove()},emptySection:function(e){var t=e.find(".sectionItems");t&&t.length&&t.empty()},emptySectionAtIndex:function(e){var t=this.$(".sectionItems");e=Math.min(e,t.length-1),t.eq(e).empty()},hasVisibleItems:function(){return this.$(".item:not(.hidden)").length>0},highlightUp:function(){this._highlightDirection(!0)},highlightDown:function(){this._highlightDirection(!1)},getSelectedItemData:function(){var e=this.getSelectedItemElement();return e.length>0?this._getItemData(e):null},scrollSelectedItemElementIntoView:function(){var e=this.getSelectedItemElement();if(0!==e.length){var t=this.$el;P.dom.scrollIntoView(e,t)}},setItemVisibilityCallback:function(e){this._itemVisibilityFn=e,this.updateItemVisibility()},_appendItem:function(e,t,o){var n=this.options.item_module||{name:"Label"},a=null;return a="module"===e.type?e:{name:n.name,options:n.options,data:e},P.moduleFactory.load(a).then(function(e){return e.renderExistingData().then(function(){var n=$('<li class="item"></li>');this.$(".sectionItems").eq(o).append(n),this.insertChild(e,n),t&&this._selectItem(n),this.updateItemVisibility(this.options.select_first_item_after_update)}.bind(this))}.bind(this))},getSelectedItemElement:function(){var e=this.$(".item.selected:not(.hidden)");return e},_getItemData:function(e){var t=this._getItemModule(e);return t?t.data:null},_getItemModule:function(e){var t=e.children()[0];return this.getChildByElement(t)},_highlightDirection:function(e){var t=this.getSelectedItemElement();if(0===t.length)e?this.selectLastVisibleItem():this.selectFirstVisibleItem();else{var o=t;do{if(o=e?o.prev():o.next(),o.is(".item:not(.hidden)")){this._selectItem(o);break}if(0===o.length){var n;e?(n=t.parents(".section").prev(),n.length||(n=this.$(".section").last())):(n=t.parents(".section").next(),n.length||(n=this.$(".section").first()));var a=n.find(".item:not(.hidden)"),r=e?a.last():a.first();this._selectItem(r)}}while(o.length>0)}},_onClickItem:function(e){e.stopPropagation();var t=$(e.currentTarget);this._selectItem(t);var o=this._getItemData(t);o&&this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,o,!0)},_onHoverItemStart:function(e){if(!this.options.suppress_hover_events){var t=$(e.currentTarget);this._selectItem(t)}},_onHoverItemEnd:function(e){this.options.suppress_hover_events||this._selectItem(null)},_onKeydown:function(e){if(this.hasVisibleItems())switch(e.keyCode){case P.util.keyCode.UP:e.preventDefault(),e.stopPropagation(),this.highlightUp();break;case P.util.keyCode.DOWN:e.preventDefault(),e.stopPropagation(),this.highlightDown()}},selectFirstVisibleItem:function(){this._selectItemAtEnd(!0)},_selectItemAtEnd:function(e){var t=this.$(".item:not(.hidden)"),o=e?t.first():t.last();o.length>0&&this._selectItem(o)},selectLastVisibleItem:function(){this._selectItemAtEnd(!1)},_selectItem:function(e){var t=this.$(".item.selected");e&&(t=t.add(e)),t.each(function(t,o){var n=e?o===e[0]:!1,a=$(o);a.toggleClass(this.CssClassName.IS_SELECTED,n);var r=this._getItemModule(a);r&&r.setSelectedState&&r.setSelectedState(n)}.bind(this)),this.options.scroll_selected_item_into_view&&this.scrollSelectedItemElementIntoView()},updateItemVisibility:function(e){if(this._itemVisibilityFn){void 0===e&&(e=!0);var t=[],o=[];this.children.forEach(function(e){var n=e.$el.parent();n.hasClass(this.CssClassName.ITEM)&&(t.push(e),o.push(n))}.bind(this));for(var n=this._itemVisibilityFn(t),a=0;a<n.length;a++){var r=n[a],i=o[a];i.toggleClass(this.CssClassName.IS_HIDDEN,!r)}this.$(".section").each(function(e,t){var o=$(t),n=o.find(".item:not(.hidden)").length>0;o.find(".sectionHeading").toggleClass(this.CssClassName.IS_HIDDEN,!n)}.bind(this)),e&&this.selectFirstVisibleItem()}}}),P.modules.SelectList.prototype.className="SelectList",goog.provide("P.modules.SendInvitationEmail"),goog.require("P.Module"),P.modules.SendInvitationEmail=P.Module.extend({events:{"click .sendInvitationEmail":"onMouseClick"},onMouseClick:function(){if(this.options.is_valid_email){var e=this.options.text_value;P.Invite.userInviteEmail(e,function(){this.triggerEvent(P.CONST.EVENT_INVITE_USER,{recipients:[e]},!0)}.bind(this))}}}),P.modules.SendInvitationEmail.prototype.className="SendInvitationEmail",goog.provide("P.modules.SendObjectBase"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.modules.ConversationsList"),goog.require("P.genConst"),goog.require("P.preventScrollMixin"),P.modules.SendObjectBase=P.Module.extend({_OBJECT_ID_NAME:"",_SEND_RESOURCE_NAME:"ConversationsResource",mixins:[P.preventScrollMixin],CssClassName:{VISIBLE:"visible"},onContentReady:function(){this.childListen(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,this.onListItemClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoResultsReturned),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onContentChanged),this.listen(this.parent,P.CONST.EVENT_DROPDOWN_SHOW,this.onShow),this.startPreventingScroll(),this._setup()},onSearchStart:function(e){this.$(".spinner").addClass(this.CssClassName.VISIBLE),this.hideConversationsList()},onShow:function(e){this._focusTypeahead()},_getTypeaheadField:function(){return this.getChildById("typeaheadField")},_focusTypeahead:function(){var e=this._getTypeaheadField();window.setTimeout(function(){e.focus()},100)},onContentChanged:function(){this.startPreventingScroll()},onNoResultsReturned:function(e){this.$(".spinner").removeClass(this.CssClassName.VISIBLE);var t=this._getTypeaheadField();t.getValue().trim().length||this.showConversationsList()},onResultsReturned:function(e){this.$(".spinner").removeClass(this.CssClassName.VISIBLE)},hideConversationsList:function(){var e=this._getConversationsList();e.fadeOut()},showConversationsList:function(){var e=this._getConversationsList();e.fadeIn()},_getConversationsList:function(){return this.getChildById("conversationsList")},_setup:function(){this._setMaxHeight()},_setMaxHeight:function(){this.$el.css("maxHeight",this.$el.height())},startPreventingScroll:function(){this.startPreventScroll(this.$(".ConversationsList").last(),this.$(".List").last())},onItemSelected:function(e){var t=e.data.item,o=t.attributes,n=o.username?[o.id]:[],a=o.email?[o.email]:[];this._sendToUsers(n,a),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},reset:function(){this.render()},onListItemClick:function(e){var t=e.target;this._sendToUsers(t.getUserIds(),t.getEmails()),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},_getMessageEl:function(){return this.$(".message")},getMessageValue:function(){return this._getMessageEl().val().trim()},clearMessageValue:function(){this._getMessageEl().val("")},_sendToUsers:function(e,t){if(t||(t=[]),e.length+t.length!==0){var o={text:this.getMessageValue(),object_type:this._OBJECT_ID_NAME,object_id:this.options.object_id};P.conversationsManager.instance.sendMessageToUsers(e,t,o).then(function(e){this.clearMessageValue(),this.resetTypeaheadField();var t=e.resource_response.data;P.conversationsManager.instance.logContextEvent(P.genConst.EventType.CONVERSATION_MESSAGE_SEND,t.id,this.options.object_id,this.$el)}.bind(this))}},resetTypeaheadField:function(){var e=this._getTypeaheadField();e.reset(),e.clear()}}),P.modules.SendObjectBase.prototype.className="SendObjectBase",goog.provide("P.modules.SendPin"),goog.require("P.modules.SendObjectBase"),P.modules.SendPin=P.modules.SendObjectBase.extend({_OBJECT_ID_NAME:"pin"}),P.modules.SendPin.prototype.className="SendPin",goog.provide("P.modules.SendPinner"),goog.require("P.modules.SendObjectBase"),P.modules.SendPinner=P.modules.SendObjectBase.extend({_OBJECT_ID_NAME:"user"}),P.modules.SendPinner.prototype.className="SendPinner",goog.provide("P.modules.SentPin"),goog.require("P.Module"),goog.require("P.util"),P.modules.SentPin=P.Module.extend({onContentReady:function(){P.util.trackRegisterAction("sent_pin_landing")}}),P.modules.SentPin.prototype.className="SentPin",goog.provide("P.modules.SentPinMessage"),goog.require("P.Module"),P.modules.SentPinMessage=P.Module.extend({}),P.modules.SentPinMessage.prototype.className="SentPinMessage",goog.provide("P.modules.SentPinRelatedContent"),goog.require("P.Module"),P.modules.SentPinRelatedContent=P.Module.extend({}),P.modules.SentPinRelatedContent.prototype.className="SentPinRelatedContent",goog.provide("P.modules.SentPinSender"),goog.require("P.Module"),P.modules.SentPinSender=P.Module.extend({}),P.modules.SentPinSender.prototype.className="SentPinSender",goog.provide("P.modules.SharedInterests"),goog.require("P.Module"),P.modules.SharedInterests=P.Module.extend({}),P.modules.SharedInterests.prototype.className="SharedInterests",goog.provide("P.modules.ShowCSRSaveButton"),goog.require("P.modules.Button"),goog.require("P.pubSub");var qe=P.CONST.PIN_IT_DOMAIN+"/webresult?";P.modules.ShowCSRSaveButton=P.modules.Button.extend({onClick:function(e){if(!P.user.instance.isAuthenticated())return P.signupModalManager.showInlineSignupModalOnButtonClick("WebResult");var t={iframeurl:this.options.link,description:this.options.description,imageurl:this.options.image_url};window.open(qe+$.param(t))}}),P.modules.ShowCSRSaveButton.prototype.className="ShowCSRSaveButton",goog.provide("P.modules.ShowModalButton"),goog.require("P.modules.Button"),goog.require("P.util"),goog.require("P.url"),P.modules.ShowModalButton=P.modules.Button.extend({onClick:function(e){if(P.user.instance.isWriteBanned())P.writeban.showWriteBanned(this);else if(P.user.instance.isLimitedLogin())P.limitedLogin.showLogin(this);else{if(P.modules.Button.prototype.onClick.call(this,e),this.options.require_auth&&!this.ensureAuthentication())return e.preventDefault(),!1;if(this.showModalSubmodule(),"a"===this.options.element_type)return!1}}}),_.extend(P.modules.ShowModalButton.prototype,{showModalSubmodule:function(){P.util.showModalSubmodule(this)},getAuthRedirectUrl:function(){var e={};return this.options.require_auth_params&&_.extend(e,this.options.require_auth_params),P.user.instance.isAuthenticated()?void P.util.changeWindowLocation(P.url.getRegisterUrl({}),!1):P.signupModalManager.showInlineSignupModalOnButtonClick("ShowModalButton")},toString:function(e){return this.className+"(module="+this.options.submodule.name+")"},getLoggingObjectIdStr:function(){return this.parent?this.parent.getLoggingObjectIdStr():null}}),P.modules.ShowModalButton.prototype.className="ShowModalButton",goog.provide("P.modules.SignedEmailDisassociatePage"),goog.require("P.Module"),P.modules.SignedEmailDisassociatePage=P.Module.extend({}),P.modules.SignedEmailDisassociatePage.prototype.className="SignedEmailDisassociatePage",goog.provide("P.modules.SignedEmailSettingsPage"),goog.require("P.Module"),P.modules.SignedEmailSettingsPage=P.Module.extend({}),P.modules.SignedEmailSettingsPage.prototype.className="SignedEmailSettingsPage",goog.provide("P.modules.SignedEmailUnsubscribePage"),goog.require("P.Module"),P.modules.SignedEmailUnsubscribePage=P.Module.extend({}),P.modules.SignedEmailUnsubscribePage.prototype.className="SignedEmailUnsubscribePage",goog.provide("P.modules.SignupButton"),goog.require("P.modules.NavigateButton"),P.modules.SignupButton=P.modules.NavigateButton.extend({getNavigateUrl:function(e){return this.options.home_page?"/":P.signupModalManager.showInlineSignupModalOnButtonClick("SignupButton")}}),P.modules.SignupButton.prototype.className="SignupButton",goog.provide("P.modules.SignupForm"),goog.require("P.Module"),P.modules.SignupForm=P.Module.extend({onContentReady:function(){this.childListen("toggleMultiStep",function(e){this.$el.toggleClass("secondStep")})}}),P.modules.SignupForm.prototype.className="SignupForm",goog.provide("P.modules.SmartFeedPage"),goog.require("P.Module"),P.modules.SmartFeedPage=P.Module.extend({}),P.modules.SmartFeedPage.prototype.className="SmartFeedPage",goog.provide("P.modules.SocialIconsCounts"),goog.require("P.Module"),P.modules.SocialIconsCounts=P.Module.extend({incrementLike:function(){this.data.liked_by_me=!0,this._alterAttribute("like_count",1)},decrementLike:function(){this.data.liked_by_me=!1,this._alterAttribute("like_count",-1)},incrementRepin:function(){this._alterAttribute("repin_count",1)},_alterAttribute:function(e,t){if(this.model){var o=this.data,n=o[e]||0,a=Math.max(n+t,0);o[e]=a,this.model.set(o),this.renderExistingData()}}}),P.modules.SocialIconsCounts.prototype.className="SocialIconsCounts",goog.provide("P.modules.SocialNetworkConnectButton"),goog.require("P.Module"),P.modules.SocialNetworkConnectButton=P.Module.extend({
events:{click:"onClick"},onCreated:function(){this.network=this.options.network,this.shouldShowLoading=this.options.show_loading;var e={};e[P.CONST.PUBSUB_TOPIC_FRIEND_IMPORT_COMPLETED]=this.handleFriendImportCompleted,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},onClick:function(){var e=!0,t={success:function(){this.shouldShowLoading&&this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,{network:this.network},!0)}.bind(this)},o=P.SocialNetworkSettingsManager.instance();o.handleConnect(this.network,e,t)},handleFriendImportCompleted:function(e,t,o){o.error||o.network!==this.network||this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}}),P.modules.SocialNetworkConnectButton.prototype.className="SocialNetworkConnectButton",goog.provide("P.modules.StepBase"),goog.require("P.interfaces.TutorialStep"),goog.require("P.Module"),goog.require("P.ExperienceManager"),P.modules.StepBase=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick);var e={};e[P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT]=function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)},this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e),this.initializeStep(),this.isContextualExperience=!1},initializeStep:function(){},onEnter:function(e){e&&e()},onShow:function(e){e&&e()},onRemoved:function(){},onExit:function(e){e&&e()},onButtonClick:function(e){},_onButtonClick:function(e){var t=e.target;t&&(this.onButtonClick(e),e.shouldPropagate()&&("previousButton"===t.id?(e.stopPropagation(),this.onPreviousButtonClicked()):"nextButton"===t.id?(e.stopPropagation(),this.onNextButtonClicked()):"dismissButton"===t.id&&(e.stopPropagation(),this.onDismissButtonClicked())))},onDismissButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},onPreviousButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0)},onNextButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)},getExperienceId:function(){return null},getPlacementId:function(){return null},getPlacedExperienceId:function(){return this.isContextualExperience?P.ExperienceManager.instance.constructPlacedExperienceId(this.getPlacementId(),this.getExperienceId()):null},completePlacedExperience:function(){var e=P.ExperienceManager.instance;return this.getPlacedExperienceId()?e.completePlacedExperienceId(this.getPlacedExperienceId()):e.completePlacedExperience(this.getPlacementId(),this.getExperienceId())},isDismissAsync:!0,dismissPlacedExperience:function(){var e=P.ExperienceManager.instance;return this.getPlacedExperienceId()?e.dismissPlacedExperienceId(this.getPlacedExperienceId(),this.isDismissAsync):e.dismissPlacedExperience(this.getPlacementId(),this.getExperienceId(),this.isDismissAsync)},onTutorialComplete:function(){},setExperienceViewed:function(){var e=P.ExperienceManager.instance;this.getPlacedExperienceId()?e.viewPlacedExperienceId(this.getPlacedExperienceId()):e.viewPlacedExperience(this.getPlacementId(),this.getExperienceId())}}),P.modules.StepBase.prototype.className="StepBase",goog.provide("P.modules.StoryFeedPage"),goog.require("P.Module"),P.modules.StoryFeedPage=P.Module.extend({}),P.modules.StoryFeedPage.prototype.className="StoryFeedPage",goog.provide("P.modules.StoryboardEditableText"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.StoryboardEditableText=P.Module.extend({events:{input:"onInputChanged"},CssClassName:{EDITABLE:"editable"},onContentReady:function(){this.$el.addClass(this.CssClassName.EDITABLE),this.$el.attr("data-edit-type","editText");var e=this.options.alignment;e&&this.$el.addClass(e);var t=this.options.text;t&&this.$(".editableText").text(t),this.addEditor()},activate:function(){this.$el.click()},getAlignment:function(){return this.options.alignment},getOptions:function(){return _.extend({text:this.$el.text()},this.options)},addEditor:function(){var e={name:"StoryboardEditorMenu",options:{target:this,storyboardFeed:this.options.storyboardFeed,horizontal:!0}};P.moduleFactory.load(e).then(function(e){e.render().then(function(){this.appendChild(e)}.bind(this))}.bind(this))},getExportData:function(){return{type:"text",alignment:this.options.alignment||"left",text:this.$(".editableText").text()}}}),P.modules.StoryboardEditableText.prototype.className="StoryboardEditableText",goog.provide("P.modules.StoryboardEditorMenu"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.StoryboardEditorMenu=P.Module.extend({events:{"click .optionsGroup.textVisibility":"_clickTextVisibility","click .optionsGroup.textAlignment":"_clickTextAlignment","click .addTextBox":"_clickAddTextbox","click .delete":"_clickDelete"},CssClassName:{HORIZONTAL:"horizontal",VISIBLE:"visible"},onContentReady:function(){var e=this.options.target.$el,t=this._getTargetModule().options.pinOptions||{},o=e.attr("data-edit-type");if("storyboardRow"===o){if(this.$(".switchLayoutButton").addClass(this.CssClassName.VISIBLE),this.$(".textVisibility").addClass(this.CssClassName.VISIBLE),this.$(".addTextBox").addClass(this.CssClassName.VISIBLE),this._updateTextVisibility(t.textVisibility),this._updateLayout(this.options.storyboardFeed.getCurrentPinVariationIndex(this._getTargetModule().options.pinOrganization)+1),this.options.rowNumber>=0){var n={};n[P.CONST.PUBSUB_TOPIC_STORYBOARD_LAYOUT_CLICKED]=this.onLayoutClicked,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,n)}}else"editText"===o&&(this.$(".delete").addClass(this.CssClassName.VISIBLE),this.$(".textAlignment").addClass(this.CssClassName.VISIBLE),this._updateAlignment(this._getTargetModule()));this.options.horizontal&&this.$el.addClass(this.CssClassName.HORIZONTAL)},onLayoutClicked:function(e,t,o){o&&o.rowNumber===this.options.rowNumber&&this._setCurrentLayout(o.layoutNumber)},_clickTextVisibility:function(e){var t=this.options.storyboardFeed,o=$(e.target).attr("data-next");t.setTextVisibility(this._getTargetModule(),o),this._updateTextVisibility(o)},_setCurrentLayout:function(e){var t=this.options.storyboardFeed;t.setLayoutNumber(this._getTargetModule(),e)},_clickAddTextbox:function(e){var t=this.options.storyboardFeed,o={name:"StoryboardEditableText",options:{storyboardFeed:this.options.storyboardFeed}};P.moduleFactory.load(o).then(function(e){e.render().then(function(){t.insertChild(e,null,null,this._getTargetModule().$el),e.activate()}.bind(this))}.bind(this))},_clickDelete:function(e){this._getTargetModule().destroy(),this.destroy()},_clickTextAlignment:function(e){var t=$(e.target).attr("data-next-alignment"),o=this._getTargetModule();o.options=o.getOptions(),o.options.alignment=t,o.render().then(function(){o.activate()}),this._updateAlignment(o)},_updateTextVisibility:function(e){e=e||"titleDescription",this.$(".textVisibility .option").removeClass(this.CssClassName.VISIBLE),this.$(".textVisibility ."+e).addClass(this.CssClassName.VISIBLE)},_updateAlignment:function(e){this.$(".textAlignment .option").removeClass(this.CssClassName.VISIBLE);var t=e.getAlignment()||"left";this.$(".textAlignment ."+t).addClass(this.CssClassName.VISIBLE)},_updateLayout:function(e){e=e||1;var t=this.$(".switchLayoutButtonWrapper");t.attr("class","switchLayoutButtonWrapper"),t.addClass("layout-"+e)},_getTargetModule:function(){return this.options.target}}),P.modules.StoryboardEditorMenu.prototype.className="StoryboardEditorMenu",goog.provide("P.modules.StoryboardFeed"),goog.require("P.Module"),goog.require("P.moduleFactory");var $e=[{className:"fullWidth bigText",numPins:1,variant:"withPadding"},{className:"fullWidth twoColumnText bigText",numPins:1,variant:"fullWidthTwoColumnText"},{className:"fullWidth textOnRight bigText",numPins:1,variant:"fullWidthTextOnRight"},{className:"fullBleed oneColumnText bigText",numPins:1,variant:"fullBleed"},{className:"fullBleed twoColumnText bigText",numPins:1,variant:"fullBleedTwoColumnText"},{className:"fullBleed textOnRight bigText",numPins:1,variant:"fullBleedTextOnRight"},{className:"fullBleed fullBleedGradient oneColumnText bigText",numPins:1,variant:"fullBleedWithGradient"},{className:"fullBleed fullBleedGradient twoColumnText bigText",numPins:1,variant:"fullBleedTwoColumnTextWithGradient"},{className:"fullBleed fullBleedGradient textOnRight bigText",numPins:1,variant:"fullBleedTextOnRightWithGradient"},{className:"fullBleed leftTriangle bigText",numPins:1,variant:"fullBleedLeftTriange"},{className:"fullBleed rightTriangle bigText",numPins:1,variant:"fullBleedRightTriangle"},{className:"squareWithText textOnRightHalf bigText",numPins:1,variant:"squareWithTextOnRight"},{className:"squareWithText textOnLeftHalf bigText",numPins:1,variant:"squareWithTextOnLeft"},{className:"fullWidthCircle bigText",numPins:1,variant:"withPaddingCircle"},{className:"fullScreenCircle bigText",numPins:1,variant:"bigCircle"},{className:"circleWithText textOnLeftHalf bigText",numPins:1,variant:"circleWithTextOnLeft"},{className:"circleWithText textOnRightHalf bigText",numPins:1,variant:"circleWithTextOnRight"},{className:"semiCircleLeft textOnRightHalf bigText",numPins:1,variant:"semiCircleLeft"},{className:"semiCircleRight textOnLeftHalf bigText",numPins:1,variant:"semiCircleRight"},{className:"halfWidthPins smallText",numPins:2,variant:"withPadding"},{className:"halfWidthFullBleed smallText",numPins:2,variant:"fullBleed"},{className:"fourPinUnequal smallText",numPins:4,variant:"unequalHeight"},{className:"fourPinUnequalReverse smallText",numPins:4,variant:"unequalHeightReverse"}];P.modules.StoryboardFeed=P.Module.extend({CssClassName:{STORYBOARD_ROW:"StoryboardRow"},state:{editingTarget:null},onContentReady:function(){this.renderStoryGrid()},renderStoryGrid:function(){var e=this.options.feed_data;e&&_.keys(e).length>0?this.renderGridFromData(e):this.renderGrid()},getRandomPinOrganization:function(){var e=$e[Math.floor(Math.random()*$e.length)];return e},getPinOrganizationFromVariant:function(e){for(var t=0;t<$e.length;t++){var o=$e[t];if(o.variant===e)return o}},renderGridFromData:function(e){var t=this.data||[];t=t.filter(function(e){return"pin"===e.type});for(var o=0,n=function(e){if("pin"===e.type){if(o>=t.length)return;var n=this.getPinOrganizationFromVariant(e.variant),a=n.numPins,r={name:"StoryboardRow",options:{pins:t.slice(o,o+a),pinOrganization:n,pinOptions:e.pinOptions,storyboardFeed:this,rowNumber:Math.random()}};P.moduleFactory.load(r).then(this.renderAndAppendModule.bind(this)),o+=a}else if("text"===e.type){var i={name:"StoryboardEditableText",options:_.extend({storyboardFeed:this.options.storyboardFeed},e)};P.moduleFactory.load(i).then(this.renderAndAppendModule.bind(this))}}.bind(this);o<t.length;)e.forEach(n)},renderGrid:function(){var e=this.data||[];e=e.filter(function(e){return"pin"===e.type});var t=0,o,n=!this.state.editingTarget;this.children.forEach(function(a){if(this.state.editingTarget===a&&(n=!0),a.options.pinOrganization){if(o=a.options.pinOrganization.numPins,!n)return void(t+=o);_.extend(a.options,{pins:e.slice(t,t+o),editing:this.state.editingTarget===a}),a.render(),t+=o}}.bind(this)),this.backfillPins(e,t)},backfillPins:function(e,t){for(var o=t;o<e.length;){var n=this.getRandomPinOrganization(),a=n.numPins,r={name:"StoryboardRow",options:{pins:e.slice(o,o+a),pinOrganization:n,pinOptions:{},storyboardFeed:this,rowNumber:Math.random()}};P.moduleFactory.load(r).then(this.renderAndAppendModule.bind(this)),o+=a}},renderAndAppendModule:function(e){e.render().then(function(){this.appendChild(e)}.bind(this))},setLayoutNumber:function(e,t){this.state.editingTarget=e,e.options.pinOrganization=$e[t-1],this.renderGrid()},goToNextIterationWithoutBounds:function(e){this.state.editingTarget=e;var t=e.options.pinOrganization;if(t){var o=this.getCurrentPinVariationIndex(t),n=(o+1)%$e.length;e.options.pinOrganization=$e[n]}else e.options.pinOrganization=$e[0];this.renderGrid()},getCurrentPinVariationIndex:function(e){for(var t=0;t<$e.length;t++)if($e[t].className===e.className)return t;return-1},setTextVisibility:function(e,t){this.state.editingTarget=e,e.options.pinOptions=e.options.pinOptions||{},e.options.pinOptions.textVisibility=t,this.renderGrid()},exportFeedData:function(e){var t=[];return this.$el.children().each(function(o,n){var a=this.getChildByElement(n);a&&(!e||$(n).hasClass(this.CssClassName.STORYBOARD_ROW))&&t.push(a.getExportData())}.bind(this)),t}}),P.modules.StoryboardFeed.prototype.className="StoryboardFeed",goog.provide("P.modules.StoryboardHeader"),goog.require("P.Module"),P.modules.StoryboardHeader=P.Module.extend({}),P.modules.StoryboardHeader.prototype.className="StoryboardHeader",goog.provide("P.modules.StoryboardLayoutList"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.StoryboardLayoutList=P.Module.extend({events:{"click .item":"onLayoutItemClick","click .xIcon":"onDeleteClick","keyup .layoutTextInput":"onKeyupLayoutTextInput"},CssClassName:{BOLD:"bold"},onLayoutItemClick:function(e){var t=$(e.target).text().trim();this.$(".item").removeClass(this.CssClassName.BOLD),$(e.target).addClass(this.CssClassName.BOLD),this.triggerEvent(P.CONST.EVENT_LAYOUT_ITEM_CLICK,t,!0)},onKeyupLayoutTextInput:function(e){13===e.keyCode&&this.triggerEvent(P.CONST.EVENT_LAYOUT_INPUT_KEYUP,$(e.target).val().trim(),!0)},onDeleteClick:function(e){e.stopPropagation();var t={layout_name:$(e.target).closest(".item").text().trim()},o=P.resourceFactory.instance.create("StoryboardLayoutResource",t);o.callDelete().then(function(e){this.render()}.bind(this))}}),P.modules.StoryboardLayoutList.prototype.className="StoryboardLayoutList",goog.provide("P.modules.StoryboardLayoutSelector"),goog.require("P.Module");var Je=23;P.modules.StoryboardLayoutSelector=P.Module.extend({events:{"click .selectorItem":"onClickSelectorItem"},onCreated:function(){for(var e=[],t=0;Je>t;t++)e.push(t+1);this.options.selector_nums=e},onClickSelectorItem:function(e){var t={layoutNumber:$(e.target).attr("data-item-num"),rowNumber:this.options.rowNumber};P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_STORYBOARD_LAYOUT_CLICKED,t)}}),P.modules.StoryboardLayoutSelector.prototype.className="StoryboardLayoutSelector",goog.provide("P.modules.StoryboardList"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.StoryboardList=P.Module.extend({events:{"click .deleteButton":"onClickDelete","keyup .boardInput":"onKeyupBoardInput"},onContentReady:function(){},onClickDelete:function(e){var t={board_id:$(e.target).attr("data-board-id")},o=P.resourceFactory.instance.create("StoryboardResource",t);o.callDelete().fin(function(e){this.render()}.bind(this))},onKeyupBoardInput:function(e){if(13===e.keyCode){for(var t=$(e.target).val(),o=t.split("/"),n=[];o.length>0;){var a=o.pop();if(a.length&&n.push(a),n.length>=2)break}2===n.length&&this.navigate("/internal/storyboard/"+n[1]+"/"+n[0]+"/")}}}),P.modules.StoryboardList.prototype.className="StoryboardList",goog.provide("P.modules.StoryboardPage"),goog.require("P.Module"),goog.require("P.resourceFactory");var Xe=640;P.modules.StoryboardPage=P.Module.extend({events:{"click .createButton":"onClickCreate","click .cancelButton":"onClickCancel"},state:{},onContentReady:function(){this.childListen(P.CONST.EVENT_LAYOUT_ITEM_CLICK,this.fetchLayout),this.childListen(P.CONST.EVENT_LAYOUT_INPUT_KEYUP,this.saveStoryboardLayout)},scrollToSecondFrame:function(e){var t=$(e.target).closest(".editorContainer");t.animate({scrollTop:Xe},500)},onClickCreate:function(){var e=this._getStoryboardFeed().exportFeedData(),t={board_id:this.data.id,data:{header_data:this._getHeaderData(),feed_data:e}},o=P.resourceFactory.instance.create("StoryboardResource",t);o.callUpdate().fin(function(e){alert("Storyboard saved")})},onClickCancel:function(){this.navigate("/internal/storyboards/")},fetchLayout:function(e){var t={layout_name:e.data},o=P.resourceFactory.instance.create("StoryboardLayoutResource",t);o.callGet().then(function(e){var t=e.resource_response.data.feedData;this._getStoryboardFeed().options.feed_data=t,this._getStoryboardFeed().render()}.bind(this))},saveStoryboardLayout:function(e){var t=e.data,o=this._getStoryboardFeed().exportFeedData(!0),n={layout_name:t,layout_data:{layoutName:t,feedData:o}},a=P.resourceFactory.instance.create("StoryboardLayoutResource",n);a.callUpdate().fin(function(e){this.getChildById("layout_list").render()}.bind(this))},_getHeaderData:function(){return{creatorDescription:this.$(".creatorDescription").text().trim(),storyboardBlurb:this.$(".storyboardBlurb").text().trim(),boardName:this.$(".boardNameEditable").text().trim()}},_getCountry:function(){return this.$('select[name="country"]').val()},_getStoryboardFeed:function(){return this.getChildById("grid")}}),P.modules.StoryboardPage.prototype.className="StoryboardPage",goog.provide("P.modules.StoryboardPin"),goog.require("P.Module"),P.modules.StoryboardPin=P.Module.extend({}),P.modules.StoryboardPin.prototype.className="StoryboardPin",goog.provide("P.modules.StoryboardRow"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.StoryboardRow=P.Module.extend({events:{"click .StoryboardPin":"nextIteration"},CssClassName:{EDITING:"editing"},onContentReady:function(){var e=this.options.pins,t=this.options.pinOrganization||{},o=this.options.pinOptions||{},n=this.options.editing;e.length||this.destroy(),n&&this.$el.addClass(this.CssClassName.EDITING),t.className&&this.$el.addClass(t.className),o.textVisibility&&this.$el.addClass(o.textVisibility),this.$el.attr("data-edit-type","storyboardRow");var a=[];4===t.numPins&&4===e.length?(a[0]=e[0],a[1]=e[2],a[2]=e[1],a[3]=e[3]):a=e,a&&a.length&&a.forEach(function(e){var t={name:"StoryboardPin",data:e,options:{pin:e}};P.moduleFactory.load(t).then(function(e){e.render().then(function(){this.appendChild(e)}.bind(this))}.bind(this))}.bind(this)),this.addEditor()},addEditor:function(){var e=this.options.storyboardFeed,t={name:"StoryboardEditorMenu",options:{target:this,storyboardFeed:e,rowNumber:this.options.rowNumber}};P.moduleFactory.load(t).then(function(e){e.render().then(function(){this.appendChild(e)}.bind(this))}.bind(this))},nextIteration:function(){this.options.storyboardFeed.goToNextIterationWithoutBounds(this)},getExportData:function(){var e=this.options.pinOrganization,t=this.options.pins.map(function(e){return e.id});return{type:"pin",textVisibility:this.options.textVisibility,numPins:e.numPins,variant:e.variant,pins:t,pinOptions:this.options.pinOptions}}}),P.modules.StoryboardRow.prototype.className="StoryboardRow",goog.provide("P.modules.SuggestedBoardsDropdown"),goog.require("P.Module"),P.modules.SuggestedBoardsDropdown=P.Module.extend({onContentReady:function(){this.data&&this.data.length||this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0)}}),P.modules.SuggestedBoardsDropdown.prototype.className="SuggestedBoardsDropdown",goog.provide("P.modules.SuggestedUsersDropdown"),goog.require("P.Module"),P.modules.SuggestedUsersDropdown=P.Module.extend({onContentReady:function(){this.data&&this.data.length||this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0)}}),P.modules.SuggestedUsersDropdown.prototype.className="SuggestedUsersDropdown",goog.provide("P.modules.TabButton"),goog.require("P.modules.Button"),goog.require("P.ga"),P.modules.TabButton=P.modules.Button.extend({onClick:function(e){return this.options.ga_category&&P.ga.trackEvent(this.options.ga_category,P.CONST.GA_ACTION_CLICK),this._logContextEvent(e),e.stopPropagation(),e.preventDefault(),this.isSelected()?!1:void P.modules.Button.prototype.onClick.call(this,e)}}),P.modules.TabButton.prototype.className="TabButton",goog.provide("P.modules.Tabs"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.Tabs=P.Module.extend({events:{"click .tab":"onTabSelected"},CssClassName:{ACTIVE:"active",DISABLED:"disabled"},onCreated:function(){this.childListen(P.CONST.EVENT_DATA_EMPTY,this._onNoData)},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.modulePromises={};var e=this.getChildById("selectedTabModule"),t=this.options.selected_tab_index||0;e&&(this.modulePromises[t]=Promise.resolve(e),this.setSelectedTabIndex(t)),this.options.prefetch&&this.prefetchTabsContent()},getTabCount:function(){return this.options.tabs.length},prefetchTabsContent:function(){for(var e=function(e){this.insertChild(e,this.$(".content")),e.render().then(function(){e.hide()})}.bind(this),t=0;t<this.getTabCount();t++)if(!this.modulePromises[t]){var o=this.options.tabs[t].content_module,n=P.moduleFactory.load(o);this.modulePromises[t]=n,n.then(e)}},setSelectedTabIndex:function(e){if(this.modulePromises[e])return this._setNewIndex(e),this.modulePromises[this.currentIndex].then(function(e){e.show()});var t=this.options.tabs[e].content_module,o=P.moduleFactory.load(t);return this.modulePromises[e]=o,o.then(function(t){this.insertChild(t,this.$(".content")),this._setNewIndex(e),t.showLoading(),t.render().then(function(){t.hideLoading(),e===this.currentIndex?t.show():t.hide()}.bind(this))}.bind(this))},_setNewIndex:function(e){void 0!==this.currentIndex&&this.modulePromises[this.currentIndex].then(function(e){e.hide()}),this._setTabActive(e)},_onNoData:function(e){var t=e.data;void 0!==this.currentIndex&&(this.currentIndex=0);var o=this._getTabLabels();o.eq(this.currentIndex).addClass(this.CssClassName.DISABLED),this.setSelectedTabIndex(t)},onTabSelected:function(e){if(!$(e.target).hasClass(this.CssClassName.DISABLED)){var t=e.currentTarget.getAttribute("data-tab-index");this.setSelectedTabIndex(t)}},_setTabActive:function(e){this.currentIndex=e;var t=this._getTabLabels();t.removeClass(this.CssClassName.ACTIVE),t.eq(e).addClass(this.CssClassName.ACTIVE),this.modulePromises[e].then(function(t){t.triggerEvent(P.CONST.EVENT_TAB_SELECTED,e,!1)})},_getTabLabels:function(){return this.$(".header > .tab > div")}}),P.modules.Tabs.prototype.className="Tabs",goog.provide("P.modules.TakedownForm"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.OffsiteWork"),goog.require("P.modules.ReportedContent"),goog.require("P.moduleFactory"),goog.require("P.validator"),goog.require("P.resourceFactory");var Ze=100,Qe=800,et=128;P.modules.TakedownForm=P.Module.extend({events:{"click .addAnotherInfringingButton":"onAddAnotherInfringingClick","click .removeInfringingItemButton":"onRemoveInfringingItemClick","click .sameInfoButton":"onSameInfoClicked","click .addAnotherOffsiteButton":"onAddAnotherOffsiteClick","click .removeOffsiteItemButton":"onRemoveOffsiteItemClick"},onCreated:function(){this.numOffsiteUrls=1,this.numReportedItems=1},onAddAnotherInfringingClick:function(){var e=new P.modules.ReportedContent({options:{view_type:this.extraData.view_type}});this._onAddAnotherClick(e,".ReportedContentWrapper","numReportedItems")},onAddAnotherOffsiteClick:function(){this._onAddAnotherClick(new P.modules.OffsiteWork({}),".OffsiteWorkWrapper","numOffsiteUrls")},_onAddAnotherClick:function(e,t,o){var n=this.$(t);e.render().then(function(){if(this[o]<Ze)this.insertChild(e,n),$(t).children().last().wrap("<li></li>"),this[o]+=1,this.onContentReady();else{var a={name:"ConfirmDialog",options:{message:"No more than "+Ze+" reported items per form, please."}};P.moduleFactory.load(a).then(function(e){this.showInModal(e)}.bind(this))}}.bind(this))},onRemoveInfringingItemClick:function(){this._onRemoveItemClick(".ReportedContentWrapper","numReportedItems")},onRemoveOffsiteItemClick:function(){this._onRemoveItemClick(".OffsiteWorkWrapper","numOffsiteUrls")},_onRemoveItemClick:function(e,t){if(this[t]>1){var o=this.$(e).children().last();o.remove(),this[t]-=1}else{var n={name:"ConfirmDialog",options:{message:"You must report at least one item."}};P.moduleFactory.load(n).then(function(e){this.showInModal(e)}.bind(this))}},onContentReady:function(){var e={agent_name:[P.validator.Required()],agent_street_address:[P.validator.Length({max:et})],agent_city:[P.validator.Length({max:et})],agent_state:[P.validator.Length({max:et})],agent_zipcode:[P.validator.Length({max:et})],agent_country:[],agent_phone:[P.validator.PhoneNumber()],agent_email:[P.validator.Email({}),P.validator.Required()],is_accurate:[P.validator.Required()],is_good_faith:[P.validator.Required()],is_authorized_agent:[P.validator.Required()],signed_name:[P.validator.Required(),P.validator.EqualTo({targetFieldName:"agent_name",message:"Electronic signature doesn't match your name."})]};this.$(".owner_website_url")&&(e.owner_website_url=[P.validator.Required()]),this.$(".reported_content_url")&&(e.reported_content_url=[P.validator.Required(),P.validator.URL()]),this.$(".context_notes")&&(e.context_notes=[P.validator.Length({max:Qe})]),this.$(".exact_string")&&(e.exact_string=[P.validator.Required()]),this.$(".remove_all")&&(e.remove_all=[]),this.$(".strike")&&(e.strike=[]);var t={prevalidate:!0};this.$form=this.$("form"),this.form=new P.Form(this.$form,e,t),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},getFormData:function(){var e=[],t={},o=this.form.$el.serializeArray(),n=["owner_website_url","reported_content_url","context_notes","exact_string","remove_all","strike"],a=[],r={};return _.each(o,function(o){-1!==n.indexOf(o.name)?(-1!==a.indexOf(o.name)&&(e.push(r),a=[],r={}),r[o.name]=o.value,a.push(o.name)):t[o.name]=t[o.name]="on"===o.value?!0:o.value}),e.push(r),t.reported_content=e,t},onSubmitValidated:function(e){var t;if(!e.errors[0]){var o=this.getChildById("submitButton");o.showLoading(),t="dmcapin"===this.extraData.view_type?this.form.getData(!0):this.getFormData(),t.form_type=this.extraData.view_type,t.num_offsite_urls=this.numOffsiteUrls,t.num_reported_items=this.numReportedItems;var n=P.resourceFactory.instance.create("TakedownRequestResource",t);n.options=t,n.callCreate({showError:!0}).then(function(e){o.hideLoading();var t=e.resource_response.data,n="Thanks for submitting. Your confirmation number is "+t+".",a={name:"ConfirmDialog",options:{button_text:"Got it!",body_message:n,title:"Request Submitted",template:"generic"}};P.moduleFactory.load(a).then(function(e){this.showInModal(e)}.bind(this))}.bind(this)).fin(function(){o.hideLoading()})}}}),P.modules.TakedownForm.prototype.className="TakedownForm",goog.provide("P.modules.TextContainer"),goog.require("P.Module"),P.modules.TextContainer=P.Module.extend({}),P.modules.TextContainer.prototype.className="TextContainer",goog.provide("P.modules.TextField"),goog.require("P.Module"),goog.require("P.TypeaheadProvider"),goog.require("P.util");var tt="<li data-value='${name}'><img src='${img}' /> <span class='username'>${name}</span> (${fullName})</li>";P.modules.TextField=P.Module.extend({events:{click:"_onClick","focus .content":"_onContentFocus","blur .content":"_onContentBlur","input .content":"_onContentInput","keydown .content":"_onContentKeydown","keyup .content":"_onContentKeyup","paste .content":"_onContentPaste"},CssClassName:{ACTIVE:"active",HAS_VALUE:"has-value",MAX_HEIGHT:"maxheight",ERROR:"error"},onContentReady:function(){this.options.mentions&&this.initAtMentions(),this.$el.removeClass(this.CssClassName.ERROR),this._getContent().placeholder()},initAtMentions:function(){this.typeahead=new P.TypeaheadProvider({tags:"mentions",pin_id:this.options.pin_id}),o.e(17,function(e){o(206),this._getContent().atwho("@",{data:"/",tpl:tt,callbacks:{remote_filter:this.onAtMentionFilter.bind(this)}}),this.atwho=this._getContent().data("atwho")}.bind(this))},onAtMentionFilter:function(e,t,o){e.q&&this.typeahead.search(e.q,function(e){var t=_.map(e.items,function(e){return{name:P.util.stripTags(e.username),fullName:P.util.stripTags(e.label),img:e.image}});o(t),this.atwho.settings["@"].data="/"}.bind(this))},_getContent:function(){return this.$content||(this.$content=this.$(".content")),this.$content},getValue:function(){var e=this._getContent(),t=e.val().trim();return this.log.debug("value:",t,e),t},reset:function(){this.$el.removeClass(this.CssClassName.ERROR),this.setValue("")},getUntrimmedValue:function(){return this._getContent().val()},setValue:function(e){this._getContent().val(e)},focus:function(){this._getContent().focus()},_onClick:function(){this.focus()},_onContentFocus:function(){this.$el.addClass(this.CssClassName.ACTIVE),this.triggerEvent(P.CONST.EVENT_FOCUS,null,!0)},_onContentBlur:function(){var e=this.getValue().length;this.$el.toggleClass(this.CssClassName.HAS_VALUE,e),this.$el.removeClass(this.CssClassName.ACTIVE),this.triggerEvent(P.CONST.EVENT_BLUR,{hasValue:e},!0)},_onContentInput:function(){this.options.autogrow&&this._updateInputSize(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},_shouldListenToKeyup:function(){return"onpropertychange"in this.$el[0]&&!("oninput"in this.$el[0])},_onContentKeydown:function(e){var t=e.keyCode;t===P.util.keyCode.ENTER?(this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,null,!0),this.options.prevent_default_on_enter&&(e.preventDefault(),this._onContentInput()),this.options.stop_propagation_on_enter&&e.stopPropagation()):(t===P.util.keyCode.LEFT||t===P.util.keyCode.RIGHT)&&e.stopPropagation(),this._validateMaxLength(this.options.maxlength)},_onContentKeyup:function(){this._shouldListenToKeyup()&&this._onContentInput()},_updateInputSize:function(){var e=this._estimateInputSize(),t=this._getContent();if(t.height()!==e){var o=this.options.maxheight;o&&e>o?(t.height(o),t.addClass(this.CssClassName.MAX_HEIGHT)):(t.removeClass(this.CssClassName.MAX_HEIGHT),t.height(this._estimateInputSize())),this.triggerEvent(P.CONST.EVENT_TEXT_INPUT_RESIZED,null,!0)}},_estimateInputSize:function(){var e=this._getContent();if(!this.$_mirrorInput){var t='<div class="invisibleElemContainer"><textarea class="content invisibleElem"></textarea></div>';this.$el.append(t),this.$_mirrorInput=this.$(".invisibleElem"),this.$_mirrorInput.width(e.width()),e.attr("rows")&&this.$_mirrorInput.attr("rows",e.attr("rows")),this._initInputHeight=e.height()}var o=this._getContent().val();this.$_mirrorInput.val(o);var n=parseInt(e.css("padding-top"),10)||0,a=Math.max(this.$_mirrorInput[0].scrollHeight-2*n,this._initInputHeight);return this.$_mirrorInput.val(""),a},_validateMaxLength:function(e){if(!this.options.should_validate_maxlength||!e)return!0;var t=this.getValue();return e&&t.length>=e?(this.$el.addClass(this.CssClassName.ERROR),!1):(this.$el.removeClass(this.CssClassName.ERROR),!0)},_onContentPaste:function(){this.triggerEvent(P.CONST.EVENT_PASTE,null,!0),this._validateMaxLength(this.options.maxlength)}}),P.modules.TextField.prototype.className="TextField",goog.provide("P.modules.ToastBase"),goog.require("P.Module"),goog.require("P.timer");var ot=4e3;P.modules.ToastBase=P.Module.extend({CssClassName:{VISIBLE:"visible"},onAdded:function(){var e=this;this.$el.transition({y:200,opacity:0,duration:1},function(){e.$el.addClass(e.CssClassName.VISIBLE)}).transition({y:0,easing:"cubic-bezier(.19, 1.15, .48, 1)",opacity:1,duration:450})},animateOut:function(){this.$el.transition({scale:1.1,opacity:0,duration:200},function(){this.destroy()}.bind(this))},attachTimer:function(e){this._timer=P.timer.setTimeout(function(){return this.$el.isHovering()?(clearTimeout(this._timer),void this.$el.on("mouseleave",function(){this.attachTimer(ot/2)}.bind(this))):void this.animateOut()}.bind(this),e)},onContentReady:function(){this.$el.initHovering(),this.attachTimer(ot)}}),P.modules.ToastBase.prototype.className="ToastBase",goog.provide("P.modules.Toasts"),goog.require("P.Module"),P.modules.Toasts=P.Module.extend({}),P.modules.Toasts.prototype.className="Toasts",goog.provide("P.modules.ToggleButton"),goog.require("P.modules.Button"),P.modules.ToggleButton=P.modules.Button.extend({onClick:function(e){this._logContextEvent(e),e.stopPropagation(),e.preventDefault(),this.toggleState(),P.modules.Button.prototype.onClick.call(this,e)},toggleState:function(){this.setState(!this.getState())},setState:function(e){this.options.toggled=e,this.renderExistingData()},getState:function(){return this.options.toggled}}),P.modules.ToggleButton.prototype.className="ToggleButton",
goog.provide("P.modules.Token"),goog.require("P.Module"),P.modules.Token=P.Module.extend({getTokenData:function(){return{}}}),P.modules.Token.prototype.className="Token",goog.provide("P.modules.TokenizedInput"),goog.require("P.Module"),goog.require("P.modules.Token"),goog.require("P.modules.Input"),goog.require("P.moduleFactory"),goog.require("P.util");var nt=100;P.modules.TokenizedInput=P.Module.extend({events:{"keyup input":"onInputKeyup","keydown input":"onInputKeydown","click .tokenWrapper":"onTokenModuleWrapperClick","click .inputToken":"onInputTokenClick","click .removeAll":"onRemoveAll"},CssClassName:{TOKEN_SELECTED:"tokenSelected"},onCreated:function(){this.options.handled_by_parent||this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.tokens=[],this.savedTokens=[],this.selectedToken=null,this.removingToken=!1,this.childListen(P.CONST.EVENT_REMOVE_TOKEN,this.onRemoveToken),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.onBodyColumnChange);var e={};e[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.updateTokenizedInputView=this.updateTokenizedInputView.bind(this),this.state={scrollLeft:0}},onSearchQueryUpdated:function(e,t,o){this.removingToken=!1},onRemoveToken:function(e){if(!this.removingToken){this.removingToken=!0;var t=e.data,o=_.indexOf(this.tokens,t),n=this.tokens[o].getTokenData();this.removeToken(t),this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,n,!0)}},onInputTokenClick:function(){this.selectedToken&&this.unselectSelectedToken(),this.options.hide_tokens_on_focus&&this.setEditingTokenText()},setEditingTokenText:function(){var e=this.getTokens();if(e.length>0){var t=this.constructTokenTextLeftToRight();this.savedTokens=$.extend(!0,[],e);var o=_.clone(e);_.each(o,function(e){this.removeToken(e)}.bind(this)),this.getInputField().setValue(t),_.defer(function(){this.getInputField().setCursorPosition(t.length)}.bind(this))}},onBodyColumnChange:function(){this.updateTokenizedInputView()},constructTokenText:function(){return"prioritized"===this.options.token_text_strategy?this.constructTokenTextBasedOnPriority():this.constructTokenTextLeftToRight()},_getTokensWidth:function(e,t){for(var o=this.getTokens(),n=0,a=e;t>=a;a++)n+=o[a].getWidth(!0);return n},updateTokenizedInputView:function(){var e=this.getWidth(),t=this.getTokens(),o=this._getTokensWidth(0,t.length-1),n=this.$(".inputToken"),a=this.$(".tokensWrapper"),r=this.$(".scrollWrapper"),i=e-o,s=this.state.scrollLeft;if(i>=nt)a.css("width",e+"px"),n.css("width",i+"px"),r.css("overflow-x","hidden");else{var l=o+nt;if(n.css("width",nt+"px"),P.context.instance.is_mobile_agent&&r.css("overflow-x","scroll"),this.selectedToken){var u=_.indexOf(t,this.selectedToken),d=this._getTokensWidth(0,u-1);d-s>=0?d-s>e&&(s=e-l):s=0}else s=e-l;a.css("width",l-s+"px"),r.scrollLeft(-1*s),this.state.scrollLeft=s}},constructTokenTextBasedOnPriority:function(){var e=this.getTokens(),t="";return _.each(e,function(e){var o=e.getTokenData(),n=o.text,a=o.priority;"0"===a?t=n+" "+t:t+=" "+n,t=t.trim()}),t},constructTokenTextLeftToRight:function(){var e=this.getTokens(),t="";return _.each(e,function(e){var o=e.getTokenData(),n=o.text;t+=" "+n,t=t.trim()}),t},getTokenInputValue:function(){var e=this.constructTokenText();return(e+" "+this.getInputValue()).trim()},getInputValue:function(){return this.getInputField().getValue().trim()},setTokenValue:function(e){var t=e;if(this.savedTokens.length>0)return this.clearTokens(),this.addTokensAndUpdateInputView(this.savedTokens),this.clearSavedTokens(),"";var o=this.getTokens(),n=_.clone(o);return _.each(n,function(e){var o=e.getTokenData(),n=o.text,a=new RegExp("(^|\\s)"+n+"(?=\\s|$)");t.match(a)?t=t.replace(n,""):this.removeToken(e),t=t.trim()}.bind(this)),t.trim()},setInputValue:function(e){this.getInputField().setValue(e)},onTokenModuleWrapperClick:function(e){var t=$(e.currentTarget),o=t.find(".Module").first(),n=this.getChildByElement(o);if(n&&(n===this.selectedToken?this.unselectSelectedToken():this.selectToken(n),e.stopPropagation()),this.options.hide_tokens_on_focus){var a=this._findIndexSelectedToken();this.setEditingTokenText(),a>=0&&(_.defer(function(){this.getInputField().focus(),this.getInputField().setCursorPosition(a)}.bind(this)),this.unselectSelectedToken())}},getTokens:function(){return this.tokens},onInputKeydown:function(e){var t=e.keyCode,o=$(e.target),n=o[0].selectionEnd,a=_.indexOf(this.tokens,this.selectedToken);switch(t){case P.util.keyCode.LEFT:if(0!==n)break;if(!this.tokens.length)break;this.selectedToken?0!==a?this.selectAdjacentToken(!0):this.unselectSelectedToken():this._handleNoSelectedTokenKeydown(!1);break;case P.util.keyCode.RIGHT:this.selectedToken&&(a!==this.tokens.length-1?this.selectAdjacentToken(!1):this.unselectSelectedToken(),e.preventDefault());break;case P.util.keyCode.BACKSPACE:if(0===n)if(e.preventDefault(),this.selectedToken){var r=this.selectedToken;this.unselectSelectedToken(),this.removeToken(r),this._shouldSelectOnBackspaceKeydown=!1,this.getInputField().focus()}else this.removeToken(_.last(this.tokens))}},onInputKeyup:function(e){var t=e.keyCode;return t!==P.util.keyCode.LEFT&&t!==P.util.keyCode.RIGHT&&t!==P.util.keyCode.BACKSPACE?void this.unselectSelectedToken():(e.preventDefault(),this._shouldSelectOnBackspaceKeydown=!0,void e.stopPropagation())},_handleNoSelectedTokenKeydown:function(e){var t;t=e?_.first(this.tokens):_.last(this.tokens),this.selectToken(t)},selectAdjacentToken:function(e){var t=_.indexOf(this.tokens,this.selectedToken),o;o=-1!==t?e?this.tokens[t-1]:this.tokens[t+1]:e?_.last(this.tokens):_.first(this.tokens),o||(o=null),this.selectToken(o)},getInputFieldValue:function(){var e=this.getInputField(),t=e.getValue();return t},selectToken:function(e){this.selectedToken&&this.selectedToken.getContent().removeClass(this.CssClassName.TOKEN_SELECTED),this.selectedToken=e,e&&this.selectedToken.getContent().addClass(this.CssClassName.TOKEN_SELECTED),this.updateTokenizedInputView()},_findIndexSelectedToken:function(){if(this.selectedToken){for(var e=_.indexOf(this.tokens,this.selectedToken),t="",o=0;e>=o;o++)t+=" "+this.tokens[o].getTokenData().text;return t.trim().length}return-1},unselectSelectedToken:function(){this.selectedToken&&(this.selectedToken.getContent().removeClass(this.CssClassName.TOKEN_SELECTED),this.selectedToken=null,this.updateTokenizedInputView())},getInputField:function(){return this.getChildById("input")},onTypeaheadItemSelected:function(e){var t=$.extend(!0,{},this.options.token_module),o=e.data.item.attributes;if(t.data=o,!t)throw new Error("TokenizedInput module needs a `token_module` option.");P.moduleFactory.load(t).then(function(e){e.renderExistingData(),this.addToken(e);var t=this.getInputField();t.clear(),t.focus()}.bind(this))},updateInputPlaceholder:function(){this.tokens&&this.tokens.length>0?this.getInputField().clearPlaceholder():this.getInputField().restorePlaceholder()},addTokensAndUpdateInputView:function(e){var t=e.map(function(e){return this.addToken(e)}.bind(this));Promise.all(t).then(this.updateTokenizedInputView)},addToken:function(e){var t=$('<li class="tokenizedItem tokenWrapper"></li>'),o=this.$(".inputToken");return t.insertBefore(o),this.insertChild(e,t),this.tokens.push(e),this.triggerEvent(P.CONST.EVENT_TOKEN_ADDED,e,!0),this.updateInputPlaceholder(),this.options.show_remove_all&&this.updateRemoveAll(),e.render()},removeToken:function(e){var t=_.indexOf(this.tokens,e);this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED,e,!0),-1!==t&&(this.tokens.splice(t,1),this.$(".tokenWrapper").eq(t).remove(),e.destroy()),this.updateInputPlaceholder(),this.updateTokenizedInputView(),this.options.show_remove_all&&this.updateRemoveAll()},clearTokens:function(){var e=this.getTokens();if(e.length>0){var t=_.clone(e);_.each(t,function(e){this.removeToken(e)}.bind(this))}},clearSavedTokens:function(){this.savedTokens=[]},onRemoveAll:function(e){this.clearTokens(),this.clearSavedTokens(),this.getInputField().clear(),this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,null,!0),e.stopPropagation()},updateRemoveAll:function(){this.tokens.length>0?this.$(".removeAll").show():this.$(".removeAll").hide()}}),P.modules.TokenizedInput.prototype.className="TokenizedInput",goog.provide("P.modules.ToolTipPulser"),goog.require("P.Module"),goog.require("P.CONST"),goog.require("P.moduleFactory"),goog.require("P.ExperienceManager"),P.modules.ToolTipPulser=P.Module.extend({onContentReady:function(){this.options.anchor&&(this.loadPulser(),this.childListen(P.CONST.EVENT_PULSER_CLICKED,function(){this.currentPulser&&(this.currentPulser.destroy(),this.currentPulser=null),this.showTooltip()}))},loadPulser:function(){this.options.anchor.startsWith(".PinActionBar ")&&(this.options.append_to=".PinActionBar");var e={name:"TwoCirclesPulser",options:{anchor:this.options.anchor,fixed:!0,append_to:this.options.append_to}};P.moduleFactory.load(e).then(function(e){this.appendChild(e),e.render(),this.currentPulser=e}.bind(this))},showTooltip:function(){var e=this.options.experience;P.ExperienceTutorialManager.instance().startTutorial(e).then(function(){P.ExperienceManager.instance.viewPlacedExperience(e.placement_id,e.experience_id)})}}),P.modules.ToolTipPulser.prototype.className="ToolTipPulser",goog.provide("P.modules.TopLevelNav"),goog.require("P.Module"),P.modules.TopLevelNav=P.Module.extend({}),P.modules.TopLevelNav.prototype.className="TopLevelNav",goog.provide("P.modules.TrademarkForm"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.resourceFactory");var at=".agentFields",rt=".transferField";P.modules.TrademarkForm=P.Module.extend({onCreated:function(){this.onComplainantTypeChange=this.onComplainantTypeChange.bind(this),this.onTrademarkClaimSuccess=this.onTrademarkClaimSuccess.bind(this),this.onAddURLButtonClick=this.onAddURLButtonClick.bind(this)},onContentReady:function(){if(_.contains(["username","content","goods"],this.options.claim_type)){this.$("[name=complainant_type]").on("change",this.onComplainantTypeChange),this.$("[name=course_of_action]").on("change",this.onClaimTypeChange);var e=this.getChildById("addURL");e&&this.listen(e,P.CONST.EVENT_BUTTON_CLICK,this.onAddURLButtonClick),this.complainantType=null,this.claimType=null;var t=new Date;this.$("#trademarkSignatureDate").val(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),this.setupForm()}},setupForm:function(){var e=this.$("form"),t={};this.form=new P.Form(e,t),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onComplainantTypeChange:function(e){var t=$(e.target);if(t.is(":checked")){var o=t.val();this.complainantType=o,"agent"===o?this.showAgentFields():this.hideAgentFields()}},onClaimTypeChange:function(e){var t=$(e.target);if(t.is(":checked")){var o=t.val();this.claimType=o,"transfer"===o?$(rt).show():$(rt).hide()}},onSubmitValidated:function(e){if(!e.errors[0]){var t=this.createResourceOptions(),o=this.getChildById("submitBtn");o.showLoading();var n=P.resourceFactory.instance.create("TrademarkClaimResource",t);n.callCreate().then(this.onTrademarkClaimSuccess.bind(this)).fin(function(){o.hideLoading()})}},onTrademarkClaimSuccess:function(e){var t=e.resource_response.data,o={name:"ConfirmDialog",options:{claim_id:t,template:"trademark_claim_success"}};P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_DESTROYED,function(){this.navigate("/")})}.bind(this))},onAddURLButtonClick:function(){var e=this.$(".infringingURLs"),t=e.children().first().clone();t.find("input").removeAttr("id"),e.append(t)},showAgentFields:function(){this.$(at).show()},hideAgentFields:function(){this.$(at).hide()},createResourceOptions:function(){var e=_.omit(this.form.getData(),"complainant_type");e.claim_type=this.options.claim_type,e.is_owner="owner"===this.complainantType;var t=["infringing_content_urls","infringing_goods_urls"];return _.each(t,function(t){var o=e[t];_.isArray(o)&&(o=_.map(o,function(e){return e.trim()}),o=_.reject(o,function(e){return""===e}),e[t]=o.join(","))}),e}}),P.modules.TrademarkForm.prototype.className="TrademarkForm",goog.provide("P.modules.TrademarkFormSelector"),goog.require("P.Module"),P.modules.TrademarkFormSelector=P.Module.extend({onContentReady:function(){this.$("[name=claim_type]").on("change",this.onClaimTypeChange.bind(this))},onClaimTypeChange:function(e){var t=$(e.target);if(t.is(":checked")){var o=t.val();this.navigate("/about/trademark/form/"+o+"/")}}}),P.modules.TrademarkFormSelector.prototype.className="TrademarkFormSelector",goog.provide("P.modules.Tutorial"),goog.require("P.Module"),P.modules.Tutorial=P.Module.extend({onContentReady:function(){this.manager=P.TutorialManager.instance(),this.childListen(P.CONST.EVENT_NEXT,this.manager._next.bind(this.manager)),this.childListen(P.CONST.EVENT_PREVIOUS,this.manager._previous.bind(this.manager)),this.manager.startTutorial(this.options.tutorial_name,{moduleContainer:this})},onDestroyed:function(){this.manager.stopTutorial()}}),P.modules.Tutorial.prototype.className="Tutorial",goog.provide("P.modules.TweetButton"),goog.require("P.modules.Button"),goog.require("P.url"),goog.require("P.ga"),goog.require("P.windowUtil"),P.modules.TweetButton=P.modules.Button.extend({onClick:function(){P.Twitter.openDialog({tweet_path:this.options.tweet_path,tweet_text:this.options.tweet_text}),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)}}),P.modules.TweetButton.prototype.className="TweetButton",goog.provide("P.modules.TwoCirclesPulser"),goog.require("P.modules.Pulser");var it=[{transition:{scale:.6,opacity:0}},{transition:{opacity:.7},time:550,timingFuction:"linear"},{transition:{opacity:.7},time:800},{transition:{scale:.45},time:150,timingFunction:"cubic-bezier(0.1, 0.55, 0.95, 0.5)"},{transition:{scale:.6},time:150,timingFunction:"linear"},{transition:{opacity:0},time:750,timingFunction:"cubic-bezier(0.42, 0.0, 1.0, 1.0)"}],st=[{transition:{scale:.8,opacity:0}},{transition:{scale:.8,opacity:0},time:1450},{transition:{opacity:.6},time:150,timingFunction:"linear"},{transition:{scale:1.2,opacity:0},time:800,timingFunction:"linear"}];P.modules.TwoCirclesPulser=P.modules.Pulser.extend({onContentReady:function(){this.options.append_to&&this.$el.parent().appendTo(this.options.append_to),this._positionPulser(),this.$innerCircle=this.$(".innerCircle"),this.$outerCircle=this.$(".outerCircle"),this.$innerCircle.css(it[0].transition),this.$outerCircle.css(st[0].transition),this.options.fixed&&this.$el.addClass(this.CssClassName.FIXED),this.$el.css("visibility","visible"),this._playAnimation(),window.setInterval(this._playAnimation.bind(this),3e3),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this._positionPulser),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this._positionPulser)},_playAnimation:function(){this._playInnerAnimation(),this._playOuterAnimation()},_playInnerAnimation:function(){this.$innerCircle.css(it[0].transition),it.slice(1).forEach(function(e){this.$innerCircle=this.$innerCircle.transition(e.transition,e.time,e.timingFunction).delay()}.bind(this))},_playOuterAnimation:function(){this.$outerCircle.css(st[0].transition),st.slice(1).forEach(function(e){this.$outerCircle=this.$outerCircle.transition(e.transition,e.time,e.timingFunction).delay()}.bind(this))}}),P.modules.TwoCirclesPulser.prototype.className="TwoCirclesPulser",goog.provide("P.modules.Typeahead"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.TypeaheadProvider"),goog.require("P.i18n"),goog.require("P.resourceFactory");var lt="cid",ut="highlighted",dt={search:"default_item",searchV2:"default_item_2",userSelect:"send_pin",title:"title",map:"add_pin_to_map",place:"place",hint_no_city:"hint_no_city",hint_specific_city:"hint_specific_city",user_circle_avatar:"user_circle_avatar",interest:"interest",emailSelect:"send_to_email",socialConnect:"social_connect"},ct=Backbone.View.extend({tagName:"li",initialize:function(e){this.options=e,this.$el.attr("tabindex",this.options.tabIndex?1:!1);var t=this.options.template;this.templateName=t,this.model.bind("change",this.onChange,this)},appendToElement:function(e){this.render(),e.append(this.$el)},onChange:function(){return this.render(),this.model.attributes.type===P.CONST.TYPEAHEAD_TYPE_GPLUS_NON_PINNER&&this.options.container.triggerEvent(P.CONST.EVENT_TYPEAHEAD_RENDER_DONE,this.model.attributes.id,!0),this},_getTemplateFilePath:function(){return"app/common/modules/components/Typeahead/"+this.templateName+".nunjucks"},render:function(){var e=this._getTemplateFilePath(),t=P.nunjucks.render(e,this.model.toJSON());return this.$el.html(t).toggleClass(P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED,!!this.model.get(ut)).data(lt,this.model.cid),this}});P.modules.Typeahead=P.Module.extend({events:{"click .results li":"onResultClick","click .results .remove":"onRemoveResult",mousedown:"onMousedown","mouseenter .results li":"onResultMouseEnter",mouseleave:"onMouseleave",onchange:"onChange"},CssClassName:{BUTTON_TEXT:"buttonText",OPEN:"open",SHOW_RECENT_QUERIES:"showRecentQueries"},_isOpen:!1,items:[],appendedStaticItems:[],prependedStaticItems:[],onCreated:function(){this.typeahead=new P.TypeaheadProvider(this.options),this.listen(this.typeahead,P.CONST.EVENT_DATA,this.onTypeaheadData),this.listen(this.typeahead,P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize),this.VALID_SECTIONS={board:{title:P.i18n._("BOARDS"),getUrl:function(e){return"/search/boards/?q="+e},getQuery:function(e){return e}},user:{title:P.i18n._("PINNERS"),getUrl:function(e){return"/search/people/?q="+e},getQuery:function(e){return e}},recent_query:{title:P.i18n._("RECENT SEARCHES"),getUrl:function(e){return null},getQuery:function(e){return" "}},trending:{title:P.i18n._("TRENDING ON PINTEREST"),getUrl:function(e){return null},getQuery:function(e){return" "}}}},onChildButtonClick:function(e){var t=e.target;t&&t.isCancelButton()&&(e.stopPropagation(),this.hide())},onSearchStart:function(e){this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,e,!0)},removeCacheForTerm:function(e){this.typeahead.removeCacheForTerm(e)},getResource:function(){return this.typeahead.getResource()},setPrependedStaticItems:function(e,t){this.prependedStaticItems=e,this._updateItemsToRender(),t&&this.renderResults()},resetPrependStaticItems:function(e){this.setPrependedStaticItems([],e)},setAppendedStaticItems:function(e,t){this.appendedStaticItems=e,this._updateItemsToRender(),t&&this.renderResults()},resetAppendedStaticItems:function(e){this.setAppendedStaticItems([],e)},onContentReady:function(){this.$results=this.$(".results")},getItemCount:function(){return this.itemsToRender.count},highlightItemWithAttributeAndValue:function(e,t){var o=this.itemsToRender,n=_.find(o,function(o){return o.get(e)===t});n&&this.highlight(n)},focusHighlighted:function(){this.$("."+P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED).focus()},getHighlightedItem:function(){return this.highlightedItem},search:function(e){this.lastTerm=e,this.typeahead.search(e)},setAutocompleteScope:function(e){this.typeahead.setAutocompleteScope(e)},renderResults:function(){var e=[];if(e=_.map(this.itemsToRender,function(e){return this.createItemView(e)}.bind(this)),!e.length)return void this.hideNoResults();if(this.$results.empty(),_.each(e,function(e){e.appendToElement(this.$results)}.bind(this)),!this.options.bypass_maxheight){var t=this.getScrollableElement().scrollTop(),o=P.Viewport.height-P.CONST.PIN_MARGIN-this.$results.offset().top+t;this.$results.css({"max-height":o,"overflow-y":"auto"})}this.show()},emptyResults:function(){this.itemsToRender=[],this.$results.empty()},createItemView:function(e){var t=this.options.is_multiobject_search?dt.searchV2:dt.search,o=this.options.template?dt[this.options.template]:t,n=this.options.use_tab_index;e.attributes&&e.attributes.template&&(o=dt[e.attributes.template]);var a=new ct({model:e,container:this,template:o,tabIndex:n});return a},beforeHide:function(){this._isOpen=!1,this.highlightedItem=null,this.select(null),this.$el.removeClass(this.CssClassName.OPEN)},hide:function(){this.beforeHide(),this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HIDDEN,{enable_overlay:this.options.enable_overlay},!0)},hideNoResults:function(){this.beforeHide(),this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HIDDEN,{noResults:!0},!0)},show:function(){this._isOpen=!0,this.$el.addClass(this.CssClassName.OPEN),this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_SHOWN,{enable_overlay:this.options.enable_overlay},!0)},isOpen:function(){return this._isOpen},getLastTerm:function(){return this.lastTerm},selectElement:function(e){var t=this.getItemByElement(e);return this.select(t)},getSelectedItem:function(){return this.selectedItem},select:function(e){return e=e||this.highlightedItem,e&&e.get("selectable")===!1?null:(e&&this.triggerEvent(P.CONST.EVENT_ITEM_SELECTED,{item:e},!0),this.selectedItem=e,e)},highlightUp:function(){var e=this.highlightedItem,t=this.itemsToRender,o=e?_.indexOf(t,e)-1:t.length-1,n=t[o];return n&&n.get("selectable")===!1&&(--o,0>o&&(o=t.length-1)),this.highlight(t[o])},highlightDown:function(){var e=this.highlightedItem,t=this.itemsToRender,o;if(e){var n=_.indexOf(t,e);o=n===t.length-1?0:n+1}else o=0;var a=t[o];return a&&a.get("selectable")===!1&&++o,this.highlight(t[o])},highlightElement:function(e){var t=null;return e&&e[0]&&(t=this.getItemByElement(e)),this.highlight(t)},highlight:function(e){return e=e||null,e===this.highlightedItem?e:(this.highlightedItem&&this.highlightedItem.set(ut,!1),this.highlightedItem=e,e&&e.set(ut,!0),this.triggerEvent(P.CONST.EVENT_ITEM_HIGHLIGHTED,{item:e},!0),e)},getItemByElement:function(e){var t=e.data(lt);return _.find(this.itemsToRender,function(e){return e.cid===t})},abortSearch:function(){this.typeahead.abortSearch()},prefetch:function(){this.typeahead.prefetch()},onMousedown:function(e){$(e.target).is("."+this.CssClassName.BUTTON_TEXT)?e.stopPropagation():this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,null,!0)},onMouseleave:function(e){this.isOpen()&&this.highlightElement()},onRemoveResult:function(e){e.stopPropagation(),e.preventDefault();var t=$(e.currentTarget),o=t.parents("li").data(lt),n=t.attr("data-query");if(n){var a=P.resourceFactory.instance.create("TypeaheadClearRecentResource",{query:n});a.callDelete(),t.parents("li").remove(),this.items=this.items.filter(function(e){return e.query!==n}),this.itemsToRender=this.itemsToRender.filter(function(e){return e.cid!==o}),0===this.itemsToRender.length&&this.hideNoResults()}},onRemoveAllResults:function(e){e.stopPropagation(),e.preventDefault();var t=P.resourceFactory.instance.create("TypeaheadClearRecentResource",{query:null});t.callDelete().then(function(){this.items=this.items.filter(function(e){return"recent_query"!==e.type}),this._updateItemsToRender(),this.renderResults()}.bind(this))},onResultClick:function(e){this.selectElement($(e.currentTarget)),e.stopPropagation()},onResultMouseEnter:function(e){this.highlightElement($(e.currentTarget))},_updateItemsToRender:function(){var e=this.getLastTerm(),t=this.prependedStaticItems.concat(this.items,this.appendedStaticItems),o=[],n={},a=null;t.forEach(function(e){var t=e.type,r=this.VALID_SECTIONS[t];if(r&&!n[t]&&this.options.is_multiobject_search){var i={type:"title",label:r.title,url:r.getUrl(this.getLastTerm()),highlightLabel:r.getQuery(this.getLastTerm()),class_name:"titleItem",selectable:!1};o.push(i),n[t]=!0}a=e,o.push(e)}.bind(this)),this.itemsToRender=_.map(o,function(t,o){t.tag=t.tag||"",t.resultIndex=t.resultIndex||o,t.enteredQuery=e,t.label=t.label||"";var n=e?e.toLowerCase():"";return 0===t.label.indexOf(n)?(t.boldedLabelText=n,t.unboldedLabelText=t.label.slice(n.length)):t.unboldedLabelText=t.label,new Backbone.Model(t)})},onTypeaheadData:function(e){this.items=e.items,this._updateItemsToRender();var t=e.hint;this.hint=t,this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HINT,t,!0),this.renderResults(),this._triggerEvents()},_triggerEvents:function(){var e=this.getLastTerm(),t=0;e&&(t=e.length);var o=this.options.enable_recent_queries;if(0===this.itemsToRender.length||0===t){if(o)return void this.renderResults();this.hideNoResults(),this._triggerNoResultsReturned()}else this._triggerResultsReturned(),this.renderResults()},_renderEmptyState:function(){var e=[],t={},o=P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE;t[o]=!0,e.push(t),this.items=e,this._updateItemsToRender(),this._triggerEvents(),this.renderResults()},_triggerNoResultsReturned:function(e){this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,null,!0),e&&this._renderEmptyState()},_triggerResultsReturned:function(){var e={count:this.itemsToRender.length,items:this.itemsToRender};this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,e,!0)},focus:function(){},onResize:function(){this._isOpen&&this.renderResults()}}),P.modules.Typeahead.prototype.className="Typeahead",goog.provide("P.modules.UnauthBanner"),goog.require("P.modules.AppBase"),goog.require("P.modules.InlineSignup"),goog.require("P.util"),goog.require("P.modalManager"),goog.require("P.url"),goog.require("P.app"),P.modules.UnauthBanner=P.modules.InlineSignup.extend({events:{"click .continueSignupButton":"onContinueSignup","click .emailSignup":"onContinueSignup"},CssClassName:_.extend(P.modules.AppBase.prototype.CssClassName,{NO_BANNER:"noBanner",QUARTER_SCREEN_BANNER:"quarterScreenBanner",HALF_SCREEN_BANNER:"halfScreenBanner",FULL_SCREEN_BANNER:"fullScreenBanner"}),onContentReady:function(){P.modules.InlineSignup.prototype.onContentReady.call(this),this.destroyIfEmpty()||(P.pubSub.instance.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HIDE_UNAUTH_BANNER,this.hide.bind(this)),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.$(".emailLogin").attr("href",P.url.getLoginUrl()),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),P.experiments.instance.v2ActivateExperiment("tablet_black_banner"),this.bannerHeight=!1,P.experiments.instance.v2InGroup("lisa_giftwrap_v2",["enabled","employees"])&&this._loadLisaBackgrounds(),P.util.trackRegisterAction("unuath_banner_loaded"))},_onScroll:function(){var e=this.getScrollableElement().scrollTop(),t=$(window).height()/2;if(this.bannerHeight&&t>e&&P.context.instance.deep_link_action&&P.context.instance.is_tablet_agent&&(this.bannerHeight=this.CssClassName.NO_BANNER,this.$el.addClass(this.CssClassName.NO_BANNER),this.$el.removeClass(this.CssClassName.QUARTER_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.HALF_SCREEN_BANNER)),!(P.modalManager.get().hasModals()||this.lockFullScreen||P.context.instance.deep_link_action&&P.context.instance.is_tablet_agent&&1e3>e)){this.show();var o=0,n=750,a=1200;if("Closeup"===P.app.instance.options.module.name&&(P.experiments.instance.v2InGroup("unauth_pin_closeup_grid",["enabled2","employees","enabled2_no_signup_modal"])||(n=1500,a=2e3)),P.context.instance.deep_link_action&&P.context.instance.is_tablet_agent&&(n=1500,a=2e3),!(e>a)||P.context.instance.is_tablet_agent&&P.experiments.instance.v2InGroup("tablet_black_banner",["enabled","employee"]))if(!(e>n)||P.context.instance.is_tablet_agent&&P.experiments.instance.v2InGroup("tablet_black_banner",["enabled","employee"])){if(this.bannerHeight!==this.CssClassName.QUARTER_SCREEN_BANNER&&e>o){var r=this.$(".textAndButtons");this.bannerHeight===this.CssClassName.FULL_SCREEN_BANNER?this.unShowFullPageTakeover():this.bannerHeight===this.CssClassName.NO_BANNER&&(this.$el.removeClass(this.CssClassName.NO_BANNER),r.fadeOut(0)),this.bannerHeight=this.CssClassName.QUARTER_SCREEN_BANNER,this.$el.addClass(this.CssClassName.QUARTER_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.HALF_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.FULL_SCREEN_BANNER),r.delay(500).fadeIn(),P.util.trackRegisterAction("unauth_banner_quarter_screen")}}else this.bannerHeight!==this.CssClassName.HALF_SCREEN_BANNER&&(this.bannerHeight===this.CssClassName.FULL_SCREEN_BANNER&&this.unShowFullPageTakeover(),this.bannerHeight=this.CssClassName.HALF_SCREEN_BANNER,this.$el.addClass(this.CssClassName.HALF_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.FULL_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.QUARTER_SCREEN_BANNER),P.util.trackRegisterAction("unauth_banner_half_screen"));else this.bannerHeight!==this.CssClassName.FULL_SCREEN_BANNER&&this.showFullPageTakeover()}},showFullPageTakeover:function(){this.bannerHeight=this.CssClassName.FULL_SCREEN_BANNER,this.$el.addClass(this.CssClassName.FULL_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.HALF_SCREEN_BANNER),this.$el.removeClass(this.CssClassName.QUARTER_SCREEN_BANNER),this.$(".textAndButtons").fadeOut(250),this.$(".fullScreenSignup").delay(500).fadeIn(250),P.util.trackRegisterAction("unauth_banner_full_screen")},unShowFullPageTakeover:function(){this.$(".fullScreenSignup").fadeOut(250),this.$(".textAndButtons").delay(500).fadeIn(250)},onContinueSignup:function(e){P.util.trackRegisterAction("unauth_banner_continue_click"),P.context.instance.is_tablet_agent&&P.experiments.instance.v2InGroup("tablet_black_banner",["enabled","employee"])?this.navigate(P.genConst.Settings.CANONICAL_MAIN_URL,{trigger:!0,replace:!0}):(this.showFullPageTakeover(),this.lockFullScreen=!0)},onButtonClick:function(e){var t=e.target;"emailSignup"===e.target.id&&(this.navigate(P.url.appendQueryString(t.getNavigateUrl(),{prev:window.location.href})),e.stopPropagation())},onChildNavigate:function(e){(-1!==e.data.url.indexOf("/login/")||-1!==e.data.url.indexOf("/join/"))&&(e.data.url=P.url.appendQueryString(e.data.url,{prev:window.location.pathname})),e.data.url===P.genConst.Settings.CANONICAL_MAIN_URL&&P.context.instance.is_tablet_agent&&P.experiments.instance.v2InGroup("tablet_black_banner",["enabled","employee"])&&this.triggerEvent(P.CONST.EVENT_HEADER_INTERSTITIAL_DISMISSED,null,!0)},_loadLisaBackgrounds:function(){this.$(".lisaBackground1").addClass("bgImage"),this.$(".lisaBackground2").addClass("bgImage"),this.$(".lisaBackground3").addClass("bgImage")}}),P.modules.UnauthBanner.prototype.className="UnauthBanner",goog.provide("P.modules.UnauthCloseup"),goog.require("P.Module"),P.modules.UnauthCloseup=P.Module.extend({getPin:function(){return this.getChildByModuleName("Pin")}}),P.modules.UnauthCloseup.prototype.className="UnauthCloseup",goog.provide("P.modules.UnauthHomePage"),goog.require("P.modules.InlineSignup"),goog.require("P.util"),goog.require("P.url"),goog.require("P.i18n"),goog.require("P.windowUtil"),P.modules.UnauthHomePage=P.modules.InlineSignup.extend({events:{"click .openInApp":"openInApp"},openInApp:function(e){this.triggerEvent(P.CONST.EVENT_OPEN_IN_APP,null,!0)},onContentReady:function(){P.modules.InlineSignup.prototype.onContentReady.call(this),this.facebookTooltip=this.$(".facebookTooltip"),P.url.getQueryStringParams().reloadToLogin&&window.setTimeout(function(){P.util.changeWindowLocation("/")},1e3),"/"===window.location.pathname&&P.util.trackRegisterAction("unauth_home"),window.innerHeight<680&&P.windowUtil.resizeViewPort(750,680),this.extraData&&this.extraData.pinit_landing&&P.util.trackRegisterAction("unauth_pinit_landing");var e=this.data.story.story_id,t=this.options.container||"home_page";P.util.trackRegisterAction("inspired_wall."+t+"."+e),this.setMultiStepHeader(".title",{step1:this.data.story.title,step2:P.i18n._("Looking good! Just a few more details...")})},hideFacebookTooltip:function(e){this.facebookTooltip.fadeOut(500)}}),P.modules.UnauthHomePage.prototype.className="UnauthHomePage",goog.provide("P.modules.UnauthLoggedOutHomePage"),goog.require("P.Module"),P.modules.UnauthLoggedOutHomePage=P.modules.InlineSignup.extend({}),P.modules.UnauthLoggedOutHomePage.prototype.className="UnauthLoggedOutHomePage",goog.provide("P.modules.UnauthPinInGridCloseup"),goog.require("P.Module"),P.modules.UnauthPinInGridCloseup=P.Module.extend({onContentReady:function(){this.options.pin_overlay||this.$(".relatedPinsTitle").css({
"padding-top":this.$(".pinImage").offset().top-this.$(".Grid").offset().top-14})},getPin:function(){return this.getChildByModuleName("Pin")}}),P.modules.UnauthPinInGridCloseup.prototype.className="UnauthPinInGridCloseup",goog.provide("P.modules.UnblockButton"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.UnblockButton=P.Module.extend({events:{click:"onClick"},onUserUnblockSuccess:function(){var e={name:"ConfirmDialog",options:{template:"block_unblock_user_success",name:this.options.full_name,action:"unblocked"}};_.extend(e.options,this.options.dialog_options),P.moduleFactory.load(e).then(function(e){this.showInModal(e,{can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CONFIRM,this.onUnblockConfirm)}.bind(this))},onUnblockConfirm:function(){this.destroy()},onClick:function(e){P.ga.trackEvent("user_unblock",P.CONST.GA_ACTION_CLICK);var t=this.options.user_id;this.showLoading();var o=P.resourceFactory.instance.create("UserBlockResource",{blocked_user_id:this.options.user_id});o.callDelete().then(function(){P.ga.trackEvent("user_unblock",P.CONST.GA_ACTION_SUCCESS),P.pubSub.instance.publish(t,P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED),this.onUserUnblockSuccess()}.bind(this),function(){P.ga.trackEvent("user_unblock",P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))}}),P.modules.UnblockButton.prototype.className="UnblockButton",goog.provide("P.modules.User"),goog.require("P.Module");var pt="followFriendsItem",mt="gridItem";P.modules.User=P.Module.extend({events:{"click .dismiss":"onDismissClick",click:"onClick"},CssClassName:{CONTACT_CONFIRMED:"contactConfirmed",IS_CHECKED:"checked",HIDDEN:"hidden"},getLoadingSpinnerOptions:function(){var e=P.Module.prototype.getLoadingSpinnerOptions.call(this);return this.options.view_type===pt?_.extend(e,{size:P.Spinner.Size.SMALL}):e},getProfileImage:function(){var e;switch(this.options&&this.options.view_type){case"userSelect":e=this.$(".profileImage");break;default:return}return e.attr("src")},updateDom:function(){"userCheckableSelectView"===this.options.view_type&&this.$(".selectCheck").toggleClass("this.CssClassName.IS_CHECKED",this.options.state_isChecked),this.options.view_type===pt&&this.$el.toggleClass(this.CssClassName.CONTACT_CONFIRMED,this.options.state_contactConfirmed)},onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onUserFollow,e[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onUserUnfollow;var t=this.getUserId();this.pubsubSubscribe(t,e)},onCreated:function(){this.options.state_contactConfirmed=this.options.view_type===pt?!1:!0,this.options.state_isChecked=!!this.options.is_checked},onUserFollow:function(e){this.updateOptionsAndDom({state_contactConfirmed:!0}),this.triggerEvent(P.CONST.EVENT_USER_FOLLOW,null,!0),this.updateFollowCounts()},onUserUnfollow:function(e){this.triggerEvent(P.CONST.EVENT_USER_UNFOLLOW,null,!0),this.updateFollowCounts()},updateFollowCounts:function(){this.options.view_type&&this.options.view_type!==mt||this.render()},onDismissClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},getUserId:function(){return this.data&&this.data.id},setChecked:function(e){this.updateOptionsAndDom({state_isChecked:e})},isChecked:function(){if("userCheckableSelectView"===this.options.view_type){var e=this.$(".selectCheck");return e.hasClass(this.CssClassName.IS_CHECKED)}return!1},showOverflowMask:function(e){var t=this.$(".overflowMask");if(t&&e){var o=t.find(".text");o&&o.text(e)}t.show(),this.$(".profile").css("box-shadow","none")},onClick:function(e){if("userSelect"===this.options.view_type&&this.triggerEvent(P.CONST.EVENT_USER_CLICK,null,!0),"userCheckableSelectView"===this.options.view_type){var t=this.$(".selectCheck");t.toggleClass(this.CssClassName.IS_CHECKED);var o={user_id:this.getUserId(),is_following:t.hasClass(this.CssClassName.IS_CHECKED)};this.triggerEvent(P.CONST.EVENT_USER_CLICK,o,!0)}}}),P.modules.User.prototype.className="User",goog.provide("P.modules.UserAppSettings"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.resourceFactory"),P.modules.UserAppSettings=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(e){var t=e.target.id;-1!==t.indexOf("revokeButton")&&this.showConfirmation(t)},onRevokeConfirm:function(e){var t=this.getChildById(e),o=e.replace("revokeButton",""),n=P.resourceFactory.instance.create("OAuthUserAuthorizationsResource",{consumer_id:o});t.showLoading(),n.callDelete().then(function(){this.render()}.bind(this)).fin(function(){t.hideLoading()})},showConfirmation:function(e){var t={name:"ConfirmDialog",options:{template:"revoke_app_access"}};P.moduleFactory.load(t).then(function(t){this.showInModal(t),this.listen(t,P.CONST.EVENT_CONFIRM,function(){this.onRevokeConfirm(e)})}.bind(this))}}),P.modules.UserAppSettings.prototype.className="UserAppSettings",goog.provide("P.modules.UserBlock"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),goog.require("P.url"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.UserBlock=P.Module.extend({events:{"click .cancelButton":"onCancelButtonClick"},onContentReady:function(){this.form=new P.Form(this.$("form"),[]),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(e){var t=e.target;if(t){var o=this.options.blocked_by_me?"user_unblock":"user_block";"cancelButton"===t.id?P.ga.trackEvent(o,P.CONST.GA_ACTION_CLICK_CANCEL):"submitButton"===t.id&&P.ga.trackEvent(o,P.CONST.GA_ACTION_CLICK_SUBMIT)}},onSubmitValidated:function(e){if(!e.errors[0]){var t={user_id:this.options.user_id,blocked_by_me:this.options.blocked_by_me};this.blockUser(t,this.getChildById("submitButton"))}},onUserBlockSuccess:function(){var e={name:"ConfirmDialog",options:{template:"block_unblock_user_success",name:this.options.full_name,action:"blocked"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e,{can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CONFIRM,this.onBlockConfirm)}.bind(this))},onBlockConfirm:function(){P.modalManager.get().removeAllModals();var e=P.url.getCurrentUrl().split("/")||[];e[1]&&e[1]===this.options.username&&this.navigate("/")},blockUser:function(e,t){t.showLoading();var o={blocked_user_id:e.user_id},n=P.resourceFactory.instance.create("UserBlockResource",o),a=e.blocked_by_me?"user_unblock":"user_block";(e.blocked_by_me?n.callDelete():n.callCreate()).then(function(){P.ga.trackEvent(a,P.CONST.GA_ACTION_SUCCESS),P.pubSub.instance.publish(e.user_id,P.CONST.PUBSUB_TOPIC_USER_BLOCKED),this.options.not_show_confirmation_dialog||this.onUserBlockSuccess()}.bind(this),function(){P.ga.trackEvent(a,P.CONST.GA_ACTION_ERROR)}).fin(function(){t.hideLoading()})},onCancelButtonClick:function(){this.destroy()}}),P.modules.UserBlock.prototype.className="UserBlock",goog.provide("P.modules.UserBoardFollow"),goog.require("P.Module"),goog.require("P.timer");var ht=7e3;P.modules.UserBoardFollow=P.Module.extend({CssClassName:{FOLLOWED:"followed",HIDDEN:"hidden"},onContentReady:function(){var e=this.getChildById("followButton");e&&this.listen(e,"toggleFollow",function(t){e.getState()?(this.$(".UserFollowPinsPreview").addClass(this.CssClassName.FOLLOWED),this.$(".userBoardFollowButton").addClass(this.CssClassName.HIDDEN),this.$(".postUnFollow").addClass(this.CssClassName.HIDDEN),this.$(".postFollow").removeClass(this.CssClassName.HIDDEN),P.timer.setTimeout(function(){window.close()},ht)):this.$(".postUnFollow").removeClass(this.CssClassName.HIDDEN)});var t=this.$(".userBoardFakeHeader"),o=this.getChildByModuleName("UserFollowPinsPreview");if(t.length&&o){var n=t.height();o.setHeight(P.Viewport.height-n)}}}),P.modules.UserBoardFollow.prototype.className="UserBoardFollow",goog.provide("P.modules.UserBoardInvites"),goog.require("P.Module"),P.modules.UserBoardInvites=P.Module.extend({onContentReady:function(){this.destroyIfEmpty(),this.pagedGrid=this.getChildById("pagedGrid"),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged)},onChildRemoved:function(){this.destroyIfEmpty()},onChildContentChanged:function(){this.pagedGrid.hasItems()||this.pagedGrid.destroy()},isEmpty:function(){return!this.children.length},showLoading:function(){}}),P.modules.UserBoardInvites.prototype.className="UserBoardInvites",goog.provide("P.modules.UserChangePassword"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.ga"),goog.require("P.i18n"),goog.require("P.validator"),goog.require("P.resourceFactory");var gt="changePasswordSubmit";P.modules.UserChangePassword=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var e={message:" "},t={"new":[P.validator.Required(e),P.validator.ContainsOnlyAscii({message:P.i18n.commonStrings.asciiPasswordError}),P.validator.Password({samePasswordStr:P.i18n._("Oops! Your password shouldn't match your username.")})],new_confirm:[P.validator.Required(e),P.validator.EqualTo({targetFieldName:"new",message:P.i18n._("Passwords don't match")})]};this.extraData.has_password&&(t.old=[P.validator.Required(e)]),this.form=new P.Form(this.$form,t),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var o=this.getChildById("forgotPasswordButton");o&&this.listen(o,P.CONST.EVENT_BUTTON_CLICK,this.onForgotPasswordClick)},onSubmitValidated:function(e){var t=this.getChildById(gt);e.errors[0]||(t.showLoading(!0),this.changePassword())},changePassword:function(){this.hideLoading(!0);var e=function(){if(this.isInModal()){var e={name:"ConfirmDialog",options:{template:"change_password_success"}},t=function(){this.triggerEvent("success",this),this.destroy(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD,this.extraData.render_social_networks)}.bind(this);P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,t)}.bind(this))}else this.navigate("/")}.bind(this),t=$("form",this.$el),o={new_password:t.find("[name=new]").val(),new_password_confirm:t.find("[name=new_confirm]").val()};this.extraData.has_password&&(o.old_password=t.find("[name=old]").val());var n=P.resourceFactory.instance.create("UserPasswordResource",o);n.callUpdate().then(e).fin(function(){var e=this.getChildById(gt);e.hideLoading()}.bind(this))},onForgotPasswordClick:function(e){P.ga.trackEvent("forgot_password",P.CONST.GA_ACTION_CLICK),this.showLoading();var t=P.resourceFactory.instance.create("UserResetPasswordResource",{username_or_email:P.user.instance.attributes.username}),o=function(e){P.ga.trackEvent("forgot_password",P.CONST.GA_ACTION_SUCCESS);var t={name:"ConfirmDialog",options:{template:"change_password"}};P.moduleFactory.load(t).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.destroy)}.bind(this))}.bind(this),n=function(){this.hideLoading()}.bind(this),a=function(){P.ga.trackEvent("forgot_password",P.CONST.GA_ACTION_ERROR)};t.callCreate({showError:!1}).then(o,a).fin(n)}}),P.modules.UserChangePassword.prototype.className="UserChangePassword",goog.provide("P.modules.UserContact"),goog.require("P.Module"),P.modules.UserContact=P.Module.extend({events:{"click .dismiss":"onDismissClick","click .contactWrapper":"onAction"},CssClassName:{CONTACT_CONFIRMED:"contactConfirmed"},onDismissClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},getUserId:function(){return this.user.hash_id},onContentReady:function(){this.user=this.options.contact_info},onInviteSuccess:function(e){e&&(this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0),this.$el.addClass(this.CssClassName.CONTACT_CONFIRMED))},onAction:function(){return"facebook"===this.user.network?P.Invite.userInviteFacebook(this.user.id,this.onInviteSuccess.bind(this)):"email"===this.user.id_type&&P.Invite.userInviteEmail(this.user.id,this.onInviteSuccess.bind(this)),!1}}),P.modules.UserContact.prototype.className="UserContact",goog.provide("P.modules.UserEdit"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.validator"),goog.require("P.resourceFactory"),P.modules.UserEdit=P.Module.extend({CssClassName:{RESTRICT_WIDTH:"restrictWidth"},onContentReady:function(){var e={first_name:[P.validator.Required(),P.validator.Length({min:P.CONST.MIN_CHARS_FOR_USER_FIRST_NAME,should_trim:!0})],last_name:[P.validator.Required(),P.validator.Length({min:P.CONST.MIN_CHARS_FOR_USER_LAST_NAME,should_trim:!0})],username:[P.validator.Required()],about:[P.validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})],impressum_url:[P.validator.URL()],website_url:[P.validator.URL()]};this.data.is_partner&&(e.business_name=[P.validator.Required()]),this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),e),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var t={};t[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onImageUploaded,this.pubsubSubscribe(this.options.user_id,t)},onImageUploaded:function(e,t,o){if(o&&o.data&&o.data.profile_image_url){var n=this.$(".profileImage");n.attr("src",o.data.profile_image_url),n.on("load",function(){n.toggleClass(this.CssClassName.RESTRICT_WIDTH,n.height()>n.width())}.bind(this))}},onSubmitValidated:function(e){e.errors[0]||this.saveProfile()},getFormData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},getSaveResource:function(e){return P.resourceFactory.instance.create("UserSettingsResource",e)},saveProfile:function(){var e=this.getFormData(),t=this.getChildById("submitButton"),o=this.extraData.currentUsername,n=e.username&&o!==e.username;t.showLoading(),this.getSaveResource(e).callUpdate().then(function(t){var o=this.isInModal()&&!n;if(o)P.pubSub.instance.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),this.destroy();else{var a="/"+e.username+"/";this.navigate(a)}}.bind(this)).fin(function(){t.hideLoading()})}}),P.modules.UserEdit.prototype.className="UserEdit",goog.provide("P.modules.UserEditEmail"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.i18n"),goog.require("P.validator"),goog.require("P.resourceFactory"),P.modules.UserEditEmail=P.Module.extend({onContentReady:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{email:[P.validator.Required()]}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(e){e.errors[0]||this.updateEmail()},updateEmail:function(){var e={},t=this.form.getValue("email");this.data.email.trim()!==t.trim()?e.email=t:e.email_bounced=!1;var o=P.resourceFactory.instance.create("UserSettingsResource",e);o.callUpdate().then(function(e){var t=e.resource_response.data;if(this.isInModal()){var o;o=t.email_changing_to?P.i18n._("Thanks! Your email update is pending. You should receive a confirmation email soon."):P.i18n._("Thanks! Your email has been updated. You should receive a confirmation email soon."),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_NAG_UPDATED,o),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_MESSAGE_USER_EMAIL_UPDATED,{}),this.destroy()}}.bind(this))}}),P.modules.UserEditEmail.prototype.className="UserEditEmail",goog.provide("P.modules.UserEditVerifyWebsite"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.resourceFactory"),P.modules.UserEditVerifyWebsite=P.Module.extend({events:{'keyup input[name="website_url"]':"onInput",'input input[name="website_url"]':"onInput"},CssClassName:{HIDDEN:"hidden"},onContentReady:function(){this.originalWebsite=this.data&&this.data.website_url?this.data.website_url:"";var e={};e[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e);var t=this.getChildById("verifyWebsite");this.listen(t,P.CONST.EVENT_BUTTON_CLICK,this.onClick)},onUserUpdated:function(){this.render()},onInput:function(e){var t=$(e.target).val(),o=this.getChildById("verifyWebsite"),n=this.options.domain_verified&&t===this.originalWebsite;this.$(".verifiedDomainContainer").toggleClass(this.CssClassName.HIDDEN,!n),this.$(".verifyButton").toggleClass(this.CssClassName.HIDDEN,n),t?o.enable():o.disable()},showModalForDomain:function(e){this.showLoading();var t={name:"DomainVerify",resource:{name:"DomainVerifyResource",options:{}}};P.moduleFactory.load(t).then(function(e){this.hideLoading();var t={show_api_error:!0};this.showInModal(e,t)}.bind(this))},onClick:function(){var e=this.$('input[name="website_url"]').val();if(e===this.originalWebsite)return void this.showModalForDomain(e);var t=this.getChildById("verifyWebsite");t.showLoading();var o=P.resourceFactory.instance.create("UserSettingsResource",{website_url:e});o.callUpdate().then(function(){P.pubSub.instance.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),this.showModalForDomain(e)}.bind(this)).fin(function(){t.hideLoading()})}}),P.modules.UserEditVerifyWebsite.prototype.className="UserEditVerifyWebsite",goog.provide("P.modules.UserEducationGuide"),goog.require("P.modules.Tutorial"),goog.require("P.Module"),P.modules.UserEducationGuide=P.modules.Tutorial.extend({onContentReady:function(){this.manager=P.ExperienceTutorialManager.instance(),this.childListen(P.CONST.EVENT_NEXT,this.manager._next.bind(this.manager)),this.childListen(P.CONST.EVENT_PREVIOUS,this.manager._previous.bind(this.manager)),this.childListen(P.CONST.EVENT_DISMISS,this.manager._dismiss.bind(this.manager))}}),P.modules.UserEducationGuide.prototype.className="UserEducationGuide",goog.provide("P.modules.UserEducationGuideDropdown"),goog.require("P.Module"),P.modules.UserEducationGuideDropdown=P.Module.extend({events:{"click .guide":"onClickGuide"},onContentReady:function(){if(P.experiments.instance.inExperimentGroups("improve_performance_of_click_processing",["enabled","employees_enabled"])){var e={};e[P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE]=this._onTutorialTriggerActive,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e)}else P.pubSub.instance.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,function(e,t,o){o?this.options.guides=[o]:this.options.guides=[],this.render()}.bind(this))},onClickGuide:function(e){if(this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.options.guides&&0!==this.options.guides.length){var t=this.options.guides[0];t.showFlyout=!1,t.display_data.trigger="automatic",P.ExperienceTutorialManager.instance().startTutorial(t)}},_onTutorialTriggerActive:function(e,t,o){return o?this.options.guides=[o]:this.options.guides=[],this.render()}}),P.modules.UserEducationGuideDropdown.prototype.className="UserEducationGuideDropdown",goog.provide("P.modules.UserEducationGuideStep"),goog.require("P.Module"),P.modules.UserEducationGuideStep=P.Module.extend({}),P.modules.UserEducationGuideStep.prototype.className="UserEducationGuideStep",goog.provide("P.modules.UserEducationGuideStepBase"),goog.require("P.modules.StepBase"),goog.require("P.CONST"),goog.require("P.moduleFactory"),P.modules.UserEducationGuideStepBase=P.modules.StepBase.extend({CssClassName:_.extend(P.modules.StepBase.prototype.CssClassName,{HIDE_CARD:"hideCard"}),onContentReady:function(){var e=this.options.step_type,t=e===P.CONST.StepTypes.TOOLTIP,o=t?"UserEducationGuideStep":"UserEducationGuideStacked",n=this.getCardModuleLoadOptions(o),a=this.getCardPositionModuleLoadOptions(o),r=t?a:n;P.moduleFactory.load(r).then(function(e){this.guideModule=e,this.appendChild(e),e.render()}.bind(this)),this.options.anchor&&(this.loadPulser(),this.childListen(P.CONST.EVENT_PULSER_CLICKED,function(){this.goToNextStep(),$(this.options.anchor).click()}),$(this.options.anchor).on("click.userEducationGuideAnchor",function(){this.goToNextStep()}.bind(this)))},goToNextStep:function(){$(this.options.anchor).off("click.userEducationGuideAnchor"),this.guideModule.$el.find(".guideStepContent").addClass(this.CssClassName.HIDE_CARD),window.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this),200)},onShow:function(e){this.isContextualExperience=!0,e&&e()},getCardModuleLoadOptions:function(e){var t={name:e,options:{body_html:this.options.body_html,stacked_cards:this.options.stacked_cards,step_type:this.options.step_type,anchor:this.options.anchor}};return t},getCardPositionModuleLoadOptions:function(e){var t={name:"UserEducationGuideTooltip",options:{module:this.getCardModuleLoadOptions(e),anchor:this.options.anchor,position_mode:"ANCHORED",position_point:this.options.position_point,hide_caret:!0,class_name:"active",fixed:!!this.options.fixed}};return t},loadPulser:function(){var e={name:"Pulser",options:{anchor:this.options.anchor,fixed:!!this.options.fixed}};P.moduleFactory.load(e).then(function(e){this.appendChild(e),e.render()}.bind(this))},getExperienceId:function(){return this.options.experienceID},getPlacementId:function(){return this.options.placementID}}),P.modules.UserEducationGuideStepBase.prototype.className="UserEducationGuideStepBase",goog.provide("P.modules.UserEducationGuideTooltip"),goog.require("P.Module"),goog.require("P.modules.PositionModule"),goog.require("P.moduleFactory"),P.modules.UserEducationGuideTooltip=P.modules.PositionModule.extend({CssClassName:_.extend(P.modules.PositionModule.prototype.CssClassName,{CARET_ON_LEFT:"caretOnLeft",CARET_IN_MIDDLE:"caretInMiddle",CARET_ON_RIGHT:"caretOnRight"}),onContentReady:function(){var e=P.Viewport,t=$(this.options.anchor),o=t.offset().left+t.outerWidth()/2;o>e.width*(2/3)?this.$el.addClass(this.CssClassName.CARET_ON_RIGHT):o<e.width*(1/3)?this.$el.addClass(this.CssClassName.CARET_ON_LEFT):this.$el.addClass(this.CssClassName.CARET_IN_MIDDLE)},render:function(){return new Promise(function(e,t){this.renderContainer();var o=function(){this.contentReady=!0,this.onContentReady(),e()}.bind(this);this.options.module?P.moduleFactory.load(this.options.module).then(function(e){this.insertChild(e,this.getPositionElement()),e.render().then(function(){this.positionModule(),o()}.bind(this))}.bind(this)):o()}.bind(this))}}),P.modules.UserEducationGuideTooltip.prototype.className="UserEducationGuideTooltip",goog.provide("P.modules.UserEducationTriggerCard"),goog.require("P.Module"),P.modules.UserEducationTriggerCard=P.Module.extend({events:{click:"onClick"},onClick:function(){this.triggerEvent(P.CONST.EVENT_TRIGGER_FLYOUT_CLICKED,null,!0)}}),P.modules.UserEducationTriggerCard.prototype.className="UserEducationTriggerCard",goog.provide("P.modules.UserFollowPinsPreview"),goog.require("P.Module"),P.modules.UserFollowPinsPreview=P.Module.extend({onContentReady:function(){if(this.data){this.$el.height(P.Viewport.height);var e=P.CONST.PIN_WIDTH,t=P.CONST.PIN_MARGIN,o=e+t,n=this._calculateNumColumns(e,t);this._pinSlotWrapper=this.$(".pinSlotWrapper"),this._pinSlotWrapper.width(n*o);for(var a=0;n>a;a++)this._pinSlotWrapper.append($('<span class="pinSlot slot"></span>'));this._pinSlots=this._pinSlotWrapper.children();for(var r=0,i=0;i<this.data.length;i++)if(this.data[i].images){var s=document.createElement("IMG");s.src=this.data[i].images["236x"].url,this._pinSlots[r%n].appendChild(s),r+=1}this._positionSlots(e,t)}},setHeight:function(e){this.$el.height(e)},_positionSlots:function(e,t){for(var o=0,n=500,a=e+t,r=0;r<this._pinSlots.length;r++)$(this._pinSlots[r]).css("left",o),$(this._pinSlots[r]).transition({top:"30px",duration:n}),o+=a,n+=500},_calculateNumColumns:function(e,t){var o=this.$el.width(),n=e+t;return Math.floor((o+1)/n)}}),P.modules.UserFollowPinsPreview.prototype.className="UserFollowPinsPreview",goog.provide("P.modules.UserInfoBar"),goog.require("P.Module"),P.modules.UserInfoBar=P.Module.extend({}),P.modules.UserInfoBar.prototype.className="UserInfoBar",goog.provide("P.modules.UserNavigateButton"),goog.require("P.modules.NavigateButton"),P.modules.UserNavigateButton=P.modules.NavigateButton.extend({onContentReady:function(){var e=this.data.id;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(e,t)}},onUserUpdated:function(){this.render()}}),P.modules.UserNavigateButton.prototype.className="UserNavigateButton",goog.provide("P.modules.UserNews"),goog.require("P.Module"),goog.require("P.modules.FriendsToFollow"),goog.require("P.moduleFactory"),goog.require("P.genConst"),P.modules.UserNews=P.Module.extend({events:{"click .sendInvite":"showBulkInviteBox","click .launchFlexibleSetup":"launchFlexibleSetup"},onContentReady:function(){this.destroyIfEmpty()},onChildRemoved:function(){this.destroyIfEmpty()||this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},getFriendsToFollowButton:function(){var e=this.getChildByModuleName("FriendsToFollow");return e.getHeaderElement()},showBulkInviteBox:function(){P.moduleFactory.load({name:"MultiInviter"}).then(function(e){this.showInModal(e,{can_dismiss:!0,only_modal:!0})}.bind(this))},launchFlexibleSetup:function(){var e={steps:[{moduleName:"NuxModalInterestPicker",options:{view_type:"brio"}},{moduleName:"NuxModalCompassStep",options:{view_type:"brio_final_loading"}}]};P.ExperienceTutorialManager.instance().startTutorial({type:P.genConst.ExperienceType.NUX,id:"31:10035",display_data:e})}}),P.modules.UserNews.prototype.className="UserNews",goog.provide("P.modules.UserOrdersPage"),goog.require("P.Module"),P.modules.UserOrdersPage=P.Module.extend({}),P.modules.UserOrdersPage.prototype.className="UserOrdersPage",goog.provide("P.modules.UserProfileContent"),goog.require("P.Module"),goog.require("P.experienceUtil"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),goog.require("P.resourceFactory");var _t="boards",ft="pins";P.modules.UserProfileContent=P.Module.extend({onCreated:function(){var e={};e[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onPinAdded,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},addTutorials:function(){if(this.options.tab===_t){var e=P.genConst.Placement.WEB_USER_PROFILE_TAKEOVER;P.experienceUtil.launchPlacedExperience(e,{user_id:this.data.id})}},onContentReady:function(){if(!this.data.board_count&&!this.data.secret_board_count){var e={};e[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onFirstBoardCreated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)}_.defer(this.addTutorials.bind(this)),this.followingContentGrid=this.getChildByModuleName("UserProfileFollowingGrid"),this.childListen(P.CONST.EVENT_REFRESH_FOLLOWING_GRID,this.onRefreshFollowingGrid);var t=this.data;switch(this.options.tab){case"boards":t.board_count||this._log_empty_state_view(P.genConst.ViewType.EMPTY_STATE,P.genConst.ViewParameterType.USER_BOARDS);break;case"pins":t.pin_count||this._log_empty_state_view(P.genConst.ViewType.EMPTY_STATE,P.genConst.ViewParameterType.USER_PINS);break;case"likes":t.like_count||this._log_empty_state_view(P.genConst.ViewType.EMPTY_STATE,P.genConst.ViewParameterType.USER_LIKES);break;case"followers":t.follower_count||this._log_empty_state_view(P.genConst.ViewType.EMPTY_STATE,P.genConst.ViewParameterType.USER_FOLLOWERS);break;case"following":t.following_count||this._log_empty_state_view(P.genConst.ViewType.EMPTY_STATE,P.genConst.ViewParameterType.USER_FOLLOWING)}},_log_empty_state_view:function(e,t){var o={event_type:P.genConst.EventType.VIEW,view_type:e,view_parameter:t},n=P.context.instanceEvent.fromPlainObject(o);P.context.instanceLogger.getInstance().addEvent(n)},onRefreshFollowingGrid:function(e){var t=this._getFollowingGridOptions(e.data.following_tab);t.resource&&(this.followingContentGrid.resource=P.resourceFactory.instance.create(t.resource,{username:e.target.options.username}),_.extend(this.followingContentGrid.options,_.omit(t,"resource")),this.followingContentGrid.render())},_getFollowingGridOptions:function(e){var t={};switch(e){case"navFollowedInterests":_.extend(t,{resource:"InterestFollowingResource",item_options:{view_type:"followingView"},empty_content_message:P.i18n._("What are you interested in? Follow any topic to see what ideas people are saving on Pinterest."),nav_url:"/categories/",nav_button_text:P.i18n._("Explore topics")});break;case"navFollowedPinners":_.extend(t,{resource:"UserFollowingResource",empty_content_message:P.i18n._("Follow people who share your interests to discover more Pins you might like."),nav_url:"/find_friends/",nav_button_text:P.i18n._("Find users to follow")});break;case"navFollowedBoards":_.extend(t,{resource:"BoardFollowingResource",empty_content_message:P.i18n._("Follow interesting boards to get the latest Pins delivered right to your home feed."),nav_url:"/search/boards",nav_button_text:P.i18n._("Find boards to follow")})}return t},onFirstBoardCreated:function(e,t,o){this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED),this.render()},onPinAdded:function(e,t,o){if(this.options.tab===ft&&o.board.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this.extraData.isOwnProfile){var n=this.getChildById("userPins");n?n.prependNewItems(1):this.render()}}}),P.modules.UserProfileContent.prototype.className="UserProfileContent",goog.provide("P.modules.UserProfileFollow"),goog.require("P.Module"),goog.require("P.timer");var bt=7e3,kt=25;P.modules.UserProfileFollow=P.Module.extend({CssClassName:{FOLLOWED:"followed",HIDDEN:"hidden"},onContentReady:function(){this.followButton=this.getChildById("followButton"),this.followButton&&this.listen(this.followButton,"toggleFollow",this._onToggleFollowButton),this._setHeightOfFollowPinsModule()},_setHeightOfFollowPinsModule:function(){var e=this.$el.find(".userProfileFakeHeader"),t=this.getChildByModuleName("UserFollowPinsPreview");if(e.length&&t){var o=e.height();t.setHeight(P.Viewport.height-o)}},_onToggleFollowButton:function(e){this.followButton.getState()?(this._addFollowedAnimation(),this.$(".userProfileFollowButton").addClass(this.CssClassName.HIDDEN),this.$(".postUnFollow").addClass(this.CssClassName.HIDDEN),this.$(".postFollow").removeClass(this.CssClassName.HIDDEN),P.timer.setTimeout(function(){window.close()},bt)):this.$(".postUnFollow").removeClass(this.CssClassName.HIDDEN)},_addFollowedAnimation:function(){var e=this.data&&this.data.pin_count||0;e>=kt&&this.$(".UserFollowPinsPreview").addClass(this.CssClassName.FOLLOWED)}}),P.modules.UserProfileFollow.prototype.className="UserProfileFollow",goog.provide("P.modules.UserProfileFollowingGrid"),goog.require("P.Module"),P.modules.UserProfileFollowingGrid=P.Module.extend({}),P.modules.UserProfileFollowingGrid.prototype.className="UserProfileFollowingGrid",goog.provide("P.modules.UserProfileHeader"),goog.require("P.Module"),P.modules.UserProfileHeader=P.Module.extend({CssClassName:{ACTIVE:"active",SHADOW:"shadow",FIXED:"fixed"},onCreated:function(){this._resized=!1,this._canSeeFixedHeader=!1},_resizeTextIfReady:function(){!this._resized&&this.inDom&&this.contentReady&&this.$(".userProfileHeaderBio").overflowingText()},onContentReady:function(){if(this._resizeTextIfReady(),this.options.user_id){var e={};e[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(this.options.user_id,e)}this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll)},onAddedToDom:function(){this._resizeTextIfReady()},onUserUpdated:function(){this.render()},onScroll:function(){var e=this.getScrollableElement().scrollTop(),t=this.$el.offset().top,o=63;if(!(0>e)){var n=e>t;n^this._canSeeFixedHeader&&(this.$(".fixedHeaderNameAndImage").transition({y:this._canSeeFixedHeader?"0":"50px",duration:200}),this.$(".fixedHeader").toggleClass(this.CssClassName.SHADOW),this._canSeeFixedHeader=n);var a=e>t-o;if(this.$(".header").toggleClass(this.CssClassName.FIXED,a),P.context.instance.is_mobile_agent){var r=this.$(".userProfileMenu");r.hasClass(this.CssClassName.ACTIVE)&&r.trigger("click")}}}}),P.modules.UserProfileHeader.prototype.className="UserProfileHeader",goog.provide("P.modules.UserProfileImageUploader"),
goog.require("P.Module"),goog.require("P.ga"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.UserProfileImageUploader=P.Module.extend({onContentReady:function(){var e=this.getChildById("uploader");this.listen(e,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(e,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError)},onUploadSuccess:function(e){P.ga.trackEvent("user_profile_image_upload",P.CONST.GA_ACTION_SUCCESS),this.imageUrl=e.data.image_url,this.updateUserProfileImage()},onUploadError:function(e){P.ga.trackEvent("user_profile_image_upload",P.CONST.GA_ACTION_ERROR);var t=e.data;P.errorUtil.showError(t)},getUserSettingsResource:function(){return P.resourceFactory.instance.create("UserSettingsResource",{profile_image_url:this.imageUrl})},updateUserProfileImage:function(){this.showLoading();var e=this.getUserSettingsResource();e.callUpdate().then(function(e){this.onUpdateSuccess(e),this.hideLoading()}.bind(this))},onUpdateSuccess:function(e){var t=e.resource_response;t.data.profile_image_url=this.imageUrl,P.pubSub.instance.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED,t),this.destroy()}}),P.modules.UserProfileImageUploader.prototype.className="UserProfileImageUploader",goog.provide("P.modules.UserRegister"),goog.require("P.Form"),goog.require("P.i18n"),goog.require("P.modules.LoginBase"),goog.require("P.util"),goog.require("P.url"),goog.require("P.validator"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),goog.require("P.resourceFactory"),P.modules.UserRegister=P.modules.LoginBase.extend({events:{"keyup .standardForm":"handleKeydown","keyup .userCustomGender":"handleEnterCustomGender","click .continueButton":"submitFirstStep","click .signup":"submitSecondStep","click .toggleStep > span":"toggleMultiStep","click .saveGender":"setCustomGender","click .removeCustomGender":"removeCustomGender","click .infoButton":"toggleGenderInfo","mouseleave .genderInfo":"hideGenderInfo"},CssClassName:_.extend(P.modules.LoginBase.prototype.CssClassName,{ACTIVE:"active",HIDDEN:"hidden"}),onContentReady:function(){if(P.user.instance.isAuthenticated())return void this.redirect();if(Cookie.get(P.CONST.COOKIE_REGISTER_RESTRICT))return P.util.changeWindowLocation("/restricted/age/",!1);this.setupForm(),this.logContainerViewType(),this.$emailInput=this.$("input[name='email']"),this.$passwordInput=this.$("input[name='password']"),this.$userFullNameInput=this.$("#userFullName"),this.$customGenderInput=this.$(".userCustomGender"),this.$genderReadout=this.$(".genderReadout"),this.$genderReadoutText=this.$(".genderReadout span"),this.$genderHiddenField=this.$("#custom_gender"),this.$genderSelectFields=this.$(".genderFormItem .fieldset"),this.$genderRadioButtons=this.$('input[name="gender"]'),this.$genderSaveButton=this.$(".saveGender"),this.$genderInfoBlurb=this.$(".genderInfo"),this.$userAgeInput=this.$("#userAge"),this.$userFullNameField=this.$("input[name='full_name']"),this.$userAgeField=this.$("input[name='age']"),this.$finalSignupButton=this.$(".signup"),this.$confirmedEmail=this.$(".confirmedEmail"),this.firstStepComplete=!1;var e=P.conversationsManager.instance.getUnauthUserEmail();!this.$emailInput.val()&&e&&this.$emailInput.val(e),this.options.register=!0},setCustomGender:function(){var e=this.$customGenderInput.val();this.$genderReadoutText.text(e),this.$genderHiddenField.val(e),this.$genderSelectFields.fadeOut(),this.$genderSelectFields.addClass(this.CssClassName.HIDDEN),this.$genderRadioButtons.prop("checked",!1),this.$genderReadout.fadeIn(),this.$genderReadout.removeClass(this.CssClassName.HIDDEN)},removeCustomGender:function(){this.$customGenderInput.val(""),this.$genderReadoutText.text(""),this.$genderHiddenField.val(""),this.$genderSelectFields.fadeIn(),this.$genderSelectFields.removeClass(this.CssClassName.HIDDEN),this.$genderReadout.fadeOut(),this.$genderReadout.addClass(this.CssClassName.HIDDEN)},logContainerViewType:function(){if(this.options.container){P.user.instance.setLoginContainer(this.options.container||"unknown");var e={home_page:P.genConst.EventType.HOME_PAGE_SIGNUP_VIEW,plain_signup_modal:P.genConst.EventType.PLAIN_MODAL_SIGNUP_VIEW,closeup_signup_modal:P.genConst.EventType.CLOSEUP_MODAL_SIGNUP_VIEW,widescreen_signup_modal:P.genConst.EventType.WIDESCREEN_MODAL_SIGNUP_VIEW,pinit_button_landing:P.genConst.EventType.PIN_IT_BUTTON_LANDING_SIGNUP_VIEW},t=e[this.options.container];if(t){var o=P.context.instanceEvent.fromEventType(t);P.context.instanceLogger.getInstance().addEvent(o)}}},setupForm:function(){var e={first_name:[P.validator.Required()],email:[P.validator.Required({message:P.i18n._("<b>You missed a spot!</b> Don't forget to add your email.")}),P.validator.Email({message:P.i18n._("<b>Hmm...</b>that doesn't look like an email address.")})],age:[P.validator.Age({message:P.i18n._("Please enter a valid number.")})],password:[P.validator.ContainsOnlyAscii({message:P.i18n._("<b>Oh @*&#!</b> No zany characters allowed.")}),P.validator.Password({shortPassStr:P.i18n._("<b>Your password is too short!</b> You need 6+ characters."),badPassStyle:P.i18n._("Your password does not have the proper style."),samePasswordStr:P.i18n._("Please make your username and password different."),blackPassStr:P.i18n._("Please make a stronger password.")})],full_name:[P.validator.Name({message:P.i18n._("<b>And your name is...?</b>")})]};this.form=new P.Form(this.$("form"),e,{disableAutoValidation:!0}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},toggleGenderInfo:function(){this.$genderInfoBlurb.fadeToggle()},hideGenderInfo:function(){this.$genderInfoBlurb.fadeOut()},handleKeydown:function(e){e.stopPropagation(),e.keyCode===P.util.keyCode.ENTER&&(this.firstStepComplete?this.$finalSignupButton.click():this.$(".continueButton").click()),this.form.disableAutoValidation=!1},handleEnterCustomGender:function(e){e.stopPropagation(),e.keyCode===P.util.keyCode.ENTER&&this.$genderSaveButton.click(),this.form.disableAutoValidation=!1},validateInput:function(e){return new Promise(function(t,o){this.form.validateField(e,function(e){0!==e.errors.length?o(e.errors):t()})}.bind(this))},validateEmailAvailable:function(){var e=P.resourceFactory.instance.create("EmailExistsResource",{email:this.$emailInput.val()});e.callGet({showError:!1}).then(function(e){e.resource_response.data===!1?this.validateComplete({message:null,type:"emailError"}):this.login({username_or_email:this.form.getValue("email"),password:this.form.getValue("password")}).then(this.onLoginComplete.bind(this),function(e){this.onLoginError(e)}.bind(this))}.bind(this),function(){var e=P.i18n._("Hmm... that doesn't look like an email address.");this.validateComplete({message:e,type:"emailError"})}.bind(this))},submitFirstStep:function(){return P.util.trackRegisterAction("multi_step_step_1_submit"),this.form.disableAutoValidation=!1,this.options.unified_auth?this.unifiedAuthFirstStep():this.options.is_login_form?this.attemptLogin():void this.validateFirstStep()},validateFirstStep:function(){return this.validateInput(this.$emailInput).then(function(){this.validateInput(this.$passwordInput).then(function(){this.validateEmailAvailable()}.bind(this),function(e){this.validateComplete({message:e[0],type:"passwordError"})}.bind(this))}.bind(this),function(e){this.validateComplete({message:e[0],type:"emailError"})}.bind(this))},submitSecondStep:function(){return P.util.trackRegisterAction("multi_step_step_2_submit"),this.firstStepComplete?this.options.unified_auth?this.unifiedAuthSecondStep():void this.validateSecondStep():this.submitFirstStep()},validateSecondStep:function(){return this.validateInput(this.$userFullNameField).then(function(){""===this.$userAgeInput.val().trim()?this.secondStepComplete():this.validateInput(this.$userAgeField).then(function(){this.secondStepComplete()}.bind(this),function(e){this.validateComplete({message:e[0],type:"ageError"})}.bind(this))}.bind(this),function(e){this.validateComplete({message:e[0],type:"nameError"})}.bind(this))},secondStepComplete:function(){this.$finalSignupButton.submit()},validateComplete:function(e){if(!P.url.getQueryStringParams().email){var t,o;"emailError"===e.type||"passwordError"===e.type||"deactivatedUser"===e.type?(t=this.$("#firstStepTooltip"),o=".step1"):("nameError"===e.type||"ageError"===e.type)&&(t=this.$("#secondStepTooltip"),o=".step2"),"passwordError"===e.type&&this.options.unified_auth&&(t=this.$("#secondStepTooltip"),o=".step2"),e.message?(this.options.is_unauth_logout&&t.addClass(".leftToBox"),this.$(".errorIcon").hide(),this.$("input.hasError").siblings("em").fadeIn(),t.addClass(e.type),t.html(e.message).fadeIn(),this.$(".standardForm").height(this.$(o).height())):("emailError"===e.type||"passwordError"===e.type)&&(P.util.trackRegisterAction("multi_step_step_1_complete"),this.$confirmedEmail.text(this.$emailInput.val()),this.toggleMultiStep(),this.options.unified_auth?this.$passwordInput.focus():this.extraData.disableAutofocus||this.$("input[name='full_name']").focus(),this.extraData.show_personalize_field&&(this.$(".personalizeInput").prop("checked",!0),this.$(".personalizeField").removeClass(this.CssClassName.HIDDEN)))}},toggleMultiStep:function(){if(this.firstStepComplete=!this.firstStepComplete,this.firstStepComplete){var e=P.experiments.instance.v2GetGroup("custom_gender_at_signup_click");null!==e&&P.experiments.instance.v2ActivateExperiment("custom_gender_at_signup_click")}this.$el.toggleClass("secondStep"),this.triggerEvent("toggleMultiStep",{step1:!this.firstStepComplete},!0)},onLoginError:function(e){if(e.api_error_code===P.CONST.LOGIN_VOLUNTARILY_DEACTIVATED_USER)this.validateComplete({message:e.message,type:"deactivatedUser"});else{var t=P.i18n._('<b>Deja vu!</b> That email\'s taken. <a href="{{ link }}">Forgot your password?</a>'),o=P.string.format(t,{link:"/password/reset/"});this.validateComplete({message:o,type:"emailError"})}},onLoginComplete:function(){P.util.trackRegisterAction("multi_step_login"),this.redirect(P.storage.sessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW))},onSubmitValidated:function(e){if(!e.errors[0]){if(this.extraData&&this.$userFullNameInput&&""===this.$userFullNameInput.val().trim())return;var t=this.getChildById("submitButton");t.showLoading();var o=this.getFormData();this.options.container&&(o.container=this.options.container),P.util.trackRegisterAction("multi_step_step_2_complete"),P.UserRegistration.register(this.options.network,o).then(this.redirect.bind(this,!0),function(e){t.hideLoading(),e.api_error_code===P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT&&P.util.changeWindowLocation("/restricted/age/",!1)})}},redirect:function(e){if(e)this.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0);else{var t=this.options.next||"/";if(this.options.auto_follow)t=P.url.appendQueryString(t,{auto_follow:!0});else{var o=P.url.getQueryStringParams();o&&(t=P.url.appendQueryString(t,o))}P.util.navigateAfterLoginStatusChange(t)}},getFormData:function(){var e=this.$("form").serializeArray(),t={},o="";if(_.each(e,function(e){"full_name"===e.name?o=e.value.trim():t[e.name]="on"===e.value?!0:e.value}),o){var n=o.split(" ");""===n[0]&&n.shift(),n.length>0&&(t.first_name=n[0]||""),n.length>1&&(t.last_name=n[1]||"")}return t},attemptLogin:function(){var e=this.validateComplete.bind(this);return this.validateInput(this.$emailInput).then(function(){this.validateInput(this.$passwordInput).then(function(){this.login({username_or_email:this.form.getValue("email"),password:this.form.getValue("password")}).then(this.onLoginComplete.bind(this),function(t){e(78===t.api_error_code?{message:t.message,type:"passwordError"}:{message:t.message,type:"emailError"})})}.bind(this),function(t){e({message:t[0],type:"passwordError"})})}.bind(this),function(t){e({message:t[0],type:"emailError"})})},unifiedAuthFirstStep:function(){this.$el.removeClass("unifiedLogin"),this.validateInput(this.$emailInput).then(function(){this.unifiedAuthTestEmail()}.bind(this),function(e){this.validateComplete({message:e[0],type:"emailError"})}.bind(this))},unifiedAuthSecondStep:function(){this.$("input.hasError").siblings("em").fadeOut(),this.validateInput(this.$passwordInput).then(function(){this.$el.hasClass("unifiedLogin")?this.unifiedAuthlogin():this.validateInput(this.$userFullNameField).then(function(){""===this.$userAgeInput.val().trim()?this.$finalSignupButton.submit():this.validateInput(this.$userAgeField).then(function(){this.$finalSignupButton.submit()}.bind(this),function(e){this.validateComplete({message:e[0],type:"ageError"})}.bind(this))}.bind(this),function(e){this.validateComplete({message:e[0],type:"nameError"})}.bind(this))}.bind(this),function(e){this.validateComplete({message:e[0],type:"passwordError"})}.bind(this))},unifiedAuthTestEmail:function(){var e=P.resourceFactory.instance.create("EmailExistsResource",{email:this.$emailInput.val()});e.callGet({showError:!1}).then(function(e){e.resource_response.data&&this.unifiedAuthAttemptLogin(),this.validateComplete({message:null,type:"emailError"})}.bind(this))},unifiedAuthAttemptLogin:function(){this.form.getValue("password")&&this.unifiedAuthlogin(),this.$el.addClass("unifiedLogin"),this.$passwordInput.attr("placeholder",P.i18n._("Password"))},unifiedAuthlogin:function(){var e={username_or_email:this.form.getValue("email"),password:this.form.getValue("password")};this.login(e).then(this.onLoginComplete.bind(this),function(){this.$passwordInput.addClass("hasError");var e=P.i18n._("Forgot your password?"),t='<a href="{{ link }}">'+e+"</a>",o=P.string.format(t,{link:"/password/reset/"});this.validateComplete({message:o,type:"passwordError"})}.bind(this))}}),P.modules.UserRegister.prototype.className="UserRegister",goog.provide("P.modules.UserRegisterPage"),goog.require("P.Module"),P.modules.UserRegisterPage=P.Module.extend({onAddedToDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)}}),P.modules.UserRegisterPage.prototype.className="UserRegisterPage",goog.provide("P.modules.UserRegisterRestricted"),goog.require("P.Module"),P.modules.UserRegisterRestricted=P.Module.extend({onAddedToDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)}}),P.modules.UserRegisterRestricted.prototype.className="UserRegisterRestricted",goog.provide("P.modules.UserSearchResult"),goog.require("P.Module"),goog.require("P.resourceFactory"),P.modules.UserSearchResult=P.Module.extend({events:{"click .sendButton":"resetPassword"},resetPassword:function(){var e=this.id,t={username_or_email:e},o=P.resourceFactory.instance.create("UserResetPasswordResource",t);o.callCreate({showError:!0}).then(function(){var t={username:e,obfuscatedEmail:this.$(".userEmail").text()};P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEND_PASSWORD_RESET_EMAIL,t)}.bind(this))}}),P.modules.UserSearchResult.prototype.className="UserSearchResult",goog.provide("P.modules.UserSecuritySettings"),goog.require("P.Module"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.resourceFactory"),P.modules.UserSecuritySettings=P.Module.extend({events:{"click .revokeButton":"revokeSession","click .showHideButton":"showSessions"},CssClassName:{HIDDEN:"hidden"},onCreated:function(){this.options.state_activeSessionHidden=!0},updateDom:function(){var e=this.getChildById("showHideButton"),t=this.$(".activeSessions");t.toggleClass(this.CssClassName.HIDDEN,this.options.state_activeSessionHidden),this.options.state_activeSessionHidden?e.setText(P.i18n._("Show Sessions")):e.setText(P.i18n._("Hide Sessions"))},revokeSession:function(e){var t=$(e.currentTarget),o=t.parent().parent();this.showConfirmation(o)},showSessions:function(e){this.updateOptionsAndDom({state_activeSessionHidden:!this.options.state_activeSessionHidden})},onConfirm:function(e){var t=e.attr("data-sess-id"),o=P.resourceFactory.instance.create("UserSessionStoreResource",{sess_id:t});o.callDelete().then(function(){e.hide()})},showConfirmation:function(e){var t={name:"ConfirmDialog",options:{template:"revoke_session"}};P.moduleFactory.load(t).then(function(t){this.showInModal(t),this.listen(t,P.CONST.EVENT_CONFIRM,function(){this.onConfirm(e)})}.bind(this))}}),P.modules.UserSecuritySettings.prototype.className="UserSecuritySettings",goog.provide("P.modules.UserSettingsPage"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.genConst"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.validator"),goog.require("P.context.instanceEvent"),goog.require("P.resourceFactory");var yt="https://www.google.com/webmasters/tools/removals?pli=1",vt=2,Pt=["company","agency","business","organization","corporate","online","store","magazine","website"];P.modules.UserSettingsPage=P.Module.extend({events:{"click .toc li":"onTOCClick","change input[name=gender]":"onGenderChange"},CssClassName:{HIDDEN:"hidden",TOC_SELECTED:"selected"},onContentReady:function(){this.options.state_hideCustomGenderField=!0,this.options.state_tocSelectedIndex=0;var e={email:[P.validator.Required(),P.validator.Email()],first_name:[P.validator.Required()],username:[P.validator.Required()],about:[P.validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})],website_url:[P.validator.URL()]};this.data.is_partner&&(e.contact_name=[P.validator.Required()],e.business_name=[P.validator.Required()]);var t=this.$(".Checkbox[name=exclude_from_search]");this.listen(t,"change",this.onSearchPrivacyChange),this.$form=this.$("form"),this.form=new P.Form(this.$form,e),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.listen(this.$(".customGender"),"blur",this.onCustomGenderBlur);var o={};o[P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD]=this.onPasswordChanged,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,o),this.negativeSpaceAdded=0,this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll)},onAdded:function(e){o.e(18,function(){o(208),this.$(".formFooter").fixedsticky()}.bind(this))},updateDom:function(){this.$(".toc li").removeClass(this.CssClassName.TOC_SELECTED),this.$(".toc").children().eq(this.options.state_tocSelectedIndex).addClass(this.CssClassName.TOC_SELECTED);var e=this.$(".customGender");e.toggleClass(this.CssClassName.HIDDEN,this.options.state_hideCustomGenderField),this.options.state_hideCustomGenderField&&e.val("")},onGenderChange:function(e){var t=e.target;"unspecified"===t.value&&t.checked?this.updateOptionsAndDom({state_hideCustomGenderField:!1}):this.updateOptionsAndDom({state_hideCustomGenderField:!0})},isBusinessAccountKeyword:function(e){return-1!==Pt.indexOf(e)},onCustomGenderBlur:function(){var e=this.$(".customGender").val().toLowerCase();if(""!==e&&this.isBusinessAccountKeyword(e)){var t=P.i18n._("It looks like you might be using Pinterest as a business. Would you like to switch to a business account and get access to analytics?"),o={name:"ConfirmDialog",options:{button_text:P.i18n._("Switch now"),body_message:t,title:P.i18n._("Switch to a business account?"),template:"generic"}};return P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.onDialogConfirm)}.bind(this))}},onDialogConfirm:function(){this.navigate("/business/convert")},onSearchPrivacyChange:function(e){var t=e.target;if(t.checked){var o={name:"ConfirmDialog",options:{template:"search_privacy",google_search_privacy_url:yt}};P.moduleFactory.load(o).then(function(e){this.showInModal(e);var t={event_type:P.genConst.EventType.VIEW,view_type:P.genConst.ViewType.SETTINGS,view_parameter:P.genConst.ViewParameterType.SETTINGS_SEARCH_PRIVACY},o=P.context.instanceEvent.fromPlainObject(t);P.context.instanceLogger.getInstance().addEvent(o),this.listen(e,P.CONST.EVENT_NAVIGATE,function(e){if(e.data&&e.data.url===yt){var t={};this._logCustomContextEvent(P.genConst.EventType.CLICK,P.genConst.ElementType.SEARCH_PRIVACY_LINK,P.genConst.ComponentType.MODAL_SEARCH_PRIVACY,t)}})}.bind(this))}},onPasswordChanged:function(e,t,o){var n=this.getChildById("userChangePasswordButton");if(n.options.submodule.options.has_password=!0,n.options.text=this.extraData.change_password_text,n.render(),o){var a=this.getChildById("userSocialNetworkSettings");a.render()}},onButtonClick:function(e){var t=e.target,o=t.id;switch(o){case"clearRecentSearches":this.clearRecentSearches(e)}},clearRecentSearches:function(e){var t=e.target;t.disable();var o=P.resourceFactory.instance.create("TypeaheadClearRecentResource");o.callDelete({showError:!1}).fin(function(){t.enable()})},onSubmitValidated:function(e){if(!e.errors[0]){var t=this.getChildById("notifications"),o=[this.save()];return t&&o.push(t.updateResource()),Promise.all(o).then(function(e){var t=e[0];if(t&&!t.resource_response.error){var o=t.resource_response.data;this.data.email!==this.email&&o.email_changing_to?this.showPendingEmailChange():this.navigateToUserProfilePage(this.username)}}.bind(this))}},navigateToUserProfilePage:function(e){var t="/"+e+"/";P.util.changeWindowLocation(t,!1)},save:function(){var e=this.$form.serializeArray(),t={};_.each(e,function(e){t[e.name]="on"===e.value||"off"===e.value?"on"===e.value:e.value}),this.$form.find("input[type=checkbox]").each(function(){var e=$(this);t[e.attr("name")]=e.is(":checked")});var o=this.getChildById("submitButton"),n=P.resourceFactory.instance.create("UserSettingsResource",t);return this.email=t.email,this.username=t.username,o.showLoading(),n.callUpdate().fin(function(){o.hideLoading()})},showPendingEmailChange:function(){var e=P.string.format(P.i18n._("To finish updating your address, look for the confirmation email we sent to {{ current_email }}."),{current_email:this.data.email}),t={name:"ConfirmDialog",options:{button_text:P.i18n._("Ok"),body_message:e,title:P.i18n._("You're almost done!"),template:"generic"}};P.moduleFactory.load(t).then(function(e){this.showInModal(e,{can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CLOSE,this.navigateToUserProfilePage(this.username)),this.listen(e,P.CONST.EVENT_CONFIRM,this.navigateToUserProfilePage(this.username))}.bind(this))},onTOCClick:function(e){var t=$(e.currentTarget).find("a").attr("href"),o=$(t).position().top,n=$(e.currentTarget).index();return this.updateOptionsAndDom({state_tocSelectedIndex:n}),this.tocClicked=!0,P.util.scrollToTop({newScrollOffset:o,duration:800,callback:function(){this.tocClicked=!1}.bind(this)}),e.stopPropagation(),!1},addNegativeSpace:function(){if(0===this.negativeSpaceAdded){var e=this.$(".standardForm");e.height("100%");var t=this.$("#apps").position().top,o=$(document).height()-this.getScrollableElement().height(),n=t-o;if(n>0){var a=e.height();e.height(a+n),this.negativeSpaceAdded=n}}},onScroll:function(){var e=this.getScrollableElement().scrollTop();if(!(0>e)){if(!this.tocClicked){for(var t=null,o=0,n=this.$(".sectionTitle"),a=0;a<n.length;a++){var r=n[a],i=$(r).position().top;e>=i-vt&&(!t||i>o)&&(t=r,o=i)}var s=this.$('.toc a[href="#'+$(t).attr("id")+'"]').parent("li").index();this.updateOptionsAndDom({state_tocSelectedIndex:s})}this.addNegativeSpace()}}}),P.modules.UserSettingsPage.prototype.className="UserSettingsPage",goog.provide("P.modules.UserSocialNetworkSettings"),goog.require("P.Module"),goog.require("P.modules.Checkbox"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.errorUtil"),goog.require("P.SocialConnect"),P.modules.UserSocialNetworkSettings=P.Module.extend({FB_PUBLISH_ACTIONS_PERMISSION:"publish_actions",onCreated:function(){this.childListen("change",this.onChildChange);var e={};e[P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED]=this.onSocialNetworkUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},disconnectFromSocial:function(e,t,o){this.showLoading(!0);var n={error:function(){e.toggle()},complete:function(){this.hideLoading()}.bind(this)},a=P.SocialNetworkSettingsManager.instance();a.handleConnect(o,t,n)},onChildChange:function(e){var t=e.target,o=t.isChecked&&t.isChecked(),n=null;switch(t.id){case"facebookToggle":if(!(o&&!this.extraData.facebookUrl||!o&&this.extraData.facebookUrl))return;n=P.SocialConnect.FACEBOOK;break;case"twitterToggle":if(!(o&&!this.extraData.twitterUrl||!o&&this.extraData.twitterUrl))return;n=P.SocialConnect.TWITTER;break;case"gplusToggle":if(!(o&&!this.extraData.gplusUrl||!o&&this.extraData.gplusUrl))return;n=P.SocialConnect.GPLUS;break;case"googleToggle":if(!(o&&!this.extraData.connected_to_google||!o&&this.extraData.connected_to_google))return;n=P.SocialConnect.GOOGLE;break;case"yahooToggle":if(!(o&&!this.extraData.connected_to_yahoo||!o&&this.extraData.connected_to_yahoo))return;n=P.SocialConnect.YAHOO;break;case"rakutenToggle":if(!(o&&!this.extraData.connected_to_rakuten||!o&&this.extraData.connected_to_rakuten))return;n=P.SocialConnect.RAKUTEN;break;case"microsoftToggle":if(!(o&&!this.extraData.connected_to_microsoft||!o&&this.extraData.connected_to_microsoft))return;n=P.SocialConnect.MICROSOFT;break;default:return}if(o||this.extraData.has_password)this.disconnectFromSocial(t,o,n);else{var a={name:"UserChangePassword",options:{has_password:!1,render_social_networks:!1}},r=!1;P.moduleFactory.load(a).then(function(e){this.showInModal(e),this.listen(e,"destroyed",function(){r?this.disconnectFromSocial(t,o,n):(P.errorUtil.showError(P.i18n._("A password must be set before unlinking.")),t.toggle())}),this.listen(e,"success",function(){r=!0})}.bind(this))}},onSocialNetworkUpdated:function(){this.render()}}),P.modules.UserSocialNetworkSettings.prototype.className="UserSocialNetworkSettings",goog.provide("P.modules.VerifyWebSiteButton"),goog.require("P.moduleFactory"),goog.require("P.modules.Button"),P.modules.VerifyWebSiteButton=P.modules.Button.extend({onClick:function(e){e.stopPropagation(),this.showLoading();var t={name:"DomainVerify",options:{prepend_main_url:!0},resource:{name:"DomainVerifyResource",options:{}}};P.moduleFactory.load(t).then(function(e){this.hideLoading();var t={show_api_error:!0};this.showInModal(e,t)}.bind(this))}}),P.modules.VerifyWebSiteButton.prototype.className="VerifyWebSiteButton",goog.provide("P.modules.VisualCropSearchButton"),goog.require("P.modules.Button"),P.modules.VisualCropSearchButton=P.modules.Button.extend({onClick:function(e){this.triggerEvent(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_CROP_BUTTON_PRESSED,{commerce:!1},!0)}}),P.modules.VisualCropSearchButton.prototype.className="VisualCropSearchButton",goog.provide("P.modules.VisualSearchPage"),goog.require("P.Module"),P.modules.VisualSearchPage=P.Module.extend({onContentReady:function(){this._fadeOutBoxesIfReady()},onAddedToDom:function(){this._fadeOutBoxesIfReady()},_fadeOutBoxesIfReady:function(){this.inDom&&this.contentReady&&setTimeout(function(){this.$(".visualSearchOverlayInnerWrapper>img").fadeTo(1500,1)}.bind(this),1e3)}}),P.modules.VisualSearchPage.prototype.className="VisualSearchPage",goog.provide("P.modules.VisualSearchPageQueryItem"),goog.require("P.Module"),P.modules.VisualSearchPageQueryItem=P.Module.extend({}),P.modules.VisualSearchPageQueryItem.prototype.className="VisualSearchPageQueryItem",goog.provide("P.modules.VisualSearchSelector"),goog.require("P.Module"),P.modules.VisualSearchSelector=P.Module.extend({events:{"click label":"_onPinTypeLabelClick"},navigateToPinType:function(e){this.navigate("/search/"+e+"/"+this.options.pin_id+"/")},_onPinTypeLabelClick:function(e){var t=$(e.currentTarget),o=t.find("input"),n=o.val();if(n!==this.options.pin_type){var a=o.attr("data-url")||n;return this.navigateToPinType(a),!1}}}),P.modules.VisualSearchSelector.prototype.className="VisualSearchSelector",goog.provide("P.modules.VisuallySimilar"),goog.require("P.Module"),goog.require("P.moduleFactory"),P.modules.VisuallySimilar=P.Module.extend({onCreated:function(){this.showDuplicates=!1,this.fetchVisuallySimilarResults(this.options)},fetchVisuallySimilarResults:function(e){var t="VisualLiveSearchResource";e.keep_duplicates=this.showDuplicates;var o={name:"FlashlightResults",id:"flashlightResults",resource:{name:t,options:e}},n=this.getChildById("flashlightResults");n&&n.fadeOut(function(){n.destroy()}),this.showLoading(),P.moduleFactory.load(o).then(function(e){e.render().then(function(){this.hideLoading(),this.insertChild(e,this.$(".flashlightResultsContainer"))}.bind(this))}.bind(this))}}),P.modules.VisuallySimilar.prototype.className="VisuallySimilar",goog.provide("P.modules.YourWebsiteDropdown"),goog.require("P.Module"),P.modules.YourWebsiteDropdown=P.Module.extend({}),P.modules.YourWebsiteDropdown.prototype.className="YourWebsiteDropdown",goog.provide("P.modules.ActionSuccessToast"),goog.require("P.Module"),goog.require("P.modules.ToastBase"),P.modules.ActionSuccessToast=P.modules.ToastBase.extend({}),P.modules.ActionSuccessToast.prototype.className="ActionSuccessToast",goog.provide("P.modules.AddPin"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.moduleFactory"),goog.require("P.genConst");var wt="upload_button",Tt="url_button",Lt="browser_button";P.modules.AddPin=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),Modernizr.fileinput||this.$(".pinUpload").remove()},onButtonClick:function(e){var t=e.target,o=t.id,n;t.showLoading(),t.$el.blur(),o===wt?n={name:"PinUploader",options:{}}:o===Tt?n={name:"AddPinURL",options:{show_title:!0,pinmarklet_link_element_type:P.genConst.ElementType.ADD_PIN_REP_BOOKMARKLET}}:o===Lt&&(n={name:"BrowserButtonUpsell",options:{extension_installed:!!P.browserExtension.instance.isExtensionInstalled(),suppress:!0}});var a=this.options.default_board_id;a&&(n.options.default_board_id=a),n&&P.moduleFactory.load(n).then(function(e){t.hideLoading(),this.modal?this.modal.setSubmodule(e):this.showInModal(e)}.bind(this))}}),P.modules.AddPin.prototype.className="AddPin",goog.provide("P.modules.AddPinRep"),goog.require("P.modules.ModalTrigger"),P.modules.AddPinRep=P.modules.ModalTrigger.extend({events:{click:"onClick"},onClick:function(e){e.stopPropagation(),e.preventDefault(),P.user.instance.isLimitedLogin()?P.limitedLogin.showLogin(this):this.showModalSubmodule()}}),P.modules.AddPinRep.prototype.className="AddPinRep",goog.provide("P.modules.App"),goog.require("P.modules.AppBase"),goog.require("P.conversationsManager"),goog.require("P.pushNotifications"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.toastsManager"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.errorUtil"),goog.require("P.router"),goog.require("P.resourceFactory"),P.modules.App=P.modules.AppBase.extend({events:{dragenter:"_onDragEnter",dragover:"_eventPreventDefault",dragdrop:"_eventPreventDefault",drop:"_eventPreventDefault",dragleave:"_eventPreventDefault"},CssClassName:_.extend(P.modules.AppBase.prototype.CssClassName,{INVISIBLE:"invisible",NO_SHOW:"doNotShow",SHOW_CLOSEUP:"showingCloseup",SHOW_PLACE_BOARD:"showingPlaceBoard"}),onCreated:function(){P.modules.AppBase.prototype.onCreated.apply(this),this.hasReturnInterstitial=!1,this.childListen(P.CONST.EVENT_CLEAR_HAS_RETURN_INTERSTITIAL,this._onClearHasReturnInterstitial)},onAddedToDom:function(){P.modules.AppBase.prototype.onAddedToDom.apply(this,arguments);var e=this.extraData?this.extraData.deepLinkTracking:null;P.DeepLink.setup(P.context.instance.ios_deep_link,"pinterest://",e,P.context.instance.deep_link_action),this.childListen(P.CONST.EVENT_APPEND_CLONED_PIN,this._onAppendClonedPin)},_onClearHasReturnInterstitial:function(e){this.hasReturnInterstitial=!1},_onAppendClonedPin:function(e){var t=e.data,o=t.getContent();o.appendTo(this.$el),t.clampDescription&&t.clampDescription()},_adjustScrollToTopPositionIfNeeded:function(){
var e=this._getCurrentMainModule();if(e){if("BoardPage"===e.className&&e.isPlaceBoard())return void this.$el.addClass(this.CssClassName.SHOW_PLACE_BOARD);this.$el.removeClass(this.CssClassName.SHOW_PLACE_BOARD);var t="Closeup"===e.className;this.$el.toggleClass(this.CssClassName.SHOW_CLOSEUP,t)}},_scrollMainModuleIfNeeded:function(){var e=this._getCurrentMainModule();e&&e.initScroll()},isContentOnly:function(){return"content_only"===this.options.view_type},returnInterstitialExperiment:function(e){this.hasReturnInterstitial||(this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID?"enabled"===P.experiments.instance.getGroupForExperiment("return_interstitial_android_v2")?(setTimeout(this.showInterstitial.bind(this,"image_v2",e),1500),this.hasReturnInterstitial=!0,this.hideInterstitialHeader()):"enabled2"===P.experiments.instance.getGroupForExperiment("return_interstitial_android_v2")&&(setTimeout(this.showInterstitial.bind(this,"image_v3",e),1500),this.hasReturnInterstitial=!0,this.hideInterstitialHeader()):this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_IOS&&("enabled"===P.experiments.instance.getGroupForExperiment("return_interstitial_iphone_v2")?setTimeout(this.showInterstitial.bind(this,"image_v2",e),3e3):"enabled2"===P.experiments.instance.getGroupForExperiment("return_interstitial_iphone_v2")?setTimeout(this.showInterstitial.bind(this,"image_v3",e),3e3):setTimeout(this.showInterstitial.bind(this,"image"),3e3),this.hasReturnInterstitial=!0,this.hideInterstitialHeader()))},onChildNavigate:function(e){var t=e.data.url,o=P.context.instance.user_agent_can_use_native_app,n=P.user.instance.isAuthenticated(),a;return this._shouldDeepLinkInsteadOfNavigate(n,o,this.userAgentPlatform,t)&&(a=P.router.instance.resolve(t)),a&&a.extraContent?(this.seamlessOverlay=this.getChildByModuleName("Nags").getChildByModuleName("SeamlessOverlay"),this.seamlessOverlay.showOverlay(),void setTimeout(function(){P.util.trackRegisterAction("seamless."+this.appTypeString),P.DeepLink.navigateToDeepLink(this.userAgentPlatform,a.extraContent),this.seamlessOverlay.hideOverlay(),(P.context.instance.is_mobile_agent||P.context.instance.deep_link_action&&P.context.instance.is_tablet_agent)&&this.hideInterstitialHeader(),e.stopPropagation(),n||this.returnInterstitialExperiment("fromSeamless")}.bind(this),3e3)):(P.context.instance.is_mobile_agent&&this.hideInterstitialHeader(),void P.modules.AppBase.prototype.onChildNavigate.apply(this,arguments))},onContentReady:function(){P.modules.AppBase.prototype.onContentReady.apply(this,arguments),this.userAgentPlatform=this.extraData.userAgentPlatform,P.context.instance.is_mobile_agent?this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_IOS?this.appTypeString="iphone":this.userAgentPlatform===P.CONST.USER_AGENT_PLATFORM_ANDROID?this.appTypeString="android":this.appTypeString="mobile_other":this.appTypeString="desktop",this.logTraffic(),this.setupInterstitialAndAppRedirect(),P.context.instance.is_mobile_agent&&(this.CLOSEUP_NAME=null),0===window.location.pathname.indexOf("/conversation/")&&this.openInApp(),P.pushNotifications.request();var e,t=P.conversationsUtil.getConversationFromUrl();if(P.user.instance.isAuthenticated()){var o=this.getChildById("toasts");P.toastsManager.instance.setContainer(o)}if((P.user.instance.isAuthenticated()||t)&&!P.user.instance.isLimitedLogin()&&!this.isContentOnly())if(e=P.conversationsManager.instance,e.setContainer(this.getChildById("activeConversations")),P.user.instance.isAuthenticated()){var n=P.genConst.Placement.WEB_ONLOAD_AUTO_COMPLETE,a=P.genConst.Experience.WEB_MSGS_WELCOME_MESSAGE;P.ExperienceManager.instance.isPlacedExperience(n,a)&&P.ExperienceManager.instance.completePlacedExperience(n,a),e.loadInitialConversations(t),e.listenForConversations()}else e.addConversationForUnauthUser(t);var r={};r[P.CONST.PUBSUB_TOPIC_WINDOW_VISIBILITY_FOCUS]=this.onWindowFocus,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,r),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown),this.childListen(P.CONST.EVENT_HEADER_INTERSTITIAL_DISMISSED,function(){this.$el.removeClass("hasInterstitialHeader")})},onWindowFocus:function(){if(P.user.instance.isAuthenticated()){var e=P.resourceFactory.instance.create("BoardPickerBoardsResource",{filter:"all",field_set_key:"board_picker",allow_stale:!0});P.resourceCache.instance.callGet(e)}},onTypeaheadHidden:function(e){e.data.enable_overlay&&this.$(".mainContainer .typeaheadOverlay").remove()},onTypeaheadShown:function(e){e.data.enable_overlay&&0===this.$(".mainContainer .typeaheadOverlay").length&&this.$(".mainContainer").append('<div class="typeaheadOverlay" />')},logTraffic:function(){if(!Cookie.get(P.CONST.COOKIE_SESSION_FUNNEL_EVENT_LOGGED)){Cookie.set(P.CONST.COOKIE_SESSION_FUNNEL_EVENT_LOGGED,"1",12);var e=document.referrer,t;t=e?e.indexOf("/t.co/")>-1?"twitter":e.indexOf("google.")>-1?"google":e.indexOf("bing.")>-1?"bing":e.indexOf("facebook.")>-1?"facebook":"other":"direct";var o=this._getCurrentMainModule().className,n=P.user.instance.isAuthenticated()?"auth":"unauth";P.util.trackRegisterAction("traffic."+this.appTypeString+"."+t+"."+o+"."+n)}},hideInterstitialHeader:function(){this.$(".AppInterstitial").fadeOut(),this.$el.removeClass("hasInterstitialHeader")},onScroll:function(){var e=this.getScrollableElement().scrollTop();if(!(0>e)){var t=e>1e3;t^this._isShowingOverlay&&(this._isShowingOverlay=t,this.toggleSignupOverlay())}},toggleSignupOverlay:function(){this.$(".Header").toggleClass(this.CssClassName.INVISIBLE),this.$(".BoardHeader").toggleClass(this.CssClassName.INVISIBLE),this.$(".UserProfileHeader").toggleClass(this.CssClassName.INVISIBLE),this.$(".inspiredWallOverlay").toggleClass(this.CssClassName.NO_SHOW)},closeSignupOverlay:function(){this.toggleSignupOverlay()},setupInterstitialAndAppRedirect:function(){if(this.childListen(P.CONST.EVENT_AUTH_BANNER_OPEN_IN_APP,function(){this.openInApp(P.CONST.EVENT_AUTH_BANNER_OPEN_IN_APP)}),this.childListen(P.CONST.EVENT_OPEN_IN_APP,this.openInApp),this.childListen(P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP,function(){this.openInApp(P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP)}),P.context.instance.is_mobile_agent||P.context.instance.is_tablet_agent){P.DeepLink.setup(P.context.instance.deep_link,P.context.instance.deep_link_default,P.context.instance.deep_link_tracking,P.context.instance.deep_link_action);var e=P.experiments.instance.v2GetGroup("branch_deeplinking");if("enabled"===e||"employees"===e)navigator.userAgent.indexOf("FBAN/FBIOS")<0&&P.DeepLink.redirectToApp(this.userAgentPlatform,"branchAutoDeeplink");else switch(P.context.instance.deep_link_action){case P.genConst.DeepLinkAction.OPEN_IN_APP:this.openInApp(P.CONST.EVENT_COOKIE_BASED_REDIRECT_TO_APP)}}},_shouldDeepLinkInsteadOfNavigate:function(e,t,o,n){if(!t)return!1;if(o===P.CONST.USER_AGENT_PLATFORM_IPAD)return!1;var a=/^\/(join|login)\//;return n&&a.test(n)?!1:e?_.contains(["enabled","employees"],P.experiments.instance.v2ActivateExperiment("seamless_auth"))&&!Cookie.get(P.genConst.CookieName.HAS_BEEN_AUTH_REDIRECTED_TO_APP_ON_NAVIGATE)?(Cookie.set(P.genConst.CookieName.HAS_BEEN_AUTH_REDIRECTED_TO_APP_ON_NAVIGATE,"true",24),!0):!1:!0},showInterstitial:function(e,t){var o=this.extraData.isTablet||!1,n={name:"AppInterstitial",options:{interstitial_data:this.extraData.appInterstitialData,is_tablet:o,type:e,source:t,on_home_page:"/"===window.location.pathname}};P.moduleFactory.load(n).then(function(e){this._modalManager.createAndShowModal(e,{can_dismiss:!1,modal_style:"fullScreen"})}.bind(this))},openInApp:function(e){Cookie.set(P.genConst.CookieName.SUPRESS_AUTO_REDIRECT,window.location.pathname),e===P.CONST.EVENT_COOKIE_BASED_REDIRECT_TO_APP?P.DeepLink.redirectToApp(this.userAgentPlatform,"autoRedirect"):e===P.CONST.EVENT_INTERSTITIAL_OPEN_IN_APP?P.DeepLink.redirectToApp(this.userAgentPlatform,"interstitialOpenInApp"):e===P.CONST.EVENT_AUTH_BANNER_OPEN_IN_APP?P.DeepLink.redirectToApp(this.userAgentPlatform,"authUpsellOpenInApp"):P.DeepLink.redirectToApp(this.userAgentPlatform,"default"),this.returnInterstitialExperiment()},_getScrollToTopModule:function(){var e=this.getChildById("scrollToTop");return e},updateScrollWatchers:function(e){var t=this._getScrollToTopModule();t&&t.setScroller(e.getScrollableElement())},_eventPreventDefault:function(e){e.preventDefault()},_checkDataTransferTypes:function(e,t){return _.every(e,function(e){return _.contains(t,e)})},_onDragEnter:function(e){e.preventDefault();var t=e.originalEvent.dataTransfer.types;if(t){var o=_.values(t),n=this._checkDataTransferTypes(["text/uri-list","text/html"],o),a=this._checkDataTransferTypes(["Files"],o)&&!!e.originalEvent.dataTransfer.files;if((n||a)&&(!this.dragOverlayModule||this.dragOverlayModule.destroyed)&&P.user.instance&&P.user.instance.isAuthenticated()){var r={name:"PinDragAndDrop",options:{file_drop:a,image_drop:n}};P.moduleFactory.load(r).then(function(e){this.dragOverlayModule=e,e.render().then(function(){this.appendChild(e)}.bind(this))}.bind(this))}}},getHeader:function(){return this.getChildById("header")}}),P.errorUtil.wrap(P.modules.App.prototype,["initialize","onAddedToDom","onContentReady"]),P.modules.App.prototype.className="App",goog.provide("P.modules.BasicSignupModule"),goog.require("P.modules.InlineSignup"),goog.require("P.Module"),P.modules.BasicSignupModule=P.modules.InlineSignup.extend({}),P.modules.BasicSignupModule.prototype.className="BasicSignupModule",goog.provide("P.modules.BlockAndUnfollowBoardContent"),goog.require("P.modules.BlockAndUnfollowForm"),P.modules.BlockAndUnfollowBoardContent=P.modules.BlockAndUnfollowForm.extend({getButtonConfig:function(e){return this.buttonConfig[e]}}),P.modules.BlockAndUnfollowBoardContent.prototype.className="BlockAndUnfollowBoardContent",goog.provide("P.modules.BlockAndUnfollowComment"),goog.require("P.modules.BlockAndUnfollowBoardContent"),goog.require("P.modalManager"),P.modules.BlockAndUnfollowComment=P.modules.BlockAndUnfollowBoardContent.extend({getUserToBlock:function(e){return this.options.commenter&&this.options.commenter[e]},_onUserBlockConfirmed:function(){var e=P.modalManager.get();e&&e.removeTopModal();var t=this.getUserToBlock("id"),o=this.data&&this.data.board&&this.data.board.owner&&this.data.board.owner.id===t;"leaveBoardAndBlockPinner"!==this._getCheckedValues()||o?this._onUserActionDone():this._leaveAndUnfollowBoard()}}),P.modules.BlockAndUnfollowComment.prototype.className="BlockAndUnfollowComment",goog.provide("P.modules.BlockAndUnfollowPin"),goog.require("P.modules.BlockAndUnfollowBoardContent"),P.modules.BlockAndUnfollowPin=P.modules.BlockAndUnfollowBoardContent.extend({getUserToBlock:function(e){return this.data&&this.data.pinner&&this.data.pinner[e]}}),P.modules.BlockAndUnfollowPin.prototype.className="BlockAndUnfollowPin",goog.provide("P.modules.BoardCount"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.BoardCount=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onBoardCountUpdate,e[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardCountUpdate,e[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardCountUpdate,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e),P.modules.NavigateButton.prototype.onContentReady.call(this)},onBoardCountUpdate:function(e,t,o){o.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this.render()}}),P.modules.BoardCount.prototype.className="BoardCount",goog.provide("P.modules.BoardCoverEdit"),goog.require("P.Module"),goog.require("P.modules.ImageCrop"),goog.require("P.util"),goog.require("P.resourceFactory"),P.modules.BoardCoverEdit=P.Module.extend({pins:null,index:null,prefetchBuffer:10,events:{"click .previous":"previous","click .next":"next"},onCreated:function(){this.imageCrop=null,this.onKeyup=this.onKeyup.bind(this),this.next=this.next.bind(this),this.previous=this.previous.bind(this),this.$img=$("<img>")},_positionIfReady:function(){!this._positioned&&this.inDom&&this.contentReady&&(this._positioned=!0,this.imageCrop=this.getChildByModuleName("ImageCrop"),this.listen($("body"),"keyup",this.onKeyup),this.coverPinId=this.options.cover_pin_id,this._initializePins(!0))},_initializePins:function(e){if(e&&null!==this.coverPinId){var t={id:this.coverPinId,field_set_key:"board_cover_picker"},o=P.resourceFactory.instance.create("PinResource",t);o.callGet({showError:!1}).then(function(e){this._appendPinsFromData([e.resource_response.data]),this._initializePins()}.bind(this),function(){this.coverPinId=null,this._initializePins()}.bind(this))}else this._appendPinsFromData(this.data),this.setIndex(0),this.updateButtons()},_appendPinsFromData:function(e){this.pins||(this.pins=[]),_.each(e,function(e){var t={id:e.id,url:e.images["236x"].url};t.id===this.coverPinId&&this.pins.length||this.pins.push(t)}.bind(this))},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){this._positionIfReady()},onKeyup:function(e){null!==this.index&&(e.keyCode===P.util.keyCode.LEFT?this.previous():e.keyCode===P.util.keyCode.RIGHT&&this.next())},requestMoreIfNeeded:function(){this.index+this.prefetchBuffer<this.pins.length||this.resource.atEnd()||this.resource.callGet().then(function(e){this.data=e.resource_response.data,this._appendPinsFromData(this.data)}.bind(this),function(){this.data=[]}.bind(this))},next:function(){if(this.requestMoreIfNeeded(),this.index===this.pins.length-1)return!1;var e=this.index+1;return this.setIndex(e),!1},previous:function(){var e=this.index-1;return this.setIndex(e),!1},setIndex:function(e){var t=this.pins[e];t&&(this.imageCrop.setImage(t.url),this.index=e,this.preload([this.index-2,this.index-1,this.index+1,this.index+2]),this.updateButtons())},preload:function(e){_.each(e,function(e){var t=this.pins[e];t&&P.util.preloadImage(t.url)}.bind(this))},updateButtons:function(){var e=this.index>0;this.$(".previous").toggle(e);var t=this.index<this.pins.length-1||!this.resource.atEnd();this.$(".next").toggle(t)},getBoardCoverData:function(){var e=this.pins[this.index].id,t=this.pins[this.index].url,o=_.extend({},{pin_id:e,pin_image_url:t},this.imageCrop.getCropData());return o}}),P.modules.BoardCoverEdit.prototype.className="BoardCoverEdit",goog.provide("P.modules.BoardCreate"),goog.require("P.modules.BoardEditBase");var Et=150;P.modules.BoardCreate=P.modules.BoardEditBase.extend({CssClassName:_.extend(P.modules.BoardEditBase.prototype.CssClassName,{HAS_MAX_HEIGHT:"hasMaxHeight"}),_clearInviteForm:function(){var e=this.getChildById("boardInviteForm");e.clearTypeahead()},onChildInviteUser:function(e){var t=this.getChildById("boardInvites"),o=e.data.userId,n=e.data.type,a=e.data.attributes;if(n===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER)t.addInvitee({type:"facebook",identifier:o,attributes:a});else if("user"===n)t.addInvitee({type:"pinner",identifier:o});else{var r=e.data.userId;t.addInvitee({type:"email",identifier:r})}this._clearInviteForm()},setCollabsMaxHeight:function(){this.updateDom()},updateDom:function(){var e=this.$(".boardEditCollaborators"),t=e.position().top,o=this.$(".formFooter").outerHeight(),n=parseInt(this.$(".boardCollaboratorsWrapper").css("padding-bottom"),10),a=this.$(".collaboratorInvitesEnabledToggleWrapper").outerHeight()||0,r=o+t+a+n,i=this.getHeight()-r;e.addClass(this.CssClassName.HAS_MAX_HEIGHT).css("max-height",i)},animateOut:function(e){var t=this.getWidth();this.$el.transition({x:t,duration:Et},function(){e&&e(),this.destroy()}.bind(this))},animateIn:function(e){var t=this.getWidth();this.$el.transition({x:t,opacity:1,duration:1}).transition({x:0,duration:Et,easing:"ease-out"},function(){this.focusDescription(),e&&e()}.bind(this))},focusDescription:function(){P.context.instance.is_mobile_agent||this.$(".boardEditDescription").focus()},onChildInviteEmail:function(e){var t=this.getChildById("boardInvites"),o=e.data.email;t.addInvitee({type:"email",identifier:o}),this._clearInviteForm()}}),P.modules.BoardCreate.prototype.className="BoardCreate",goog.provide("P.modules.BoardCreateRep"),goog.require("P.modules.ModalTrigger"),P.modules.BoardCreateRep=P.modules.ModalTrigger.extend({events:{click:"onClick"},onClick:function(e){e.stopPropagation(),e.preventDefault(),P.user.instance.isLimitedLogin()?P.limitedLogin.showLogin(this):this.showModalSubmodule()}}),P.modules.BoardCreateRep.prototype.className="BoardCreateRep",goog.provide("P.modules.BoardEditActionBase"),goog.require("P.modules.BoardEditBase"),goog.require("P.modules.BoardInvites"),goog.require("P.ga"),goog.require("P.i18n"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.BoardEditActionBase=P.modules.BoardEditBase.extend({onContentReady:function(){if(P.autologin.checkForAutologin()){var e=P.i18n._("To edit your board, please take a second to confirm it's really you.");return P.autologin.showLoginErrorDialog(this,e),void this.destroy()}P.modules.BoardEditBase.prototype.onContentReady.call(this);var t={};t[P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR]=this.onBannedUser,t[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,this.pubsubSubscribe(this.data.id,t)},onInviteAdded:function(e,t){var o=e?this.getChildById("boardPendingInvites"):this.getChildById("boardInvites");P.ga.trackEvent("collaborator_invite_user",P.CONST.GA_ACTION_SUCCESS),o.addInvitee({type:t.type,identifier:t.invitee})},onSubmitValidated:function(){this.saveBoard()},deleteBoard:function(){var e=this.getBoardId(),t=this.getFieldValues(),o=t.privacy,n=P.resourceFactory.instance.create("BoardResource",{board_id:e}),a=function(e){P.errorUtil.showError(e.message),P.ga.trackEvent("board_delete",P.CONST.GA_ACTION_ERROR)},r=function(t){if(P.ga.trackEvent("board_delete",P.CONST.GA_ACTION_SUCCESS),this.updateBoardPickerBoardsResource(),t){var n=t.resource_response;if(n&&!n.error){this.handleDelete(e,o);var r=P.resourceFactory.instance.create("BoardPickerBoardsResource",{filter:"all",field_set_key:"board_picker",allow_stale:!0});return void P.resourceCache.instance.invalidate(r)}}a(t)}.bind(this);this.showLoading(),n.callDelete({showError:!1}).then(r,a).fin(function(){this.hideLoading()}.bind(this))},handleDelete:function(e,t){},redirectAfterDelete:function(){var e=this.data.owner?"/"+this.data.owner.username+"/":"/";window.location.href!==e&&this.navigate(e)},onBoardRemovedSelf:function(e,t,o){this.destroy()},onBannedUser:function(e,t,o){var n=this.getChildById("boardInvites");n.render();var a=this.getChildById("boardPendingInvites");a&&a.render()}}),P.modules.BoardEditActionBase.prototype.className="BoardEditActionBase",goog.provide("P.modules.BrowserButtonUpsell"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.i18n"),goog.require("P.genConst"),goog.require("P.errorUtil"),P.modules.BrowserButtonUpsell=P.Module.extend({events:{"click .promoWrapper":"_installExtension"},onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),P.context.instanceLogger.getInstance().logCustomViewEvent(P.genConst.ViewType.SAVE,P.genConst.ViewParameterType.EXTENSION_UPSELL_MODAL)},_installExtension:function(){P.browserExtension.instance.isExtensionInstalled()?P.errorUtil.showError(P.i18n._("Oops! You already have the browser button.")):P.browserExtension.instance.handleExtensionInstall(function(){this.destroy()}.bind(this))},onButtonClick:function(e){var t=e.target,o=t.id;"installExtensionButton"===o?this._installExtension():"cancelInstallButton"===o&&(this.options.suppress&&Cookie.set(P.CONST.COOKIE_SUPPRESS_EXTENSION_NAG,"true"),this._logCustomContextEvent(P.genConst.EventType.CLICK,P.genConst.ElementType.CANCEL_EXTENSION_INSTALL_BUTTON,P.genConst.ComponentType.BROWSER,{}),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_IGNORE_EXTENSION_NAG))}}),P.modules.BrowserButtonUpsell.prototype.className="BrowserButtonUpsell",goog.provide("P.modules.BuildingHomeFeedSpinner"),goog.require("P.modules.StepBase"),goog.require("P.timer"),goog.require("P.resourceFactory");var xt=10,Ot=500;P.modules.BuildingHomeFeedSpinner=P.modules.StepBase.extend({numChecks:0,onContentReady:function(){},_checkHomeFeedRebuildStatus:function(){var e,t=function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)};e=P.resourceFactory.instance.create("OrientationContextStatusResource",{redo_homefeed:this.options.is_nux===!1}),this.numChecks+=1,e.callGet({showError:!1}).then(function(e){t()},function(e){this.numChecks<=xt?P.timer.setTimeout(this._checkHomeFeedRebuildStatus.bind(this),Ot):t()}.bind(this))},onShow:function(e){P.timer.setTimeout(this._checkHomeFeedRebuildStatus.bind(this),Ot),P.modules.StepBase.prototype.onShow.call(this,e)}}),P.modules.BuildingHomeFeedSpinner.prototype.className="BuildingHomeFeedSpinner",goog.provide("P.modules.BulkEditBar"),goog.require("P.Module"),goog.require("P.modules.PinCount"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),goog.require("P.i18n"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.BulkEditBar=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_BULK_PIN_SELECTED]=this.pinSelected,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,e),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.pinsSelected={},this.selectedPinsCount=0},pinSelected:function(e,t,o){if(o&&this.pinsSelected){if(this.pinsSelected.hasOwnProperty(o))this.selectedPinsCount--,delete this.pinsSelected[o];else{if(50===Object.keys(this.pinsSelected).length)return P.errorUtil.showError(P.i18n._("You can only move 50 Pins at a time.")),void P.pubSub.instance.publish(o,P.CONST.PUBSUB_TOPIC_BULK_PIN_UNSELECTED);this.selectedPinsCount++,this.pinsSelected[o]=1}this.updateSelectedPinsCount()}},updateSelectedPinsCount:function(){var e=this.getChildById("selectedPinsCount");e&&e.destroy();var t={can_update_count:!0,view_type:"selectedPins"},o={pin_count:this.selectedPinsCount},n=new P.modules.PinCount({id:"selectedPinsCount",data:o,options:t});n.renderExistingData().then(function(){var e=this.$(".notifications");this.insertChild(n,e)}.bind(this))},showBoardPicker:function(e){var t=Object.keys(this.pinsSelected);0===t.length?e===P.CONST.BulkAction.MOVE?P.errorUtil.showError(P.i18n._("Select the Pins you want to move.")):e===P.CONST.BulkAction.COPY?P.errorUtil.showError(P.i18n._("Select the Pins you want to copy.")):P.errorUtil.showError(P.i18n._("Select some Pins first.")):P.moduleFactory.load({name:"BulkBoardPicker",options:{action_type:e,board_privacy:this.options.board_privacy,pin_count:t.length,pin_ids:t}}).then(function(e){P.modalManager.get().createAndShowModal(e)})},onButtonClick:function(e){var t=e.target,o=t.id;switch(o){case"moveBulkButton":this.showBoardPicker(P.CONST.BulkAction.MOVE);break;case"copyBulkButton":this.showBoardPicker(P.CONST.BulkAction.COPY);break;case"deleteBulkButton":this.onDeleteClick();break;case"cancelBulkButton":P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}},enterBulkEditMode:function(){this.$el.transition({y:"64px",easing:"ease-out",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})},exitBulkEditMode:function(){this.$el.transition({y:"0",easing:"ease-out",duration:P.CONST.BULK_EDIT_ANIMATION_DURATION},1,function(){this.destroy()}.bind(this))},onDeleteClick:function(){var e=Object.keys(this.pinsSelected);if(0===e.length)P.errorUtil.showError(P.i18n._("Select the Pins you want to delete."));else{var t="";t=1===e.length?"delete_pin":"delete_pins";var o={name:"ConfirmDialog",options:{template:t}};P.moduleFactory.load(o).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.bulkDeletePins)}.bind(this))}},bulkDeletePins:function(){var e=P.resourceFactory.instance.create("BulkEditResource",{board_id:this.options.board_id,pin_ids:Object.keys(this.pinsSelected)});e.callDelete({showError:!0}).then(function(){for(var e in this.pinsSelected)P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_PIN_DELETED);P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.EXIT_BULK_EDIT)}.bind(this))}}),P.modules.BulkEditBar.prototype.className="BulkEditBar",goog.provide("P.modules.BusinessGetStarted"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),goog.require("P.ga"),P.modules.BusinessGetStarted=P.Module.extend({events:{"click .partnerCreateBoard":"createBoard"},createBoard:function(){return P.ga.trackEvent("board_create",P.CONST.GA_ACTION_OPEN_MODAL),this.showBoardCreateModal(),!1},showBoardCreateModal:function(){var e=new P.modules.BoardCreate({options:{}});this.showInModal(e)}}),P.modules.BusinessGetStarted.prototype.className="BusinessGetStarted",goog.provide("P.modules.CampbellMenuList"),goog.require("P.modules.List"),P.modules.CampbellMenuList=P.modules.List.extend({}),P.modules.CampbellMenuList.prototype.className="CampbellMenuList",goog.provide("P.modules.CloseupBottom"),goog.require("P.Module"),goog.require("P.modules.CloseupRelatedPins");var Ct="relatedPins",St="relatedBoards";P.modules.CloseupBottom=P.Module.extend({onContentReady:function(){},renderCloseupRelatedPins:function(e){return this.closeupRelatedPins?this.closeupRelatedPins.options.initial_column_lengths=[e,e,e]:(this.closeupRelatedPins=new P.modules.CloseupRelatedPins({id:Ct,options:{show_seo_canonical_pins:this.options.show_seo_canonical_pins,pin_id:this.options.pin_id,initial_column_lengths:[e,e,e]}}),this.appendChild(this.closeupRelatedPins)),this.closeupRelatedPins.render()},onChildRendered:function(e){var t=e.id===Ct,o=e.id===St,n,a;if(t&&(n=e.getChildByModuleName("Grid"),a=this.$(".relatedPinsWrapper")),o&&(n=e.getChildByModuleName("PagedGrid"),a=this.$(".relatedBoardsWrapper")),n&&a.length){var r=n.hasItems(),i=r?"visible":"hidden";a.css("visibility",i)}},onDeepLink:function(){this.relatedPinsInterval&&(window.clearInterval(this.relatedPinsInterval),this.relatedPinsInterval=null)},setMinHeight:function(e){this.$el.css("min-height",null!==e?e:"")}}),P.modules.CloseupBottom.prototype.className="CloseupBottom",goog.provide("P.modules.CloseupSignupModal"),goog.require("P.modules.InlineSignup"),goog.require("P.util"),goog.require("P.i18n"),P.modules.CloseupSignupModal=P.modules.InlineSignup.extend({onContentReady:function(){P.util.trackRegisterAction("closeup_signup_modal_view"),P.modules.InlineSignup.prototype.onContentReady.call(this),this.setMultiStepHeader(".tagline",{step1:this.options.tagline,step2:P.i18n._("Looking good! Just a few more details...")})}}),P.modules.CloseupSignupModal.prototype.className="CloseupSignupModal",goog.provide("P.modules.ConversationHead"),goog.require("P.modules.Token"),P.modules.ConversationHead=P.modules.Token.extend({events:{"click .headWrapper":"onClick"},CssClassName:_.extend(P.modules.Token.prototype.CssClassName,{DROPPABLE_HOVER:P.CONST.CLASS_DROPPABLE_HOVER,INACTIVE:"inactive",TOUCH:"touch"}),onContentReady:function(){"ontouchstart"in window&&this.$el.addClass(this.CssClassName.TOUCH);var e=this.$el;this.options.inactive?window.setTimeout(function(){e.addClass(this.CssClassName.INACTIVE)}.bind(this),100):this.$el.removeClass(this.CssClassName.INACTIVE),this.triggerEvent(P.CONST.EVENT_CONVERSATION_HEAD_READY,null,!0)},getBadgeCount:function(){return this.options.badge_count},setBadgeCount:function(e){this.options.badge_count=e,this.render()},setActive:function(){this.options.inactive=!1,this.$el.removeClass(this.CssClassName.INACTIVE)},setInactive:function(){this.options.inactive=!0,this.$el.addClass(this.CssClassName.INACTIVE)},getUsers:function(){return this.options.users||[]},toggleDroppableHover:function(e){this.$el.toggleClass(this.CssClassName.DROPPABLE_HOVER,e)},getUserIds:function(){return _.pluck(this.getUsers(),"id")},getExternalEmails:function(){return this.options.emails||[]},getAllUserIds:function(){return this.getUserIds().concat(this.getExternalEmails())},getFirstUserId:function(){return this.getAllUserIds()[0]},onClick:function(e){this.triggerEvent(P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,null,!1)}}),P.modules.ConversationHead.prototype.className="ConversationHead",goog.provide("P.modules.CreateConversationGroup"),goog.require("P.Module"),goog.require("P.modules.ConversationHead"),goog.require("P.preventScrollMixin"),P.modules.CreateConversationGroup=P.Module.extend({mixins:[P.preventScrollMixin],events:{"click .tokenized":"onTokenizedAreaClick"},focus:function(){var e=this.getTypeaheadField();e.focus()},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClicked),this.childListen(P.CONST.EVENT_TOKEN_REMOVED,this.onTokenRemoved),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onEnterPressed),this.childListen(P.CONST.EVENT_TOKEN_ADDED,this.onTokenAdded),this.childListen(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,this.onListItemClicked),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.userIds=[],this.emails=[]},onEnterPressed:function(e){var t=this.getTypeaheadField();t.getTypeaheadHighlightedItem()||"input"===e.target.id||this.userIds.length&&this._triggerSendEvent()},getTokenizedInput:function(){return this.getTypeaheadField().getChildById("tokenizedInput")},getTypeaheadField:function(){return this.getChildById("searchField")},onTokenizedAreaClick:function(e){this.focus()},onTokenAdded:function(e){var t=e.data,o=t.getUsers(),n=t.getFirstUserId();o.length>0?this.userIds.push(n):this.emails.push(n),this._setListItemWithUserId(n,!0),this.setSendButtonEnabled(!0),this.focus()},onTokenRemoved:function(e){var t=e.data,o=t.getFirstUserId(),n=_.indexOf(this.userIds,o),a=_.indexOf(this.emails,o);-1!==n?this.userIds.splice(n,1):-1!==a&&this.emails.splice(a,1),this._setListItemWithUserId(o,!1),this._getTotalUsersCount()||this.setSendButtonEnabled(!1),this.focus()},_getTotalUsersCount:function(){return this.userIds.length+this.emails.length},_setListItemWithUserId:function(e,t){this._getConversationsList().setListItemWithUserId(e,t)},_getConversationsList:function(){return this.getChildById("convosList")},onContentReady:function(){this._setup(),this.focus(),this.startPreventingScroll()},adjustTokenizedInputWidth:function(){var e=this.getTypeaheadField(),t=this.getWidth(),o=10,n=this.$(".placeholder").width();e.getContent().width(t-2*o-n)},onTypeaheadItemSelected:function(e){e.stopPropagation();var t=e.target;t.parent.reset();var o=e.data.item.attributes,n=o.email,a;a=n?{id:n}:{id:o.id,username:o.username,image_large_url:o.image_medium_url},this.setSendButtonEnabled(!0),this._addConversationHeadAsToken(a)},_addConversationHeadAsToken:function(e){var t=this.getTokenizedInput(),o=t.getTokens(),n=_.find(o,function(t){return t.getFirstUserId()===e.id});if(!n){var a={size:"small",users:[],emails:[]};e.username?a.users=[e]:a.emails=[e.id];var r=new P.modules.ConversationHead({options:a});r.render().then(function(){t.addTokensAndUpdateInputView([r])})}this.focus()},_setup:function(){this.inDom&&this.contentReady&&(this.adjustTokenizedInputWidth(),this.focus())},setSendButtonEnabled:function(e){var t=this.$(".cancelButton"),o=this.$(".sendToGroupButton");e?(t.hide(),o.show()):(t.show(),o.hide())},_removeHeadForUser:function(e){var t=this.getTokenizedInput(),o=t.getTokens();_.each(o,function(o){e.id===o.getFirstUserId()&&t.removeToken(o)})},_addUserAsToken:function(e){this._addConversationHeadAsToken(e)},onListItemClicked:function(e){e.stopPropagation();var t=e.target,o=t.getFirstUser();t.isActive()?this._removeHeadForUser(o):(t.setActive(!0),this._addUserAsToken(o))},onAddedToDom:function(){this._setup()},startPreventingScroll:function(){this.startPreventScroll(this.$(".ConversationsList"),this.$(".List"))},onButtonClicked:function(e){var t=e.target.id;"sendToGroupButton"===t&&this._triggerSendEvent()},_triggerSendEvent:function(){this.triggerEvent(P.CONST.EVENT_SEND_OBJECT_TO_USERS,{user_ids:this.userIds,emails:this.emails},!0)}}),P.modules.CreateConversationGroup.prototype.className="CreateConversationGroup",
goog.provide("P.modules.Dropdown"),goog.require("P.dom"),goog.require("P.HoverIntent"),goog.require("P.modules.PositionModule"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.router");var Ft="dropdownContainer";P.modules.Dropdown=P.modules.PositionModule.extend({events:{keyup:"_onKeyUp"},CssClassName:_.extend(P.modules.PositionModule.prototype.CssClassName,{FADE_IN:"fadeIn",HIDE:"hideModule",IS_ACTIVE:"active",IS_EMPTY:"isEmpty",IS_EMPTY_WITHOUT_FRIENDS:"isEmptyWithoutFriends",MODAL:"Modal",SLIDE_IN:"slideIn"}),_onKeyUp:function(e){switch(e.keyCode){case P.util.keyCode.ESCAPE:e.stopPropagation(),e.stopImmediatePropagation(),this.hide(),this.triggerEvent(P.CONST.EVENT_ESCAPE_DROPDOWN,this)}},onCreated:function(){P.modules.PositionModule.prototype.onCreated.apply(this,arguments),this.renderPromise=null,this.showing=!1,this._setAllowPositioning(!1),this.childListen(P.CONST.EVENT_DISMISS,this.hide),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.hide),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE_NOT_PROPAGATE,this.hideWithoutTriggering),this.childListen(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS,this.onIsEmptyWithoutFriends),this.childListen(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY,this.onIsEmpty),this.options.persist_through_navigate||(this.childListen(P.CONST.EVENT_NAVIGATE,this.hide),this.listen(P.router.instance,P.CONST.EVENT_ROUTE_MATCHED,this.hide)),this.childListen(P.CONST.EVENT_EXTERNAL_CLICK,this.hide),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.positionModule),this.childListen(P.CONST.EVENT_CHANGE,this.positionModule),this.options.module&&this.options.module.options&&this.options.module.options.is_modular_closeup&&this.$el.addClass("modularCloseup")},onIsEmpty:function(e){this.$el.addClass(this.CssClassName.IS_EMPTY)},onIsEmptyWithoutFriends:function(e){this.$el.addClass(this.CssClassName.IS_EMPTY_WITHOUT_FRIENDS)},_positionIfReady:function(){this.inDom&&this.contentReady&&(this.positionModule(),this.ensureHoverIntent(),this.getPositionAnchor().initHovering())},onAdded:function(){this.options.prefetch&&(this.options.prefetch=!1,this.render())},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){this._positionIfReady()},onOptionsChanged:function(){this.renderPromise=null},getLoadingSpinnerOptions:function(){return _.extend(P.modules.PositionModule.prototype.getLoadingSpinnerOptions.call(this),{size:P.Spinner.Size.SMALL})},render:function(){var e=this._renderInternal2();return this.renderPromise=e,e},_renderInternal2:function(){return new Promise(function(e,t){this.renderContainer();var o=this.$el;this.options.append_to_closeup?$(".Closeup").append(o):$("body").append(o);var n=function(){this.contentReady=!0,this.onContentReady(),e()}.bind(this);(this.options.log_component_type||0===this.options.log_component_type)&&o.attr("data-component-type",this.options.log_component_type);var a=this.getPositionElement();this.options.title&&a.append('<h2 class="dropdownTitle">'+this.options.title+"</h2>"),this.options.text&&a.append('<p class="dropdownText">'+this.options.text+"</p>"),this.options.module?P.moduleFactory.load(this.options.module).then(function(e){this.setContentModule(e);var t=e.data?e.renderExistingData():e.render();t.then(n),this.options.display_while_loading&&n()}.bind(this)):n(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0)}.bind(this))},setSticky:function(e){var t=_.clone(this.options);t.sticky=e,this.setOptions(t)},turnOnFixed:function(e){this.toggleFixed(),this.$el.css("top",e)},turnOffFixed:function(e){this.toggleFixed(),this.$el.css("top",e)},getTopOffset:function(){return this.$el.position().top},ensureHoverIntent:function(){this.parent.isClickButton&&!this.parent.isClickButton()&&(this._hoverIntent||this.options.manually_close||(this._hoverIntent=new P.HoverIntent(this.$el,{exitDelay:500}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,function(){this.getPositionAnchor().isHovering()||this.hide()})))},_hide:function(){this.showing=!1,this._setAllowPositioning(!1),this.$el.removeClass(this.CssClassName.IS_ACTIVE).removeClass(this.CssClassName.SLIDE_IN),this._bodyListener&&(this.removeListener(this._bodyListener),this._bodyListener=null)},hideWithoutTriggering:function(){this._hide()},hide:function(){if(this.showing&&(this._hide(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),this.children.length)){var e=this.getContentModule();e.trigger(P.CONST.EVENT_DROPDOWN_CONTAINER_HIDDEN,null)}},_ensureModule:function(){return this.renderPromise||(this.renderPromise=this.render()),this.renderPromise},ensureOpenListeners:function(){this.options.sticky||(this._bodyListener=this.listen($(document),"mousedown touchstart",this._onMouseDown))},_onMouseDown:function(e){var t=this.options.mouse_close_mode;switch(t){case"never":return;case"always":return void this.hide();case"ignore_modal_click":if($(e.target).parents(".Modal").length>0||$(e.target).hasClass(this.CssClassName.MODAL))return}var o=$(e.target).closest(this.$el).length>0||$(e.target).closest(this.options.anchor).length>0;o||this.hide()},isShowing:function(){return this.showing},updateMaxHeight:function(){if(this.children.length){var e=this.getContentModule(),t=e.getHeight(!0);if(this.options.constrain_height){var o=parseInt(this.$el.css("top"),10)||0,n=Math.max(P.Viewport.height-o-P.CONST.PIN_MARGIN,0);t>n&&e.getContent().css({"max-height":n,"overflow-y":"auto"})}else this.options.wrap_parent_max_height&&this.$el.css("max-height",t)}},show:function(e){return this.showing?void 0:(this.showing=!0,this._setAllowPositioning(!0),this.ensureOpenListeners(),this._ensureModule().then(function(){if(this.showing){this.$el.addClass(this.CssClassName.IS_ACTIVE),this.positionModule(),this.updateMaxHeight();var t=this.getContentModule();t&&P.dom.deferDomManipulation(function(){t.trigger(P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN,null),t.focus()}),e&&P.dom.deferWrite().then(e)}this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,{moduleName:"Dropdown",action:P.CONST.ViewActions.OPEN,options:this.options})}.bind(this)))},reposition:function(e){this.showing&&(this.$el.addClass(this.CssClassName.IS_ACTIVE),this.positionModule(),this.updateMaxHeight(),e&&e())},fadeIn:function(e){this.show(function(){this.$el.addClass(this.CssClassName.FADE_IN),e&&e()}.bind(this))},slideIn:function(e){return this.$el.addClass(this.CssClassName.HIDE),new Promise(function(e,t){this.show(function(){"undefined"!=typeof Modernizr&&Modernizr.csstransforms3d?this.$el.addClass(this.CssClassName.SLIDE_IN):this.$el.removeClass(this.CssClassName.HIDE),e(void 0)}.bind(this))}.bind(this))},getDropdown:function(){return this.$("."+Ft)},isVisible:function(){return this.$el.hasClass(this.CssClassName.IS_ACTIVE)},setVisible:function(e){return this.$el.toggleClass(this.CssClassName.IS_ACTIVE,e)},isHovering:function(){return this.$el.isHovering()},initHovering:function(){this.$el.initHovering()},getContentModule:function(){return this.children[0]},getContentModulePromise:function(){return this._ensureModule().then(function(){return this.getContentModule()}.bind(this))},setContentModule:function(e){var t=this.getContentModule();t&&t.destroy(),this.insertChild(e,this.getPositionElement())}}),P.modules.Dropdown.prototype.className="Dropdown",goog.provide("P.modules.DropdownButton"),goog.require("P.modules.Button"),goog.require("P.modules.Dropdown"),goog.require("P.modules.Dropdown2"),goog.require("P.HoverIntent"),goog.require("P.ExperienceManager");var Nt="tutorialDropdown",It="click",At="hover",Rt={};Rt[It]=It,Rt[At]=At,P.modules.DropdownButton=P.modules.Button.extend({CssClassName:P.modules.Button.prototype.CssClassName,onClick:function(e){if(this.options.check_write_banned&&P.user.instance.isWriteBanned())P.writeban.showWriteBanned(this);else if(this.options.check_limited_login&&P.user.instance.isLimitedLogin())P.limitedLogin.showLogin(this);else{if(this.openStrategy===At)return!1;this._ensureDropdown();var t=this._dropdown.isVisible();t?this.hideDropdown():this.showDropdown()}this._logContextEvent(e),e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()},onCreated:function(){this._dropdown=null,this.openStrategy=this.options.show_dropdown_on_hover?Rt[At]:Rt[It]},getDropdown:function(){return this._ensureDropdown(),this._dropdown},getDropdownOptions:function(){return this.options.dropdown_options||{}},getContentModuleLoadOptions:function(){return this.options.submodule},_ensureDropdown:function(){if(!this._dropdown){var e=this.options.anchor_selector,t;e&&(t="."+e);var o={anchor:t?t:this.$el,module:this.getContentModuleLoadOptions()};_.extend(o,this.getDropdownOptions());var n=this.options.use_dropdown2?P.modules.Dropdown2:P.modules.Dropdown;this._dropdown=new n({id:"dropdown",options:o}),this._dropdown.initHovering(),this.listen(this._dropdown,P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.addChild(this._dropdown)}},onMouseEnterComplete:function(){this.isHoverEnabled()&&this.$el.isHovering()&&this.showDropdown()},showDropdown:function(e){-1===window.navigator.userAgent.indexOf("FBIOS")&&this.setActive(!0),this.hideTutorial(),this._ensureDropdown(),this._dropdown.slideIn(200).then(e)},hideDropdown:function(){this._dropdown&&this._dropdown.hide()},isDropdownVisible:function(){return this._ensureDropdown(),this._dropdown.isVisible()},onMouseOutComplete:function(){this._ensureDropdown(),this._dropdown.isHovering()||this.hideDropdown()},initListeners:function(){this.openStrategy!==It&&(!this._hoverIntent||this._hoverIntent.isElement(this.$el))&&(this._hoverIntent=new P.HoverIntent(this.$el,{enterDelay:5,exitDelay:200}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE,function(){this.onMouseEnterComplete()}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,function(){this.onMouseOutComplete()}))},onButtonClick:function(e){e.stopPropagation()},onContentReady:function(){var e=!!this.getDropdownOptions().prefetch;e&&this._ensureDropdown(),this.$el.initHovering(),this.childListen(P.CONST.EVENT_TUTORIAL_SHOW,this.showTutorial),this.initListeners(),this.options.tutorial&&this.options.tutorial.topic&&this.options.tutorial.show&&this.showTutorial()},onDropdownHide:function(){this.setActive(!1),this.$el.focusWithoutScrolling()},ensureTutorialDropdown:function(){if(!this.getChildById(Nt)){var e=_.extend({},this.options.dropdown_options,{title:this.options.tutorial.title,text:this.options.tutorial.text,anchor:this.$el,class_name:"tutorial",largeCaret:!1}),t=new P.modules.Dropdown({id:Nt,options:e});this.appendChild(t)}return this.getChildById(Nt)},onShowTutorial:function(e,t,o){this.showTutorial()},isClickButton:function(){return this.openStrategy===It},showTutorial:function(){if(this.options.tutorial){var e=this.ensureTutorialDropdown();e.fadeIn(),this.setExperienceViewed()}},hideTutorial:function(){if(this.options.tutorial){var e=this.getChildById(Nt);e&&e.destroy(),this.setExperienceCompleted()}},setExperienceViewed:function(){if(this.options.tutorial.experienceId&&this.options.tutorial.placementId){var e=P.ExperienceManager.instance;e.viewPlacedExperience(this.options.tutorial.placementId,this.options.tutorial.experienceId)}},setExperienceCompleted:function(){if(this.options.tutorial.experienceId&&this.options.tutorial.placementId){var e=P.ExperienceManager.instance;e.completePlacedExperience(this.options.tutorial.placementId,this.options.tutorial.experienceId)}},isHoverEnabled:function(){return this.options.disabled!==!0&&this.openStrategy!==It}}),P.modules.DropdownButton.prototype.className="DropdownButton",goog.provide("P.modules.EmptyStateCardBoard"),goog.require("P.modules.EmptyStateCard"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.EmptyStateCardBoard=P.modules.EmptyStateCard.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_BROWSER_EXTENSION_STATE_UPDATED]=this._setBrowserButtonUpsellDisplayState,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BROWSER_EXTENSION,e),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this._setBrowserButtonUpsellDisplayState()},_setBrowserButtonUpsellDisplayState:function(){var e=this.options.is_own_board;P.browserExtension.instance.isExtensionInstalled()&&e&&(P.modules.EmptyStateCard.prototype.setFooterIsVisible.call(this,!1),P.modules.EmptyStateCard.prototype.setActionButtonIsVisible.call(this,!1))},onButtonClick:function(e){var t=e.target;t.showLoading();var o=new P.modules.BrowserButtonUpsell({options:{extension_installed:!!P.browserExtension.instance.isExtensionInstalled(),suppress:!1}});o.render().then(function(){t.hideLoading(),this.showInModal(o)}.bind(this))}}),P.modules.EmptyStateCardBoard.prototype.className="EmptyStateCardBoard",goog.provide("P.modules.EmptyStateCardProfileLikes"),goog.require("P.modules.EmptyStateCard"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.EmptyStateCardProfileLikes=P.modules.EmptyStateCard.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_BROWSER_EXTENSION_STATE_UPDATED]=this._setBrowserButtonUpsellDisplayState,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BROWSER_EXTENSION,e),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this._setBrowserButtonUpsellDisplayState()},_setBrowserButtonUpsellDisplayState:function(){var e=this.options.is_own_profile;P.browserExtension.instance.isExtensionInstalled()&&e&&(P.modules.EmptyStateCard.prototype.setFooterIsVisible.call(this,!1),P.modules.EmptyStateCard.prototype.setActionButtonIsVisible.call(this,!1))},onButtonClick:function(e){var t=e.target;t.showLoading();var o=new P.modules.BrowserButtonUpsell({options:{extension_installed:!!P.browserExtension.instance.isExtensionInstalled(),suppress:!1}});this.showInModal(o),t.hideLoading()}}),P.modules.EmptyStateCardProfileLikes.prototype.className="EmptyStateCardProfileLikes",goog.provide("P.modules.EmptyStateCardProfilePins"),goog.require("P.modules.EmptyStateCard"),goog.require("P.modules.BrowserButtonUpsell"),P.modules.EmptyStateCardProfilePins=P.modules.EmptyStateCard.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var e=this.options.is_own_profile;P.browserExtension.instance.isExtensionInstalled()&&e&&(P.modules.EmptyStateCard.prototype.setFooterIsVisible.call(this,!1),P.modules.EmptyStateCard.prototype.setActionButtonIsVisible.call(this,!1))},onButtonClick:function(e){var t=e.target;t.showLoading();var o=new P.modules.BrowserButtonUpsell({options:{extension_installed:!!P.browserExtension.instance.isExtensionInstalled(),suppress:!1}});this.showInModal(o),t.hideLoading()}}),P.modules.EmptyStateCardProfilePins.prototype.className="EmptyStateCardProfilePins",goog.provide("P.modules.ExperienceNag"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),P.modules.ExperienceNag=P.modules.HeroHelperBase.extend({events:{"click .nagClose":"onCloseButtonClick","click .message a":"onMessageLinkClick"},onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.call(this),this.options.type=P.genConst.ExperienceReverse[String(this.experienceId)];var e=this.data;e&&!_.isEmpty(e.triggerable_placed_exps)&&e.triggerable_placed_exps.forEach(function(e){P.ExperienceManager.instance.triggerPlacedExperienceIds([e])})},onCloseButtonClick:function(){switch(this.data.experience_id){case P.genConst.Experience.WEB_NOTIFICATION_NAG_CHROME_PUSH:case P.genConst.Experience.WEB_NAG_CHROME_PUSH:this.dismiss();break;default:this.destroy()}},onMessageLinkClick:function(){switch(this.data.experience_id){case P.genConst.Experience.WEB_NOTIFICATION_NAG_CHROME_PUSH:case P.genConst.Experience.WEB_NAG_CHROME_PUSH:P.WebPushManager.instance().subscribe(),this.complete(!1)}},showLoading:function(){}}),P.modules.ExperienceNag.prototype.className="ExperienceNag",goog.provide("P.modules.ExtensionInstallToast"),goog.require("P.modules.ToastBase"),goog.require("P.moduleFactory"),goog.require("P.toastsManager"),goog.require("P.genConst"),P.modules.ExtensionInstallToast=P.modules.ToastBase.extend({events:{"click .toastWrapper":"onToastClick"},onContentReady:function(){P.modules.ToastBase.prototype.onContentReady.call(this),P.context.instanceLogger.getInstance().logCustomViewEvent(P.genConst.ViewType.SAVE,P.genConst.ViewParameterType.EXTENSION_UPSELL_TOAST)},onToastClick:function(e){this._logCustomContextEvent(P.genConst.EventType.CLICK,P.genConst.ElementType.GET_EXTENSION_BUTTON,P.genConst.ComponentType.BROWSER,{}),e.preventDefault();var t={name:"BrowserButtonUpsell",options:{extension_installed:!!P.browserExtension.instance.isExtensionInstalled()}};P.moduleFactory.load(t).then(function(e){P.toastsManager.instance.removeAllToasts(),this.modal?this.modal.setSubmodule(e):this.showInModal(e)}.bind(this))}}),P.modules.ExtensionInstallToast.prototype.className="ExtensionInstallToast",goog.provide("P.modules.FacebookConnectLink"),goog.require("P.modules.LoginBase"),P.modules.FacebookConnectLink=P.modules.LoginBase.extend({events:{click:"facebookConnect"}}),P.modules.FacebookConnectLink.prototype.className="FacebookConnectLink",goog.provide("P.modules.FeedUsers"),goog.require("P.Module"),goog.require("P.modules.User"),P.modules.FeedUsers=P.Module.extend({unusedPinfluencers:[],onContentReady:function(){var e=this.data?_.pluck(this.data,"id"):[],t=this.resource.options.num_featured_users;this.unusedPinfluencers=e.length>t?e.slice(t):[],this.destroyIfEmpty()||this.childListen(P.CONST.EVENT_USER_FOLLOW,this.onChildActionTaken)},onChildActionTaken:function(e){var t=e.target;this.dismissUser(t)},dismissUser:function(e){e&&e.fadeOut(function(){this.unusedPinfluencers.length?this.replaceUser(e):this.removeUser(e)}.bind(this))},replaceUser:function(e){var t=this.unusedPinfluencers.pop();if(t){var o=new P.modules.User({resource:{name:"UserResource",options:{field_set_key:"grid_item",user_id:t}}});o.render().then(function(){o.show(),this.removeChild(e),this.appendChild(o),o.fadeIn()}.bind(this))}},removeUser:function(e){this.removeChild(e);var t=this.getChildByModuleName("User");t||this.remove(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}}),P.modules.FeedUsers.prototype.className="FeedUsers",goog.provide("P.modules.FlashlightEnabledImage"),goog.require("P.Module"),goog.require("P.modules.Image");var Bt=35,Mt=10;P.modules.FlashlightEnabledImage=P.modules.Image.extend({events:{"click .flashlightContainer":"onFlashlightContainerClick"},onContentReady:function(){var e=this.options.is_flashlight;if(this.options.state_isFlashlight=e,e){var t=this.getWidth(),o=this.options,n=this.data;o.is_flashlight=!1,o.in_flashlight=!0,o.width=t;var a={name:"CloseupFlashlight",data:n,options:{img_options:o,pin:n}},r={modal_style:"flashlightModal",can_dismiss:!0};P.moduleFactory.load(a).then(function(e){this.childListen(P.CONST.EVENT_BUTTON_CLICK,function(t){this.showInModal(e,r)})}.bind(this))}},onAddedToDom:function(){this.$window=$(window),this.$flashlightButton=this.$(".flashlightContainer");var e=this.options.is_flashlight;(e||this.options.state_isFlashlight)&&(this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onScroll),this.onScroll())},onFlashlightContainerClick:function(e){e.preventDefault(),e.stopPropagation()},onButtonClick:function(e){var t=e.target,o=t.id;switch(o){case"flashlightButton":this.onFlashlightClick()}},onScroll:function(){var e=this.$window.scrollTop(),t=this.$window.height(),o=this.$el.offset().top,n=this.$el.height();if(o+n>e+t){var a=e+t,r=o+Bt+Mt;this.$flashlightButton.css("top",a-r+"px")}else this.$flashlightButton.css("top","initial")},setupCropper:function(e){o.e(19,function(){o(210);var e=this.$el;this.$(".visualLiveSearchOverlayOuterWrapper").show();var t=e.width()/6,n=e.height()/6;return this.$(".visualLiveSearchOverlay").Jcrop({keySupport:!1,setSelect:[t,n,e.width()-t,e.height()-n],onSelect:function(t){var o=e.width(),n=e.height(),a=t.x,r=t.x2,i=t.y,s=t.y2,l={x:a/o,y:i/n,w:(r-a)/o,h:(s-i)/n},u={pinId:this.data.id,crop:l};P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_FLASHLIGHT_CROPPER_CHANGED,u)}.bind(this),onRelease:function(){var t=e.width(),o=e.height(),n={x:0,y:0,w:t,h:o},a={pinId:this.data.id,crop:n};P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_FLASHLIGHT_CROPPER_CHANGED,a)}.bind(this)}),this.$(".jcrop-holder").css({"background-color":""}),!1}.bind(this))}}),P.modules.FlashlightEnabledImage.prototype.className="FlashlightEnabledImage",goog.provide("P.modules.FollowButton"),goog.require("P.modules.Button"),goog.require("P.modules.Dropdown"),goog.require("P.url"),goog.require("P.ga"),goog.require("P.timer");var Dt="dim",Vt="primary",Wt="memoDropdown";P.modules.FollowButton=P.modules.Button.extend({getResourceId:function(){return null},getFollowResource:function(){return null},getFollowClass:function(){return Vt},getUnfollowClass:function(){return Dt},toggleState:function(){this.setState(!this.options.followed),this.trigger("toggleFollow"),this.getResourceId()&&P.pubSub.instance.publish(this.getResourceId(),this.options.followed?P.CONST.PUBSUB_TOPIC_USER_FOLLOW:P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW,!0)},setState:function(e){this.options.text=this.options[e?"unfollow_text":"follow_text"],this.options.followed=e,this.renderExistingData()},getState:function(){return this.options.followed},toggleFollow:function(){var e=this.getFollowResource();if(!e)return void this.log.error("No resource returned in `getFollowResource()`");this.showLoading();var t=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;(this.options.followed?e.callDelete():e.callCreate()).then(function(){t&&P.ga.trackEvent(t,P.CONST.GA_ACTION_SUCCESS),this.toggleState()}.bind(this),function(){t&&P.ga.trackEvent(t,P.CONST.GA_ACTION_ERROR)}).fin(function(){this.hideLoading()}.bind(this))},onClick:function(){if(this.ensureAuthentication()&&!this.options.is_me){var e=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;return e&&P.ga.trackEvent(e,P.CONST.GA_ACTION_CLICK),this.toggleFollow(),!1}},getAuthRedirectUrl:function(){return P.url.getRegisterUrl({action:"follow"})},hideMemo:function(){if(this.options.memo){var e=this.getChildById(Wt);e&&e.fadeOut(function(){e.destroy()})}},showMemo:function(){var e=this.options.memo&&this.options.memo.show;if(e&&!this.getChildById(Wt)){this.isClickButton=function(){return!1};var t=this.options.memo.position_point?this.options.memo.position_point:"RIGHT_CENTER",o={title:this.options.memo.title,anchor:this.$el,position_point:t,class_name:"autoFollowMemo",largeCaret:!1},n=new P.modules.Dropdown({id:Wt,options:o});this.appendChild(n),n.fadeIn(function(){P.timer.setTimeout(function(){this.hideMemo()}.bind(this),5e3)}.bind(this))}}}),P.modules.FollowButton.prototype.className="FollowButton",goog.provide("P.modules.FollowerCount"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.FollowerCount=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowerChange,e[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onFollowerChange,this.pubsubSubscribe(this.data.id,e),P.modules.NavigateButton.prototype.onContentReady.call(this)},onFollowerChange:function(e,t,o){this.render()}}),P.modules.FollowerCount.prototype.className="FollowerCount",goog.provide("P.modules.FollowingCount"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.FollowingCount=P.Module.extend({onContentReady:function(){P.modules.NavigateButton.prototype.onContentReady.call(this);var e={};e[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowingChange,e[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onFollowingChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},onFollowingChange:function(e,t,o){this.render()}}),P.modules.FollowingCount.prototype.className="FollowingCount",goog.provide("P.modules.GenericPinInfo"),goog.require("P.modules.PinInfo"),P.modules.GenericPinInfo=P.modules.PinInfo.extend({}),P.modules.GenericPinInfo.prototype.className="GenericPinInfo",goog.provide("P.modules.GeoFeatureList"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),P.modules.GeoFeatureList=P.Module.extend({events:{"click .dropdownTarget":"onTargetClick"},onListItemClick:function(e){var t=$(e.data).attr("data-index"),o=this.options.features[t];this.options.active_feature=o,this.hideDropdown(),this.render().then(function(){this.triggerEvent(P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST,o,!0)}.bind(this))},onContentReady:function(){var e={module:this.getContentModuleLoadOptions(),anchor:this.$(".dropdownTarget"),class_name:"aboveModal geoFeatureDropdown",prefetch:!0,position_point:"BOTTOM_LEFT"};this.options.active_feature=null,this._dropdown=new P.modules.Dropdown({options:e,id:"dropdown"})},updateFeatures:function(e){this.options.active_feature=null,this.options.features=e,this.render()},getContentModuleLoadOptions:function(){return{name:"List",options:{items:this.options.features}}},hideDropdown:function(){this._dropdown.hide()},onTargetClick:function(e){if(this._dropdown.isShowing())this.hideDropdown();else{var t=this;this._dropdown.show(function(){var e=t._dropdown.getChildByModuleName("List");t.listen(e,P.CONST.EVENT_LIST_ITEM_CLICK,t.onListItemClick)})}}}),P.modules.GeoFeatureList.prototype.className="GeoFeatureList",goog.provide("P.modules.Grid"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.modules.GridItems"),goog.require("P.timer");var jt=2,Ut=240;P.modules.Grid=P.Module.extend({events:{"click .navigator.left em":"onLeftNavigatorClick","click .navigator.right em":"onRightNavigatorClick"},CssClassName:{ERROR:"hasError",LOADING:"loading"},DRAGGING_ENABLED:"draggingEnabled",DRAGGING_DISABLED:"draggingDisabled",onContentReady:function(){if(this.options.show_grid_footer&&(this.childListen(P.CONST.EVENT_ERROR,this.onError),this.childListen(P.CONST.EVENT_ERROR_RESOLVED,this.onErrorResolved),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_START,this.onItemsRequestStart),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onItemsRequestSuccess),this.childListen(P.CONST.EVENT_ITEMS_END,this.onItemsEnd),"boardPinsGrid"!==this.options.view_type){var e={};e[P.CONST.PUBSUB_TOPIC_CLOSE_CLOSEUP]=this.onCloseupClose,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)}this.items=this.getChildByModuleName("GridItems"),this.footer=this.getChildByModuleName("GridFooter"),this._initializeDragManagerIfPossible(),this.footer&&this.hasItems()&&this.footer.show();var t=!!Cookie.get(P.CONST.COOKIE_GIFT_WRAP_HOLDOUT);if(P.user.instance.isAuthenticated()){var o={};o[P.CONST.PUBSUB_TOPIC_CONVERSATION_ADDED]=this.onConversationAdded,o[P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS]=this.onNoActiveConversations,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,o),P.conversationsManager.instance.hasActiveConversations()||this.onNoActiveConversations()}else this.showingPageTwoSneakPeek=!1,this.options.scrollable&&"row_layout"!==this.options.layout?t||this.attachScrollListener():this.hasMoreItems()?(this.requestMoreItemsAndBlock(),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.requestMoreItemsAndBlock)):this.options.show_grid_footer&&this.addNegativeSpace();this.options.scrollable&&"row_layout"===this.options.layout&&this.attachRowSliderScrollListener()},attachScrollListener:function(){this.scrollListener&&this.removeListener(this.scrollListener),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll)},attachRowSliderScrollListener:function(){this.scrollListener&&this.removeListener(this.scrollListener),this.$gridContainer=this.$(".gridContainer"),this.$gridItems=this.$(".GridItems.rowLayout"),this.$leftNav=this.$(".navigator.left"),this.$rightNav=this.$(".navigator.right"),this.scrollListener=this.listen(this.$gridContainer,P.CONST.EVENT_SCROLL,this._onSliderScroll),this._onSliderScroll()},hasItems:function(){return this.items.hasItems()},hasItemsOfType:function(e){return!!this.items.getChildrenByModuleName(e).length},hasMoreItems:function(){return this.items.hasMoreItems()},getGridItemsChildren:function(){var e=this.getGridItems();return e.getChildren()},requestMoreItems:function(){this.items.requestMoreItems()},requestMoreItemsIfNeeded:function(){this.items.requestMoreItemsIfNeeded()},emptyItems:function(){this.items.empty()},renderItems:function(e,t){this.items.render().then(e,t)},setPageSize:function(e){this.items.setPageSize(e)},getItemsResource:function(){return this.items.resource},setItemsResource:function(e){this.setResource(e),this.items&&this.items.setResource(e)},onCloseupClose:function(e,t,o){var n=this.getGridItemsChildren(),a=this._getPinByPinId(o,n);if(a){var r=a.getPinWrapperElement(),i=r.offset().top<window.pageYOffset+window.innerHeight;i||this.triggerEvent(P.CONST.EVENT_SCROLL_TO_ELEMENT,{$el:r},!0)}},_getPinByPinId:function(e,t){return _.find(t,function(t){return"Pin"===t.className&&t.data&&t.getId()===e})},onConversationAdded:function(){this.setDragState(this.DRAGGING_ENABLED)},onNoActiveConversations:function(){P.experiments.instance.v2InGroup("rearrange_pins_internal","employees")||this.setDragState(this.DRAGGING_DISABLED)},onError:function(){this.hasError=!0,this.$el.addClass(this.CssClassName.ERROR),this.footer&&(this.footer.showError(),this.footer.hideGridLoading())},onErrorResolved:function(){this.hasError&&(this.hasError=!1,this.$el.removeClass(this.CssClassName.ERROR))},onButtonClick:function(e){return"gridFooter"===e.target.id&&this.requestMoreItems(),!1},onItemsRequestStart:function(){this.footer&&this.footer.showGridLoading(),this.$rightNav&&this.$rightNav.addClass(this.CssClassName.LOADING)},_initializeDragManagerIfPossible:function(){P.user.instance.isAuthenticated()&&(this.items.initializeDragManager({}),this.dragState&&this.setDragState(this.dragState,!0))},setDragState:function(e,t){(this.dragState!==e||t)&&(this.dragState=e,this.dragState===this.DRAGGING_DISABLED?this.items.disableDragging():this.items.enableDragging())},onItemsRequestSuccess:function(){this.footer&&this.footer.hideError(),this.$rightNav&&(this.$rightNav.removeClass(this.CssClassName.LOADING),this.$rightNav.show())},forceDragState:function(){this.setDragState(this.dragState,!0)},onItemsEnd:function(){this.footer&&this.footer.hideGridLoading(),this.$rightNav&&this.$rightNav.removeClass(this.CssClassName.LOADING)},prependChildItem:function(e){this.getGridItems().prependChildItem(e)},prependNewItems:function(e,t){return this.getGridItems().prependNewItems(e,t)},getGridItems:function(){return this.items},getFirstGridItem:function(e){return this.getGridItems().getChildByModuleName(e)},requestMoreItemsAndBlock:function(){var e=this.getGridItems();if(e&&e.isReady()&&!this.showingPageTwoSneakPeek){var t=this.$el.height();this.showingPageTwoSneakPeek=!0,this.requestMoreItems(),this.$el.height(t),this.$el.css("overflow-y","hidden"),this.$el.css("margin-bottom",0)}},addNegativeSpace:function(){this.$(".GridFooter").hide(),this.$el.css("padding-bottom",Ut)},onScroll:function(){var e=this.getScrollableElement().scrollTop(),t=$(document).height()-this.getScrollableElement().height();e>=t-jt&&(this.addNegativeSpace(),this.removeListener(this.scrollListener))},_onSliderScroll:function(e){this.scrollLeft=e?e.target.scrollLeft:0,this.updateNavigators(),this.updateActiveItem(),this.scrollLeft>.9*this.$(".gridContainer").width()&&this.requestMoreItemsIfNeeded()},updateNavigators:function(){0===this.scrollLeft?this.hideLeftNavigator():this.showLeftNavigator(),this.scrollLeft<this.$gridItems.width()-this.$gridContainer.width()?this.showRightNavigator():this.$rightNav.hasClass(this.CssClassName.LOADING)||this.hideRightNavigator()},updateActiveItem:function(){
if(this.currentlyActiveItem&&!this._inScrollTransition){var e=this.currentlyActiveItem.getContent(),t=e.offset().left,o=this.$gridContainer.width();(t<this.$leftNav.width()||t>o-e.width())&&(this.triggerEvent(P.CONST.EVENT_ROW_ITEM_DEACTIVATED,null,!0),this.currentlyActiveItem=null)}},hideLeftNavigator:function(){this.$leftNav.hide()},showLeftNavigator:function(){this.$leftNav.show()},hideRightNavigator:function(){this.$rightNav.hide()},showRightNavigator:function(){this.$rightNav.show()},onLeftNavigatorClick:function(e){this.scrollSliderByPageOfItems(!0)},onRightNavigatorClick:function(e){this.scrollSliderByPageOfItems(!1)},scrollSliderByPageOfItems:function(e){var t=this._getSliderValues(),o=e?1-t.numberOfItemsPerPage:t.numberOfItemsPerPage+1,n=t.marginLeftOffset-t.sideMarginWidth+o*t.widthPerItem;0===t.numberOfItemsPerPage&&(n=e?t.marginLeftOffset-t.widthPerItem:t.marginLeftOffset+t.widthPerItem),this.$gridContainer.animate({scrollLeft:this.scrollLeft+n},200)},scrollToItem:function(e){var t=e.getContent().offset().left,o=this._getSliderValues(),n=function(){this.currentlyActiveItem=e,this.triggerEvent(P.CONST.EVENT_SCROLL_GRID_TO_ITEM_END,e,!0)}.bind(this),a=0;if(t<o.sideMarginWidth)a=t-o.containerLeftOffset-o.sideMarginWidth;else{if(!(t>o.sliderWidth-o.sideMarginWidth-o.widthPerItem))return void n();a=t-o.containerLeftOffset-o.sliderWidth+o.widthPerItem+o.sideMarginWidth}this._inScrollTransition=!0,this.$gridContainer.animate({scrollLeft:a},300,"swing",function(){P.timer.setTimeout(function(){n(),this._inScrollTransition=!1}.bind(this),100)}.bind(this))},_getSliderValues:function(){var e=this.$gridItems.offset().left,t=this.$gridContainer.width(),o=this.getGridItemsChildren()[0].getWidth()+P.CONST.PIN_MARGIN,n=Math.floor(.9*t/o),a=(t-n*o)/2,r=(this.$gridItems.offset().left-this.$gridContainer.offset().left)%o;return{containerLeftOffset:e,sliderWidth:t,widthPerItem:o,numberOfItemsPerPage:n,sideMarginWidth:a,marginLeftOffset:r}},increaseRowContainerHeight:function(e){var t=this.getGridItems().getContent(),o=this.getHeight(),n=o+e,a=o-n;this.$gridContainer.css({height:n,y:a}),t.css("y",-a),this.$el.css("height",o)},resetRowContainerHeight:function(){var e=this.getGridItems().getContent();this.$gridContainer.css({height:"",transform:""}),e.css("transform",""),this.$el.css({height:"",transform:""})},updateActiveGridItem:function(e){var t=this.getGridItems();t.setActiveItemById(e)}}),P.modules.Grid.prototype.className="Grid",goog.provide("P.modules.HeroBasic"),goog.require("P.modules.HeroHelperBase"),goog.require("P.util"),goog.require("P.genConst"),P.modules.HeroBasic=P.modules.HeroHelperBase.extend({onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.call(this),this.options.type=P.genConst.ExperienceReverse[String(this.experienceId)],P.util.trackRegisterAction("web_hero_app_upsell_displayed_"+this.experienceId)},onButtonClick:function(e){var t=e.target;if("close"===t.id)return void this.dismiss();if(t.options)switch(t.options.action){case P.genConst.ExperienceCompleteAction.COMPLETE:this.complete();break;case P.genConst.ExperienceCompleteAction.COMPLETE_AND_SHOW:this.complete(!0);break;case P.genConst.ExperienceCompleteAction.DONT_COMPLETE_AND_HIDE:this.hide();break;case P.genConst.ExperienceCompleteAction.DONT_COMPLETE_AND_SHOW:break;default:this.hide()}}}),P.modules.HeroBasic.prototype.className="HeroBasic",goog.provide("P.modules.HeroFixEmail"),goog.require("P.modules.HeroBasic"),goog.require("P.moduleFactory"),P.modules.HeroFixEmail=P.modules.HeroBasic.extend({onContentReady:function(){P.modules.HeroBasic.prototype.onContentReady.call(this);var e={};e[P.CONST.PUBSUB_MESSAGE_USER_EMAIL_UPDATED]=this.completeExperienceAndReload,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},complete:function(e){this.keepHero=e,this.showEditEmailModal()},showEditEmailModal:function(){var e=this.getChildById("complete");e.showLoading();var t={name:"UserEditEmail",resource:{name:"UserSettingsResource",options:{}}};P.moduleFactory.load(t).then(function(t){e.hideLoading(),this.showInModal(t)}.bind(this))},completeExperienceAndReload:function(){var e=this.getChildById("complete");e.showLoading(),P.modules.HeroBasic.prototype.complete.apply(this,[this.keepHero]),window.location.reload()}}),P.modules.HeroFixEmail.prototype.className="HeroFixEmail",goog.provide("P.modules.HeroRebuildFeed"),goog.require("P.modules.HeroBasic"),goog.require("P.resourceFactory");var zt=1;P.modules.HeroRebuildFeed=P.modules.HeroBasic.extend({complete:function(e){var t=this.getChildById("complete");t.showLoading();var o=P.resourceFactory.instance.create("UserStateResource",{state:"RESETTING_HOME_FEED",value:zt});o.callCreate().then(function(t){P.modules.HeroBasic.prototype.complete.apply(this,[e]),window.location.reload()}.bind(this),function(){})}}),P.modules.HeroRebuildFeed.prototype.className="HeroRebuildFeed",goog.provide("P.modules.HeroUndoRebuildFeed"),goog.require("P.modules.HeroBasic"),goog.require("P.timer"),goog.require("P.resourceFactory");var Ht=10,Gt=500,Kt=2;P.modules.HeroUndoRebuildFeed=P.modules.HeroBasic.extend({dismiss:function(e){var t=this.getChildById("close");t.showLoading();var o=P.resourceFactory.instance.create("OrientationContextResource",{});o.callDelete({showError:!1}).then(function(){this.pollFeedStatus(Ht)}.bind(this))},pollFeedStatus:function(e){0>=e&&window.location.reload();var t=P.resourceFactory.instance.create("UserStateResource",{state:"RESETTING_HOME_FEED"});t.callGet({showError:!1}).then(function(t){t.resource_response.data!==Kt?window.location.reload():P.timer.setTimeout(function(){this.pollFeedStatus(e-1)}.bind(this),Gt)}.bind(this),function(){P.timer.setTimeout(function(){this.pollFeedStatus(e-1)}.bind(this),Gt)}.bind(this))}}),P.modules.HeroUndoRebuildFeed.prototype.className="HeroUndoRebuildFeed",goog.provide("P.modules.HeroWebPush"),goog.require("P.modules.HeroBasic"),P.modules.HeroWebPush=P.modules.HeroBasic.extend({complete:function(e){P.modules.HeroBasic.prototype.complete.apply(this,[e]),P.WebPushManager.instance().subscribe()}}),P.modules.HeroWebPush.prototype.className="HeroWebPush",goog.provide("P.modules.HomeFeedPinFollowedInfo"),goog.require("P.modules.PinInfo"),goog.require("P.resourceFactory"),P.modules.HomeFeedPinFollowedInfo=P.modules.PinInfo.extend({events:_.extend(P.modules.PinInfo.prototype.events,{"click .unfollowBoard":"unfollowBoard","click .unfollowPinner":"unfollowPinner"}),unfollowBoard:function(){var e={board_id:this.options.board_id},t=P.resourceFactory.instance.create("BoardFollowResource",e);t.callDelete(),this.hidePin(P.CONST.FeedbackType.UNFOLLOW_BOARD,!0)},unfollowPinner:function(){var e={user_id:this.options.pinner_id},t=P.resourceFactory.instance.create("UserFollowResource",e);t.callDelete(),this.hidePin(P.CONST.FeedbackType.UNFOLLOW_PINNER,!0)}}),P.modules.HomeFeedPinFollowedInfo.prototype.className="HomeFeedPinFollowedInfo",goog.provide("P.modules.IncrementingNavigateButton"),goog.require("P.modules.NavigateButton"),P.modules.IncrementingNavigateButton=P.modules.NavigateButton.extend({CssClassName:_.extend(P.modules.NavigateButton.prototype.CssClassName,{IS_HIDDEN:"hidden"}),onContentReady:function(){this.updateOptions({is_hidden:!this.getValue()}),this.listen(this,P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.makeVisible),this.listen(this,P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.makeInvisible)},getValue:function(){if(void 0===this.options.actionCount){var e=$.trim(this.$el.text());return parseInt(e,10)}return this.options.actionCount},setValue:function(e){this.options.actionCount=e,this.$el.text(e)},makeVisible:function(){this.options.is_hidden&&this.updateOptionsAndDom({is_hidden:!1})},makeInvisible:function(){this.options.is_hidden||this.updateOptionsAndDom({is_hidden:!0})},updateDom:function(){this.$el.toggleClass(this.CssClassName.IS_HIDDEN,this.options.is_hidden)},increment:function(){var e=this.getValue();isNaN(e)&&(e=0),this.triggerEvent(P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.options.siblingButtonId,!0),e+=1,this.setValue(e)},decrement:function(){var e=this.getValue();return e-=1,0===e?void this.triggerEvent(P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.options.siblingButtonId,!0):void this.setValue(e)}}),P.modules.IncrementingNavigateButton.prototype.className="IncrementingNavigateButton",goog.provide("P.modules.InitiatePasswordReset"),goog.require("P.Form"),goog.require("P.Module"),goog.require("P.modules.UserSearchResult"),goog.require("P.string"),goog.require("P.i18n"),goog.require("P.validator"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),P.modules.InitiatePasswordReset=P.Module.extend({events:{"click .submitButton":"onSubmit","click .clearIcon":"onClearAnimation","focus .passwordResetSearch":"onClearAnimation","click .directSendEmail":"onSendEmail"},CssClassName:{HIDDEN:"hidden",EXPANDED:"expanded",SHRUNK:"shrunk",HAS_RESULTS:"hasResults",DIRECT_SEND:"directSend"},downloadWebfont:function(){var e=/(android)/i.test(navigator.userAgent);e&&$("head").append("<link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>"),this.$el.removeClass("hidden")},onContentReady:function(){this.downloadWebfont(),this.$form=this.$("form"),this.$header=this.$(".header"),this.$subtitle=this.$(".subtitle"),this.$noEmailAccessMessage=this.$(".noEmail"),this.$noSearchResultMessage=this.$(".noSearchResult"),this.$cantFindAccountMessage=this.$(".cantFindAccount"),this.$buttonDirectSendEmail=this.$(".directSendEmail"),this.$buttonPasswordResetSearch=this.$(".submitButton"),this.$inputPasswordResetSearch=this.$(".passwordResetSearch"),this.$successMessage=this.$(".successMessage"),this.$inputWrapper=this.$(".inputWrapper"),this.$userContainer=this.$(".allResults"),this.$resultsContainer=this.$(".searchResultsContainer"),this.$userSearchContainer=this.$(".userSearchContainer"),this.$emailSentMessage=this.$(".emailSent"),this.$clearIcon=this.$(".clearIcon"),this.form=new P.Form(this.$form,{email:[P.validator.Required(),P.validator.Email()]},{}),this.displayingResults=!1,this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var e={};e[P.CONST.PUBSUB_TOPIC_SEND_PASSWORD_RESET_EMAIL]=this.onSendEmail,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},onSubmit:function(){var e=this.$inputPasswordResetSearch.val();if(this.$inputPasswordResetSearch.blur(),this.onSubmitAnimation(),this.displayingResults=!0,P.string.isEmailAddress(e))this.promptSendEmail();else{if(""!==e){var t={scope:"obfuscated_users",query:e,page_size:25},o=this.createSearchResource(t),n=[];return o.callGet({showError:!1}).then(function(e){var t=e.resource_response.data.results;0!==t.length?(this.onSubmitTextChange(),t.forEach(function(e){var t={user:e},o=new P.modules.UserSearchResult({id:e.username,options:t});n.push(o.render().then(function(){o.getContent().appendTo(this.$userContainer)}.bind(this)).fin(function(){this.$cantFindAccountMessage.removeClass(this.CssClassName.HIDDEN),this.$resultsContainer.hide().show(0),this.$resultsContainer.addClass(this.CssClassName.HAS_RESULTS)}.bind(this)))}.bind(this))):this.onNoResult()}.bind(this),function(e){429===e.http_status&&P.errorUtil.showError(e.message)}).then(function(){return Promise.all(n)})}this.onNoResult()}},createSearchResource:function(e){return P.resourceFactory.instance.create("BaseSearchResource",e)},onNoResult:function(){this.$cantFindAccountMessage.addClass(this.CssClassName.HIDDEN),this.$noSearchResultMessage.removeClass(this.CssClassName.HIDDEN),this.$resultsContainer.addClass(this.CssClassName.HAS_RESULTS)},onClearAnimation:function(){if(this.displayingResults){var e=P.i18n._("Let&rsquo;s find your Pinterest account"),t=P.i18n._("What&rsquo;s your email, name or username?");this.$userContainer.empty(),this.$buttonDirectSendEmail.addClass(this.CssClassName.HIDDEN),this.$header.html(e),this.$subtitle.html(t),this.$emailSentMessage.addClass(this.CssClassName.HIDDEN),this.$noEmailAccessMessage.addClass(this.CssClassName.HIDDEN),this.$clearIcon.addClass(this.CssClassName.HIDDEN),this.$noSearchResultMessage.addClass(this.CssClassName.HIDDEN),this.$cantFindAccountMessage.addClass(this.CssClassName.HIDDEN),this.$resultsContainer.removeClass(this.CssClassName.HAS_RESULTS),this.$resultsContainer.removeClass(this.CssClassName.DIRECT_SEND),this.$inputPasswordResetSearch.val(""),this.$inputWrapper.removeClass(this.CssClassName.EXPANDED),this.$buttonPasswordResetSearch.removeClass(this.CssClassName.SHRUNK),this.displayingResults=!1}},onSubmitAnimation:function(){this.$clearIcon.removeClass(this.CssClassName.HIDDEN),this.$buttonPasswordResetSearch.addClass(this.CssClassName.SHRUNK),this.$emailSentMessage.addClass(this.CssClassName.HIDDEN),this.$inputWrapper.addClass(this.CssClassName.EXPANDED)},onSubmitTextChange:function(){var e=P.i18n._("Is this you?"),t=P.i18n._("We&rsquo;ll send you the info you need.");this.$header.text(e),this.$subtitle.html(t),this.$noEmailAccessMessage.removeClass(this.CssClassName.HIDDEN),this.$emailSentMessage.addClass(this.CssClassName.HIDDEN)},onSendEmail:function(e,t,o){this.$header.text(P.i18n._("Email sent!"));var n;o?n=o.obfuscatedEmail:(n=this.$inputPasswordResetSearch.val(),this.resetPassword(n));var a=P.i18n._("We sent a message to {{ obfuscatedEmail }} so you can pick your new password."),r=P.string.format(a,{obfuscatedEmail:n});this.$noEmailAccessMessage.addClass(this.CssClassName.HIDDEN),this.$buttonDirectSendEmail.addClass(this.CssClassName.HIDDEN),this.$emailSentMessage.removeClass(this.CssClassName.HIDDEN),this.$userSearchContainer.addClass(this.CssClassName.HIDDEN),this.$(".searchResultsScrollContainer").empty(),this.displayingResults=!1,this.$cantFindAccountMessage.addClass(this.CssClassName.HIDDEN),this.$subtitle.text(r),this.$resultsContainer.removeClass(this.CssClassName.HAS_RESULTS),this.$resultsContainer.removeClass(this.CssClassName.DIRECT_SEND)},onSubmitValidated:function(e){if(!e.errors[0]){var t=this.form.getValue("email");this.resetPassword(t)}},promptSendEmail:function(){this.$header.text(P.i18n._("Reset your password")),this.$subtitle.html(P.i18n._("We&rsquo;ll send you the info you need.")),this.$noEmailAccessMessage.removeClass(this.CssClassName.HIDDEN),this.$buttonDirectSendEmail.removeClass(this.CssClassName.HIDDEN),this.$resultsContainer.addClass(this.CssClassName.DIRECT_SEND)},resetPassword:function(e){var t={username_or_email:e},o=P.resourceFactory.instance.create("UserResetPasswordResource",t);o.callCreate({showError:!1})},onSuccess:function(e){this.$form.hide();var t=P.string.format(P.i18n._("We&rsquo;ll send a message to <strong>{{ email }}</strong> so you can pick your new password."),{email:e});this.$(".messageText").html(t),this.$successMessage.removeClass(this.CssClassName.HIDDEN),this.$successMessage.show()}}),P.modules.InitiatePasswordReset.prototype.className="InitiatePasswordReset",goog.provide("P.modules.InterestFollowButton"),goog.require("P.modules.Button"),goog.require("P.modules.FollowButton"),goog.require("P.ga"),goog.require("P.resourceFactory"),P.modules.InterestFollowButton=P.modules.FollowButton.extend({getResourceId:function(){return this.options.interest_id},getFollowResource:function(){var e={interest_list:P.CONST.INTEREST_LIST_FAVORITED,interest_id:this.getResourceId()};return this.options.referrer&&(e.referrer=this.options.referrer),P.resourceFactory.instance.create("InterestFollowResource",e)},getFollowClass:function(){return this.options.follow_class},onContentReady:function(){this.showMemo()},onClick:function(e){if(P.modules.Button.prototype.onClick.call(this,e),!P.context.instance.is_mobile_agent||this.ensureAuthentication()){if(!P.user.instance.isAuthenticated())return P.signupModalManager.showInlineSignupModalOnButtonClick("InterestFollowButton");var t=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;t&&P.ga.trackEvent(t,P.CONST.GA_ACTION_CLICK),this.toggleFollow()}}}),P.modules.InterestFollowButton.prototype.className="InterestFollowButton",goog.provide("P.modules.InterestPinInfo"),goog.require("P.modules.PinInfo"),goog.require("P.timer"),goog.require("P.resourceFactory"),P.modules.InterestPinInfo=P.modules.PinInfo.extend({events:_.extend(P.modules.PinInfo.prototype.events,{"click .reportUnrelatedPin":"reportUnrelatedPin","click .unfollowInterest":"unfollowInterest"}),reportUnrelatedPin:function(){var e=this.options.pin_id;this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.timer.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_INTEREST_PAGE,P.CONST.FeedbackType.DOWNVOTE)}.bind(this),this.HIDE_DELAY)},_getFollowResource:function(){var e={interest_list:P.CONST.INTEREST_LIST_FAVORITED,interest_id:this.options.interest_id};return this.options.referrer&&(e.referrer=this.options.referrer),P.resourceFactory.instance.create("InterestFollowResource",e)},unfollowInterest:function(){this._getFollowResource().callDelete();var e=this.options.pin_id;this.$(".preAction").addClass(this.CssClassName.HIDDEN),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.timer.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_UNFOLLOW,P.CONST.FeedbackType.UNFOLLOW_INTEREST)}.bind(this),this.HIDE_DELAY)}}),P.modules.InterestPinInfo.prototype.className="InterestPinInfo",goog.provide("P.modules.InviteLanding"),goog.require("P.Module"),goog.require("P.modules.InviteModal"),goog.require("P.util"),P.modules.InviteLanding=P.Module.extend({onContentReady:function(){P.util.trackRegisterAction("web_invite_landing"),P.Invite.trackInviteFunnelAction("invite_landing");var e=this.extraData.invite_type;switch(e){case"reminder_1":P.Invite.trackInviteFunnelAction("recipient_invite_reminder1_landing",!0);break;case"reminder_2":P.Invite.trackInviteFunnelAction("recipient_invite_reminder2_landing",!0);break;default:P.Invite.trackInviteFunnelAction("recipient_invite_landing",!0)}this.extraData.show_invite_modal&&P.modules.InviteModal.showInviteModal(this.options.inviter_user_id,"user")}}),P.modules.InviteLanding.prototype.className="InviteLanding",goog.provide("P.modules.JoinButton"),goog.require("P.modules.NavigateButton"),goog.require("P.url"),P.modules.JoinButton=P.modules.NavigateButton.extend({getNavigateUrl:function(e){return P.url.getRegisterUrl({action:"join"})}}),P.modules.JoinButton.prototype.className="JoinButton",goog.provide("P.modules.Login"),goog.require("P.modules.LoginBase"),goog.require("P.util"),goog.require("P.url"),P.modules.Login=P.modules.LoginBase.extend({events:{"focus input[name=username_or_email]":"onFocusEmail","click .forgotPassword":"onForgotPassword"},onFocusEmail:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onContentReady:function(){P.url.getQueryStringParams().auto_facebook_signup&&this.registerWithFacebook();var e={},t=this.options.invite_follow_board,o=this.options.invite_follow_user;return o&&(t?e.invite_follow_board=o+"/"+t:e.invite_follow_user=o,P.storage.sessionStorage.setItem(P.CONST.SESSION_KEY_INVITE_FOLLOW,e)),!P.user.instance.isAuthenticated()||P.user.instance.get("autologin")||P.user.instance.isLimitedLogin()?(P.modules.LoginBase.prototype.onContentReady.apply(this,arguments),void(this.$inputEmail=this.$("input[name=username_or_email]"))):void this.redirect(e)},onForgotPassword:function(e){P.util.changeWindowLocation(""+$(e.target).attr("href"))}}),P.modules.Login.prototype.className="Login",goog.provide("P.modules.LoginButton"),goog.require("P.modules.NavigateButton"),P.modules.LoginButton=P.modules.NavigateButton.extend({onClick:function(e){return P.signupModalManager.showInlineSignupModalOnButtonClick("LoginButton")}}),P.modules.LoginButton.prototype.className="LoginButton",goog.provide("P.modules.Modal"),goog.require("P.modules.PositionModule"),goog.require("P.modules.Button"),goog.require("P.Module"),goog.require("P.ga"),goog.require("P.genConst"),goog.require("P.errorUtil");var Yt=300,qt="Chrome Mobile iOS";P.modules.Modal=P.modules.PositionModule.extend({events:{"mousedown .modalScroller":"onModalDown","touchstart .modalScroller":"onModalDown","click .modalScroller":"onModalScrollerClick","touchmove .modalScroller":"onModalScrollerTouchMoveOrMouseWheel","mousewheel .modalScroller":"onModalScrollerTouchMoveOrMouseWheel","click .closeModal":"onCloseModalClick","blur .modalScroller":"onKeyboardClose"},CssClassName:_.extend(P.modules.PositionModule.prototype.CssClassName,{SHOW:"show"}),positionMode:P.CONST.PositionMode.VIEWPORT_MIDDLE,onCreated:function(){this.options.showCloseModal=!1,this.options.mouseDownInModal=!1,P.modules.PositionModule.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildButtonClick)},_addSubmoduleToContainer:function(e){e.id="submodule",e.errorStrategy=P.CONST.ErrorStrategy.SHOW,this.insertChild(e,this.getModuleContainer());var t=e.render().then(function(){e.setModal(this)}.bind(this));return this.listen(e,P.CONST.EVENT_ERROR,function(e,t){var o=P.i18n.commonStrings.defaultErrorMessage;this.options.show_api_error&&e.data.message&&(o=e.data.message),P.errorUtil.showError(o),this.animateOutAndDestroy()}),t},onContentReady:function(){var e=this.getSubmodule();e&&e.setModal(this)},_showMask:function(){var e=this.getMask();P.dom.deferWrite().then(function(){e.addClass(this.CssClassName.SHOW)}.bind(this))},setVisible:function(e){this.$el.toggleClass(this.CssClassName.SHOW,e)},_isPanel:function(){return this.options.presentation_type===P.genConst.ModalPresentationType.PANEL},_isPanelRight:function(){var e=this.options.presentation_options||{};return e.panel_direction===P.genConst.ModalPanelDirection.PANEL_RIGHT},onRendered:function(){this.positionMode=this._isPanel()?P.CONST.PositionMode.MANUAL:P.CONST.PositionMode.VIEWPORT_MIDDLE},onChildRendered:function(){this.updateOptionsAndDom({showCloseModal:!0})},updateDom:function(){this.$(".closeModal").toggleClass(this.CssClassName.SHOW,this.options.showCloseModal)},show:function(){if(this.positionModule(),this.$el.addClass(this.CssClassName.SHOW),this.options.custom_entrance_animation)P.dom.deferWrite().then(function(){this.getSubmodule().animateEntranceToModal()}.bind(this));else{var e=this.getSubmodule(),t=this.getModuleContainer();this._showMask(),e&&e.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_SHOW_START,null,!1);var o=this._isPanel()?{x:(this._isPanelRight()?1:-1)*t.width(),duration:1}:{duration:0},n=this._isPanel()?{x:0,easing:"cubic-bezier(.19, 1.15, .48, 1)",duration:Yt}:{duration:0};t.transition(o,function(){this.getPositionElement().addClass(this.CssClassName.SHOW)}.bind(this)).transition(n,function(){P.dom.deferWrite().then(function(){e&&e.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_SHOW_END,null,!1)})})}},animateOutAndDestroy:function(){var e=this.getSubmodule();if(this.options.custom_exit_animation&&e)e.animateExitFromModal();else{var t=this.getModuleContainer(),o=this.getSubmodule(),n=this.getMask();P.dom.deferWrite().then(function(){n.removeClass(this.CssClassName.SHOW)}.bind(this)),o&&o.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_HIDE_START,null,!1);var a=this._isPanel()?{x:(this._isPanelRight()?1:-1)*t.width(),easing:"cubic-bezier(.36, -.15, .21, 1)",duration:Yt}:{duration:0};t.transition(a,function(){var e=this.getSubmodule();e&&e.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_HIDE_END,null,!1),P.dom.deferWrite().then(function(){t.removeClass(this.CssClassName.SHOW)}.bind(this)),this.destroy()}.bind(this))}},onAddedToDom:function(){P.Body.pushScrolling(!1)},onRemovedFromDom:function(){P.Body.pop()},getSubmodule:function(){return this.getChildById("submodule")||null},getContent:function(){return this.$(".modalContent")},getModuleContainer:function(){return this.$(".modalModule")},getMask:function(){return this.$(".modalMask")},getModalScroller:function(){return this.$(".modalScroller")},getFullName:function(){var e=P.Module.prototype.getFullName.call(this);return this.moduleOpener&&(e=this.moduleOpener.getFullName()+"#"+e),e},getPositionElement:function(){return this.$(".modalContainer")},setSubmodule:function(e){var t=this.getChildById("submodule");return t&&(t.id="",t.remove()),this._addSubmoduleToContainer(e)},onChildRemoved:function(e,t){this.getChildById("submodule")||this.destroy()},onChildButtonClick:function(e){var t=e.target;if(t&&t.isCancelButton()){var o=this.getSubmodule(),n=o.GACategory;n||(n=o.options.ga_category),n&&P.ga.trackEvent(n,P.CONST.GA_ACTION_CLICK_CANCEL),e.stopPropagation(),this.animateOutAndDestroy()}},onModalScrollerClick:function(e){var t=$(e.target).closest(".modalContent").length>0,o=t||this.options.mouseDownInModal;if(!o&&(e.stopPropagation(),this.getCanDismiss())){this.animateOutAndDestroy();var n=this.getSubmodule();n&&n.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)}this.options.mouseDownInModal=!1},onModalDown:function(e){this.options.mouseDownInModal=$(e.target).closest(".modalContent").length>0},onModalScrollerTouchMoveOrMouseWheel:function(e){var t=$(e.target).closest(".modalContent").length>0;t||(e.preventDefault(),e.stopPropagation())},onCloseModalClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.getSubmodule().triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.destroy()},onKeyboardClose:function(e){P.context.instance.browser_name===qt&&window.scrollTo(0,1)},getCanDismiss:function(){var e=this.options.can_dismiss;return void 0===e||e}}),P.modules.Modal.prototype.className="Modal",goog.provide("P.modules.ModalStepBase"),goog.require("P.interfaces.ModalTutorialStep"),goog.require("P.Module"),goog.require("P.modules.StepBase");var $t="tutorialHighlightMask",Jt="tutorialHighlightBackground",Xt="href";P.modules.ModalStepBase=P.modules.StepBase.extend({CssClassName:_.extend(P.modules.StepBase.prototype.CssClassName,{TUTORIAL_HIGHLIGHT:"tutorialHighlight"}),highlightedElements:{},initializeStep:function(){this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize)},disableCloneLinks:function(e){var t=e.find("a");_.each(t,function(e){var t=$(e),o=t.attr(Xt);t.attr("data-href",o).removeAttr(Xt)})},disableButtonCloneLinks:function(e){e.removeAttr(Xt)},setModalPosition:function(e,t,o,n){var a="VIEWPORT_MIDDLE";e&&t&&(a="ANCHORED",this.modal.options.position_point=e,this.modal.options.anchor=t),this.modal.options.position_mode=a,void 0!==n&&(this.modal.options.fixed=n),this.modal.options.caret=!0,o&&this.modal.positionModule()},setCloneInteractions:function(e){var t=$("body"),o=$('<div class="'+$t+'"/>');o.addClass(this.CssClassName.TUTORIAL_HIGHLIGHT),t.append(o),e.$mask=o,this.disableCloneLinks(e)},setCloneBackground:function(e){var t=$("body"),o=$('<div class="'+Jt+'"/>');o.addClass(this.CssClassName.TUTORIAL_HIGHLIGHT),t.append(o),e.$background=o},setCloneDimensions:function(e,t){var o=t.outerWidth()+1,n=t.outerHeight()+1;e.css({width:o,height:n,"box-sizing":"border-box"})},ensurePath:function(e){window.location.pathname!==e&&this.navigate(e)},cleanHighlightedElements:function(){$("."+this.CssClassName.TUTORIAL_HIGHLIGHT).remove(),this.highlightedElements={}},_getModuleChildById:function(e,t){var o=e._childrenIdMap[t];if(o)return o;for(var n,a=0,r=e.children.length;r>a;a++)if(n=e.children[a],o=this._getModuleChildById(n,t))return o},_getModuleChildrenByModuleName:function(e,t){var o=[];return _.each(e.children,function(e){e.className===t&&o.push(e),o=o.concat(this._getModuleChildrenByModuleName(e,t))}.bind(this)),o},_highlightModule:function(e,t){return this._highlightElement(e.cid,e.$el,t)},_highlightElement:function(e,t,o){var n;if(o){n=t.clone(),n.$origin=t,n.attr("id",e),n.addClass(this.CssClassName.TUTORIAL_HIGHLIGHT),this.highlightedElements[e]=n;var a=$("body");a.append(n),this.options.has_background&&this.setCloneBackground(n),void 0!==this.options.disable_mask&&this.options.disable_mask||this.setCloneInteractions(n),this.setCloneDimensions(n,t),this.positionClone(n)}else n=this.highlightedElements[e],n&&(n.remove(),delete this.highlightedElements[e]);return n},positionClone:function(e){var t=e.$origin.parents().addBack();t.css("animation-duration","0s"),_.defer(function(){var o=e.$origin.offset();o={top:o.top,left:o.left};var n=o.top-$(window).scrollTop();n>0&&(o.top=n),e.css(o);var a=$.extend({},o,{height:e.outerHeight(),width:e.outerWidth()});e.$mask&&e.$mask.css(a),e.$background&&(this.options.background_class&&e.$background.addClass(this.options.background_class),e.$background.css(a)),this.modal&&this.modal.positionModule(),t.css("animation-duration","")}.bind(this))},onResize:function(){_.each(this.highlightedElements,this.positionClone.bind(this))},onRemoved:function(){this.cleanHighlightedElements()}}),P.modules.ModalStepBase.prototype.className="ModalStepBase",goog.provide("P.modules.MultipleUserBlock"),goog.require("P.modules.UserBlock"),P.modules.MultipleUserBlock=P.modules.UserBlock.extend({onSubmitValidated:function(e){if(!e.errors[0]){var t=this.getChildById("submitButton"),o=this.options.users,n=this.options.blocked_users;_.each(o,function(e){-1!==_.indexOf(n,e.user_id)&&this.blockUser(e,t)}.bind(this))}}}),P.modules.MultipleUserBlock.prototype.className="MultipleUserBlock",goog.provide("P.modules.NetworkNotificationItems"),goog.require("P.Module"),goog.require("P.modules.NotificationLoadingItem"),goog.require("P.i18n");var Zt="<div class='networkNotifDateHeader unseenHeader todayHeader'><span> {{text}} </span></div>",Qt="<div class='networkNotifDateHeader'><span> {{timeSince}} </span></div>",eo=".networkNotifDateHeader";P.modules.NetworkNotificationItems=P.Module.extend({events:{addHeaders:"addHeadersToContent",appendLoadingItem:"appendLoadingItem",removeLoadingItem:"removeLoadingItem"},CssClassName:{UNSEEN:"unseen"},onContentReady:function(){this.listen(this,"addHeaders",this.addHeadersToContent),this.trigger("addHeaders"),this.loadingItem=null},addHeadersToContent:function(){this.$(eo).remove();var e=!1,t="",o=P.i18n._("Today's stories"),n=P.string.format(Zt,{text:o}),a=this.$(".networkNotifItem"),r=this;a.each(function(o){var a=$(this),i=a.data("time"),s=new Date(1e3*parseInt(i,10)),l=new Date,u=P.locale.formatDate(l,P.locale.DateFormatType.WEEKDAY_DATE),d=P.locale.formatDate(s,P.locale.DateFormatType.WEEKDAY_DATE);u===d&&a.addClass(r.CssClassName.UNSEEN),u!==d||e?d!==t&&$(Qt.replace("{{timeSince}}",d)).insertBefore(a):($(n).insertBefore(a),e=!0),t=d})},appendLoadingItem:function(){this.removeLoadingItem(),this.loadingItem=new P.modules.NotificationLoadingItem,this.loadingItem.render().then(function(){this.insertChild(this.loadingItem,this.$el)}.bind(this))},removeLoadingItem:function(){this.loadingItem&&(this.loadingItem.destroy(),this.loadingItem=null)}}),P.modules.NetworkNotificationItems.prototype.className="NetworkNotificationItems",goog.provide("P.modules.NewUserStepBase"),goog.require("P.modules.StepBase"),goog.require("P.app"),P.modules.NewUserStepBase=P.modules.StepBase.extend({CssClassName:_.extend(P.modules.StepBase.prototype.CssClassName,{HIDDEN:"hidden"}),onContentReady:function(){this.nuxProgress=P.app.instance.getChildById("nuxProgress"),this.nuxProgress.initializeProgress({module:this})},hideStepHeader:function(){this.$(".newUserStepHeader").addClass(this.CssClassName.HIDDEN)}}),P.modules.NewUserStepBase.prototype.className="NewUserStepBase",goog.provide("P.modules.NewUserWelcome"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserWelcome=P.modules.NewUserStepBase.extend({onButtonClick:function(e){var t=e.target;t.disable(),this.$(".spinner").show()}}),P.modules.NewUserWelcome.prototype.className="NewUserWelcome",goog.provide("P.modules.NotificationItems"),goog.require("P.Module"),goog.require("P.modules.NotificationLoadingItem"),P.modules.NotificationItems=P.Module.extend({events:{appendLoading:"appendLoadingItem",removeLoading:"removeLoadingItem"},onContentReady:function(){this.loadingItem=null},appendLoadingItem:function(){
this.removeLoadingItem(),this.loadingItem=new P.modules.NotificationLoadingItem,this.loadingItem.render().then(function(){this.insertChild(this.loadingItem,this.$el)}.bind(this))},removeLoadingItem:function(){this.loadingItem&&(this.loadingItem.destroy(),this.loadingItem=null)}}),P.modules.NotificationItems.prototype.className="NotificationItems",goog.provide("P.modules.NotificationsConversationsDropdown"),goog.require("P.Module"),goog.require("P.modules.CreateConversationGroup"),P.modules.NotificationsConversationsDropdown=P.Module.extend({CssClassName:{SHOWING_CONVERSATIONS:"conversationsShowing"},onCreated:function(){var e={};this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_SEND_OBJECT_TO_USERS,this.onCreateConversationWithUsers),this.showingConversationGroup=!1,e[P.CONST.PUBSUB_TOPIC_CONVERSATION_SET_BADGE]=this.setConversationBadge,e[P.CONST.PUBSUB_TOPIC_NOTIFICATION_SET_BADGE]=this.setNotificationBadge,e[P.CONST.PUBSUB_TOPIC_NETWORK_STORY_SET_BADGE]=this.setNetworkStoryBadge,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},show:function(){P.Module.prototype.show.call(this)},hide:function(){P.Module.prototype.hide.call(this)},onChildRemoved:function(e,t){P.Module.prototype.onChildRemoved.call(this,e,t),this.removeCreateConversationGroup()},onChildAdded:function(e){P.Module.prototype.onChildAdded.call(this,e)},onButtonClick:function(e){var t=e.target;if(t.isCancelButton())return void this.removeCreateConversationGroup();switch(t.id){case"conversationsButton":P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_DROPDOWN_SHOW,{}),this.$el.addClass(this.CssClassName.SHOWING_CONVERSATIONS);break;case"notificationsButton":P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NOTIFICATION_DROPDOWN_SHOW,{}),this.$el.removeClass(this.CssClassName.SHOWING_CONVERSATIONS);break;case"networkNotificationsButton":P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NETWORK_STORY_DROPDOWN_SHOW,{}),this.$el.removeClass(this.CssClassName.SHOWING_CONVERSATIONS);break;case"newMessage":this.showCreateConversationGroup()}},setBadge:function(e,t){e&&(t>0?e.setBadge(t):e.clearBadge())},setConversationBadge:function(e,t,o){var n=this.getConversationsSegmentedButton();this.setBadge(n,o)},setNotificationBadge:function(e,t,o){var n=this.getNotificationsSegmentedButton();this.setBadge(n,o)},setNetworkStoryBadge:function(e,t,o){var n=this.getNetworkNotifSegmentedButton();this.setBadge(n,o)},onCreateConversationWithUsers:function(e){var t=e.data.user_ids,o=e.data.emails,n={text:e.data.text};P.conversationsManager.instance.sendMessageToUsers(t,o,n).then(function(e){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.render()}.bind(this))},showCreateConversationGroup:function(){this.showingConversationGroup||(this.createConversationGroup=new P.modules.CreateConversationGroup({}),this.createConversationGroup.renderExistingData().then(function(){this.appendChild(this.createConversationGroup)}.bind(this))),this.showingConversationGroup=!0},removeCreateConversationGroup:function(){(this.showingConversationGroup||this.createConversationGroup)&&(this.createConversationGroup.destroy(),this.createConversationGroup=null),this.showingConversationGroup=!1},getConversationsSegmentedButton:function(){var e=this._getSegmentedController();return e?e.getChildById("conversationsButton"):void 0},getNotificationsSegmentedButton:function(){var e=this._getSegmentedController();return e?e.getChildById("notificationsButton"):void 0},getNetworkNotifSegmentedButton:function(){var e=this._getSegmentedController();return e?e.getChildById("networkNotificationsButton"):void 0},setConversationsActiveSegment:function(){var e=this._getSegmentedController();this.$el.addClass(this.CssClassName.SHOWING_CONVERSATIONS),e.makeActiveModuleFromIndex(1)},_getSegmentedController:function(){return this.getChildById("segmentedController")},setNotificationsActiveSegment:function(){var e=this._getSegmentedController();this.$el.removeClass(this.CssClassName.SHOWING_CONVERSATIONS),e.makeActiveModuleFromIndex(0)},getNotificationsSegment:function(){var e=this._getSegmentedController(),t;return e&&(t=e.getChildByModuleName("notifications")),t}}),P.modules.NotificationsConversationsDropdown.prototype.className="NotificationsConversationsDropdown",goog.provide("P.modules.NuxModalStepBase"),goog.require("P.modules.StepBase"),goog.require("P.CONST"),goog.require("P.moduleFactory"),goog.require("P.i18n"),P.modules.NuxModalStepBase=P.modules.StepBase.extend({events:{"click .optionalSkip":"onSkipClick"},onContentReady:function(){var e=this.getChildById("nuxModalDismissButton");e&&this.listen(e,P.CONST.EVENT_BUTTON_CLICK,this.onDismiss)},onSkipClick:function(){this._launchSkipConfirmDialog()},_launchSkipConfirmDialog:function(){var e=this.options.skip_message?this.options.skip_message:P.i18n._("Are you sure you want to skip this step?"),t={name:"ConfirmDialog",options:{title:P.i18n._("Skip this step?"),body_message:e,dismiss_button_text:P.i18n._("Go back"),button_text:P.i18n._("Skip"),template:"generic"}};P.moduleFactory.load(t).then(function(e){this.showInModal(e,{mask_type:"dark",can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CONFIRM,this._goToNextStep)}.bind(this))},onNextButtonClicked:function(){var e=this.getChildById("nextButton");e&&e.showLoading(),P.modules.StepBase.prototype.onNextButtonClicked.call(this)},getExperienceId:function(){return this.options.experienceID},getPlacementId:function(){return this.options.placementID},onDismiss:function(e){P.ExperienceTutorialManager.instance()._dismiss()}}),P.modules.NuxModalStepBase.prototype.className="NuxModalStepBase",goog.provide("P.modules.NuxProgress"),goog.require("P.modules.NuxProgressBase"),goog.require("P.ga"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.resourceFactory");var to="nuxTutorialProgress";P.modules.NuxProgress=P.modules.NuxProgressBase.extend({CssClassName:P.modules.NuxProgressBase.prototype.CssClassName,onCreated:function(){P.modules.NuxProgressBase.prototype.onCreated.call(this);var e={};e[P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT]=this.updateMiniStep,e[P.CONST.PUBSUB_TOPIC_TUTORIAL_SKIP_PROGRESS_BAR_STEP]=this.skipProgessBarStep,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,e)},autoFollowInterest:function(e){var t={interest_list:"favorited",interest_id:e},o="InterestFollowResource",n="interest_auto_follow",a=P.resourceFactory.instance.create(o,t);a.callCreate({showError:!1}).then(function(e){P.ga.trackEvent(n,P.CONST.GA_ACTION_SUCCESS)},function(e){P.ga.trackEvent(n,P.CONST.GA_ACTION_ERROR)})},onContentReady:function(){this.$progressWrapper=this.$(".nuxProgress"),this.progressBar=this.getChildByModuleName("Progress"),this.$progressWrapper.removeClass(this.CssClassName.HIDDEN),P.modules.NuxProgressBase.prototype.onContentReady.call(this)},onChildRendered:function(e){var t=this.progressData[this.getNuxTutorialName()];e.id===to&&"bar"===t.progressBarType&&this.progressBar.updateStepWidths()},nextStep:function(e){P.modules.NuxProgressBase.prototype.nextStep.call(this,e),this.setProgressBar(e)},setProgressBar:function(e){var t=this.progressData[this.getNuxTutorialName()];if(t){var o=t.steps,n=_.values(o);this.hasMinisteps=_.all(n,function(e){return _.has(e,"miniStepData")}),this.hasMinisteps?(_.isUndefined(this.stepSequences)&&(this.stepSequences=_.pluck(n,"miniStepData"),this.miniStepSequences=_.flatten(this.stepSequences,!1),this.progressBar.options={steps:this.miniStepSequences.length,ministeps:this.miniStepSequences,type:t.progressBarType},this.progressBar.render()),o[this.currentStep].enableOnMiniStepsFull&&this.nextButton.disable()):(this.progressBar.options={current_step:e,steps:n.length},this.progressBar.render());var a=o[e];a&&a.hide_progress_bar?this.$(".progressFooterWrapper").addClass(this.CssClassName.HIDDEN):this.$(".progressFooterWrapper").removeClass(this.CssClassName.HIDDEN)}},updateMiniStep:function(e,t,o){var n=o,a=_.where(this.miniStepSequences,{type:n.type}).length,r=_.isNumber(n.total)?n.total:1;r=Math.min(Math.max(r,0),a),this.progressBar.setMiniStepProgress(n.type,r),this.setMiniStepMessage(n.type,r);var i=this.progressData[this.getNuxTutorialName()].steps[this.currentStep];i.enableOnMiniStepsFull&&(a===r?(this.nextButton.enable(),i.enabledButtonText&&this.nextButton.setText(i.enabledButtonText)):(this.nextButton.disable(),i.enabledButtonText&&this.nextButton.setText(i.buttonText)))},setMiniStepMessage:function(e,t){var o=_.filter(this.miniStepSequences,function(t){return t.type===e}),n="";if(t>0&&t<=o.length){var a=o[t-1];a&&(n=a.finishedStepText)}var r=this.$(".contextualProgress");r&&r.text(n)},endMandatoryFlow:function(){return P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_MANDATORY_AUTOBAHN)?P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_MANDATORY_AUTOBAHN):Promise.resolve()},setStepTexts:function(e){var t,o,n,a;if(this.progressData){var r=this.progressData[this.getNuxTutorialName()];if(r){var i=r.steps;if(i){var s=i[e];s&&(t=s.buttonText,o=s.header1,n=s.header2,a=s.skip_data)}}}this.$skip&&(this.$skip.unbind(),P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_REBUILD_FEED)?(this.$skip.removeClass(this.CssClassName.HIDDEN),this.$skip.bind("click",function(){var e=P.resourceFactory.instance.create("UserStateResource",{state:"RESETTING_HOME_FEED"});e.callDelete().then(function(e){window.location.reload()},function(){})})):this._handleSkipButton(a)),t&&(this.getNextButton().setText(t),this.getNextButton().show()),this._updateHeaders(o,n)},skipProgessBarStep:function(){var e=_.indexOf(this.tutorialManager.allStepNames,this.tutorialManager.currentStep)+1;if(this.progressData){var t=this.progressData[this.getNuxTutorialName()];if(t){var o=t.steps;if(o){var n=o[e];if(n){var a=n.skip_data;this._launchSkipConfirmDialog(a)}}}}}}),P.modules.NuxProgress.prototype.className="NuxProgress",goog.provide("P.modules.OAuthAuthorizationPage"),goog.require("P.Form"),goog.require("P.modules.OAuthPageBase"),P.modules.OAuthAuthorizationPage=P.modules.OAuthPageBase.extend({onContentReady:function(){this.tryRedirect(this.data),this.form=new P.Form(this.$("form"),{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.authorizeConsumer),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(e){return"cancelButton"===e.target.id?this.cancelAuthorization():void 0},authorizeConsumer:function(){var e=this.getChildById("submitButton");e.showLoading(),this.makeAuthorizationDecision(!0,e)},cancelAuthorization:function(){var e=this.getChildById("cancelButton");e.showLoading(),this.makeAuthorizationDecision(!1,e)}}),P.modules.OAuthAuthorizationPage.prototype.className="OAuthAuthorizationPage",goog.provide("P.modules.OAuthPage"),goog.require("P.modules.OAuthPageBase"),goog.require("P.url"),P.modules.OAuthPage=P.modules.OAuthPageBase.extend({events:{"click .authorizeApp":"onAuthorizeButtonClicked","click .joinButton":"onJoinButtonClicked"},onJoinButtonClicked:function(){this.navigate("/join/register/email/?next="+encodeURIComponent(P.url.getCurrentUrl()))}}),P.modules.OAuthPage.prototype.className="OAuthPage",goog.provide("P.modules.PagedGrid"),goog.require("P.modules.PagedCollection"),goog.require("P.modules.Grid");var oo=9;P.modules.PagedGrid=P.modules.PagedCollection.extend({CssClassName:_.extend(P.modules.PagedCollection.prototype.CssClassName,{HIDE:"hide"}),onAddedToDom:function(){this.contentReady&&this._setUpGrid()},onContentReady:function(){P.modules.PagedCollection.prototype.onContentReady.call(this),this.inDom&&this._setUpGrid()},_getGrid:function(){return this.getChildById("grid")},prependChildItem:function(e){var t=this._getGrid();t.prependChildItem(e)},_setUpGrid:function(){var e=this._getGrid(),t=this.options.ajax_page_size||oo;e.setPageSize(t),e.hasMoreItems()||this.getMoreItemsButton().getContent().addClass(this.CssClassName.HIDE),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_ERROR,this.onChildError)},hasItems:function(){var e=this._getGrid();return e.hasItems()},requestMore:function(){if(this.contentReady){this.showMoreItemsLoading();var e=this._getGrid();e.requestMoreItems()}},onChildContentChanged:function(){this.hideMoreItemsLoading();var e=this.getMoreItemsButton();if(e){if(this.gridHasError)return e.hide(),void(this.gridHasError=!1);var t=this._getGrid();t.hasMoreItems()?e.show():e.destroy()}},onChildError:function(e){this.log.debug("Child error!",e),e.target===this._getGrid()&&(this.gridHasError=!0)}}),P.modules.PagedGrid.prototype.className="PagedGrid",goog.provide("P.modules.Picker"),goog.require("P.dom"),goog.require("P.Module"),goog.require("P.modules.SelectList"),goog.require("P.util"),goog.require("P.genConst"),P.modules.Picker=P.Module.extend({events:{keydown:"_onKeydown","textchange .name":"_onNameTextChange"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onChildButtonClick),this.childListen(P.CONST.EVENT_ITEM_CLICK,this._onChildItemClick),this._list=null,this._addedCreateItem=!1},onContentReady:function(){this._list=this.getChildById("list"),this._addedCreateItem=!1},focus:function(){P.dom.deferDomManipulation(function(){P.context.instance.is_mobile_agent||this.$(".name").focusWithoutScrolling(),this._list.scrollSelectedItemElementIntoView()}.bind(this))},getList:function(){return this._list},clearName:function(){this.$(".name").val(""),this._onNameTextChange()},_create:function(e){return Promise.reject(new Error("subclasses must override this"))},_createAndSubmit:function(e){this.showLoading(),this._create(e).then(function(e){return e&&(this._submit(e),!this.options.skip_append_created_item)?this._list.appendItem(e,!0):void 0}.bind(this)).fin(function(){this.hideLoading()}.bind(this))},_createFromInputNameAndSubmit:function(){var e=this._getNameInputText();this._createAndSubmit(e)},_getNameInputText:function(){return this.$(".name").val().trim()},_handleChoice:function(e){if(e.is_create)this._createFromInputNameAndSubmit();else if(e.is_create_suggestion){var t=e.name,o=t.toString();this._createAndSubmit(o)}else this._submit(e)},_onChildButtonClick:function(e){var t=e.target;t&&"createButton"===t.id&&this._createFromInputNameAndSubmit()},_onChildItemClick:function(e){var t=e.target,o=e.data;t&&"list"===t.id&&this._handleChoice(o)},_logArrowEvent:function(e){"pinCreate"===this.options.view_type&&this._logCustomContextEvent(e?P.genConst.EventType.WEB_PIN_CREATE_BOARD_FILTER_KEYDOWN_ARROW_UP:P.genConst.EventType.WEB_PIN_CREATE_BOARD_FILTER_KEYDOWN_ARROW_DOWN,P.genConst.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.genConst.ComponentType.MODAL_REPIN,{})},_logEnterEvent:function(){"pinCreate"===this.options.view_type&&this._logCustomContextEvent(P.genConst.EventType.WEB_PICKER_ENTER,P.genConst.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.genConst.ComponentType.MODAL_REPIN,{})},_onKeydown:function(e){if(this._list.hasVisibleItems())switch(e.keyCode){case P.util.keyCode.UP:e.preventDefault(),e.stopPropagation(),this._logArrowEvent(!0),this._list.highlightUp();break;case P.util.keyCode.DOWN:e.preventDefault(),e.stopPropagation(),this._logArrowEvent(!1),this._list.highlightDown();break;case P.util.keyCode.ENTER:case P.util.keyCode.NUMPAD_ENTER:e.preventDefault(),e.stopPropagation(),this._logEnterEvent();var t=this._list.getSelectedItemData();t?this._handleChoice(t):this._handleChoice({name:this._getNameInputText(),is_create:!0})}},_onNameTextChange:function(){var e=void 0!==this.options.allow_create?this.options.allow_create:!0;if(e&&!this._addedCreateItem){var t={};this.options.create_item_label&&(t.create_item_label=this.options.create_item_label),"pinCreate"===this.options.view_type&&(t.view_type="pinCreate",this._logCustomContextEvent(P.genConst.EventType.WEB_PIN_CREATE_BOARD_FILTER_KEYDOWN,P.genConst.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.genConst.ComponentType.MODAL_REPIN,{})),this._list.appendItem({type:"module",name:"PickerItemCreate",options:t,data:{is_create:!0}}),this._addedCreateItem=!0}var o=this._getNameInputText(),n=function(e){var t=!!o;if(t){var n=e.filter(function(e){return!e.data||e.data.is_spinner||e.data.is_create||e.data.recommendation_reason||e.data.is_create_suggestion||e.data.skip_filter?!1:!0}),a=n.map(function(e){return e.data.name}),r=P.filter.match(o,a),i={};a.forEach(function(e,t){i[e]=r.itemMatched[t]})}var s=e.map(function(e){var n=e.data;if(!n)return!1;if(n.is_spinner)return!0;if(n.is_create){var a=t&&!r.hasExactMatch,s=e;return s.setCreateName(o),a}if(n.recommendation_reason||n.is_create_suggestion)return!t;if(n.skip_filter)return!0;if(t){var l=n.name;return this.options.highlight_matched_text&&(i[l]?e.highlightMatchedText(o):e.unHighlightMatchedText()),i[l]}return this.options.highlight_matched_text&&e.unHighlightMatchedText(),!0}.bind(this));return s}.bind(this);this._list.setItemVisibilityCallback(n)},_submit:function(e){this.triggerEvent(P.CONST.EVENT_CHANGE,e,!0)}}),P.modules.Picker.prototype.className="Picker",goog.provide("P.modules.Pin"),goog.require("P.Module"),goog.require("P.modules.RemovePinDialog"),goog.require("P.modules.PinFeedbackConfirmation"),goog.require("P.modules.SocialIconsCounts"),goog.require("P.util"),goog.require("P.modalManager"),goog.require("P.url"),goog.require("P.i18n"),goog.require("P.frontEndEvent"),goog.require("P.timer"),goog.require("P.genConst"),goog.require("P.resourceFactory");var no="editButton",ao="mapPage",ro="mouseenter."+ao,io="mouseleave."+ao,so={BOARD_PINS_GRID:"boardPinsGrid",DETAILED:"detailed",SUMMARY:"summary",VISUAL_OBJECT_GRID:"visualObjectGrid",PLAIN_IMAGE_GRID:"plainImageGrid",SENT_PIN:"sentPin"},lo=[".likeEditButtonWrapper",".repinSendButtonWrapper"],uo=[".hoverMask",".pinImageActionButtonWrapper"];P.modules.Pin=P.Module.extend({events:{"mouseleave .pinImageSourceWrapper":"onPinMouseout","click .bulkEditPinWrapper":"onBulkEditPinWrapperClick","click .placePinActivateWrapper":"onPlacePinActivateWrapperClick","click .playIndicatorPill.gifType":"onGifClick","click .richPinMeta.hasMapButton":"onRichPinMetaWithMapClick","click .vaseButton":"onVaseToggleClick","focus .pinDescriptionInput":"onPinDescriptionInputFocus","blur .pinDescriptionInput":"onPinDescriptionInputBlur","click .pinDescription":"onPinDescriptionParagraphClick","click .pinImageActionButtonWrapper":"onPinClick"},CssClassName:{CLONED:"cloned",COLLAPSED:"collapsed",EDITING_DESCRIPTION:"editingDescription",HIDDEN:"hidden",MAP_FOCUS:"mapFocus",PIN_BLURRED:"blurred",PIN_BULK_EDIT:"bulkEditMode",PIN_CREDIT_HOVER:"creditHover",PIN_VISIBLE:"visible",PLACE_SUMMARY:"placeSummary",PLAYING:"playing",SELECTED:"selected",SQUISHED:"squished"},onPinMouseout:function(e){var t=this.getChildById("sendPinButton");if(t){var o=t.getDropdown();o&&o.isVisible()&&(this.toggleActionButtons(!0),this.toggleBlurredPin(!0))}},onPinClick:function(e){this.triggerEvent(P.CONST.EVENT_PIN_IMAGE_CLICK,this,!0)},onPinDescriptionParagraphClick:function(e){this.isCloneForRepin()&&(this.$el.addClass(this.CssClassName.EDITING_DESCRIPTION),this.getPinDescriptionInput().is(":focus")||this.getPinDescriptionInput().focus())},onRendered:function(){this.inDesktopPlaceBoard()&&this.triggerEvent(P.CONST.EVENT_PIN_CONTENT_CHANGED,this,!0)},isCloneForRepin:function(){return this.options.is_clone_for_repin},inDesktopPlaceBoard:function(){return this.options.in_desktop_place_board},setPinImages:function(e){var t=this.data;t.image_url=e;var o=t.images;o["236x"].url=e,o["474x"].url=e},getPinDescriptionInput:function(){return this.$(".pinDescriptionInput")},getPinDescriptionElement:function(){return this.$(".pinDescription")},getDescriptionText:function(){var e=this.data.description;if(!this._clamp)return e;var t=$("<div>");return e=this._clamp.original,t.html(e.replace(/<br\s*[\/]?>/gi,"\n")),t.text()},onPinDescriptionInputFocus:function(e){if(this.isCloneForRepin()&&(this.$el.addClass(this.CssClassName.EDITING_DESCRIPTION),!this.getPinDescriptionInput().is(":focus"))){var t=this._clamp.original.trim();this.getPinDescriptionInput().html(t.replace(/<br\s*[\/]?>/gi,"\n"))}},onPinDescriptionInputBlur:function(e){this.isCloneForRepin()&&P.timer.setTimeout(function(){var e=this.getPinDescriptionInput().val();e=_.escape(this.getPinDescriptionInput().val()),this.$el.toggleClass(this.CssClassName.EDITING_DESCRIPTION,!e.length),this.getPinDescriptionElement().html(e.replace(/\n/g,"<br />")),this.clampDescription()}.bind(this),50)},toggleActionButtons:function(e){this.$(lo.join(", ")).toggleClass(this.CssClassName.PIN_VISIBLE,e)},toggleBlurredPin:function(e){this.$(uo.join(", ")).toggleClass(this.CssClassName.PIN_BLURRED,e),this.$(".pinCreditWrapper").toggleClass(this.CssClassName.PIN_CREDIT_HOVER,e)},onRichPinMetaWithMapClick:function(e){var t=this.getPinId();this.inDesktopPlaceBoard()||(this._forceSeeOnMap=!0),this.getPlaceData()&&this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,t,!0)},getLoggingObjectIdStr:function(){return this.getPinId()},getPlaceData:function(){return this.data.place_summary||this.data.place||null},getPinId:function(){return this.resource.get("id")},isInFacebookTrendingExperiment:function(){return this.data.is_in_facebook_trending_experiment},getPlaceProvider:function(){var e=this.getPlaceData();return e?e.source_name:null},getPlaceProviderImage:function(){var e=this.getPlaceData();return e?e.source_icon:null},beginEditingDescription:function(){this.$el.addClass(this.CssClassName.EDITING_DESCRIPTION),this.getPinDescriptionInput().focus().select()},onButtonClick:function(e){var t=e.target,o=t.id;switch(o){case"expandGiraffe":this.onExpandGiraffeClick(e),t.destroy(),this.$(".navLinkOverlay").removeClass(this.CssClassName.SQUISHED);break;case"addToMap":this.triggerEvent(P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP,this,!0);break;case"seeOnMap":t.setHighlight(!0);break;case"pinItToMapButton":var n=this.extraData.image;this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_PINIT_BUTTON_CLICKED,n,!0);break;case"editDescription":this.beginEditingDescription();break;case"pinItButton":if(this._getViewType()===so.SUMMARY){var a=_.extend({},this.options,{is_clone_for_repin:!0}),r=new P.modules.Pin({id:"pin",options:a,data:this.data});r.renderExistingData().then(function(){var e=r.getContent(),t=this.$el.parent(".item"),o=t.offset();e.css({opacity:"0",position:"absolute",top:o.top,left:o.left}),e.addClass(this.CssClassName.CLONED);var n=P.genConst.Placement.WEB_REPIN_DIALOG_TAKEOVER,a=P.genConst.Experience.WEB_SEO_NUX_CREATE_BOARD;P.ExperienceManager.instance.isPlacedExperience(n,a)||this.triggerEvent(P.CONST.EVENT_APPEND_CLONED_PIN,r,!0),P.modalManager.get().setAnimatedModule(r)}.bind(this))}P.util.trackRegisterAction("pin_it_button_click")}},getId:function(){return this.data.id},onExpandGiraffeClick:function(e){this.$(".pinImageWrapper").removeClass(this.CssClassName.COLLAPSED),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},getSummaryImageUrl:function(){return this.data.images["236x"].url},getLink:function(){return this.data.link||null},getPlaceName:function(){var e=this.getPlaceData();return e?e.name:null},getBoardUrl:function(){return this.data.board.url},showEditModal:function(){var e=this.getChildById(no);return e?(e.showModalSubmodule(),!0):!1},getPinMedia:function(){var e=this._getViewType();switch(e){case so.DETAILED:case so.SENT_PIN:return this.isEmbed()&&!this.isGif()?this.$("iframe"):this.$(".PaddedPin img.pinImage");case so.BOARD_PINS_GRID:case so.VISUAL_OBJECT_GRID:case so.PLAIN_IMAGE_GRID:return this.$("img");case so.SUMMARY:return this.$(".pinHolder .pinImg");default:return this.log.error("requesting pin media for unsupported view_type:"+e),null}},isEmbed:function(){return this.data.embed&&this.data.embed.src},isPinStory:function(){return this.data.embed&&"pinstory"===this.data.embed.subtype},isGif:function(){return this.data.embed&&"gif"===this.data.embed.type},isVideo:function(){return this.data.is_video},getDominantColor:function(){return this.data.dominant_color||"#eee"},_getViewType:function(e){return this.options.view_type?this.options.view_type:so.SUMMARY},setDescriptionInputHeight:function(){this.getPinDescriptionInput().height(this.getPinDescriptionElement().height())},clampDescription:function(){var e=this.getPinDescriptionElement();e.length&&(e.html(e.html().trim()),this._clamp=window.$clamp(e[0],{clamp:6,useNativeClamp:!1}))},renderDescription:function(){var e=this.$(".descriptionJS"),t=this.$(".richPinGridTitle"),o=this.extraData.description_html,n=this.extraData.richTitleTruncated;e&&o&&e.html(o),t&&n&&t.html(n)},onContentReady:function(){P.Module.prototype.onContentReady.call(this);var e=this.data.id;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN]=this.onPinHidden,t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_BOARD]=this.onPinHiddenStopThroughBoard,t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_PIN]=this.onPinHiddenStopThroughPin,t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_STOP_THROUGH_INTEREST]=this.onPinHiddenStopThroughInterest,t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_UNFOLLOW]=this.onPinHiddenUnfollow,t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN_INTEREST_PAGE]=this.onPinHiddenUnfollow,t[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this.onPinCommentCreated,t[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED]=this.onPinCommentDeleted,t[P.CONST.PUBSUB_TOPIC_PIN_REPINNED]=this.onPinRepinned,t[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,t[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this.onPinLiked,t[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this.onPinUnliked,t[P.CONST.PUBSUB_TOPIC_PIN_UPDATED]=this.onPinUpdated,t[P.CONST.PUBSUB_TOPIC_PIN_FLAGGED]=this.onPinFlagged,t[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,t[P.CONST.PUBSUB_TOPIC_BULK_PIN_UNSELECTED]=this.togglePinSelected,this.pubsubSubscribe(e,t)}this.listen(this,P.CONST.EVENT_NAVIGATE,this.onNavigate),this.childListen(P.CONST.EVENT_NAVIGATE,this.onNavigate),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,function(e){e.data.contextualResource||(e.data.contextualResource=this.getContextualResource())}),this.listen(this,P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER,this.addHoverListenerForMapMarker),this.listen(this,P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER,this.removeHoverListenerForMapMarker),this._commentList=this.getChildById("comment_list"),this.getPinMedia().load(this.hideBackgroundText.bind(this)).each(function(){this.complete&&this.width<P.CONST.PIN_WIDTH&&$(this).trigger("load")}),this.isCloneForRepin()&&this.clampDescription(),this.options.render_desc_with_js&&this.renderDescription()},closeAddToMapModalIfNeeded:function(){var e=this.getChildById("addToMap");e&&P.modalManager.get().removeTopModal()},onPinHidden:function(e,t,o){var n=this.data,a=n.recommendation_reason,r={pin_id:n.id,feedback_type:P.genConst.PinFeedbackTypes.BLOCK_SINGLE_PFY_PIN},i={pin_id:n.id,recommendation_reason:a,feedback_type:P.genConst.PinFeedbackTypes.BLOCK_SINGLE_PFY_PIN,feedback_type_name:o,is_asking_for_feedback:!0};if(a){r.promoted=!1;var s=a.reason;if("REPIN_BOARD"===s){var l=a.board;l&&(r.through_id=l.id)}else"RECOMMENDED_INTEREST"===s&&(r.through_id=a.through_interest);r.recommendation_reason_id=a.reason_id}else r.promoted=!0;this._sendHidePinFeedback(r),this._showRemovePinDialog(i)},onPinHiddenStopThroughBoard:function(e,t,o){this.onPinHiddenStopThroughObject("board",P.genConst.PinFeedbackTypes.BLOCK_PFY_THROUGH_BOARD,o)},onPinHiddenStopThroughPin:function(e,t,o){this.onPinHiddenStopThroughObject("pin",P.genConst.PinFeedbackTypes.BLOCK_PFY_THROUGH_PIN,o)},onPinHiddenStopThroughInterest:function(e,t,o){this.onPinHiddenStopThroughObject("interest",P.genConst.PinFeedbackTypes.BLOCK_PFY_THROUGH_INTEREST,o)},downvoteInterestPin:function(e,t,o){var n=this.getId(),a=P.CONST.FeedbackType.DOWNVOTE,r=this.options.interest_name||this.options.source_interest&&this.options.source_interest.interest_id,i="/explore/"+this.data.source_interest.url_name,s=P.resourceFactory.instance.create("TopicPinFeedbackResource",{feedback_type:a,interest_name:r,interest_url_name:i,pin_id:n});s.callUpdate({showError:!0})},onPinHiddenUnfollow:function(e,t,o){var n=this.data,a=o,r=null,i=null;switch(o){case P.CONST.FeedbackType.UNFOLLOW_INTEREST:r=n.source_interest.name,i="/explore/"+n.source_interest.url_name;break;case P.CONST.FeedbackType.UNFOLLOW_BOARD:r=n.board.name,i=n.board.url;break;case P.CONST.FeedbackType.UNFOLLOW_PINNER:r=n.pinner.full_name,i="/"+n.pinner.username;break;case P.CONST.FeedbackType.DOWNVOTE:this.downvoteInterestPin();break;default:a=null}var s={pin_id:n.id,feedback_type_name:a,is_asking_for_feedback:!1,object_name:r,object_url_name:i};this._showRemovePinDialog(s)},onPinHiddenStopThroughObject:function(e,t,o){var n=this.data,a=n.recommendation_reason,r=a[e]||{},i=null;switch(e){case"pin":i=r.title;break;case"board":case"interest":i=r.name}var s={pin_id:n.id,feedback_type:t,through_id:r.cacheable_id||r.id,recommendation_reason_id:a.reason_id,promoted:!1},l={pin_id:n.id,feedback_type:t,feedback_type_name:o,is_asking_for_feedback:!1,recommendation_reason:n.recommendation_reason,promoter:n.promoter,through_id:r.cacheable_id||r.id,object_name:i};this._sendHidePinFeedback(s),this._showRemovePinDialog(l)},_sendHidePinFeedback:function(e){var t=P.resourceFactory.instance.create("PinFeedbackResource",e);t.callUpdate({showError:!0})},_showRemovePinDialog:function(e){if(this.options.show_feedback_tool){var t=!1,o=P.experiments.instance.v2GetGroup("web_pin_feedback");["employee","enabled"].indexOf(o)>-1&&(t=!0);var n=null;n=t?new P.modules.PinFeedbackConfirmation({options:_.extend(e,{pin_height:this.$el.height()})}):new P.modules.RemovePinDialog({options:e}),n.render().then(function(){n.getContent().insertBefore(this.getContent()),n.parent=this.parent,t?"IE"===P.context.instance.browser_name?(this.$el.transition({transform:"rotateY(180deg)"},500),n.animateIn()):this.$el.parent().transition({transform:"rotateY(180deg)"},500):this.getContent().hide(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}.bind(this))}},getImageUrl:function(e){if(!e)return"";var t=this.data.images;return t[e]?t[e].url:e===P.CONST.IMAGE_SIZE_ORIG&&t.originals?t.originals.url:""},getCoordinates:function(){var e=this.getPlaceData();return e?[e.latitude,e.longitude]:null},getContextualResource:function(){return P.resourceFactory.instance.create("PinResource",{id:this.getId()})},scrollIntoView:function(){this._forceSeeOnMap=!0;var e=this.$el,t=e.offset().top,o=e.height(),n=P.Viewport.height,a=$(".Header").height(),r;r=o>=n-a?t-o/2+P.Viewport.height/2-a-1.5*P.CONST.PIN_MARGIN:t-n/2-a/2+o/2,this.$el.addClass(this.CssClassName.MAP_FOCUS);var i=this.getChildById("seeOnMap");i&&i.setHighlight(!0),this._highlightMarkerOnMap();var s=function(){this._highlightMarkerOnMap()}.bind(this);P.util.scrollToTop({$scroller:null,newScrollOffset:r,callback:s})},resetShowOnMapButton:function(){var e=this.getChildById("seeOnMap");this.$el.removeClass(this.CssClassName.MAP_FOCUS),e&&(e.setHighlight(!1),this._forceSeeOnMap=!1)},hideBackgroundText:function(){this.$(".pinDomain").addClass(this.CssClassName.HIDDEN),this.$(".pinCanonicalDescription").addClass(this.CssClassName.HIDDEN)},onGifClick:function(e){e.preventDefault(),this.originalSrc||(this.originalSrc=this.$(".pinImg").attr("src"));var t=this.$(".playIndicatorPill.gifType");return this.isPlaying?(this.$(".pinImg").attr("src",this.originalSrc),t.removeClass(this.CssClassName.PLAYING)):(this.$(".pinImg").attr("src",this.data.embed.src),t.addClass(this.CssClassName.PLAYING)),this.isPlaying=!this.isPlaying,!1},onPinRepinned:function(){this.incrementRepinCount()},addHoverListenerForMapMarker:function(){
var e=this.$el,t=this.getId(),o=this.getChildById("seeOnMap");this.removeHoverListenerForMapMarker(),e.on(ro,function(e){this.triggerEvent(P.CONST.EVENT_PIN_MOUSE_IN,t,!0),o&&o.setHighlight(!0)}.bind(this)),e.on(io,function(e){this._forceSeeOnMap||(this.triggerEvent(P.CONST.EVENT_PIN_MOUSE_OUT,t,!0),o&&o.setHighlight(!1))}.bind(this))},getLocality:function(){var e=this.getPlaceData();if(!e)return null;var t=e.address;return t?t.locality:null},_highlightMarkerOnMap:function(){var e=this.getPinId();this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,e,!0)},removeHoverListenerForMapMarker:function(){var e=this.$el;e.off(ro+" "+io)},onDropdownShow:function(e){var t=e.target.options.view_type;"pickedForYou"===t?P.frontEndEvent.log("pickedForYouHoverShow",.01):"pinFeedbackTool"===t?this.toggleBlurredPin(!0):this.toggleActionButtons(!0)},onDropdownHide:function(e){this.toggleActionButtons(!1),this.toggleBlurredPin(!1)},isPinComment:function(e){return"PinDescriptionComment"===e.target.className&&e.target.options.is_description===!1?!0:!1},onNavigate:function(e){P.url.isOffsiteUrl(e.data.url)&&!this.isPinComment(e)&&(e.data.pinId=this.data.id),e.data&&e.data.url&&-1!==e.data.url.indexOf("web-result")&&(e.data.forceRefresh=1),this.hideDropdowns()},hideDropdowns:function(){var e=this.getChildrenByModuleName("DropdownButton");_.each(e,function(e){e.getDropdown().hide()})},onBulkEditPinWrapperClick:function(){var e=this.options.can_bulk_edit||!1,t=_.contains(this.data.access,"write");if(t||e){this.togglePinSelected();var o=this.data.id;o&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_BULK_PIN_SELECTED,o)}},togglePinSelected:function(){this.$(".bulkEditCheckbox").toggleClass(this.CssClassName.SELECTED)},changePinBulkEditMode:function(e){e?this.$el.addClass(this.CssClassName.PIN_BULK_EDIT):(this.$el.removeClass(this.CssClassName.PIN_BULK_EDIT),this.$(".bulkEditCheckbox").removeClass(this.CssClassName.SELECTED))},toggleBulkEditMode:function(e,t,o){this.changePinBulkEditMode(o===P.CONST.ENTER_BULK_EDIT)},onPlacePinActivateWrapperClick:function(e){this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,this.getId(),!0)},focusPlacePin:function(){var e=this.$el.height(),t=this.$el.parent(".item");this.$el.addClass(this.CssClassName.MAP_FOCUS);var o=e-this.$el.height()-P.CONST.PIN_MARGIN;t.transition({y:o},300,"cubic-bezier(.19, 1, .48, 1)")},unfocusPlacePin:function(){var e=this.$el.parent(".item");e.transition({y:0},300,"cubic-bezier(.36, 0, .21, 1)",function(){this.$el.removeClass(this.CssClassName.MAP_FOCUS)}.bind(this))},onPinCommentCreated:function(){this._getViewType()===so.SUMMARY&&this.render()},onPinCommentDeleted:function(){this._getViewType()===so.SUMMARY&&this.render()},onPinLiked:function(){this.triggerEvent(P.CONST.EVENT_PIN_LIKED,null,!0);var e=this.getChildById("likeButton");e&&e.setState(!0),this.incrementLikeCount()},getSocialIconsCounts:function(){return this.getChildById("socialIconsCounts")},onPinUnliked:function(){this.triggerEvent(P.CONST.EVENT_PIN_UNLIKED,null,!0);var e=this.getChildById("likeButton");e&&e.setState(!1),this.decrementLikeCount()},incrementLikeCount:function(){var e=this.getSocialIconsCounts();e&&e.incrementLike()},incrementRepinCount:function(){var e=this.getSocialIconsCounts();e&&e.incrementRepin()},decrementLikeCount:function(){var e=this.getSocialIconsCounts();e&&e.decrementLike()},onPinFlagged:function(e,t,o){var n={pin_id:this.data.id,feedback_type_name:o,is_asking_for_feedback:!1};this._showRemovePinDialog(n)},onPinUpdated:function(e,t,o){this.triggerEvent(P.CONST.EVENT_PIN_UPDATED,o,!0),this.model&&this.model.set(o),this.render()},onPinDeleted:function(e){this.triggerEvent(P.CONST.EVENT_PIN_DELETED,this,!0),this.destroy()},onVaseToggleClick:function(e){var t=this.getChildById("vaseButton");this.$(".vaseText.hidden")[0]?(t.setText(P.i18n._("Less")),this.$(".vaseText:not(.alwaysShow)").removeClass(this.CssClassName.HIDDEN)):(t.setText(P.i18n._("More")),this.$(".vaseText:not(.alwaysShow)").addClass(this.CssClassName.HIDDEN)),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},getSourceUrl:function(){return this.data.link||""},getFirstVisualObject:function(){var e=this.getChildByModuleName("PaddedPin");return e?e.getFirstVisualObject():null},getPinWrapperElement:function(){return this.$(".pinWrapper")},updateSendPinDropdownPosition:function(e){var t=this.getChildById("sendPinButton");t&&(t.getDropdownOptions().position_point=e)},configurePlacePinMode:function(e){e?(this.$el.addClass(this.CssClassName.PLACE_SUMMARY),this.$el.addClass(this.CssClassName.HIDDEN),this.getPlaceData()&&this.$el.removeClass(this.CssClassName.HIDDEN)):(this.$el.removeClass(this.CssClassName.PLACE_SUMMARY),this.$el.removeClass(this.CssClassName.HIDDEN))},emptyPaddedPin:function(e,t){var o=this.getChildByModuleName("PaddedPin"),n=null;o&&(n=o.el.parentElement,o.empty(),n&&(n.style["padding-top"]=e))},isDescriptionValid:function(){var e=this.getChildById("pinDescriptionField");if(e){var t=e.options.maxlength,o=e.getUntrimmedValue();if(o&&t)return o.length<t}return!0}}),P.modules.Pin.prototype.className="Pin",goog.provide("P.modules.PinCreateSuccessBoardEdit"),goog.require("P.modules.BoardEditActionBase"),goog.require("P.moduleFactory"),goog.require("P.resourceFactory"),P.modules.PinCreateSuccessBoardEdit=P.modules.BoardEditActionBase.extend({onContentReady:function(){P.modules.BoardEditActionBase.prototype.onContentReady.call(this);var e=this.getChildById("doneButton");e&&this.listen(e,P.CONST.EVENT_BUTTON_CLICK,this.onDone)},onDone:function(e){this.showLoading();var t={board_id:this.data&&this.data.id},o=this.getChildById("placeLayoutCheckbox");o&&(t.layout=o.isChecked()?"places":"default");var n=P.resourceFactory.instance.create("BoardResource",t),a=this.options.pinCreateInfo,r=function(){a&&P.moduleFactory.load(a).then(function(e){this.showInModal(e),this.hideLoading(),this.destroy()}.bind(this))}.bind(this);n.callUpdate({showError:!1}).fin(r)}}),P.modules.PinCreateSuccessBoardEdit.prototype.className="PinCreateSuccessBoardEdit",goog.provide("P.modules.PromotedPinInfo"),goog.require("P.modules.PinInfo"),goog.require("P.modules.Dropdown"),goog.require("P.timer"),goog.require("P.genConst"),P.modules.PromotedPinInfo=P.modules.PinInfo.extend({events:_.extend(P.modules.PinInfo.prototype.events,{"click .showSurvey":"showSurvey"}),showSurvey:function(){this._ensureSurvey(),P.timer.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this._feedbackDropdown.slideIn(200)}.bind(this),this.HIDE_DELAY)},_ensureSurvey:function(){if(!this._feedbackDropdown){var e=this.options.pin_id,t={pin_id:e,promoter:this.options.promoter,feedback_type:P.genConst.PinFeedbackTypes.BLOCK_SINGLE_PFY_PIN},o={name:"PromotedPinFeedback",options:t},n={anchor:this.parent.options.anchor,module:o,hide_caret:!0,view_type:"pinFeedbackTool",position_point:"TOP_RIGHT",display_while_loading:!0,force_in_viewport:!0,class_name:"underneathHeader"};this._feedbackDropdown=new P.modules.Dropdown({id:"dropdown",options:n}),this._feedbackDropdown.initHovering(),this.addChild(this._feedbackDropdown)}}}),P.modules.PromotedPinInfo.prototype.className="PromotedPinInfo",goog.provide("P.modules.RepinSuccessToast"),goog.require("P.modules.ToastBase"),P.modules.RepinSuccessToast=P.modules.ToastBase.extend({}),P.modules.RepinSuccessToast.prototype.className="RepinSuccessToast",goog.provide("P.modules.SearchInputToken"),goog.require("P.modules.Token");var co;P.modules.SearchInputToken=P.modules.Token.extend({events:{"click .remove":"onRemoveClick"},onContentReady:function(){this.bgColor||(this.options.color?this.bgColor=this.clampColorBrightness(this.options.color):this.bgColor=this.getRandomColor()),this.$(".tokenContainer").css("background-color",this.bgColor)},onRemoveClick:function(e){this._logContextEvent(e),this.triggerEvent(P.CONST.EVENT_REMOVE_TOKEN,this,!0),e.stopPropagation()},getTokenData:function(){var e=this.options.term,t=this.options.position;return{text:e,priority:t}},clampColorBrightness:function(e){return this._isBright(e)?this._darken(e,.2):e},_isBright:function(e){var t=this.hexToRgb(e);if(t){var o=Math.sqrt(t.r*t.r*.241+t.g*t.g*.691+t.b*t.b*.068);return o>200}return!1},_darken:function(e,t){var o=this.hexToRgb(e),n=Math.round(o.r*(1-t)),a=Math.round(o.g*(1-t)),r=Math.round(o.b*(1-t));return n=Math.min(Math.max(0,n),255),a=Math.min(Math.max(0,a),255),r=Math.min(Math.max(0,r),255),"#"+n.toString(16)+a.toString(16)+r.toString(16)},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/,o=e.match(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null},getRandomColor:function(){var e=_.random(1,360),t=_.random(20,90),o=_.random(20,75);return"hsl("+e+","+t+"%,"+o+"%)"}}),P.modules.SearchInputToken.prototype.className="SearchInputToken",goog.provide("P.modules.SendBoard"),goog.require("P.modules.SendObjectBase"),P.modules.SendBoard=P.modules.SendObjectBase.extend({_OBJECT_ID_NAME:"board"}),P.modules.SendBoard.prototype.className="SendBoard",goog.provide("P.modules.TypeaheadField"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),goog.require("P.modules.Typeahead"),goog.require("P.util"),goog.require("P.genConst"),P.modules.TypeaheadField=P.Module.extend({events:{"input .field":"onFieldInput","blur .field":"onFieldBlur","focus .field":"onFieldFocus","keyup .field":"onFieldKeyup","keydown .field":"onFieldKeydown","textchange .field":"onFieldTextChange"},CssClassName:{DISABLED:"disabled",VISIBLE:"visible"},onCreated:function(){this.valueFromHighlight=!1,this.showNewTypeahead=!!this.options.support_advanced_typeahead,this.showGuidedSearch=!!this.options.support_guided_search},getTypeahead:function(){return this.showNewTypeahead?this.getChildById("typeaheadDropdown").getContentModule():this.getChildById("typeahead")},onFieldTextChange:function(e){this.isFocussed()&&this.search()},initTypeahead:function(){this.showNewTypeahead?(this.initTypeaheadDropdown(),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onChildItemHighlighted),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown),this.childListen(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,this.onTypeaheadMousedown)):(this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onChildItemHighlighted),this.childListen(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,this.onTypeaheadMousedown),this.options.show_caret&&(this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown)))},initTypeaheadDropdown:function(){this.typeaheadDropdown=new P.modules.Dropdown({id:"typeaheadDropdown",options:{class_name:"typeaheadDropdown",fixed:!0,hide_caret:!0,position_mode:P.CONST.PositionMode.MANUAL,prefetch:!0,mouse_close_mode:"never",submodule:{name:"Typeahead",options:{bypass_lru_cache:this.options.bypass_lru_cache,bypass_maxheight:!0,class_name:"centeredWithinWrapper",enable_recent_queries:this.options.enable_recent_queries,exclude_non_followers:this.options.exclude_non_followers,minimum_term_character_length:this.options.minimum_term_character_length,num_places:this.options.num_places,resource_name:this.options.resource_name,should_geocode:this.options.should_geocode,tags:this.options.tags,template:this.options.template,use_tab_index:this.options.use_tab_index,view_type:"expanded"}}}}),this.addChild(this.typeaheadDropdown)},hideTypeaheadUnlessPreserved:function(){this.options.preserve_typeahead||this.getTypeahead().hide()},enableInput:function(){this._setInputEnabled(!0)},_setInputEnabled:function(e){var t="disabled";this.$field.toggleClass(this.CssClassName.DISABLED,!e),e?this.$field.removeAttr(t):this.$field.attr(t,t)},disableInput:function(){this._setInputEnabled(!1)},onChildItemSelected:function(e){var t=e.data.item,o=t&&!t.get("ignoreLabel")?t.get("label"):this.getValue(),n=this.options.set_input_value_on_selection;void 0===n&&(n=!0),o&&n&&(this.valueFromHighlight=!1,this.setValue(o)),this.blur()},onChildItemHighlighted:function(e){var t=e.data.item,o=t&&!t.get("ignoreLabel")?t.get("highlightLabel")||t.get("label"):this.getTypeahead().getLastTerm();this.options.populate_on_result_highlight&&(this.valueFromHighlight=!!t,this.setValue(o))},onTypeaheadResultsReturned:function(e){this.showCaret()},onTypeaheadHidden:function(e){this.hideCaret(),this.typeaheadDropdown&&this.typeaheadDropdown.hide()},onTypeaheadShown:function(e){this.showCaret(),this.typeaheadDropdown&&!this.typeaheadDropdown.isShowing()&&this.typeaheadDropdown.show()},onTypeaheadNoResultsReturned:function(e){this.hideCaret()},showCaret:function(){this._setCaretVisible(!0)},hideCaret:function(){this._setCaretVisible(!1)},_setCaretVisible:function(e){this.$(".typeaheadCaret").toggleClass(this.CssClassName.VISIBLE,e)},highlightTypehaeadUp:function(){this.getTypeahead().highlightUp()},highlightTypeaheadDown:function(){this.getTypeahead().highlightDown()},onContentReady:function(){this.initTypeahead(),this.$field=this.$(".field"),this.$field.placeholder()},onFieldInput:function(){this.isFocussed()&&this.search()},_focusHighlightedIfNeeded:function(){this.options.use_tab_index&&(this.getTypeahead().focusHighlighted(),this.focus())},onFieldKeydown:function(e){var t=this.getTypeahead(),o=P.util.keyCode;if(t.isOpen())switch(e.keyCode){case o.UP:t.highlightUp(),this._focusHighlightedIfNeeded(),e.preventDefault();break;case o.DOWN:t.highlightDown(),this._focusHighlightedIfNeeded(),e.preventDefault();break;case o.ENTER:this.options.is_multiobject_search&&t.highlightedItem&&t.highlightedItem.get("selectable")!==!1&&this.triggerEvent(P.CONST.EVENT_ITEM_SELECTED,{item:t.highlightedItem},!0),this.valueFromHighlight&&(this.cancelBlur=!0,window.setTimeout(function(){this.cancelBlur=!1}.bind(this),500)),(this.options.prevent_default_on_enter||this.options.close_typeahead_on_selection)&&e.preventDefault();break;case o.BACKSPACE:this.valueFromHighlight=!1}},focus:function(){this.getField().focusWithoutScrolling()},onFieldKeyup:function(e){var t=this.getTypeahead(),o=P.util.keyCode;if(t.isOpen())switch(e.keyCode){case o.ENTER:case o.NUMPAD_ENTER:case o.TAB:var n={};if(t.highlightedItem){var a="pins",r=t.highlightedItem.get("type");"pin_search"===r&&(r="query"),"board_search"===r&&(a="boards",r="query"),"people_search"===r&&(a="users",r="query"),n={entered_query:t.getLastTerm(),selected_query:t.highlightedItem.get("label"),result_index:t.highlightedItem.get("resultIndex"),autocomplete_type:r,search_mode:a}}var i=t.select();this._logCustomContextEvent(P.genConst.EventType.CLICK,P.genConst.ElementType.AUTOCOMPLETE_SUGGESTION,P.genConst.ComponentType.TYPEAHEAD_SUGGESTIONS,n),i&&(this.abortSearch(),e.preventDefault()),this.options.close_on_selection&&this.closeTypeahead();break;case o.ESCAPE:this.blur(),e.preventDefault();break;default:this.valueFromHighlight=!1}else switch(e.keyCode){case o.ENTER:case o.NUMPAD_ENTER:this.abortSearch(),this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,{},!0)}},getTypeaheadItemsToRender:function(){return this.getTypeahead().itemsToRender},getTypeaheadHighlightedItem:function(){return this.valueFromHighlight?this.getTypeahead().getHighlightedItem():null},getTypeaheadSelectedItem:function(){return this.getTypeahead().getSelectedItem()},removeCacheForTerm:function(e){this.getTypeahead().removeCacheForTerm(e)},removeCacheForCurrentTerm:function(){var e=this.getValue();this.removeCacheForTerm(e)},closeTypeahead:function(){this.abortSearch(),this.getTypeahead().hide()},onFieldBlur:function(){return this.cancelBlur?void(this.cancelBlur=!1):(this.valueFromHighlight?(this.valueFromHighlight=!1,this.reset()):this.showGuidedSearch&&(this.abortSearch(),this.setValue("")),this.hideTypeaheadUnlessPreserved(),void this.triggerEvent(P.CONST.EVENT_BLUR,null,!0))},onFieldFocus:function(){this.$field.trigger("mousedown"),this.options.search_on_focus&&this.search(),this.options.prefetch_on_focus&&this.getTypeahead().prefetch(),this.triggerEvent(P.CONST.EVENT_FOCUS,null,!0)},onTypeaheadMousedown:function(e){this.cancelBlur=!0,window.setTimeout(function(){this.cancelBlur=!1}.bind(this),300)},getValue:function(){if("tokenized"===this.options.type){var e=this.getChildById("tokenizedInput");return this.showGuidedSearch?e.getTokenInputValue():e.getInputValue()}return this.$field.val()},getField:function(){return this.$field},reset:function(){this.abortSearch(),this.setValue(""),this.getTypeahead().emptyResults(),this.getTypeahead().hide()},setValue:function(e){if("tokenized"===this.options.type){var t=this.getChildById("tokenizedInput");t.setInputValue(e)}else this.$field.val(e);this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,{value:e},!0)},getTypeaheadResultCount:function(){return this.getTypeahead().getItemCount()},setAutocompleteScope:function(e){this.getTypeahead().setAutocompleteScope(e)},clear:function(){if("tokenized"===this.options.type){var e=this.getChildById("tokenizedInput");e.clearTokens(),e.clearSavedTokens()}this.setValue("")},abortSearch:function(){this.searchTimer&&window.clearTimeout(this.searchTimer),this.getTypeahead().abortSearch()},setResourceOptionForTypeahead:function(e,t){var o=this.getTypeahead().getResource();o.set(e,t)},setPrependedStaticItems:function(e){this.getTypeahead().setPrependedStaticItems(e)},setAppendedStaticItems:function(e){this.getTypeahead().setAppendedStaticItems(e)},resetPrependedStaticItems:function(){this.getTypeahead().resetPrependedStaticItems()},resetAppendedStaticItems:function(){this.getTypeahead().resetAppendedStaticItems()},search:function(e){var t=e;t||(t=this.getValue()),t&&""!==t||!this.options.is_multiobject_search||P.context.instance.user_agent_platform!==P.CONST.USER_AGENT_PLATFORM_IPAD||window.scrollTo(0,0),this.searchTimer&&window.clearTimeout(this.searchTimer);var o=function(){this.getTypeahead().search(t)}.bind(this),n=this.options.search_delay;n?this.searchTimer=window.setTimeout(o,n):o()},blur:function(){this.$field.blur()},isFocussed:function(){return this.$field.is(":focus")}}),P.modules.TypeaheadField.prototype.className="TypeaheadField",goog.provide("P.modules.UserDropdown"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.genConst"),goog.require("P.modules.Dropdown"),goog.require("P.moduleFactory"),goog.require("P.i18n"),P.modules.UserDropdown=P.Module.extend({events:{"click .reportBug":"openReportBugModal","click .getHelp":"openHelpDropdown","click .blockUser":"onBlockUser","click .sendProfile":"sendProfile","click .sendMessage":"sendUserMessage","click .userMenuFindBoards":"openFindBoards","click .userMenuCreateBoard":"openCreateBoard","click .userMenuAddPin":"openAddPin","click .userMenuUploadPin":"openUploadPin","click .userMenuEditProfile":"openEditProfile","click .userMenuMakeAWidget":"openMakeAWidget","click .settings":"onSettingsClick","click .userMenuMakeABoardWidget":"openMakeABoardWidget","click .sendBoard":"sendBoard","click .shareBoardOnFacebook":"onClickShareBoardOnFacebook"},onCreated:function(){this._help_dropdown=null},onSettingsClick:function(e){if(e.stopPropagation(),e.preventDefault(),P.user.instance.isLimitedLogin())P.limitedLogin.showLogin(this);else if(P.autologin.checkForAutologin()){var t=P.i18n._("To get to your settings, please take a second to confirm it's really you.");P.autologin.showLoginErrorDialog(this,t)}else this.navigate("/settings/")},getFindFriendsElement:function(){return this.$(".userMenuFindFriends").parent().eq(0)},getMyBoardsElement:function(){return this.$(".myBoards").parent().eq(0)},getFindBoardsElement:function(){return this.$(".userMenuFindBoards").parent().eq(0)},openFindBoards:function(){var e={name:"FastFollow",resource:{name:"UserResource",options:{username:P.user.instance.get("username"),field_set_key:"fast_follow"}},options:{post_orientation:!0}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e,{can_dismiss:!0,container_class:"fastFollowContainer"})}.bind(this)),!1},openReportBugModal:function(e){e.preventDefault();var t={name:"ReportBug",options:{shrinkToFit:!0}};return this.showLoading(),P.moduleFactory.load(t).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},openHelpDropdown:function(e){e.preventDefault(),null===this._help_dropdown&&(this._help_dropdown=new P.modules.Dropdown({options:{anchor:this.$("a.getHelp"),position_point:"LEFT_TOP",module:{name:"HelpMenu",options:{}}}})),this._help_dropdown.isVisible()||this._help_dropdown.slideIn(200)},onBlockUser:function(e){var t=this.options.user,o={name:"UserBlock",options:{full_name:t.full_name,first_name:t.first_name,username:t.username,blocked_by_me:t.blocked_by_me,user_id:t.id}};return P.moduleFactory.load(o).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},sendProfile:function(e){if(e.stopPropagation(),e.preventDefault(),P.user.instance.isLimitedLogin())P.limitedLogin.showLogin(this);else{var t=this.options.user,o={name:"SendPinner",options:{class_name:"modal",object_id:t.id,object_image_url:t.image_large_url,object_description:t.bio,object_url:"/"+t.username}};this.showLoading(),P.moduleFactory.load(o).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this))}},sendUserMessage:function(e){if(P.user.instance.isLimitedLogin())P.limitedLogin.showLogin(this);else{var t=[this.options.user.id];P.conversationsManager.instance.sendMessageToUsers(t,[],{text:null}).then(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),this.render()}.bind(this)),e.stopPropagation()}},openCreateBoard:function(){var e={name:"BoardCreate",options:{}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},openAddPin:function(){var e={name:"AddPinURL",options:{shrinkToFit:!0,show_title:!0}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},openUploadPin:function(){var e={name:"PinUploader",options:{shrinkToFit:!0,show_title:!0}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},openEditProfile:function(){var e={name:"UserEdit",resource:{name:"UserSettingsResource",options:{}},options:{user_id:this.options.user_id}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},openMakeAWidget:function(){var e={name:"EmbedPinner",options:{user:this.options.user}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},openMakeABoardWidget:function(){var e={name:"EmbedBoard",options:{board:this.options.board,class_name:"v2"}};return this.showLoading(),P.moduleFactory.load(e).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this)),!1},sendBoard:function(e){if(e.preventDefault(),P.user.instance.isLimitedLogin())P.limitedLogin.showLogin(this);else{var t=this.options.board,o={name:"SendBoard",options:{class_name:"newBoardHeaderStyle",object_id:t.id,object_image_url:t.image_cover_url,object_description:t.description,object_url:t.url}};this.showLoading(),P.moduleFactory.load(o).then(function(e){this.hideLoading(),this.showInModal(e)}.bind(this))}return!1},onClickShareBoardOnFacebook:function(){if(P.user.instance.isAuthenticated()){var e=this.options.board,t=P.genConst.Settings.CANONICAL_MAIN_URL+e.url,o={object_type:"board",type:"feed",object_id:e.id,path:t};P.FacebookDialog.open(o),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}return!1}}),P.modules.UserDropdown.prototype.className="UserDropdown",goog.provide("P.modules.UserEducationDropdownButton"),goog.require("P.modules.DropdownButton"),P.modules.UserEducationDropdownButton=P.modules.DropdownButton.extend({CssClassName:_.extend(P.modules.DropdownButton.prototype.CssClassName,{TRIGGER_ACTIVE:"triggerActive"}),onClick:function(e){P.modules.DropdownButton.prototype.onClick.call(this,e),this.triggerEvent(P.CONST.EVENT_TUTORIAL_TRIGGER_CLICKED,null,!0)},onContentReady:function(){P.modules.DropdownButton.prototype.onContentReady.call(this),P.pubSub.instance.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,function(e,t,o){o&&!o.showFlyout&&this.setTriggerActiveState(!0)}.bind(this))},setTriggerActiveState:function(e){this.$el.toggleClass(this.CssClassName.TRIGGER_ACTIVE,e)}}),P.modules.UserEducationDropdownButton.prototype.className="UserEducationDropdownButton",goog.provide("P.modules.UserEducationGuideStacked"),goog.require("P.Module"),goog.require("P.modules.UserEducationGuideStep");var po=30,mo=10;P.modules.UserEducationGuideStacked=P.modules.UserEducationGuideStep.extend({CssClassName:_.extend(P.modules.UserEducationGuideStep.prototype.CssClassName,{ACTIVE:"active"}),onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,function(e){var t=e.target;t&&("nextButton"===t.id?(e.stopPropagation(),this.updateCardsForNextStep().then(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this))):"dismissButton"===t.id&&(e.stopPropagation(),this.$el.removeClass(this.CssClassName.ACTIVE),window.setTimeout(function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}.bind(this),500)))}),window.setTimeout(function(){this.$el.addClass(this.CssClassName.ACTIVE)}.bind(this),200)},updateCardsForNextStep:function(){return new Promise(function(e,t){var o=this.$(".guideStepContent:first-child");o.appendTo(this.$(".cardPositionAnimation.cardPosition")).transition({y:350,rotate:this._getRotateAngle(),visibility:"hidden"},800,"ease",function(){o.remove(),e(void 0)})}.bind(this))},_getRotateAngle:function(){var e=Math.random()*po;return mo>e&&(e=mo),Math.random()<.5&&(e*=-1),e+"deg"}}),P.modules.UserEducationGuideStacked.prototype.className="UserEducationGuideStacked",goog.provide("P.modules.UserFollowButton"),goog.require("P.modules.Dropdown"),goog.require("P.modules.FollowButton"),goog.require("P.resourceFactory"),P.modules.UserFollowButton=P.modules.FollowButton.extend({getResourceId:function(){return this.options.user_id},getFollowResource:function(){return P.resourceFactory.instance.create("UserFollowResource",{user_id:this.getResourceId()})},getFollowClass:function(){return this.options.follow_class},getAuthRedirectUrl:function(){return P.user.instance.isAuthenticated()?void 0:P.signupModalManager.showInlineSignupModalOnButtonClick("UserFollowButton")},toggleState:function(){if(P.modules.FollowButton.prototype.toggleState.call(this),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,this.options.followed?P.CONST.PUBSUB_TOPIC_USER_FOLLOW:P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW,!0),this.options.followed&&this.options.suggested_users_menu&&!P.context.instance.is_mobile_agent){this._dropdown&&this._dropdown.destroy();var e={anchor:this.$el.closest(".userFollowButtonWrapper"),anchored:!0,largeCaret:!0,fixed:!0,position_point:"BOTTOM_CENTER",force_in_viewport:!0,class_name:"suggestedUsersDropdown",module:this.options.suggested_users_menu};this._dropdown=new P.modules.Dropdown({options:e}),this._dropdown.initHovering(),this._dropdown.slideIn(200)}},onContentReady:function(){this.showMemo()},getContextualResource:function(){return P.resourceFactory.instance.create("UserResource",{user_id:this.getResourceId(),field_set_key:"grid_item"})}}),P.modules.UserFollowButton.prototype.className="UserFollowButton",goog.provide("P.modules.UserMenu"),goog.require("P.modules.DropdownButton"),P.modules.UserMenu=P.modules.DropdownButton.extend({onContentReady:function(){var e=this.extraData.userId;if(e){var t={};t[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(this.extraData.userId,t)}P.modules.DropdownButton.prototype.onContentReady.apply(this,arguments)},onUserUpdated:function(){this.render()},setSticky:function(e){this.getDropdown().setSticky(e)}}),P.modules.UserMenu.prototype.className="UserMenu",goog.provide("P.modules.UserProfilePage"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),goog.require("P.unauthUsage"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),goog.require("P.router"),P.modules.UserProfilePage=P.Module.extend({events:{},getLoggingObjectIdStr:function(){return this.data.id},onAddedToDom:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onRemovedFromDom:function(){this._removeListeners()},onContentReady:function(){P.user.instance.isAuthenticated()||(Cookie.set(P.CONST.COOKIE_LAST_UNAUTH_PROFILE_ID,this.data.id),P.unauthUsage.logUrl());var e={};e[P.CONST.PUBSUB_TOPIC_USER_BLOCKED]=this.onAccessChange,e[P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED]=this.onAccessChange,this.data&&this.data.id&&this.pubsubSubscribe(this.data.id,e),"1"===this.options.show_redirected_memo&&this.showRedirectDialog(),"1"===this.options.board_create&&this.showBoardCreateModal()},showRedirectDialog:function(){var e={name:"ConfirmDialog",options:{template:"deleted_board_redirect",user_name:this.data.full_name,auto_close_delay_ms:7e3}};P.moduleFactory.load(e).then(function(e){P.modalManager.get().createAndShowModal(e)})},showBoardCreateModal:function(){var e=new P.modules.BoardCreate({options:{}});this.showInModal(e)},onAccessChange:function(){this.render()},onChildNavigate:function(e){this.log.debug("UserProfilePage got navigate event from child",e.target,"for url:",e.data.url);var t=P.router.instance&&P.router.instance.resolve(e.data.url);if(t){var o=t.module,n=t.options,a=t.resource,r=a.options&&a.options.username,i=this.data;if(this.contentReady&&o===this.className&&r===(i&&i.username)){this.setOptions(n),this.setResource(a);var s=this.$el.height();this.$el.css("min-height",s);var l=this.getScrollableElement(),u=l.scrollTop(),d=n.tab,c=this.getChildByModuleName("UserProfileContent"),p=this.getChildByModuleName("UserInfoBar");p.setOptions({tab:d,spinner:{enable:!1}}),p.render(),c.setOptions({tab:d}),c.showLoading(),c.render().then(function(){c.hideLoading(),this.$el.css("min-height","");var e=l.height(),t=this.$el.positionAncestor(l).top,o=this.$el.height(),n=u+e-o+t;n>0&&(this.$el.css("min-height",o+n),l.scrollTop(u))}.bind(this)),e.data.handled=!0}}}}),P.modules.UserProfilePage.prototype.className="UserProfilePage",goog.provide("P.modules.AddPinToMap"),goog.require("P.Module"),goog.require("P.modules.GeoFeatureList"),goog.require("P.moduleFactory"),goog.require("P.i18n"),goog.require("P.MarkerOptions"),goog.require("P.resourceFactory");var ho="backButton",go="closeButton",_o=1e5;P.modules.AddPinToMap=P.Module.extend({events:{"keydown input":"onSearchFieldKeydown","click .exampleQuery":"onExampleQueryClick"},CssClassName:{EMPTY_STATE:"isEmpty",HAS_GEO_FEATURES:"hasGeoFeatures",HAS_NO_RESULTS:"hasNoResults",LOADING:"loading"},onExampleQueryClick:function(e){var t=$(e.target),o=t.text();this.typeaheadField.setValue(o),this.typeaheadField.search()},onSearchFieldKeydown:function(e){this.typeaheadField.setResourceOptionForTypeahead("center",this.center),this.typeaheadField.setResourceOptionForTypeahead("radius",null!=this.center?_o:null),this.typeaheadField.setResourceOptionForTypeahead("near",null),this.typeaheadField.setResourceOptionForTypeahead("should_geocode",!0),this._ignoreHints=!1},onCreated:function(){this.onUploadSuccess=this.onUploadSuccess.bind(this),this._place=null,this.center=null,this.typeaheadItems=null,this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onTypeaheadItemHighlighted),this.childListen(P.CONST.EVENT_EXTERNAL_CLICK,this.onExternalClick),this.listen(this,P.CONST.EVENT_EXTERNAL_CLICK,this.onExternalClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),
this.childListen(P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onTypeaheadSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onTypeaheadHint),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.childListen(P.CONST.EVENT_PINIT_BUTTON_CLICKED,this.onPinItButtonClicked),this.childListen(P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST,this.onUpdateGeo)},onExternalClick:function(e){e.stopPropagation()},getTerm:function(){var e=this.typeaheadField.getValue();return e},search:function(){var e=this.getTerm();e.length&&this.typeaheadField.getTypeahead().search()},onTypeaheadHint:function(e){if(!this._ignoreHints){var t=e.data||[];this._loadFeatures(t),this.features.length>1?this._addGeoFeatureList():this._removeGeoFeatureList(),this._panMapAsNeeded(),this._toggleRegionEmptyResult()}},_toggleRegionEmptyResult:function(){var e=this.$(".noResults"),t;t=this.features.length?P.string.format(P.i18n._("Sorry, we couldn't find {{ what }} in {{ where }}."),{where:this.$(".featureName").text(),what:this.interpretation.what}):P.i18n._("Sorry, we couldn't find that"),e.text(t)},_loadFeatures:function(e){var t=_.map(e,function(e){var t={},o=e.feature;return t.text=o.name,t.icon_class_name="flag"+o.cc,t.class_name="geoFeature",t.cc=o.cc,t.center=o.center,t});if(this.features=t,e.length){var o=e[0];this.interpretation={what:o.what,where:o.where,center:t[0].center}}},_removeGeoFeatureList:function(){this.$el.removeClass(this.CssClassName.HAS_GEO_FEATURES),this._geoFeatureList&&(this._geoFeatureList.hide(),this._geo=null,this._toggleRegionEmptyResult())},_addGeoFeatureList:function(){if(this.$el.addClass(this.CssClassName.HAS_GEO_FEATURES),this._geoFeatureList)this._geoFeatureList.updateFeatures(this.features),this._geoFeatureList.show();else{var e=this.typeaheadField,t=e.$el,o=new P.modules.GeoFeatureList({options:{features:this.features}});this._geoFeatureList=o,o.render().then(function(){this.insertChild(o,t)}.bind(this))}this._panMapAsNeeded()},_panMapAsNeeded:function(){if(this.interpretation){var e=this.interpretation.center,t=new L.LatLng(e.latitude,e.longitude);this._triggerCenter(t)}},onTypeaheadSearchStart:function(){this.showLoading()},hideTypeaheadResults:function(){this.typeaheadField.getTypeahead().emptyResults()},showLoading:function(){this.$el.toggleClass(this.CssClassName.LOADING,!0)},hideLoading:function(){this.$el.toggleClass(this.CssClassName.LOADING,!1)},_setLoading:function(e){this.$el.toggleClass(this.CssClassName.LOADING,e)},onTypeaheadResultsReturned:function(e){var t=e.data.items;this._setPlaceholderMarkersOnMap(t),this.hideEmptyState(),this.hideNoResults(),this.hideLoading()},showEmptyState:function(){this.hideNoResults(),this._setEmptyStateVisible(!0)},hideEmptyState:function(){this._setEmptyStateVisible(!1)},_setEmptyStateVisible:function(e){this.$el.toggleClass(this.CssClassName.EMPTY_STATE,e)},showNoResults:function(){this._setNoResultsVisible(!0)},hideNoResults:function(){this._setNoResultsVisible(!1)},_setNoResultsVisible:function(e){this.$el.toggleClass(this.CssClassName.HAS_NO_RESULTS,e)},onTypeaheadNoResultsReturned:function(e){this.$(".Typeahead").show(),this.clearPlaceholderMarkersFromMap(),this.hideLoading(),this.hideTypeaheadResults(),this._toggleRegionEmptyResult();var t=this.getTerm();t.trim().length>1?this.showNoResults():this.showEmptyState()},_triggerCenter:function(e){this.triggerEvent(P.CONST.EVENT_CENTER_MAP_GEO_FEATURE,e)},getPlaceSelector:function(){return this.getChildByModuleName("PlaceSelector")},onContentReady:function(){var e=this.options.board_id,t=this.getPlaceSelector(),o=t.getTypeaheadField();this.typeaheadField=o;var n={};n[P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED]=this.onPlaceholderMarkerOpen,this.pubsubSubscribe(e,n)},onUpdateGeo:function(e){var t=e.data;this._geo=t,this._updateGeo(t),this._panMapAsNeeded();var o=this._geo.center,n=new L.LatLng(o.latitude,o.longitude);this._triggerCenter(n)},_updateGeo:function(e){var t=e.text,o=this.interpretation.what;this.typeaheadField.setResourceOptionForTypeahead("center",null),this.typeaheadField.setResourceOptionForTypeahead("radius",null),this.typeaheadField.setResourceOptionForTypeahead("near",t),this.typeaheadField.setResourceOptionForTypeahead("should_geocode",!1),this.typeaheadField.search(o),this._ignoreHints=!0},focus:function(){this.typeaheadField.focus()},onPlaceholderMarkerOpen:function(e,t,o){var n=o.place_id;if(n){var a=this.typeaheadField.getTypeahead();a.highlightItemWithAttributeAndValue("id",n),a.focusHighlighted()}},onUploadSuccess:function(e){e.stopPropagation();var t=e.data.image_url;this._setActiveImage(t)},onButtonClick:function(e){var t=e.target,o=t.id;if(o===ho){var n=this.getChildById("addPlace");n&&n.remove(),this._panMapAsNeeded(),this._setPlaceholderMarkersOnMap(this.typeaheadItems),this.setBackButton(!1),e.stopPropagation()}else o===go&&this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null)},reset:function(){var e=this.typeaheadField;e.reset(),this.hideTypeaheadResults(),this._removeAddPlace()},onPinItButtonClicked:function(e){var t=e.data;this._setActiveImage(t),this.createPin()},_setActiveImage:function(e){this._activeImageUrl=e},_getActiveImage:function(){return this._activeImageUrl},createPin:function(){var e=this._place,t=e.get("id"),o=this.$("textarea").val(),n=this.options.board_id,a=this._getActiveImage(),r={board_id:n,place:t,description:o,image_url:a},i=P.resourceFactory.instance.create("PinResource",r);i.callCreate().then(function(e){this._place.set("placeholder",!1),this._setActiveImage(null),P.pubSub.instance.publish(n,P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD,{marker:this._place.attributes,pin:e.resource_response.data}),this.reset()}.bind(this))},addPermanentMarkerToMap:function(e){var t=e.attributes;this.triggerEvent(P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD,t)},_isNewPin:function(){return!this.options.pin_id},setBackButton:function(e){var t=this.getChildById("closeButton");e?(t.options.text=P.i18n._("Back"),t.id=ho,t.options.cancelButton=!1):(t.options.text=P.i18n._("Close"),t.id=go,t.options.cancelButton=!0),t.render()},_replaceContentWithPinForm:function(e){var t=this.options.board_id,o={id:"addPlace",name:"AddAPlace",options:{place:e.attributes,board_id:t}};P.moduleFactory.load(o).then(function(t){this.showLoading(),t.render().then(function(){this.setBackButton(!0),this.hideLoading();var o=this.$(".typeaheadWrapper");this.insertChild(t,o),t.setPlace(e)}.bind(this))}.bind(this))},_removeAddPlace:function(){var e=this.getChildById("addPlace");e&&e.remove()},_getMarkerOptions:function(e){var t=P.MarkerOptions.fromPlainObject(e.attributes);return t},onRemovedFromDom:function(){this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null)},_setPlaceholderMarkersOnMap:function(e){this.typeaheadItems=e;var t=_.map(e,function(e){return e.get("template")?void 0:this._getMarkerOptions(e)}.bind(this));t=t;var o={markerOptionsList:t};this.triggerEvent(P.CONST.EVENT_SET_PLACEHOLDER_MARKERS,o)},highlightPlaceholderMarkerOnMap:function(e){var t=e.get("resultIndex"),o={index:t};this.triggerEvent(P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER,o)},clearPlaceholderMarkersFromMap:function(){this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null),this.triggerEvent(P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,null)},hideChildDropdowns:function(){this._geoFeatureList&&this._geoFeatureList.hideDropdown()},onTypeaheadItemSelected:function(e){e.stopPropagation();var t=e.data.item;if(t&&!t.get(P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE)){var o=t.get("search_id"),n=t.get("id");if(o){var a={search_id:o,place:n},r=P.resourceFactory.instance.create("PlacePingbackResource",a);r.call("update",{error:function(){},success:function(){},complete:function(){}})}if(this._isNewPin()){this._place=t;var i=t.get("latitude"),s=t.get("longitude"),l=L.latLng(i,s),u=t.get("resultIndex"),d={latLng:l,index:u};return this.triggerEvent(P.CONST.EVENT_PLACE_SELECTED,d),this._replaceContentWithPinForm(t),void this.highlightPlaceholderMarkerOnMap(t)}var c=e.target;c.showLoading(!0);var p=this.options.pin_id,m=P.resourceFactory.instance.create("PinResource",{id:p,place:n});m.callUpdate({showError:!1}).then(function(e){var o=e.resource_response.data;c.hideLoading(),this.addPermanentMarkerToMap(t),P.pubSub.instance.publish(p,P.CONST.PUBSUB_TOPIC_PIN_UPDATED,o)}.bind(this))}},onTypeaheadItemHighlighted:function(e){var t=e.data.item;t||this._place?(t&&this.highlightPlaceholderMarkerOnMap(t),e.stopPropagation()):this.triggerEvent(P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,null)}}),P.modules.AddPinToMap.prototype.className="AddPinToMap",goog.provide("P.modules.Board"),goog.require("P.HoverIntent"),goog.require("P.Module"),goog.require("P.modules.Dropdown");var fo="follow_view",bo="boardPinsGrid",ko="boardCoverImage";P.modules.Board=P.Module.extend({events:{"click .dismiss":"onDismissClick"},CssClassName:{NOT_NAVIGATABLE:"notNavigatable",NO_SHADOW:"noShadow",FOLLOW_CONFIRMED:"followConfirmed"},getOwnedScrollables:function(){return this.$(".pinGridWrapper")},onContentReady:function(){var e=this.getId();if(e){var t={};t[P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED]=this.onBoardCoverUpdated,t[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,t[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,t[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,t[P.CONST.PUBSUB_TOPIC_BOARD_FOLLOW]=this.onBoardFollow,this.pubsubSubscribe(e,t)}if(this.options.view_type===bo){var o=this.getChildById("pinGrid");this.listen(o,P.CONST.EVENT_CONTENT_CHANGED,this.updateDom)}this.options.view_type===fo&&this.initHoverListeners()},onDismissClick:function(){this.dismissed=!0,this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},onBoardHoverEnter:function(){this.$el.isHovering()&&this._dropdown.show()},onBoardHoverExit:function(){this._dropdown.isHovering()||this._dropdown.hide()},onBoardFollow:function(e,t,o){this.options.view_type===fo&&this.$el.addClass(this.CssClassName.FOLLOW_CONFIRMED)},onPinDeleted:function(e,t,o){this.options.view_type===ko&&this.onBoardUpdated()},onBoardCoverUpdated:function(e,t,o){this.setBoardCover(o)},positionBoardPinsGrid:function(){var e=this.getChildById("pinGrid"),t=document.activeElement;e.$(".activeItem").focus(),t&&$(t).focus()},toggleFollow:function(){this.getChildByModuleName("BoardFollowButton").toggleFollow()},initHoverListeners:function(){!this._hoverIntent&&this.options.use_flyout&&(this._hoverIntent=new P.HoverIntent(this.$el,{enterDelay:500,exitDelay:200}),this.listen(this,P.CONST.EVENT_NAVIGATE,this.onBoardHoverExit),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE,this.onBoardHoverEnter),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,this.onBoardHoverExit),this.isClickButton=function(){return!1},this._dropdown=new P.modules.Dropdown({options:{anchor:this.$el,class_name:"followViewHover underneathHeader",position_point:"RIGHT_TOP",module:{name:"Board",options:{view_type:"boardPinsGrid",scrollable:!0,prevent_default_scroll:!0,board_follow_button_options:{board_id:this.resource.options.board_id}},resource:{name:"BoardResource",options:{board_id:this.resource.options.board_id}}}}}),this.appendChild(this._dropdown),this.$el.initHovering(),this._dropdown.initHovering())},setBoardCover:function(e){var t=e.url,o=e.crop_x,n=e.crop_y,a=e.nativeHeight,r=e.nativeWidth,i=e.scale,s=this.$(".boardCoverWrapper img");s.attr("src",t).css({height:a*i,left:-o,"max-width":"none",position:"absolute",top:-n,width:r*i})},disabledButtons:[],disable:function(){this.$el.find(".hoverMask").addClass(this.CssClassName.NOT_NAVIGATABLE),this.disabledButtons=[],_.each(this.getChildrenByModuleName("ShowModalButton"),function(e){e.isDisabled()||(e.disable(),this.disabledButtons.push(e))}.bind(this))},enable:function(){this.$el.find(".hoverMask").removeClass(this.CssClassName.NOT_NAVIGATABLE),_.each(this.disabledButtons,function(e){e.enable()})},setFollowButtonState:function(e){var t=this.getChildByModuleName("BoardFollowButton");t&&t.setState(e)},getId:function(){return this.data&&this.data.id},onBoardDeleted:function(){this.triggerEvent(P.CONST.EVENT_BOARD_DELETED,this,!0),this.destroy()},onBoardUpdated:function(){this.render()},getLoggingObjectIdStr:function(){return this.getId()},updateBoardPinsGrid:function(e,t){this.updatePinGrid(e.id,t),this.updateUser(e.name,e.url,(e.owner||{}).id)},updateBoardGridActiveItem:function(e){var t=this.getChildById("pinGrid");t&&e&&t.updateActiveGridItem(e)},updateBoardDetails:function(e){this.data.id=e.id,this.updateBoardIcons(e),this.updateBoardButtons(e)},updateBoardIcons:function(e){var t=this.getChildByModuleName("BoardIcons");t&&e&&(t.data=e,t.render())},updateDom:function(){var e=this.$el.css("max-height")||"0";e=e.replace(/[^0-9]/g,""),this.$el.outerHeight()<e&&this.$el.addClass(this.CssClassName.NO_SHADOW)},updateUser:function(e,t,o){var n=this.getChildByModuleName("User");n&&e&&o&&(n.options.title_text=e,n.options.url=t,n.options.spinner={enable:!1},n.resource.set("user_id",o),n.render())},updatePinGrid:function(e,t){var o=this.getChildById("pinGrid");o&&e&&t&&(o.options.active_item_id=t,o.options.spinner={enable:!1},o.resource.set("board_id",e),o.render())},updateBoardButtons:function(e){var t=this.getChildById("boardButtons");if(t&&e){var o={board_access:e.access||[],board_followed_by_me:e.followed_by_me,board_owner:(e.owner||{}).id,board_id:e.id};t.options.button_options=o,t.options.url=e.url,t.render()}}}),P.modules.Board.prototype.className="Board",goog.provide("P.modules.BoardCollaboratorInviter"),goog.require("P.modules.BoardEditActionBase"),P.modules.BoardCollaboratorInviter=P.modules.BoardEditActionBase.extend({onContentReady:function(){P.modules.BoardEditActionBase.prototype.onContentReady.call(this);var e=this.$(".BoardInviteForm .TypeaheadField .Input"),t=this.$(".BoardInviteForm .inviteButton");e.width(e.width()-t.innerWidth())}}),P.modules.BoardCollaboratorInviter.prototype.className="BoardCollaboratorInviter",goog.provide("P.modules.BoardEdit"),goog.require("P.modules.BoardEditActionBase"),goog.require("P.modules.BoardEditBase"),goog.require("P.moduleFactory"),goog.require("P.ga"),P.modules.BoardEdit=P.modules.BoardEditActionBase.extend({handleDelete:function(e,t){this.isInModal()?(P.pubSub.instance.publish(e,P.CONST.PUBSUB_TOPIC_BOARD_DELETED),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_DELETED,{privacy:t}),this.destroy()):this.redirectAfterDelete()},onButtonClick:function(e){P.modules.BoardEditBase.prototype.onButtonClick.call(this,e);var t=e.target;"deleteBoardButton"===t.id&&this.onDeleteClick()},onDeleteClick:function(){P.ga.trackEvent("board_delete",P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()},onDeleteConfirm:function(){P.ga.trackEvent("board_delete",P.CONST.GA_ACTION_CLICK_SUBMIT),this.deleteBoard()},showConfirmation:function(){var e={name:"ConfirmDialog",options:{template:"delete_board"}};P.moduleFactory.load(e).then(function(e){this.showInModal(e),this.listen(e,P.CONST.EVENT_CONFIRM,this.onDeleteConfirm)}.bind(this))}}),P.modules.BoardEdit.prototype.className="BoardEdit",goog.provide("P.modules.BoardFollowButton"),goog.require("P.modules.Dropdown"),goog.require("P.modules.FollowButton"),goog.require("P.resourceFactory"),P.modules.BoardFollowButton=P.modules.FollowButton.extend({getResourceId:function(){return this.options.board_id},getFollowResource:function(){return P.resourceFactory.instance.create("BoardFollowResource",{board_id:this.getResourceId()})},getFollowClass:function(){return this.options.follow_class},getContextualResource:function(){return P.resourceFactory.instance.create("BoardResource",{board_id:this.getResourceId(),field_set_key:"grid_item"})},getAuthRedirectUrl:function(){return P.user.instance.isAuthenticated()?void 0:P.signupModalManager.showInlineSignupModalOnButtonClick("BoardFollowButton")},onContentReady:function(){if(this.options.user_id){var e={};e[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowUser,e[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onUnfollowUser,this.pubsubSubscribe(this.options.user_id,e)}var t={};t[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this._onFollow,t[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this._onUnfollow,t[P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW]=this._onUnfollow,this.pubsubSubscribe(this.getResourceId(),t),this.showMemo()},_onFollow:function(){this.setState(!0);var e={board_id:this.getResourceId()};if(this.triggerEvent(P.CONST.EVENT_BOARD_FOLLOW,e,!0),P.pubSub.instance.publish(this.getResourceId(),P.CONST.PUBSUB_TOPIC_BOARD_FOLLOW,!0),this.options.suggested_boards_menu&&!P.context.instance.is_mobile_agent){var t=P.experiments.instance.v2ActivateExperiment("recommend_boards_on_board_follow"),o=["enabled2","employee","employees"].indexOf(t)>-1;if(o){this._dropdown&&this._dropdown.destroy();var n={anchor:this.$el.closest(".boardFollowButtonWrapper"),anchored:!0,largeCaret:!0,fixed:!0,position_point:"BOTTOM_CENTER",force_in_viewport:!0,class_name:"suggestedBoardsDropdown",module:this.options.suggested_boards_menu};this._dropdown=new P.modules.Dropdown({options:n}),this._dropdown.initHovering(),this._dropdown.slideIn(200)}}},_onUnfollow:function(){this.setState(!1);var e={board_id:this.getResourceId()};this.triggerEvent(P.CONST.EVENT_BOARD_UNFOLLOW,e,!0),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW,!0),this.options.suggested_boards_menu&&!P.context.instance.is_mobile_agent&&this.dropdown&&this._dropdown.destroy()},onFollowUser:function(){this.setState(!0)},onUnfollowUser:function(){this.setState(!1)}}),P.modules.BoardFollowButton.prototype.className="BoardFollowButton",goog.provide("P.modules.BoardInfoBar"),goog.require("P.Module"),goog.require("P.modules.BulkEditBar");var yo="editButton",vo="boardMenu",Po=300,wo=2,To="ease-out";P.modules.BoardInfoBar=P.Module.extend({CssClassName:{FIXED_HEADER:"fixedHeader",HEADER_COLLAPSED:P.CONST.CLASS_HEADER_COLLAPSED},events:{"click .movePinsButton":"onMovePinsClicked"},onCreated:function(){this.totalNagHeight=0,this.boardInfoOffsetHeight=0;var e={};e[P.CONST.PUBSUB_TOPIC_NAG_TOGGLE]=this.onNagVisibilityChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)},onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED]=this.onWriteAccessChange,this.pubsubSubscribe(this.data.id,e),this._isPlaceBoard="places"===this.data.layout;var t={};t[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,t)},onAddedToDom:function(){var e=this.$el.position().top;"places"===this.data.layout&&(e+=P.CONST.PIN_MARGIN,P.context.instance.is_mobile_agent||(e=300)),this.infoBarPosition=e;var t=!P.context.instance.is_mobile_agent&&!P.user.instance.isAuthenticated();P.context.instance.is_mobile_agent||t||("undefined"==typeof this.inBulkEditMode&&this._setBulkEditMode(!1),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll),this.onScroll())},onRemovedFromDom:function(){this.scrollListener&&this.removeListener(this.scrollListener)},onWriteAccessChange:function(e,t){this.render()},onNagVisibilityChange:function(e,t,o){o.height&&(o.visible?this.totalNagHeight+=o.height:this.totalNagHeight-=o.height)},showEditModal:function(){var e=this.getChildById(yo);return e?(e.showModalSubmodule(),!0):!1},onScroll:function(){var e=this.getScrollableElement().scrollTop();if(!(0>e)&&this.options.collapsible)if(e>=this.infoBarPosition+this.totalNagHeight&&!this.options.fixedHeader){if(this.collapse(),this.getChildById(vo)){this.boardInfoOffsetHeight=this.getChildById(vo).getDropdown().getTopOffset();var t=String(this.boardInfoOffsetHeight-(this.parent.$(".boardHeaderWrapper").height()+wo))+"px";this.getChildById(vo).getDropdown().turnOnFixed(t)}}else e<this.infoBarPosition+this.totalNagHeight&&this.options.fixedHeader&&(this.expand(),this.getChildById(vo)&&this.getChildById(vo).getDropdown().turnOffFixed(this.boardInfoOffsetHeight))},collapse:function(e){this.options.fixedHeader||(this.triggerEvent(P.CONST.EVENT_INFO_BAR_COLLAPSED,null,!0),this.updateOptionsAndDom({collapsed:!0,fixedHeader:!0,offsetTop:e}))},expand:function(){this.options.fixedHeader&&(this.triggerEvent(P.CONST.EVENT_INFO_BAR_EXPANDED,null,!0),this.updateOptionsAndDom({collapsed:!1,fixedHeader:!1}))},onMovePinsClicked:function(){if(!this.inBulkEditMode){this._setBulkEditMode(!0);var e=this.data,t={board_id:e.id,board_privacy:e.privacy,is_place_board:this._isPlaceBoard},o=new P.modules.BulkEditBar({options:t});return o.render().then(function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,P.CONST.ENTER_BULK_EDIT);var e="64px";this.insertChild(o,this.$el),this.bulkEditBar=o,this.enterBulkEditMode(e)}.bind(this))}},enterBulkEditMode:function(e){this.$(".infoBarWrapper").transition({y:e,easing:To,duration:P.CONST.BULK_EDIT_ANIMATION_DURATION}),this.bulkEditBar.enterBulkEditMode()},exitBulkEditMode:function(){this.bulkEditBar&&this.bulkEditBar.exitBulkEditMode(),this._setBulkEditMode(!1),this.$(".infoBarWrapper").transition({y:"0",easing:To,duration:P.CONST.BULK_EDIT_ANIMATION_DURATION})},toggleBulkEditMode:function(e,t,o){o===P.CONST.EXIT_BULK_EDIT&&this.exitBulkEditMode()},updateDom:function(){this.$el.toggleClass(this.CssClassName.HEADER_COLLAPSED,this.options.collapsed),this.$el.toggleClass(this.CssClassName.FIXED_HEADER,this.options.fixedHeader);var e={easing:To,duration:Po},t=this.$(".smallBoardName"),o=this.$(".pinsAndFollowerCount");this.inBulkEditMode||(this.options.fixedHeader?(e.y="66px",t.css("opacity",1),t.transition(e),this.$el.css("top",this.options.offsetTop)):(this.$el.css("top",""),e.y="0",t.transition(e,function(){t.css("opacity",0)})),o.transition(e))},_setBulkEditMode:function(e){this.inBulkEditMode=e},setCollapsible:function(e){this.updateOptions({collapsible:e})},onOptionsChanged:function(e,t){"undefined"==typeof t.fixedHeader&&(t.fixedHeader=!1),"undefined"==typeof t.collapsible&&(t.collapsible=!0)}}),P.modules.BoardInfoBar.prototype.className="BoardInfoBar",goog.provide("P.modules.BoardPicker"),goog.require("P.modules.Picker"),goog.require("P.resourceFactory"),P.modules.BoardPicker=P.modules.Picker.extend({_SHOW_BOARD_SUGGESTIONS_THRESHOLD:3,onCreated:function(){P.modules.Picker.prototype.onCreated.call(this)},onContentReady:function(){P.modules.Picker.prototype.onContentReady.call(this),this.shouldRenderQuickPicks()&&this._renderQuickPicksItems(),this.options.select_first_board&&this.selectFirstBoard(),this.options.default_board_id&&this.selectBoardById(this.options.default_board_id),this.model&&this.model.on("change",function(){this.renderExistingData()}.bind(this))},_renderQuickPicksItems:function(){var e=P.resourceFactory.instance.create("QuickPicksSuggestionResource",{pin_id:this.options.pin_id});e.callGet({showError:!1}).then(function(e){var t=this.getList(),o=e.resource_response&&e.resource_response.data,n=_.uniq(o,!1,function(e){return e.id});if(this.data.boards_shortlist&&this.data.boards_shortlist.length){var a=this.data.boards_shortlist[0].id===n[0].id;this._removeQuickPicksSpinner(),a||t.emptySectionAtIndex(0);var r=a?n.slice(1):n;r.forEach(function(e){t.appendItem({type:"module",name:"BoardLabel",item_module:"BoardLabel",data:e,options:{view_type:"pinCreate",show_pin_it_button:!0}},!1,0)}),this.data.boards_shortlist=n}}.bind(this))},selectBoardAtIndex:function(e){var t=this._list.$(".allBoards"),o=t.find(".item").eq(e);this._list._selectItem(o)},selectBoardById:function(e){var t=-1;this.getAllBoards().forEach(function(o,n){o.id===e&&(t=n)}),t>0&&this.selectBoardAtIndex(t)},selectFirstBoard:function(){this._list.selectFirstVisibleItem()},_create:function(e){var t="compact"===this.options.view_type;if(e&&t){var o=P.resourceFactory.instance.create("BoardResource",{name:e});return o.callCreate().then(function(e){var t=e.resource_response.data,o=t.id;return this.triggerEvent(P.CONST.EVENT_BOARD_CREATED,o,!0),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,t),t}.bind(this))}return Promise.resolve({name:e})},getSelectedElement:function(){return this._list.getSelectedItemElement()},getSelectedBoardData:function(){return this._list.getSelectedItemData()},getAllBoards:function(){return this.data.all_boards},getBoardsShortList:function(){return this.data.boards_shortlist},getCreateSuggestions:function(){return this.data.create_suggestions},_onNameTextChange:function(){if(P.modules.Picker.prototype._onNameTextChange.call(this),this.options.hide_all_boards_heading_on_filter){var e=this._getNameInputText(),t=this.$(".allBoards .sectionHeading");e.length?t.hide():t.show()}},hasBoards:function(){return this.extraData.hasBoards},appendModuleToList:function(e,t){var o=this.getList();o.appendItem(e,!1,t)},shouldRenderQuickPicks:function(){return this.options.async&&this.getBoardsShortList().length},_removeQuickPicksSpinner:function(){var e=this.getList().getChildByModuleName("BoardPickerSpinnerBlock");e&&(this.getList().removeItem(e.getParentElement()),e.destroy())}}),P.modules.BoardPicker.prototype.className="BoardPicker",goog.provide("P.modules.BoardPickerDropdownButton"),goog.require("P.dom"),goog.require("P.modules.BoardPicker"),goog.require("P.modules.DropdownButton"),P.modules.BoardPickerDropdownButton=P.modules.DropdownButton.extend({CssClassName:_.extend(P.modules.DropdownButton.prototype.CssClassName,{PRIMARY:"primary"}),onCreated:function(){P.modules.DropdownButton.prototype.onCreated.call(this),this._selectedBoard=null,this.childListen(P.CONST.EVENT_CHANGE,this._onChildChange),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this._onChildDropdownHide)},onContentReady:function(){this.extraData&&(this._selectedBoard=this.extraData.selectedBoard),P.modules.DropdownButton.prototype.onContentReady.call(this),this.extraData.noBoards&&P.dom.deferDomManipulation(function(){var e=this.$el;P.boardPickerUtil.showNoBoardsTooltip(e)}.bind(this))},getContentModuleLoadOptions:function(){var e={name:"BoardPicker",options:{view_type:"compact",in_popover:!0},resource:{name:this.resource.name,options:this.resource.options}};return this.options.selected_board_id?e.options.selected_board_id=this.options.selected_board_id:(e.options.selected_section_index=0,e.options.selected_item_index=0),e},getSelectedBoardId:function(){return this._selectedBoard?this._selectedBoard.id:null},getSelectedBoardPrivacy:function(){return this._selectedBoard?this._selectedBoard.privacy:null},_onChildChange:function(e){e.stopPropagation(),this._selectedBoard=e.data,this.options.selected_board_id=this._selectedBoard.id;var t=this._getLabelModule();t.data=this._selectedBoard,t.renderExistingData(),this.hideDropdown(),this.$el.removeClass(this.CssClassName.PRIMARY),this.triggerEvent(P.CONST.EVENT_CHANGE,e.data,!0),this.$el.blur()},_onChildDropdownHide:function(e){var t=this.getDropdown().getContentModule();t.clearName()}}),P.modules.BoardPickerDropdownButton.prototype.className="BoardPickerDropdownButton",goog.provide("P.modules.CampbellUserMenu"),goog.require("P.modules.DropdownButton"),P.modules.CampbellUserMenu=P.modules.DropdownButton.extend({}),P.modules.CampbellUserMenu.prototype.className="CampbellUserMenu",goog.provide("P.modules.CloseupRichPinContent"),goog.require("P.Module"),goog.require("P.modules.Pin"),P.modules.CloseupRichPinContent=P.Module.extend({getLoggingObjectIdStr:function(){return this.resource.id},onCreated:function(){this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady)},onMapReady:function(e){var t=this.getChildById("map");if(t){var o=new P.modules.Pin({data:this.data,resource:this.resource});t.addMarkerToCloseupMap(o)}}}),P.modules.CloseupRichPinContent.prototype.className="CloseupRichPinContent",goog.provide("P.modules.CloseupSidebar"),goog.require("P.Module"),goog.require("P.modules.Board"),goog.require("P.moduleFactory"),P.modules.CloseupSidebar=P.Module.extend({onContentReady:function(){if(this.data.id){var e={};e[P.CONST.PUBSUB_TOPIC_PIN_UPDATED]=this.onPinUpdated,this.pubsubSubscribe(this.data.id,e)}var t=this.getChildByModuleName("Board");t&&t.positionBoardPinsGrid()},onPinUpdated:function(){this.render()},updateDomain:function(e){var t=this.getChildById("domain");if(!e)return void(t&&(t.destroy(),this.$(".domainContainerTitle").hide()));if(!t&&e){var o={name:"Domain",id:"domain",options:{spinner:{enable:!1}},resource:{name:"DomainResource",options:{domain:e}}};return P.moduleFactory.load(o).then(function(e){return e.render().then(function(){this.$(".domainContainerTitle").show(),this.insertChild(e,this.$("#domainContainer"))}.bind(this))}.bind(this))}return t.resource.set("domain",e),t.render().then(function(){t.fadeIn()})},updateRelatedRecipes:function(e){if(this.$(".relatedRecipeContainer")){var t=this.getChildById("relatedRecipe");if(!e||0===e.length)return void(t&&t.destroy());if(!t&&e){var o={name:"RelatedRecipe",id:"relatedRecipe",options:{ingredients:e}};return void P.moduleFactory.load(o).then(function(e){e.render().then(function(){this.insertChild(e,this.$(".relatedRecipeContainer"))}.bind(this))}.bind(this))}t.options={ingredients:e},t.render().then(function(){t.fadeIn()})}},updateBoardGrid:function(e,t){var o=this.getChildById("boardGrid");o&&e&&t&&(o.getId()===e.id?o.updateBoardGridActiveItem(t):(this.data.board=e,o.updateBoardPinsGrid(e,t)))},updateBoardDetails:function(e){var t=this.getChildById("boardGrid");t&&e&&t.getId()!==e.id&&t.updateBoardDetails(e)}}),P.modules.CloseupSidebar.prototype.className="CloseupSidebar",goog.provide("P.modules.CloseupSourceDescription"),goog.require("P.Module"),goog.require("P.modules.Pin"),P.modules.CloseupSourceDescription=P.Module.extend({getLoggingObjectIdStr:function(){return this.resource.id},onContentReady:function(){this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady)},onMapReady:function(e){var t=this.getChildById("map");if(t){var o=new P.modules.Pin({data:this.data,resource:this.resource});t.addMarkerToCloseupMap(o)}}}),P.modules.CloseupSourceDescription.prototype.className="CloseupSourceDescription",goog.provide("P.modules.Conversation"),goog.require("P.conversationsUtil"),goog.require("P.Module"),goog.require("P.modules.ConversationHead"),goog.require("P.modules.ConversationPopup"),goog.require("P.modules.Dropdown"),goog.require("P.i18n"),goog.require("P.timer"),goog.require("P.genConst"),P.modules.Conversation=P.Module.extend({CssClassName:{UI_STATE_CONVERSATION:"ui-state-conversation",UI_STATE_HOVER:"ui-state-hover"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CONVERSATION_HEAD_READY,this.onConversationHeadReady)},onEscape:function(){this.closeConversation()},onContentReady:function(){this._attachPopup()},onConversationHeadReady:function(e){var t=e.target;_.contains(this.children,t)&&(this._headClickListener||(this._headClickListener=this.listen(t,P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,this.onConversationHeadClick)),t.getContent().droppable({activeClass:"ui-state-highlight",tolerance:"pointer",over:function(e,t){$(t.helper).transition({scale:.24},230,"ease").transition({scale:.25,duration:20}),$(this).transition({scale:1.3,duration:150}).transition({scale:1.2,duration:100})},out:function(e,t){$(t.helper).transition({scale:1,duration:250}),$(this).transition({scale:1,duration:250})},drop:function(e,t){var o=this.getConversationPopup(),n=P.conversationsUtil.getDraggedObject();o.sendMessage(null,n),this.openConversation(),$(t.helper).transition({scale:1,duration:0})}.bind(this)}))},onConversationHeadClick:function(e){if(this._popup)if(this._popup.isShowing()){if(this.getConversationHeadBadgeCount())return void this.getConversationPopup().scrollToLatest();
this.closeConversation()}else this.openConversation();else this._attachPopup()},onDropdownShow:function(e){var t=this.getConversationPopup();this.focusInput();var o=this._popup.getContent();o.droppable({activeClass:"ui-state-highlight",tolerance:"pointer",activate:function(e,o){P.conversationsUtil.getDraggedObject()&&t.showDropTarget()},deactivate:function(e,o){t.hideDropTarget()},over:function(e,n){P.conversationsUtil.getDraggedObject()&&($(n.helper).addClass(this.CssClassName.UI_STATE_CONVERSATION),t.setDropTargetText(P.i18n._("Drop here to send!")),n.helper.transition({scale:.5,duration:130}).transition({scale:.53,duration:50}),o.addClass(this.CssClassName.UI_STATE_HOVER))}.bind(this),out:function(e,n){$(n.helper).removeClass(this.CssClassName.UI_STATE_CONVERSATION),t.setDropTargetText(P.i18n._("Drag here to send!")),o.removeClass(this.CssClassName.UI_STATE_HOVER),n.helper.animate({scale:1},150)}.bind(this),drop:function(e,n){if(P.conversationsUtil.getDraggedObject()){var a=P.conversationsUtil.getDraggedObject();t.sendMessage(null,a),$(n.helper).transition({scale:1,duration:0}),P.timer.setTimeout(function(){$(n.helper).removeClass(this.CssClassName.UI_STATE_CONVERSATION)}.bind(this),100),o.addClass(this.CssClassName.UI_STATE_HOVER)}}.bind(this)}),this._shouldScrollToBottom&&t.scrollToLatest(),this._shouldScrollToBottom=!1},_attachPopup:function(){var e={module:this.getPopupModuleLoadOptions(),anchor:this.getContent(),mouse_close_mode:"never",persist_through_navigate:!0,fixed:!0,caret_style:"lightGray lightGrayConversations",position_point:"RIGHT_BOTTOM",class_name:"aboveModal activeConversationDropdown",prefetch:!0};this._popup=new P.modules.Dropdown({options:e,id:"popup"}),this.addChild(this._popup),this._shouldScrollToBottom=!0,this.listen(this._popup,P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.listen(this._popup,P.CONST.EVENT_ESCAPE_DROPDOWN,this.onEscape),this.childListen(P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE,this.onDecrementBadge)},onDecrementBadge:function(e){var t=this._getConversationHead(),o=this.getConversationHeadBadgeCount(),n=Math.max(o-1,0);t.setBadgeCount(n)},getPopupModuleLoadOptions:function(){var e=_.clone(this.options);return e.peek=!0,_.isUndefined(this.options.peek)||(e.peek=this.options.peek),e.popup_log_component_type=P.genConst.ComponentType.CONVERSATION_MESSAGES,{name:"ConversationPopup",options:e,data:this.data}},focusInput:function(){var e=this.getConversationPopup();e&&e.focus()},updateConversation:function(e){this.data=e;var t=e.unread,o=this.getConversationPopup();if(this.popupIsVisible()){if(!o.isScrolledToBottom()){var n=this.getConversationHeadBadgeCount(),a=n+t;o.setUnseenMessageCount(a),this.setBadgeCount(a)}o.fetchNewMessages(t)}else this.setBadgeCount(t),o.fetchNewMessages(t,!0)},getConversationPopup:function(){return this._popup.getContentModule()},focus:function(){this.focusInput()},onDestroyed:function(){this.closePopup()},showPopup:function(){var e=this.getConversationHeadBadgeCount();e&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,e),this.setBadgeCount(0),this._popup.show(),this.focusInput()},adjustPopup:function(){this._popup.reposition()},getConversationHeadBadgeCount:function(){var e=this._getConversationHead();return e.getBadgeCount()},closePopup:function(){this._popup.hide()},setBadgeCount:function(e){var t=this._getConversationHead();t.setBadgeCount(e)},setActive:function(){var e=this._getConversationHead();e.setActive()},setInactive:function(){var e=this._getConversationHead();e.setInactive()},popupIsVisible:function(){return this._popup.isVisible()},_getConversationHead:function(){return this.getChildById("conversationHead")},onButtonClick:function(e){var t=e.target;t.isCancelButton()&&(this.closePopup(),this.scaleConversationDownAndRemove())},scaleConversationDownAndRemove:function(){this.parent.scaleConversationDownAndRemove(this.getConversationId())},closeConversation:function(){this.parent.closeConversation(this)},openConversation:function(){this.parent.openConversation(this)},getConversationId:function(){return this.options.id}}),P.modules.Conversation.prototype.className="Conversation",goog.provide("P.modules.FastFollow"),goog.require("P.Module"),goog.require("P.modules.Grid"),goog.require("P.util");var Lo="fastFollowContent",Eo="fastFollowHeader",xo="categoryBoardsGrid",Oo="wholeBoardMask",Co=355,So=102,Fo=56,No=5,Io={CATEGORY:0,SEARCH_TERM:1};P.modules.FastFollow=P.Module.extend({_boardsFollowed:[],_modalDisplayed:!1,_cachedGrids:{},_currentAction:Io.CATEGORY,getOwnedScrollables:function(){return this.$(".fastFollowGridContainer")},_getBoardIdFromEvent:function(e){var t=e.data||{};return t.board_id},_onBoardFollow:function(e){var t=this._getBoardIdFromEvent(e),o=$.inArray(t,this._boardsFollowed);t&&-1===o&&(this._boardsFollowed.push(t),this._updateFollowedBoards(1),this._updateFollowedBoardMask(e,!0))},_onBoardUnfollow:function(e){var t=this._getBoardIdFromEvent(e);if(t){var o=$.inArray(t,this._boardsFollowed);-1!==o&&(this._boardsFollowed.splice(o,1),this._updateFollowedBoards(-1)),this._updateFollowedBoardMask(e,!1),this._boardsFollowed.length===No-1&&this._setProgressCompletion(!1)}},_updateFollowedBoardMask:function(e,t){var o=this._getBoardIdFromEvent(e);if(o){var n=this.$("."+Oo+".mask"+o);t?n.show():n.hide()}},_onCategoryUpdate:function(e){var t=e.data,o={name:"CategoryBoardsResource",options:{category:t}};this._currentAction=Io.CATEGORY,this._updateGridFromResource(o,t,t)},_onSearchQueryUpdate:function(e){var t=e.data,o={name:"SearchResource",options:{query:t,scope:"boards",search_context:"fast_follow"}};this._currentAction=Io.SEARCH_TERM,this._updateGridFromResource(o,null,t)},_updateGridFromResource:function(e,t,o){this._currentGrid||(this._currentGrid=this.getChildById(xo),this._cachedGrids[this._currentGrid.resource.options.category]=this._currentGrid),this._currentGrid.remove();var n=this._cachedGrids[t];n||(n=new P.modules.Grid({id:xo,options:{centered:!1,layout:"fixed_height",show_grid_footer:!1,scrollable:!0,item_options:{allow_click_thru:!1,board_click_mask:!0}},resource:e}),n.render(),t&&(this._cachedGrids[t]=n));var a=this.$(".fastFollowGridContainer");this.$("."+Lo).scrollTop(0),this.insertChild(n,a),this._currentGrid=n},_updateBoardHeading:function(e){this.$(".heading").hide(),this._currentAction===Io.CATEGORY?(e=this.$(".followPageSidebarCategory[data-category="+e+"]"),e=e?e.text():null,this.$(".categoryHeading").show()):this.$(".searchHeading").show();var t=this.$(".categoryOrQuery");t&&t.length&&e&&t.text(e)},_onProgressCompletion:function(){this._userRegisterTrackActionOrientationComplete(),this._setProgressCompletion(!0)},_onFastFollowCompletion:function(e){var t=e.target;t&&"tryOutYourFeedButton"===t.id&&(this.hide(),this.navigate("/",null,P.genConst.ForceRefreshType.PAGE))},_userRegisterTrackActionOrientationComplete:function(){P.util.trackRegisterAction("orientation_complete")},_setProgressCompletion:function(e){var t=this.getChildById(Eo);return t?(t.options.progress_completed=e,e?t.render():(t.options.num_boards_followed=this._boardsFollowed.length,t.render())):Promise.resolve(void 0)},_updateFollowedBoards:function(e){if(!this._modalDisplayed){var t=this.getChildById(Eo);t&&t.stepProgress(e)}},onContentReady:function(){_.each(this.extraData.followed_boards,function(e){this._boardsFollowed.push(e.id)}.bind(this)),this.childListen(P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED,this._onCategoryUpdate),this.childListen(P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED,this._onSearchQueryUpdate),this.childListen(P.CONST.EVENT_PROGRESS_COMPLETED,this._onProgressCompletion),this.childListen(P.CONST.EVENT_BOARD_FOLLOW,this._onBoardFollow,this),this.childListen(P.CONST.EVENT_BOARD_UNFOLLOW,this._onBoardUnfollow,this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onFastFollowCompletion),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.position),this.position()},position:function(){if(this.inDom&&this.contentReady){this.fastFollowHeaderHeight||(this.fastFollowHeaderHeight=this.$(".FastFollowHeader").outerHeight(!0));var e=So+Fo,t=P.Viewport.height,o=t-e-this.fastFollowHeaderHeight,n=Math.max(Co,o);this.$(".fastFollowContent").height(n)}},onDestroyed:function(){_.each(_.values(this._cachedGrids),function(e){e.destroy()})}}),P.modules.FastFollow.prototype.className="FastFollow",goog.provide("P.modules.FirstBoardCreate"),goog.require("P.modules.Picker"),goog.require("P.resourceFactory"),P.modules.FirstBoardCreate=P.modules.Picker.extend({onContentReady:function(){P.modules.Picker.prototype.onContentReady.call(this),this.model&&this.model.on("change",function(){this.renderExistingData()}.bind(this))},_onChildItemClick:function(e){var t=e.target,o=e.data;t&&"list"===t.id&&o&&o.name&&(this.$("input.name").val(o.name),this._onNameTextChange())},getBoardResource:function(e){var t=P.resourceFactory.instance.create("BoardResource",{name:e,return_existing:!0});return t},_create:function(e){if(e){var t=this.getBoardResource(e);return t.callCreate().then(function(t){var o=t.resource_response.data,n=_.pluck(this.data,"title"),a=n.indexOf(e),r;if(a>-1){var i=this.data[a].metadata;r={board_title:e,preselected_title:!0,index:a,board_title_metadata:i,board_title_list:n}}else r={board_title:e,preselected_title:!1,board_title_list:n};this._logCustomContextEvent(P.genConst.EventType.CLICK,P.genConst.ElementType.CREATE_BOARD_BUTTON,P.genConst.ComponentType.FPE_CREATE_FIRST_BOARD_MODAL,r);var s=o.id;return this.triggerEvent(P.CONST.EVENT_BOARD_CREATED,s,!0),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,o),o}.bind(this))}return Promise.resolve({name:e})},_onNameTextChange:function(){this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,{name:this._getNameInputText()},!0)},createFromInputNameAndSubmit:function(){return this._createFromInputNameAndSubmit()}}),P.modules.FirstBoardCreate.prototype.className="FirstBoardCreate",goog.provide("P.modules.FirstPinCreate"),goog.require("P.Module"),goog.require("P.modules.FirstBoardCreate"),goog.require("P.modalManager"),goog.require("P.ExperienceManager"),goog.require("P.errorUtil"),goog.require("P.ga"),goog.require("P.genConst"),goog.require("P.historyNavigator"),goog.require("P.resourceFactory"),goog.require("P.url"),P.modules.FirstPinCreate=P.Module.extend({CssClassName:{PINIT_BUTTON_SUCCESS:"success"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_BOARD_CREATED,this.createPin),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this._toggleSubmitButtonEnabled),this.placedExperience=P.ExperienceManager.instance.getPlacedExperience(P.genConst.Placement.WEB_REPIN_DIALOG_TAKEOVER),this.placedExperience&&P.ExperienceManager.instance.viewPlacedExperienceId(this.placedExperience.id),this.options.state_isSuccess=!1,this.options.state_seoBannerText=""},updateDom:function(){var e=this.$(".seoNuxBannerText");e.toggleClass(this.CssClassName.PINIT_BUTTON_SUCCESS,!!this.options.state_isSuccess),e.text(this.options.state_seoBannerText)},setImage:function(e){var t=this.getChildById("pin");t.setPinImages(e),t.renderExistingData()},onButtonClick:function(e){var t=e.target;t.isCancelButton()?(this._logCustomContextEvent(P.genConst.EventType.WEB_PIN_CREATE_CLOSE_MODAL_BEFORE_PINNING,P.genConst.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.genConst.ComponentType.MODAL_REPIN,{}),this.destroy()):"submitButton"===t.id&&this.getFirstBoardCreate()._getNameInputText()&&(t.showLoading(),this.getFirstBoardCreate().createFromInputNameAndSubmit())},getPinResource:function(){var e="PinResource",t={},o,n=P.modalManager.get(),a=n&&n.getAnimatedModule();a&&(o=a);var r=this.getChildById("pin");r&&(o=r);var i=o.data,s=o.getDescriptionText();this.isRepin()&&(t.pin_id=i.id,e="RepinResource");var l=this.options.method;l&&(t.method=l),t.description=s;var u=i.link;if(t.link=u,t.is_video=i.is_video,t.guid=this.options.guid,!this.isRepin()){var d=i.image_url;d=this.prependSchemeIfNeeded(d,u),t.image_url=d}return P.resourceFactory.instance.create(e,t)},prependSchemeIfNeeded:function(e,t){if(!t)return e;var o=new RegExp(/http(s?):/);if(!o.test(e)){var n=o.exec(t);if(n&&n.length){var a=n[0];e=a+e}}return e},showPinItSuccess:function(){return this._applySuccessTextToSeoBanner(),P.util.delay(2500)},_applySuccessTextToSeoBanner:function(){var e={state_isSuccess:!0};this.placedExperience&&this.placedExperience.display_data&&this.placedExperience.display_data.create_board_text&&(e.state_seoBannerText=this.placedExperience.display_data.create_board_text),this.updateOptionsAndDom(e)},createPin:function(e){var t=e.data,o=this.getPinResource();o.options.board_id=t,o.callCreate({showError:!1}).then(function(e){this._onPinCreateSuccess(e)}.bind(this),function(e){P.ga.trackEvent(this.GACategory,P.CONST.GA_ACTION_ERROR),P.errorUtil.showError(e.message)}.bind(this))},_onPinCreateSuccess:function(e){P.ga.trackEvent(this.GACategory,P.CONST.GA_ACTION_SUCCESS);var t=P.resourceFactory.instance.create("BoardPickerBoardsResource",{allow_stale:!0,field_set_key:"board_picker",filter:"all",shortlist_length:3});P.resourceCache.instance.callGet(t),P.ExperienceManager.instance.refreshPlacedExperiences();var o=e.resource_response.data,n=new Promise(function(e,t){this.triggerCommonPinCreateEvents(o),e(void 0)}.bind(this)),a=[this.showPinItSuccess(),P.ExperienceManager.instance.completePlacedExperienceId(this.placedExperience.id),n];Promise.all(a).fin(function(){var e=new P.navigateData.NavigateData;e.evt=new P.Event("",null,{forceRefresh:1}),P.historyNavigator.instance.navigate("/",e)})},isRepin:function(){return!(!this.data||!this.data.id)},onContentReady:function(){this.$pinCreateContainer=this.getContent().find(".pinCreateContainer"),this.submitButton=this.getChildById("submitButton"),_.defer(this.lockHeight.bind(this))},_toggleSubmitButtonEnabled:function(){this.submitButton.setEnabled(!!this.getFirstBoardCreate()._getNameInputText())},lockHeight:function(){if(this.$pinCreateContainer){var e=this.$pinCreateContainer.height()||this.$el.height();this.$pinCreateContainer.height(e)}var t=this.getContent().find(".rightContainer"),o=this.getContent().find(".SelectList.firstPinCreate");if(t&&o){var n=t.height()-Math.abs(t.position().top-o.position().top);o.height(n)}var a=this.$(".seoNuxBannerText"),r=this.$(".bottomSpaceAdjuster");r.height(a.outerHeight())},getFirstBoardCreate:function(){return this.getChildById("firstBoardCreate")},focus:function(){this.getFirstBoardCreate().focus()},triggerCommonPinCreateEvents:function(e){this.triggerEvent(P.CONST.EVENT_PIN_CREATE,e,!1),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,e),P.pubSub.instance.publish(e.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,{pin:e}),P.pubSub.instance.publish(P.user.instance.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED),this.isRepin()&&P.pubSub.instance.publish(this.data.id,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,e)}}),P.modules.FirstPinCreate.prototype.className="FirstPinCreate",goog.provide("P.modules.ModalAnalyticsAudienceSelectorIntro"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalAnalyticsAudienceSelectorIntro=P.modules.ModalStepBase.extend({getPlacementId:function(){return P.genConst.Placement.ANALYTICS_AUDIENCE_DASHBOARD_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.ANALYTICS_AUDIENCE_SELECTOR_USER_ED},getHighlightedElement:function(){var e=this._getModuleChildrenByModuleName(P.app.instance,"SelectButtonWrapper");return this._highlightModule(e[0],!0)},onShow:function(e){var t=this.getHighlightedElement();t&&this.setModalPosition("BOTTOM_CENTER",t,!0),e&&e()}}),P.modules.ModalAnalyticsAudienceSelectorIntro.prototype.className="ModalAnalyticsAudienceSelectorIntro",goog.provide("P.modules.ModalAnalyticsHomeIntroBase"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalAnalyticsHomeIntroBase=P.modules.ModalStepBase.extend({getPlacementId:function(){return P.genConst.Placement.ANALYTICS_HOME_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.ANALYTICS_HOME_USER_ED},getHighlightedCardModule:function(e){var t=this._getModuleChildrenByModuleName(P.app.instance,"HomePageAnalyticsCard"),o=null;switch(e){case"profile":o=t[0];break;case"audience":o=t[1];break;case"domain":o=t[2]}return o?this._highlightModule(o,!0):null},getStepPosition:function(){},getHighlightedElement:function(){throw new Error("must be overridden")},onShow:function(e){var t=this.getHighlightedElement();t?this.setModalPosition(this.getStepPosition(),t,!0):this.setModalPosition(null,null,!0),e&&e()}}),P.modules.ModalAnalyticsHomeIntroBase.prototype.className="ModalAnalyticsHomeIntroBase",goog.provide("P.modules.ModalAnalyticsHomeOverallIntro"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeOverallIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return null},getHighlightedElement:function(){return null}}),P.modules.ModalAnalyticsHomeOverallIntro.prototype.className="ModalAnalyticsHomeOverallIntro",goog.provide("P.modules.ModalAnalyticsHomeProfileCardIntro"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeProfileCardIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return"RIGHT_CENTER"},getHighlightedElement:function(){return this.getHighlightedCardModule("profile")}}),P.modules.ModalAnalyticsHomeProfileCardIntro.prototype.className="ModalAnalyticsHomeProfileCardIntro",goog.provide("P.modules.ModalFindFriendsIntro"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalFindFriendsIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{FIND_FRIENDS_INTRO_HIGHLIGHT:"findFriendsIntroHighlight",FIND_FRIENDS_INTRO_HIGHLIGHT_MENU:"findFriendsIntroHighlightMenu"}),onShow:function(e){var t=this._getModuleChildrenByModuleName(P.app.instance,"UserMenu")[0];this.noUserMenu=!t,this.highlightFindFriendsInMenu(e)},onExit:function(e){if(!this.noUserMenu&&P.app.instance)try{var t=this._getMenu();t.getDropdown().setSticky(!1),t.hideDropdown()}catch(o){}e&&e()},highlightFindFriendsInMenu:function(e){if(this.noUserMenu){var t=this._getFindFriendsItem(),o=this._highlightModule(t,!0);this.setModalPosition("RIGHT_CENTER",o,!0),o.addClass(this.CssClassName.FIND_FRIENDS_INTRO_HIGHLIGHT)}else{var n=this._getMenu();n.getDropdown().setSticky(!0),n.showDropdown(function(){n.getDropdown().getContentModulePromise().then(function(t){var o=t.getFindFriendsElement(),n=this._highlightElement("highlightContainer",o,!0);n.addClass(this.CssClassName.FIND_FRIENDS_INTRO_HIGHLIGHT_MENU),n.on("click",function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this));var a="LEFT_TOP";this.setModalPosition(a,n,!0),e&&e()}.bind(this))}.bind(this))}},_getFindFriendsItem:function(){return this._getModuleChildById(P.app.instance,"friendsToFollow")},_getMenu:function(){return this._getModuleChildById(P.app.instance,"userMenu")},getPlacementId:function(){return P.genConst.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_FIND_FRIENDS_USER_ED}}),P.modules.ModalFindFriendsIntro.prototype.className="ModalFindFriendsIntro",goog.provide("P.modules.ModalFirstBoardIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalFirstBoardIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{FIRST_BOARD_INTRO_HIGHLIGHT:"firstBoardIntroHighlight"}),onShow:function(e){this.isContextualExperience=!0,$("html, body").scrollTop(0);var t=!1,o=this._getModuleChildrenByModuleName(P.app.instance,"UserProfileContent");if(o&&o[0]){var n=o[0].data,a=n.board_count+n.secret_board_count;t=a>0}var r,i;t?(r=this.$(".hasBoardsTitle"),i=this.$(".hasBoardsContent")):(r=this.$(".hasNoBoardsTitle"),i=this.$(".hasNoBoardsContent")),r.show(),i.show(),this.highlightBoard(),e&&e(),this.setExperienceViewed()},highlightBoard:function(){if(this.board=this.getTargetBoard(),this.board){var e=this._highlightModule(this.board,!0);e.on("click",this.onBoardClicked.bind(this)),e.addClass(this.CssClassName.FIRST_BOARD_INTRO_HIGHLIGHT);var t=$(window).height(),o;o=e.offset().top+e.height()>t?"TOP_LEFT":"RIGHT_TOP",this.setModalPosition(o,e,!0)}},setCloneInteractions:function(e){this.disableCloneLinks(e)},getTargetBoard:function(){var e=this._getModuleChildrenByModuleName(P.app.instance,"Grid")[0],t;if(e){var o=e.getGridItems();t=o.getChildModuleAtIndex(0,"BoardCreateRep")}return t},onBoardClicked:function(e){return e.preventDefault(),this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0),this.board.showModalSubmodule(),!1},getPlacementId:function(){return P.genConst.Placement.WEB_USER_PROFILE_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_FIRST_BOARD_USER_ED}}),P.modules.ModalFirstBoardIntro.prototype.className="ModalFirstBoardIntro",goog.provide("P.modules.ModalFirstPinExperience"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalFirstPinExperience=P.modules.ModalStepBase.extend({onShow:function(){this.actionBar=this._getModuleChildById(P.app.instance,"actions"),this.actionBar&&(this.actionButton=this._getModuleChildById(this.actionBar,this.options.anchor_id),this.highlightActionButton())},onButtonClick:function(e){var t=e.target;"nextButton"===t.id&&this.actionButton.$el.trigger("click")},isDismissAsync:!1,highlightActionButton:function(){if(this.actionButton){this.options.disable_mask=!0;var e=this._highlightModule(this.actionButton,!0);this.modal.options.caret_style="fpxBlue",this.disableButtonCloneLinks(e),e.on("click",function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),this.actionButton.$el.trigger("click")}.bind(this)),this.setModalPosition("BOTTOM_LEFT",e,!0),this.$el.css("display","block")}},getPlacementId:function(){return P.genConst.Placement.WEB_PIN_CLOSEUP},getExperienceId:function(){return P.genConst.Experience.WEB_SEO_NUX_FIRST_PIN_TOOLTIP}}),P.modules.ModalFirstPinExperience.prototype.className="ModalFirstPinExperience",goog.provide("P.modules.ModalFirstPinIntro"),goog.require("P.Module"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalFirstPinIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{FIRST_PIN_INTRO_HIGHLIGHT:"firstPinIntroHighlight",MODAL_PIN_INTRO:"modalPinIntro"}),onCreated:function(){P.modules.ModalStepBase.prototype.onCreated.apply(this,arguments),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.onBodyColumnChange)},onShow:function(e){this.highlightPin(),e&&e()},highlightPin:function(){if(this.pin=this.getTargetPin(),this.pin){var e=this._highlightModule(this.pin,!0);e.remove(),this.modal.getModalScroller().append(e),this.$repinButton=e.find(".repinSmall"),this.$repinButton.on("click",this.onRepinClicked.bind(this)),this.modal.$el.addClass(this.CssClassName.MODAL_PIN_INTRO),this.setModalPosition("LEFT_TOP",this.$repinButton,!0),e.addClass(this.CssClassName.FIRST_PIN_INTRO_HIGHLIGHT)}},setCloneInteractions:function(e){this.disableCloneLinks(e)},getTargetPin:function(){var e=this._getModuleChildrenByModuleName(P.app.instance,"Grid")[0];if(e){var t=e.getGridItems(),o=Math.ceil(P.Viewport.numColumns/2);return t.getChildModuleAtIndex(o,"Pin")}},onBodyColumnChange:function(){this.$repinButton.off(),this.$repinButton=null,this.cleanHighlightedElements(),this.highlightPin()},onRepinClicked:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0);var e=this.pin.getChildById("pinItButton");e.$el.trigger("click")},getPlacementId:function(){return P.genConst.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_FIRST_PIN_USER_ED}}),P.modules.ModalFirstPinIntro.prototype.className="ModalFirstPinIntro",goog.provide("P.modules.ModalHomeFeedPinIntro"),goog.require("P.modules.ModalStepBase"),goog.require("P.app"),P.modules.ModalHomeFeedPinIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{LOGO_STEP_BACKGROUND:"pinterestLogoStepBackground"}),onEnter:function(e){this.ensurePath("/"),e&&e()},onShow:function(e){var t=this._getModuleChildById(P.app.instance,"header"),o=t.getHomeElement(),n=this._highlightElement("homeButton",o,!0),a=$("<div>");a.addClass(this.CssClassName.LOGO_STEP_BACKGROUND),a.css({top:n.offset().top-60,left:n.offset().left}),$("body").append(a),e&&e()},onExit:function(e){$("."+this.CssClassName.LOGO_STEP_BACKGROUND).remove(),e&&e()}}),P.modules.ModalHomeFeedPinIntro.prototype.className="ModalHomeFeedPinIntro",goog.provide("P.modules.ModalPinIntro"),goog.require("P.modules.ModalStepBase");var Ao="samplePinTutorialStep";P.modules.ModalPinIntro=P.modules.ModalStepBase.extend({onEnter:function(e){this.ensurePath("/"),$("body").append('<div class="'+Ao+'">&nbsp;</div>'),e&&e()},onShow:function(e){var t=$("."+Ao);this.setModalPosition("RIGHT_TOP",t,!0),e&&e()},onExit:function(e){$("."+Ao).remove(),e&&e()}}),P.modules.ModalPinIntro.prototype.className="ModalPinIntro",goog.provide("P.modules.ModalPlacePinsAddBase"),goog.require("P.modules.ModalStepBase"),goog.require("P.app"),P.modules.ModalPlacePinsAddBase=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{ADD_PLACE:"addAPlace"}),onShow:function(e){this.highlightAddButton()},highlightAddButton:function(){if(this.button=this.getTargetModule(),this.button){var e=this._highlightModule(this.button,!0),t="RIGHT_TOP";$(window).width()<=5*(P.CONST.PIN_WIDTH+P.CONST.PIN_MARGIN)&&(t="BOTTOM_RIGHT"),this.setModalPosition(t,e,!0)}},getTargetModule:function(){var e=this._getModuleChildrenByModuleName(P.app.instance,"BoardPage")[0];if(e){var t=this._getModuleChildrenByModuleName(e,"ShowModalButton");if(!_.isEmpty(t)){var o=_.find(t,function(e){return e.$el.hasClass(this.CssClassName.ADD_PLACE)}.bind(this));return o}}}}),P.modules.ModalPlacePinsAddBase.prototype.className="ModalPlacePinsAddBase",goog.provide("P.modules.ModalPlacePinsAddEmpty"),goog.require("P.modules.ModalPlacePinsAddBase"),goog.require("P.genConst"),P.modules.ModalPlacePinsAddEmpty=P.modules.ModalPlacePinsAddBase.extend({getPlacementId:function(){return P.genConst.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED},onNextButtonClicked:function(){this.button.$el.click()}}),P.modules.ModalPlacePinsAddEmpty.prototype.className="ModalPlacePinsAddEmpty",goog.provide("P.modules.ModalPlacePinsAddFilled"),goog.require("P.modules.ModalPlacePinsAddBase"),goog.require("P.genConst"),P.modules.ModalPlacePinsAddFilled=P.modules.ModalPlacePinsAddBase.extend({getPlacementId:function(){return P.genConst.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),P.modules.ModalPlacePinsAddFilled.prototype.className="ModalPlacePinsAddFilled",goog.provide("P.modules.ModalPlacePinsEdit"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalPlacePinsEdit=P.modules.ModalStepBase.extend({onShow:function(e){$("html, body").scrollTop(0),this.highlightEditButton(),e&&e()},highlightEditButton:function(){var e=this.getTargetModule();if(e){var t=this._highlightModule(e,!0);this.setModalPosition("RIGHT_CENTER",t,!0)}},getTargetModule:function(){var e=this._getModuleChildrenByModuleName(P.app.instance,"PlaceBoardInfoBar")[0];if(e){var t=this._getModuleChildById(e,"editButton");if(t)return t}},getPlacementId:function(){return P.genConst.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),P.modules.ModalPlacePinsEdit.prototype.className="ModalPlacePinsEdit",goog.provide("P.modules.ModalPlacePinsSearch"),goog.require("P.modules.ModalStepBase"),goog.require("P.modules.AddPinToMap"),goog.require("P.modules.Modal"),goog.require("P.modalManager"),goog.require("P.genConst"),P.modules.ModalPlacePinsSearch=P.modules.ModalStepBase.extend({onShow:function(e){this.highlightAddPinToMap()},highlightAddPinToMap:function(){var e=this.getTargetModule();if(e){var t=this._highlightModule(e,!0);this.setModalPosition("RIGHT_TOP",t,!0);var o=this._getModal();o&&this._setModalVisible(o,!1)}},_setModalVisible:function(e,t){var o=e.getMask();o=o.add(e.getModalScroller()),t?o.css("visibility","visible"):o.css("visibility","hidden")},_getModal:function(){var e=P.modalManager.get(),t=e.getTopModal();return t?t:null},getTargetModule:function(){var e=this._getModal();if(!e)return null;var t=e.getModule();return t?t:null},onPreviousButtonClicked:function(){P.modules.ModalStepBase.prototype.onPreviousButtonClicked.call(this),this.clickCloseButton()},clickCloseButton:function(){var e=this.getTargetModule(),t=e.getChildById("closeButton");t.$el.click();var o=this._getModal();o&&this._setModalVisible(o,!0)},getPlacementId:function(){return P.genConst.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED}}),P.modules.ModalPlacePinsSearch.prototype.className="ModalPlacePinsSearch",goog.provide("P.modules.ModalPlacePinsShow"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalPlacePinsShow=P.modules.ModalStepBase.extend({onShow:function(e){this.highlightAddPlace(),e&&e()},highlightAddPlace:function(){var e=this.getTargetPin(),t=this._getModuleChildById(e,"addToMap");if(t||(t=this._getModuleChildById(e,"seeOnMap")),t){var o=t.$el,n=o.offset().top,a=o.height(),r=P.Viewport.height,i=$(".Header").height(),s=n-r/2-i/2+a/2;this.$("."+t.id).show(),$(window).scrollTop(s);var l=this._highlightModule(t,!0);this.setModalPosition("RIGHT_CENTER",l,!0,!0)}},getTargetPin:function(){var e=this._getModuleChildrenByModuleName(P.app.instance,"Grid")[0];if(!e)return void 0;var t=e.getGridItems();return t.getChildModuleAtIndex(0,"Pin")},getPlacementId:function(){return P.genConst.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),P.modules.ModalPlacePinsShow.prototype.className="ModalPlacePinsShow",goog.provide("P.modules.ModalSeeProfileIntro"),goog.require("P.modules.ModalStepBase"),goog.require("P.genConst"),goog.require("P.app"),P.modules.ModalSeeProfileIntro=P.modules.ModalStepBase.extend({CssClassName:_.extend(P.modules.ModalStepBase.prototype.CssClassName,{SEE_PROFILE_INTRO_HIGHLIGHT:"seeProfileIntroHighlight"}),onShow:function(e){var t=this._getModuleChildrenByModuleName(P.app.instance,"UserMenu")[0];if(this.noUserMenu=!t,this.noUserMenu){var o=this._getModuleChildById(P.app.instance,"userMenu"),n=this._highlightModule(o,!0);this.setModalPosition("BOTTOM_CENTER",n,!0)}else t.setSticky(!0),t.showDropdown(function(){t.getDropdown().getContentModulePromise().then(function(t){var o=t.getMyBoardsElement(),n=this._highlightElement("highlightContainer",o,!0);n.addClass(this.CssClassName.SEE_PROFILE_INTRO_HIGHLIGHT),n.on("click",function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this)),this.setModalPosition("LEFT_TOP",n,!0),e&&e()}.bind(this))}.bind(this))},onExit:function(e){if(!this.noUserMenu&&P.app.instance){var t=this._getModuleChildrenByModuleName(P.app.instance,"UserMenu")[0];t.setSticky(!1),t.hideDropdown()}e&&e()},getPlacementId:function(){return P.genConst.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.genConst.Experience.WEB_YOUR_BOARDS_USER_ED}}),P.modules.ModalSeeProfileIntro.prototype.className="ModalSeeProfileIntro",goog.provide("P.modules.NewUserFindFriends"),goog.require("P.modules.NewUserStepBase"),
goog.require("P.modules.FindFriendsContent"),goog.require("P.util"),goog.require("P.nuxFindFriendsMixin"),goog.require("P.resourceFactory"),goog.require("P.SocialConnect"),P.modules.NewUserFindFriends=P.modules.NewUserStepBase.extend({CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{HIDDEN:"hidden",BACKGROUND:"background"}),events:{"click .selectAllText":"_onSelectAllTextClicked"},mixins:[P.nuxFindFriendsMixin],onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.content=null,this.listen(this.nuxProgress.getNextButton(),P.CONST.EVENT_BUTTON_CLICK,this._onButtonNextClick),this.setup()},onEnter:function(e){P.util.scrollToTop({}),e&&e()},_enableNextButton:function(e){e?this.nuxProgress.getNextButton().enable():this.nuxProgress.getNextButton().disable()},_notifyProgressBar:function(e){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT,{type:e,total:1})},_onButtonNextClick:function(e){if(this.followingFriendsChanged()){var t=this.nuxProgress.getNextButton();t.showLoading();var o=this.nuxProgress.$skip;o.addClass(this.CssClassName.HIDDEN),this.signalFollowFriends().then(function(){t.hideLoading(),o.removeClass(this.CssClassName.HIDDEN)}.bind(this))}},_showSelectedTab:function(){this.$(".emptyGridWrapper").addClass(this.CssClassName.HIDDEN),this.$(".friendsContentWrapper").removeClass(this.CssClassName.HIDDEN),this.hideSelectAllCheckbox(),this._enableNextButton(!1);var e=null;if(this.tab){switch(this.tab){case P.SocialConnect.FACEBOOK:this.setNetwork(P.SocialConnect.FACEBOOK),this.facebookConnected&&(e="UserFacebookFriendsResource",this._notifyProgressBar("facebook"),this._enableNextButton(!0),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!0),this.getChildById("twTab").setSelected(!1);break;case P.SocialConnect.TWITTER:this.setNetwork(P.SocialConnect.TWITTER),this.twitterConnected&&(e="UserTwitterFriendsResource",this._notifyProgressBar("twitter"),this.resetFollowAllState(),this._enableNextButton(!0)),this.getChildById("fbTab").setSelected(!1),this.getChildById("twTab").setSelected(!0)}var t=new P.modules.FindFriendsContent({id:"friendsContent",options:{tab:this.tab,username:P.user.instance.get("username"),exclude_following:!1,item_options:{view_type:"userCheckableSelectView",is_checked:!1}}});if(e){var o={username:P.user.instance.get("username"),exclude_following:!1};t.resource=P.resourceFactory.instance.create(e,o)}this.content&&this.content.remove(),t.render().then(function(){switch(this.content&&this.content.remove(),this.insertChild(t,this.$(".friendsContentWrapper")),this.content=t,this.tab){case P.SocialConnect.FACEBOOK:this.facebookConnected&&this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this.twitterConnected&&this.resetFollowAllState()}this.listen(this.getFriendsContent(),P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,function(e){switch(e.data.network){case P.SocialConnect.FACEBOOK:this._notifyProgressBar("facebook"),this._enableNextButton(!0),this.facebookConnected=!0,this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this._notifyProgressBar("twitter"),this._enableNextButton(!0),this.twitterConnected=!1,this.resetFollowAllState()}})}.bind(this))}}}),P.modules.NewUserFindFriends.prototype.className="NewUserFindFriends",goog.provide("P.modules.NewUserInstallExtension"),goog.require("P.browserExtension"),goog.require("P.modules.NewUserStepBase"),goog.require("P.util");var Ro="installButton";P.modules.NewUserInstallExtension=P.modules.NewUserStepBase.extend({onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.optionalSkip=this.$(".optionalSkip"),this.optionalSkip.bind("click",this.onSkipClick)},onEnter:function(e){P.util.scrollToTop({});var t=P.browserExtension.instance.isExtensionInstalled();t&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT),e&&e()},onShow:function(e){var t=P.browserExtension.instance.isExtensionInstalled();t||this.show(),e&&e()},onButtonClick:function(e){var t=e.target;t.id===Ro&&P.browserExtension.instance.handleExtensionInstall(this.onChromeExtensionInstallationSuccess)},onChromeExtensionInstallationSuccess:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},onSkipClick:function(e){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_SKIP_PROGRESS_BAR_STEP)}}),P.modules.NewUserInstallExtension.prototype.className="NewUserInstallExtension",goog.provide("P.modules.NewUserInterestPicker"),goog.require("P.modules.NewUserStepBase"),goog.require("P.timer"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.resourceFactory");var Bo=1500;P.modules.NewUserInterestPicker=P.modules.NewUserStepBase.extend({CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{HIDDEN:"hidden"}),onAddedToDom:function(){this.childListen(P.CONST.EVENT_ITEM_CLICK,this.onInterestClick)},onInterestClick:function(e){var t=e.data||{},o=t.url_name;_.contains(this.selectedInterests,o)?this.selectedInterests=_.without(this.selectedInterests,o):this.selectedInterests.push(o),this._notifyProgressBar()},_notifyProgressBar:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT,{type:"interest",total:this.selectedInterests.length})},initializeStep:function(){this.selectedInterests=[]},onExit:function(e){var t=this.selectedInterests.join(",");if(t){var o=this.nuxProgress.getNextButton();o.showLoading();var n=this.nuxProgress.$skip;n.addClass(this.CssClassName.HIDDEN);var a=function(){P.timer.setTimeout(function(){e&&(e(),o.hideLoading(),n.removeClass(this.CssClassName.HIDDEN))}.bind(this),Bo)}.bind(this);this.signalFollowedInterests(t,a)}else e&&e()},signalFollowedInterests:function(e,t){var o={interests:e};P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_REBUILD_FEED)&&(o.redo_homefeed=!0);var n=P.resourceFactory.instance.create("OrientationContextResource",o);n.callCreate().then(t)}}),P.modules.NewUserInterestPicker.prototype.className="NewUserInterestPicker",goog.provide("P.modules.NewUserInterestSearch"),goog.require("P.modules.NewUserStepBase"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.router"),goog.require("P.resourceFactory");var Mo=".tooltipCloserLook",Do=15e3,Vo=48e4,Wo=1,jo={show_pinner:!0,show_board:!0,lite:!0,show_via:!1,show_pinned_from:!1};P.modules.NewUserInterestSearch=P.modules.NewUserStepBase.extend({CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{VISIBLE:"visible"}),onAddedToDom:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onButtonClick:function(e){var t=e.target.id;"previous"===t&&this.triggerInterest()},initializeStep:function(){this.childListen(P.CONST.EVENT_NAVIGATE,P.NuxUtils.preventNavigationIfNecessary),this.numSearches=0,this.endTourTooltip=null;var e={};e[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this._onRepinned,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},onChildNavigate:function(e){var t=P.router.instance.resolve(e.data.url);"FeedPage"===t.module?(this.triggerCategory(t.options.feed),e.data.handled=!0):"SearchPage"===t.module?(this.triggerPinSearch(t.options.query),e.data.handled=!0):"Closeup"===t.module&&this._closeTooltip(),e.data.handled&&e.stopPropagation()},onEnter:function(e){var t={name:"ConfirmDialog",options:{template:"new_user_ready"}};this.forceExit=window.setTimeout(function(){P.moduleFactory.load(t).then(function(e){this.showInModal(e,{mask_type:"dark",can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CONFIRM,function(){this.nuxProgress.triggerEvent(P.CONST.EVENT_NEXT)}),P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_MANDATORY_AUTOBAHN),P.util.trackRegisterAction("autobahn_force_exit")}.bind(this))}.bind(this),Vo),this.autoEnableExit=window.setTimeout(function(){this._enableExitTour()}.bind(this),Do),e&&e()},_onRepinned:function(){this._enableExitTour(),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.util.trackRegisterAction("autobahn_repinned")},onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.grid=this.getChildById("grid"),this.$previousButton=this.$(".previous"),this.endTourButton=this.nuxProgress.getNextButton(),this.endTourButton.disable();var e=this.extraData?this.extraData.showAutobahnV3Tooltip:!1;e===!0&&this.showEndTourTip()},showEndTourTip:function(){if(this.endTourButton){var e={name:"Dropdown",options:{anchor:this.endTourButton.$el,class_name:"endTourTooltip",position_point:"BOTTOM_RIGHT",sticky:!0,text:P.i18n._("Try a pin search below. <br>(The more specific, the better!)"),title:P.i18n._("Psst! Before you leave...")}};P.moduleFactory.load(e).then(function(e){this.endTourTooltip=e,e.render().then(function(){this.endTourButton.appendChild(e),e.positionModule(),e.fadeIn()}.bind(this))}.bind(this))}},hideEndTourTip:function(){this.endTourTooltip&&this.endTourTooltip.fadeOut()},showPrevious:function(){this.togglePrevious(!0),this._toggleTooltip(!0),this._handleSearchCount()},hidePrevious:function(){this.togglePrevious(!1),this._toggleTooltip(!1)},togglePrevious:function(e){this.$previousButton.toggleClass(this.CssClassName.VISIBLE,e)},_handleSearchCount:function(){this.numSearches=1,this.numSearches===Wo&&(P.util.trackRegisterAction("autobahn_user_search"),this._enableExitTour())},triggerCategory:function(e){this.grid.options.layout="variable_height",this.grid.options.item_options=jo,this.grid.resource=P.resourceFactory.instance.create("CategoryFeedResource",{feed:e}),this.grid.empty(),this.grid.render().then(this.showPrevious.bind(this))},triggerInterest:function(){this.grid.options.layout="fixed_height",this.grid.resource=P.resourceFactory.instance.create("AllCategoriesResource",{field_set_key:"grid_item"}),this.grid.render().then(this.hidePrevious.bind(this))},triggerPinSearch:function(e){return""===e.trim()?this.triggerInterest():(this.grid.resource=P.resourceFactory.instance.create("SearchResource",{query:e,scope:"pins"}),this.grid.options.layout="variable_height",this.grid.options.item_options=jo,this.grid.empty(),void this.grid.render().then(this.showPrevious.bind(this)))},_enableExitTour:function(){this.endTourButton.enable(),this.hideEndTourTip()},onExit:function(e){clearTimeout(this.forceExit),clearTimeout(this.autoEnableExit),e&&e()},_toggleTooltip:function(e){var t=this.$(Mo);t&&t.toggleClass(this.CssClassName.VISIBLE,e)},_closeTooltip:function(){var e=this.$(Mo);e&&e.remove()}}),P.modules.NewUserInterestSearch.prototype.className="NewUserInterestSearch",goog.provide("P.modules.NewUserPin"),goog.require("P.modules.NewUserStepBase");var Uo="fb_pixel",zo={pixel_id:"6011522978142",value:"0.00",currency:"USD"};P.modules.NewUserPin=P.modules.NewUserStepBase.extend({onContentReady:function(){window.fb_param=zo,P.script.load([],"//connect.facebook.net/en_US/fp.js",Uo),P.modules.NewUserStepBase.prototype.onContentReady.call(this)}}),P.modules.NewUserPin.prototype.className="NewUserPin",goog.provide("P.modules.NewUserPinCreate"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserPinCreate=P.modules.NewUserStepBase.extend({onContentReady:function(){P.modules.NewUserStepBase.prototype.onContentReady.call(this),this.nextStepButton=this.nuxProgress.getNextButton(),this.nextStepButton.disable()}}),P.modules.NewUserPinCreate.prototype.className="NewUserPinCreate",goog.provide("P.modules.NewUserPinSearch"),goog.require("P.modules.NewUserStepBase"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.timer"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.app");var Ho=-220,Go=3,Ko=".tooltipCloserLook",Yo=5e3,qo=15e3,$o=48e4,Jo="<% _.each(suggestions, function(suggestion) { %><li><%= suggestion %></li><% }) %>";P.modules.NewUserPinSearch=P.modules.NewUserStepBase.extend({events:{"click .searchSuggestions li":"_onSuggestionClick","click .searchInterestField":"stopInterval","submit .searchInterest":"_onSubmit"},CssClassName:_.extend(P.modules.NewUserStepBase.prototype.CssClassName,{HIGHLIGHT:"highlight",VISIBLE:"visible"}),initializeStep:function(){this.currentQuestion=0,this._requestedItems=0,this._startCountingRequestedItems=!1,this.childListen(P.CONST.EVENT_NAVIGATE,P.NuxUtils.preventNavigationIfNecessary),this._onScrollHandle=this.listen($(window),"scroll",_.debounce(this._onScroll.bind(this),50)),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this._onRequestItemSuccess);var e={};e[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this._onRepinned,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},onContentReady:function(){this.$searchTitle=this.$(".searchTitle"),this.$searchSuggestions=this.$(".searchSuggestions ul"),this.$searchField=this.$(".searchInterestField"),this.endTourButton=this.getChildById("nextButton"),this.interestGrid=this.getChildById("interestGrid"),this.interval=P.timer.setInterval(this._nextQuestion.bind(this),Yo),this.$searchField.placeholder(),this.endTourButton.setText(this.extraData.nextButtonText),this.endTourButton.disable(),this.siteWideNags=P.app.instance.getChildByModuleName("Nags"),this.header=P.app.instance.getChildById("header")},onEnter:function(e){var t={name:"ConfirmDialog",options:{template:"new_user_ready"}};this.forceExit=window.setTimeout(function(){P.moduleFactory.load(t).then(function(e){this.showInModal(e,{mask_type:"dark",can_dismiss:!1}),this.listen(e,P.CONST.EVENT_CONFIRM,function(){this._endMandatoryFlow()}),P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_MANDATORY_AUTOBAHN),P.util.trackRegisterAction("autobahn_force_exit")}.bind(this))}.bind(this),$o),this.autoEnableExit=window.setTimeout(function(){this._enableExitTour()}.bind(this),qo),e&&e()},_onRepinned:function(){this._enableExitTour(),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.util.trackRegisterAction("autobahn_repinned")},setInterest:function(e,t){e=e.trim(),t?(this.$searchField.val(""),this.$searchField.attr("placeholder",e)):(this.$searchField.val(e),this._onRequestItemSuccess(),P.util.trackRegisterAction("autobahn_user_search")),this.$searchField.placeholder();var o=this.$searchField.val(),n=this.$searchSuggestions.children("li");_.each(n,function(t){var n=$(t),a=n.text().toLowerCase()===e.toLowerCase(),r=n.text().toLowerCase()===o.toLowerCase();n.toggleClass(this.CssClassName.HIGHLIGHT,r||a)}.bind(this)),this.interestGrid.resource.options.interest=e,this.renderGrid()},renderGrid:_.debounce(function(){this.interestGrid.render()},250),stopInterval:function(){clearInterval(this.interval)},onRemovedFromDom:function(){this._closeTooltip(),this.stopInterval()},_closeTooltip:function(){var e=this.$(Ko);e&&(e.remove(),this.removeListener(this._onScrollHandle))},_nextQuestion:function(){this.currentQuestion++;var e=this.extraData.search_suggestions.length;this.currentQuestion===e&&(this.currentQuestion=0),this._refreshQuestion()},_previousQuestion:function(){this.currentQuestion--;var e=this.extraData.search_suggestions.length;this.currentQuestion<0&&(this.currentQuestion=e-1),this._refreshQuestion()},_refreshQuestion:function(){var e=this.extraData.search_suggestions,t=e[this.currentQuestion];if(t){var o=t.suggestions[0],n=_.template(Jo,t);this.$searchTitle.html(t.title),this.$searchSuggestions.html(n),this.setInterest(o,!0)}},_search:function(){this.setInterest(this.$searchField.val(),!1)},_onButtonClick:function(e){this.stopInterval();var t=e.target.id;"next"===t?this._nextQuestion():"prev"===t?this._previousQuestion():"search"===t?this._search():("close"===t||"nextButton"===t)&&this._endMandatoryFlow()},_endMandatoryFlow:function(){if(clearTimeout(this.forceExit),clearTimeout(this.autoEnableExit),P.ExperienceManager.instance.isPlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_MANDATORY_AUTOBAHN)){var e=P.ExperienceManager.instance.completePlacedExperience(P.genConst.Placement.WEB_HOME_TAKEOVER,P.genConst.Experience.WEB_MANDATORY_AUTOBAHN);e.fin(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),this._endMandatoryFlowRender()}.bind(this))}else this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),this._endMandatoryFlowRender()},_endMandatoryFlowRender:function(){this.header&&this.header.render(),this.siteWideNags&&this.siteWideNags.render()},_onRequestItemSuccess:function(){this._requestedItems===Go&&(this._enableExitTour(),P.util.trackRegisterAction("autobahn_search_done")),this._requestedItems++},_enableExitTour:function(){this.endTourButton.enable()},_onScroll:function(e){this.stopInterval();var t=this.$(".newUserStepHeader"),o=this.$(Ko),n=t.offset().top+t.height();if(o){var a=n+Ho;o.toggleClass(this.CssClassName.VISIBLE,$(window).scrollTop()>a)}},_onSubmit:function(e){e.preventDefault(),this._search()},_onSuggestionClick:function(e){this.stopInterval(),this.setInterest($(e.target).text(),!1)}}),P.modules.NewUserPinSearch.prototype.className="NewUserPinSearch",goog.provide("P.modules.NewUserPinSource"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserPinSource=P.modules.NewUserStepBase.extend({}),P.modules.NewUserPinSource.prototype.className="NewUserPinSource",goog.provide("P.modules.NewUserPinUsage"),goog.require("P.modules.NewUserStepBase"),P.modules.NewUserPinUsage=P.modules.NewUserStepBase.extend({}),P.modules.NewUserPinUsage.prototype.className="NewUserPinUsage",goog.provide("P.modules.NewUserSetupSpinner"),goog.require("P.modules.NewUserStepBase"),goog.require("P.modules.StepBase"),goog.require("P.timer");var Xo=5e3;P.modules.NewUserSetupSpinner=P.modules.NewUserStepBase.extend({onShow:function(e){this.nuxProgress&&this.nuxProgress.endMandatoryFlow(),P.timer.setTimeout(this._goToNextStep,Xo),P.modules.StepBase.prototype.onShow.call(this,e)},_goToNextStep:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)}}),P.modules.NewUserSetupSpinner.prototype.className="NewUserSetupSpinner",goog.provide("P.modules.NuxModalCompassStep"),goog.require("P.modules.List"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.CONST"),goog.require("P.i18n"),goog.require("P.timer"),goog.require("P.resourceFactory"),P.modules.NuxModalCompassStep=P.modules.NuxModalStepBase.extend({onContentReady:function(){var e,t,o,n,a;if("final_loading"===this.options.view_type){if(P.timer.setTimeout(this._checkHomeFeedReady.bind(this),1500),e=this.extraData.truncateLength,t=P.ExperienceTutorialManager.instance().tutorial,o=t?t.getStorage("interest_follow_count"):0,n=this.getChildByModuleName("List"),o>e&&n.children.length===e){a=_.last(n.children);var r=P.string.format(P.i18n._("+{{ num }} more interests"),{num:o-e+1});a.showOverflowMask(r)}this.numCheckHomefeedReadyChecks=0,this.maxCheckHomefeedReadyChecks=10}else if("brio_final_loading"===this.options.view_type){e=this.extraData.truncateLength,t=P.ExperienceTutorialManager.instance().tutorial,o=t?t.getStorage("interest_follow_count"):0,o||(o=0);var i=o>e||0===o;if(n=this.getChildById("interestsList"),i&&n.children.length===e){a=_.last(n.children);var s=P.i18n._("+more");a.showOverflowMask(s)}var l=t?t.getStorage("friend_ids_followed"):[];if(l&&l.length>0){var u=l.length,d=_.first(l,e),c=new P.modules.List({id:"friendsList",options:{items:d,item_options:{view_type:"imageOnlyThumb"}}});c.render().then(function(){this.insertChild(c,this.$(".followingFriendsListWrapper"));var t=this.getChildById("friendsList");if(u>e&&t.children.length===e){var o=_.last(t.children),n=P.i18n._("+more");o.showOverflowMask(n)}}.bind(this))}else this.$(".followingFriendsListWrapper").css("visibility","hidden");this.homefeedReadyCheckInitialDuration=1500,this.homefeedReadyCheckDuration=5e3,this.maxCheckHomefeedReadyChecks=10,this.numCheckHomefeedReadyChecks=0,this.homefeedReadyCheckMaxDuration=this.homefeedReadyCheckInitialDuration+this.maxCheckHomefeedReadyChecks*this.homefeedReadyCheckDuration,this.homefeedReadyCheckCurrentTotalDuration=this.homefeedReadyCheckInitialDuration+this.numCheckHomefeedReadyChecks*this.homefeedReadyCheckDuration;var p=(this.homefeedReadyCheckCurrentTotalDuration/this.homefeedReadyCheckMaxDuration*100).toString()+"%";this.$(".progressBar").animate({width:p},this.homefeedReadyCheckInitialDuration,function(){this._checkHomeFeedReady()}.bind(this))}P.modules.NuxModalStepBase.prototype.onContentReady.call(this)},numCheckHomefeedReadyChecks:0,_checkHomeFeedReady:function(){var e=P.resourceFactory.instance.create("OrientationContextStatusResource",{});this.numCheckHomefeedReadyChecks+=1,e.callGet({showError:!1}).then(function(e){this._refreshGrid()}.bind(this),function(e){if(this.numCheckHomefeedReadyChecks<=this.maxCheckHomefeedReadyChecks)if("final_loading"===this.options.view_type)this.numChecks<=10&&P.timer.setTimeout(this._checkHomeFeedReady.bind(this),500);else{this.homefeedReadyCheckMaxDuration=this.homefeedReadyCheckInitialDuration+this.maxCheckHomefeedReadyChecks*this.homefeedReadyCheckDuration,this.homefeedReadyCheckCurrentTotalDuration=this.homefeedReadyCheckInitialDuration+this.numCheckHomefeedReadyChecks*this.homefeedReadyCheckDuration;var t=(this.homefeedReadyCheckCurrentTotalDuration/this.homefeedReadyCheckMaxDuration*100).toString()+"%";this.$(".progressBar").animate({width:t},this.homefeedReadyCheckDuration,function(){this._checkHomeFeedReady()}.bind(this))}else this._refreshGrid()}.bind(this))},_refreshGrid:function(){$(".AuthHomePage").length?P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_HOMEFEED_REFRESH,{callback:this._goToNextStep.bind(this)}):this._goToNextStep()},_goToNextStep:function(){if("brio_final_loading"!==this.options.view_type)this.triggerEvent(P.CONST.EVENT_NEXT,null,!0);else{var e=[this.$(".progressBar").animate({width:"100%"},1500)];$.when.apply($,e).always(function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}.bind(this))}}}),P.modules.NuxModalCompassStep.prototype.className="NuxModalCompassStep",goog.provide("P.modules.NuxModalFindFriends"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.modules.FindFriendsContent"),goog.require("P.nuxFindFriendsMixin"),goog.require("P.resourceFactory"),goog.require("P.SocialConnect"),P.modules.NuxModalFindFriends=P.modules.NuxModalStepBase.extend({CssClassName:_.extend(P.modules.NuxModalStepBase.prototype.CssClassName,{HIDDEN:"hidden",BACKGROUND:"background"}),events:_.extend(P.modules.NuxModalStepBase.prototype.events,{"click .selectAllText":"_onSelectAllTextClicked"}),mixins:[P.nuxFindFriendsMixin],onContentReady:function(){P.modules.NuxModalStepBase.prototype.onContentReady.call(this),this.nextButton=this.getChildById("nextButton"),this._enableNextButton(!1),this.setup()},_goToNextStep:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},_enableNextButton:function(e){e?this.nextButton.enable():this.nextButton.disable(),this.$(".emptyGridWrapper").toggleClass(this.CssClassName.HIDDEN,e)},onNextButtonClicked:function(){if(this.followingFriendsChanged()){this.nextButton.showLoading();var e=this.$(".optionalSkip");e.addClass(this.CssClassName.HIDDEN),this.signalFollowFriends().then(function(){var t=P.ExperienceTutorialManager.instance().tutorial;t.setStorage("friend_ids_followed",this.followedFriendsIdsList()),this.nextButton.hideLoading(),e.removeClass(this.CssClassName.HIDDEN),P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)}.bind(this))}else P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)},_showSelectedTab:function(){this._enableNextButton(!1),this.options.view_type&&"brio"===this.options.view_type?this.$(".emptyGridWrapper").addClass(this.CssClassName.BACKGROUND):this.$(".emptyGridWrapper").addClass(this.CssClassName.HIDDEN),this.$(".friendsContentWrapper").removeClass(this.CssClassName.HIDDEN),this.hideSelectAllCheckbox();var e=null;if(this.tab){switch(this.tab){case P.SocialConnect.FACEBOOK:this.setNetwork(P.SocialConnect.FACEBOOK),this.facebookConnected&&(e="UserFacebookFriendsResource",this._enableNextButton(!0),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!0),this.getChildById("twTab").setSelected(!1);break;case P.SocialConnect.TWITTER:this.setNetwork(P.SocialConnect.TWITTER),this.twitterConnected&&(e="UserTwitterFriendsResource",this._enableNextButton(!0),this.resetFollowAllState()),this.getChildById("fbTab").setSelected(!1),this.getChildById("twTab").setSelected(!0)}var t=this.options.view_type&&"brio"===this.options.view_type?"showInBrioNuxModal":"showInNuxModal",o=new P.modules.FindFriendsContent({id:"friendsContent",options:{tab:this.tab,username:P.user.instance.get("username"),exclude_following:!1,view_type:t,item_options:{view_type:"userCheckableSelectView",is_checked:!1,no_padding:!0}}});if(e){var n={username:P.user.instance.get("username"),exclude_following:!1};o.resource=P.resourceFactory.instance.create(e,n)}var a=this.getFriendsContent();a&&this.removeChild(a),o.render().then(function(){var e=this.getFriendsContent();switch(e&&this.removeChild(e),this.insertChild(o,this.$(".friendsContentWrapper")),this.tab){case P.SocialConnect.FACEBOOK:this.facebookConnected&&this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this.twitterConnected&&this.resetFollowAllState()}this.listen(this.getFriendsContent(),P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,function(e){switch(e.data.network){case P.SocialConnect.FACEBOOK:this.facebookConnected=!0,this._enableNextButton(!0),this.resetFollowAllState();break;case P.SocialConnect.TWITTER:this.twitterConnected=!0,this._enableNextButton(!0),this.resetFollowAllState()}})}.bind(this))}}}),P.modules.NuxModalFindFriends.prototype.className="NuxModalFindFriends",goog.provide("P.modules.NuxModalInstallExtensionContainer"),goog.require("P.modules.NuxModalStepBase"),P.modules.NuxModalInstallExtensionContainer=P.modules.NuxModalStepBase.extend({_goToNextStep:function(){P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)}}),P.modules.NuxModalInstallExtensionContainer.prototype.className="NuxModalInstallExtensionContainer",goog.provide("P.modules.NuxModalInterestPicker"),goog.require("P.CONST"),goog.require("P.modules.Interest"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.TypeaheadProvider"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.resourceFactory"),P.modules.NuxModalInterestPicker=P.modules.NuxModalStepBase.extend({events:{'textchange input[type="text"]':"_onSearchTextUpdate","click .clearSearch":"_clearSearch"},CssClassName:_.extend(P.modules.NuxModalStepBase.prototype.CssClassName,{VISIBILE:"visible",HIDDEN:"hidden"}),nuxInterests:[],recommendedInterests:[],currentInterestFollowingStatus:[],onCreated:function(){this.options.state_recTitleHidden=!0,this.options.state_recHidden=!0,this.options.state_noResultsHidden=!0,this.options.state_noResultsText="",P.modules.NuxModalStepBase.prototype.onCreated.call(this)},updateDom:function(){this.$recommendedTitles.toggleClass(this.CssClassName.HIDDEN,!!this.options.state_recTitleHidden),this.$recommendedGrid.toggleClass(this.CssClassName.HIDDEN,!!this.options.state_recHidden),this.$noResultsDiv.toggleClass(this.CssClassName.HIDDEN,!!this.options.state_noResultsHidden),this.$noResultsDiv.html(this.options.state_noResultsText)},onContentReady:function(){this._setup(),P.modules.NuxModalStepBase.prototype.onContentReady.call(this)},_setup:function(){var e=P.ExperienceManager.instance.getPlacedExperienceType(P.genConst.Placement.WEB_HOME_TAKEOVER);this.inNux=e===P.genConst.ExperienceType.NUX,this._throttledSyncBothInterestCaches=_.throttle(this._syncBothInterestCaches.bind(this),200),this.nextButton=this.getChildById("nextButton"),this.grid=this.getChildById("grid"),this.$recommendedGrid=this.$(".recommended"),this.$recommendedTitles=this.$(".recommendedTitle"),this.$noResultsDiv=this.$(".noResults"),this.separateRecommended=!0,this.interestsSearchField=this.getChildById("interestsSearchField"),this.interestFollowChange=!1,this.$clearSearchEm=this.$(".clearSearch em"),this.syncInterestsCacheAndGridUI().then(function(){this.updateNextButton()}.bind(this));var t={field_set_key:"blur",resource_name:"InterestTypeaheadResource"};this._typeahead=new P.TypeaheadProvider(t),this.listen(this._typeahead,P.CONST.EVENT_DATA,this._onTypeaheadData),this.listen(this._typeahead,P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this._onSearchStart),this.childListen(P.CONST.EVENT_INTEREST_FOLLOW,this._onInterestFollowClick),this.childListen(P.CONST.EVENT_INTEREST_UNFOLLOW,this._onInterestUnfollowClick)},getEmptySearchResultsFromCache:function(){var e=_.filter(this.currentInterestFollowingStatus,function(e){return e.followingStatus}),t=_.pluck(e,"interest"),o=_.reject(t,function(e){return e.is_recommended}),n=_.pluck(e,"id"),a=_.reject(this.nuxInterests,function(e){return _.contains(n,e.id)});return this.separateRecommended&&this.recommendedExperiment?o.concat(a):t.concat(a)},getRecommendedResultsFromCache:function(){var e=_.filter(this.currentInterestFollowingStatus,function(e){return e.followingStatus}),t=_.pluck(e,"interest"),o=_.reject(t,function(e){return!e.is_recommended}),n=_.pluck(e,"id"),a=_.reject(this.recommendedInterests,function(e){return _.contains(n,e.id)});return o.concat(a)},syncInterestsCacheAndGridUI:function(){return this.grid.showLoading(),this._throttledSyncBothInterestCaches().then(function(){this.inNux&&this.recommendedExperiment&&this.createInterestModulesAndReplaceGrid(this.getRecommendedResultsFromCache(),this.recommended_grid,"recommended"),this.createInterestModulesAndReplaceGrid(this.getEmptySearchResultsFromCache(),this.grid,"other")}.bind(this))},_syncBothInterestCaches:function(){var e=[this._syncFollowedInterestsCache(),this._syncNUXInterestsCache()];return Promise.all(e).then(function(){})},_syncFollowedInterestsCache:function(){var e=P.resourceFactory.instance.create("InterestFollowingResource",{username:P.user.instance.get("username")}),t=[],o=function n(o){var a=o.resource_response.data;return _.isArray(a)&&(t=t.concat(a)),e.atEnd()?Promise.resolve(t):e.callGet().then(n)};return e.callGet().then(o).then(function(e){this.currentInterestFollowingStatus=[],_.each(e,function(e){this.currentInterestFollowingStatus.push({id:e.id,interest:e,followingStatus:!0,logData:_.has(e,"log_data")?e.log_data:null})}.bind(this))}.bind(this))},_syncNUXInterestsCache:function(){var e=P.resourceFactory.instance.create("UserInterestsResource",{blend_type:"nux",sort:"ranked",board:Cookie.get(P.CONST.COOKIE_LAST_UNAUTH_BOARD_ID),interest:Cookie.get(P.CONST.COOKIE_LAST_UNAUTH_INTEREST_ID),profile:Cookie.get(P.CONST.COOKIE_LAST_UNAUTH_PROFILE_ID),pin:Cookie.get(P.CONST.COOKIE_LAST_UNAUTH_PIN_ID),field_set_key:"grid_item_nux"});return e.callGet().then(function(e){for(var t=e.resource_response.data,o=!1,n=0;n<t.length;n++){var a=t[n];if(a.is_recommended){o=!0;break}}if(_.isArray(t))if(this.inNux&&o){this.recommended_grid=this.getChildById("recommended_grid");var r=P.experiments.instance.v2ActivateExperiment("recommended_interest_picker");if(this.recommendedExperiment="enabled"===r||"employees"===r,this.recommendedExperiment&&this.separateRecommended){for(var i=0;i<t.length;i++){var s=t[i];s.is_recommended?this.recommendedInterests.push(s):this.nuxInterests.push(s)}this.updateOptionsAndDom({state_recTitleHidden:!1,state_recHidden:!1})}else this.nuxInterests=t}else this.nuxInterests=t}.bind(this))},_onSearchStart:function(e){this.$clearSearchEm.removeClass(this.CssClassName.VISIBILE),this.interestsSearchField.showLoading(!1,this.$(".clearSearch"));
},_onTypeaheadData:function(e){if(this.interestsSearchField.hideLoading(),this._searchFieldIsEmpty()||this.$clearSearchEm.addClass(this.CssClassName.VISIBILE),!e.term||this._getSearchText()===e.term){if(e.term){if(_.isEmpty(e.items)){var t=P.string.format(P.i18n._("Sorry! We couldn't find <b>{{ searchTerm }}</b>."),{searchTerm:_.escape(e.term)});this.updateOptionsAndDom({state_noResultsHidden:!1,state_noResultsText:t}),this.inNux&&!_.isEmpty(this.recommendedInterests)&&this.separateRecommended&&(this.updateOptionsAndDom({state_recTitleHidden:!1,state_recHidden:!1}),this.createInterestModulesAndReplaceGrid(this.getRecommendedResultsFromCache(),this.recommended_grid,"recommended")),this.createInterestModulesAndReplaceGrid(this.getEmptySearchResultsFromCache(),this.grid,"other")}else this.createInterestModulesAndReplaceGrid(e.items,this.grid,"other"),this.updateOptionsAndDom({state_recTitleHidden:!0,state_recHidden:!0,state_noResultsHidden:!0});this.logToContextLog(e.term,!_.isEmpty(e.items))}else this._searchFieldIsEmpty()&&(this.inNux&&!_.isEmpty(this.recommendedInterests)&&this.separateRecommended&&(this.updateOptionsAndDom({state_recTitleHidden:!1,state_recHidden:!1}),this.createInterestModulesAndReplaceGrid(this.getRecommendedResultsFromCache(),this.recommended_grid,"recommended")),this.createInterestModulesAndReplaceGrid(this.getEmptySearchResultsFromCache(),this.grid,"other"),this.updateOptionsAndDom({state_noResultsHidden:!0}));P.util.scrollToTop({})}},_createInterestModuleAndPrependToGrid:function(e,t,o){var n="brio"===this.options.view_type?"homefeedSetupViewNoFollowButton":"homefeedSetupView",a=new P.modules.Interest({data:e,options:{view_type:n,show_mask:!0}});"recommended"===o?a.renderExistingData().then(function(){this.recommended_grid.getGridItems().prependChildItem(a)}.bind(this)):a.renderExistingData().then(function(){this.grid.getGridItems().prependChildItem(a)}.bind(this))},createInterestModulesAndReplaceGrid:function(e,t,o){t.emptyItems();for(var n=e.length-1;n>=0;n--)this._createInterestModuleAndPrependToGrid(e[n],t,o);t.hideLoading()},_searchFieldIsEmpty:function(){return _.isEmpty(this._getSearchText())},_getSearchText:function(){var e=$.trim(this.$("input[type='text']").val());return e.replace(/'/g,"`")},_onInterestFollowClick:function(e){var t=e.data||{};this._onInterestClick(t,!0)},_onInterestUnfollowClick:function(e){var t=e.data||{};this._onInterestClick(t,!1)},_onInterestClick:function(e,t){if(!this._searchFieldIsEmpty()&&this.separateRecommended&&(this.separateRecommended=!1,this.nuxInterests=this.recommendedInterests.concat(this.nuxInterests),this.recommendedInterests=[]),this._invalidateTypeaheadCacheForInterestSearchTerm(),_.has(e,"is_followed")){var o=_.find(this.currentInterestFollowingStatus,function(t){return t.id===e.id});o&&(this.currentInterestFollowingStatus=_.reject(this.currentInterestFollowingStatus,function(t){return t.id===e.id})),this.currentInterestFollowingStatus.unshift({id:e.id,interest:e,followingStatus:t,logData:_.has(e,"log_data")?e.log_data:null});var n=_.find(this.nuxInterests,function(t){return t.id===e.id});n&&(n.is_followed=t),this.interestFollowChange=!0,this.updateNextButton()}},_invalidateTypeaheadCacheForInterestSearchTerm:function(){var e=this._getSearchText();if(e){this._getTypeahead().removeCacheForTerm(e);var t=e.split(" ");t.length>=2&&_.each(t,function(e){this._getTypeahead().removeCacheForTerm(e)}.bind(this));for(var o=e.substring(0,e.length-1);o;)this._getTypeahead().removeCacheForTerm(o),o=o.substring(0,o.length-1)}},_getTypeahead:function(){return this._typeahead},updateFollowCount:function(){var e=P.ExperienceTutorialManager.instance().tutorial;e&&e.setStorage("interest_follow_count",this.getNumFollowedInterests())},getNumFollowedInterests:function(){var e=_.filter(this.currentInterestFollowingStatus,function(e){return e.followingStatus});return e.length},getMinNumToFollow:function(){return this.inNux?5:1},updateNextButton:function(){var e=this.getMinNumToFollow(),t=e-this.getNumFollowedInterests(),o;t>0?(o=P.string.format(P.i18n._("Follow {{ numToFollow }} more"),{numToFollow:t}),this.nextButton.setText(o),this.nextButton.disable()):(o=P.i18n._("Done"),this.nextButton.setText(o),this.nextButton.enable()),this.nextButton.show()},_clearSearch:function(){this.$("input").val(""),this._onSearchTextUpdate()},_onSearchTextUpdate:function(){this._getTypeahead().search(this._getSearchText()),this._searchFieldIsEmpty()?this.$clearSearchEm.removeClass(this.CssClassName.VISIBILE):this.interestsSearchField.isLoading()||this.$clearSearchEm.addClass(this.CssClassName.VISIBILE)},onNextButtonClicked:function(){if(this.updateFollowCount(),this.currentInterestFollowingStatus&&this.interestFollowChange){var e;if(this.inNux){var t=_.reject(this.currentInterestFollowingStatus,function(e){return!e.followingStatus}),o=_.pluck(t,"id"),n=_.pluck(t,"logData");e={interests:o.join(),log_data:n.join(),referrer:"nux"};var a=P.resourceFactory.instance.create("OrientationContextResource",e);a.callCreate()}else{var r=_.object(_.pluck(this.currentInterestFollowingStatus,"id"),_.pluck(this.currentInterestFollowingStatus,"followingStatus"));e={updated_interest_follows:r};var i=P.resourceFactory.instance.create("UpdateFollowedInterestsResource",e);i.callUpdate();var s=P.resourceFactory.instance.create("OrientationRefreshHomefeedResource");s.callUpdate()}}P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)},logToContextLog:function(e,t){var o={entered_query:e,results_exist:t};this._logCustomContextEvent(P.genConst.EventType.SEARCH_INTERESTS,P.genConst.ElementType.SEARCH_BOX_TEXT_INPUT,P.genConst.ComponentType.INTEREST_PICKER,o)}}),P.modules.NuxModalInterestPicker.prototype.className="NuxModalInterestPicker",goog.provide("P.modules.NuxModalJumpStartStep"),goog.require("P.modules.NuxModalStepBase"),goog.require("P.i18n");var Zo="NuxStepsProgress";P.modules.NuxModalJumpStartStep=P.modules.NuxModalStepBase.extend({events:{"click .next":"onNextClick"},onContentReady:function(){var e=P.ExperienceTutorialManager.instance().currentStep;if(e>0){this.$(".progressBar").show();var t=e===this.extraData.numSteps?P.i18n._("Done"):P.i18n._("Next");this.$(".next").text(t);var o=this.getChildById(Zo);o&&o.setStep(e)}},onNextClick:function(){P.modules.NuxModalStepBase.prototype.onNextButtonClicked.call(this)},animateOut:function(e,t){this.animateOpacity(e,0,t)},animateIn:function(e,t){this.animateOpacity(e,1,t)},animateOpacity:function(e,t,o){var n={duration:400};o&&(n.complete=function(){o()}),e.animate({opacity:t},n)},animateChain:function(e,t,o){if(1===e.length)t(this.$(e[0]),o);else{var n=this.$(e[0]);t(n,function(){this.animateChain(e.slice(1),t,o)}.bind(this))}}}),P.modules.NuxModalJumpStartStep.prototype.className="NuxModalJumpStartStep",goog.provide("P.modules.NuxModalJumpStartWelcomeStep"),goog.require("P.modules.NuxModalJumpStartStep"),goog.require("P.timer"),P.modules.NuxModalJumpStartWelcomeStep=P.modules.NuxModalJumpStartStep.extend({onContentReady:function(){P.timer.setTimeout(function(){P.modules.NuxModalJumpStartStep.prototype.onNextButtonClicked.call(this)}.bind(this),2e3)},onExit:function(e){this.animateOut(this.$(".title")),P.modules.NuxModalJumpStartStep.prototype.onExit.call(this,e)}}),P.modules.NuxModalJumpStartWelcomeStep.prototype.className="NuxModalJumpStartWelcomeStep",goog.provide("P.modules.PaddedPin"),goog.require("P.conversationsManager"),goog.require("P.conversationsUtil"),goog.require("P.Module"),goog.require("P.modules.Pin"),goog.require("P.moduleFactory"),goog.require("P.i18n"),P.modules.PaddedPin=P.Module.extend({events:{"mouseenter .visualSearchObjectTagClickTarget":"visualSearchToolTipShow","mouseleave .visualSearchObjectTagClickTarget":"visualSearchToolTipHide","mousemove .paddedPinLink":"onLinkMousemove","click .pinImage":"showContextualSignup"},onCreated:function(){this._hasBeenSetDraggable=!1,this._draggablePin=null,this._isDraggable=!1},onLinkMousemove:function(e){P.conversationsManager.instance.getConversationIds().length&&!this._draggablePin&&this.generateAndSetDraggablePin()},detatchDraggable:function(){this.$(".paddedPinLink").draggable({disabled:!0}),this._isDraggable=!1,this._draggablePin=null},attachDraggable:function(){var e=this;this._hasBeenSetDraggable&&!this._isDraggable?this.$(".paddedPinLink").draggable("enable"):this._isDraggable||this.$(".paddedPinLink").draggable({appendTo:$(".App"),cursor:"move",cursorAt:{left:P.CONST.PIN_WIDTH/2,top:50},helper:function(){return e._draggablePin.getContent()},drag:function(e,t){var o=parseInt($(this).data("startingScrollTop"),10);t.position.top-=o;var n=e.clientX-t.position.left,a=window.pageYOffset+e.clientY-t.position.top,r=t.helper.height(),i=t.helper.width(),s=n/i*100,l=a/r*100,u=""+s+"% "+l+"%";t.helper.css("transformOrigin",u)},scroll:!1,revert:!1,start:function(t,o){P.conversationsUtil.setDraggedObject(e._draggablePin),$(this).data("startingScrollTop",window.pageYOffset-P.CONST.PIN_MARGIN)},stop:function(e,t){P.conversationsUtil.setDraggedObject(null);var o=parseInt($(this).data("startingScrollTop"),10);t.position.top-=o}}),this._isDraggable=!0,this._hasBeenSetDraggable=!0},generateAndSetDraggablePin:function(){var e=this,t=new P.modules.Pin({data:this.data,options:{show_comments:!1,squish_giraffe_pins:!1}});t.renderExistingData().then(function(){e._draggablePin=t,e.attachDraggable()})},getLoggingObjectIdStr:function(){return this.resource.options.id},onAddedToDom:function(){this._setupClickIfReady()},onContentReady:function(){this._setupClickIfReady();var e={};e[P.CONST.PUBSUB_TOPIC_CONVERSATION_ADDED]=this.onConversationAdded,e[P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS]=this.onNoActiveConversations,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,e)},onButtonClick:function(e){var t=e.target,o=t.id;switch(o){case"flashlightButton":this.onFlashlightClick()}},onFlashlightClick:function(){var e=this.getChildByModuleName("Image").getWidth(),t={name:"CloseupFlashlight",options:{pin:this.data,img_width:e}},o={modal_style:"flashlightModal",can_dismiss:!0};P.moduleFactory.load(t).then(function(e){this.showInModal(e,o)}.bind(this))},onConversationAdded:function(e,t,o){this.attachDraggable()},onNoActiveConversations:function(){this.detatchDraggable()},showContextualSignup:function(){P.user.instance.isAuthenticated()||P.signupModalManager.showInlineSignupModal(this,this.resource)},_setupClickIfReady:function(){if(this.contentReady&&this.inDom){var e=this;this.createToolTips(),this.$(".visualSearchObjectTagClickTarget").click(function(){e.triggerEvent(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_SELECTED,$(this).data("visualobjectid").toString(),!0)})}},visualSearchToolTipHide:function(e){this.dropdown[$(e.currentTarget).data("visualobjectid")].hide()},visualSearchToolTipShow:function(e){this.dropdown[$(e.currentTarget).data("visualobjectid")].show(function(){})},createToolTips:function(){this.dropdown={},jQuery.each(this.$(".visualSearchObjectTagClickTarget"),function(e,t){this.createVisualSearchDropdown($(t))}.bind(this))},createVisualSearchDropdown:function(e){var t={name:"Dropdown",options:{anchor:e,class_name:"large aboveModal",position_point:"BOTTOM_CENTER",text:P.i18n._("Click the red dot to see similar looks"),append_to_closeup:!0}};P.moduleFactory.load(t).then(function(t){var o=t;this.dropdown[e.data("visualobjectid")]=o,o.render().then(function(){_.defer(function(){o.positionModule()})})}.bind(this))},getFirstVisualObject:function(){var e=this.$(".visualSearchObjectTagClickTarget");return e.length?e.first():null}}),P.modules.PaddedPin.prototype.className="PaddedPin",goog.provide("P.modules.PinCreate"),goog.require("P.dom"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),goog.require("P.modules.BoardPicker"),goog.require("P.modules.Button"),goog.require("P.modules.PinDupWarning"),goog.require("P.modules.RepinSuccessToast"),goog.require("P.moduleFactory"),goog.require("P.modalManager"),goog.require("P.ga"),goog.require("P.i18n"),goog.require("P.toastsManager"),goog.require("P.timer"),goog.require("P.experienceUtil"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.errorUtil"),goog.require("P.resourceFactory"),goog.require("P.SocialConnect");var Qo=490,en=47,tn=12,on=660,nn=200,an="ease-out";P.modules.PinCreate=P.Module.extend({events:{'change [name="share_facebook"]':"onFacebookCheckboxChanged"},CssClassName:{ANIMATE_OUT:"animateOut",CAPPED_MAX_HEIGHT:"cappedMaxHeight",PINIT_BUTTON_LOADING:"loading",PINIT_BUTTON_SUCCESS:"success",PINIT_ITEM_ACTIVE:"activeItem",PINIT_PINNING:"pinning",SHOWING_CREATE_BOARD:"showingCreateBoard"},onCreated:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange),this.childListen(P.CONST.EVENT_BOARD_CREATED,this.onBoardCreated),this.childListen(P.CONST.EVENT_DUPE_DETECTED,this.onDupeDetected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this._shouldAnimatePinBackToGrid=!0,this.networkToSelectorMap={},this.networkToSelectorMap[P.SocialConnect.FACEBOOK]='[name="share_facebook"]',this.networkToSelectorMap[P.SocialConnect.TWITTER]='[name="share_twitter"]',this.removeClickJackStyle()},onFacebookCheckboxChanged:function(e){var t=this.getNetworkChecked(P.SocialConnect.FACEBOOK);P.user.instance.set(P.CONST.FB_PUBLISH_KEY,t),t&&P.FbUtil.maybeRequestFbTimelinePermission({error:function(){this.setNetworkChecked(P.SocialConnect.FACEBOOK,!1),P.user.instance.set(P.CONST.FB_PUBLISH_KEY,!1)}.bind(this)})},onDupeDetected:function(e){this.adjustHeight(!0)},onChildContentChanged:function(e){this.addCreateBoardStaticItems(),this.adjustHeight()},setImage:function(e){var t=this.getChildById("pin");t.setPinImages(e),t.renderExistingData()},onButtonClick:function(e){var t=e.target;if(t.isCancelButton()){var o=this.getChildById("boardCreate");o?(e.stopPropagation(),this.getCloseButton().fadeOut(),this.hideCreateBoard()):("closeButton"===t.id&&this._logCustomContextEvent(P.genConst.EventType.WEB_PIN_CREATE_CLOSE_MODAL_BEFORE_PINNING,P.genConst.ElementType.WEB_PIN_CREATE_BOARD_FILTER,P.genConst.ComponentType.MODAL_REPIN,{}),this.options.is_csr&&window.parent.postMessage("navigate",P.CONST.PIN_IT_DOMAIN),this.modal||this.destroy())}},removeClickJackStyle:function(){var e=window.location.hostname;if("pin.it"===e||e===P.genConst.Settings.CANONICAL_MAIN_DOMAIN||"tilde.pinterdev.com"===e){var t=$(".antiClickJack");t.removeClass("antiClickJack")}},setNetworkChecked:function(e,t){var o=this.networkToSelectorMap[e];o&&this.$(o).prop("checked",t)},getNetworkChecked:function(e){var t=this.networkToSelectorMap[e];if(t){var o=this.$(t);return o.length?o.is(":checked"):""}},animateEntranceToModal:function(){this.modal&&(this.modal.setVisible(!0),this.$el.transition({duration:0,opacity:0},function(){this.animatePinToModal(),this.adjustHeight()}.bind(this)).transition({duration:0,scale:.95}).transition({opacity:1,scale:1,duration:nn}))},_onAnimateModalOutComplete:function(){P.modalManager.get().setAnimatedModule(null),this._pinGridOffset=0,this.modal&&this.modal.destroy()},_animateModalOut:function(){if(this.modal){var e=this.modal.getMask();if(e.addClass(this.CssClassName.ANIMATE_OUT),this.shouldAnimatePinBackToGrid()){this.animatePinBackToGrid();var t=this.modal.getContent();t.transition({duration:nn,opacity:0,scale:.95,easing:an},function(){this._onAnimateModalOutComplete()}.bind(this))}else{var o=this.$el.outerHeight(),n=this.modal.getPositionElement(),a=this.modal.getContent(),r=0;a.length&&(r=a.offset().top-this.getScrollableElement().scrollTop()),n.transition({y:r+o+en,duration:nn},function(){this._onAnimateModalOutComplete()}.bind(this))}}},animateExitFromModal:function(){this._animateModalOut()},shouldAnimatePinBackToGrid:function(){return this._shouldAnimatePinBackToGrid},adjustHeight:function(e){var t=P.modalManager.get(),o=t&&t.getAnimatedModule();o||(o=this.getChildById("pin"));var n=o.getContent(),a=this.$(".socialShareWrapper").height();if(P.context.instance.is_mobile_agent&&o)this.$el.height($(window).height());else if(o){var r=n.height();r+=2*en;var i;if(a&&(a+=P.CONST.PIN_MARGIN),Qo>r)i=Qo;else if(r>on-en-a){n.addClass(this.CssClassName.CAPPED_MAX_HEIGHT);var s=n.find(".pinImageActionButtonWrapper"),l=r-s.height(),u=on-l-a;i=on-a,e||s.css("maxHeight",u+"px")}else i=r;e||this.$el.height(i)}else{var d=a?P.CONST.PIN_MARGIN+a:0;this.$el.height(on-d)}var c=this.getBoardpicker().getList().getContent(),p=this.$el.height()-c.position().top;if(P.context.instance.is_mobile_agent){var m=a?tn+a:0;p=p-tn-m}if(c.height(p),P.context.instance.is_mobile_agent){if(n&&n.hasClass("compact")){var h=o.getChildById("pinDescriptionField").getContent().find("textarea"),g=n.find(".pinImageWrapper"),_=o.getPinDescriptionElement(),f=_.outerHeight(!0)-_.height();h.height(g.height()-f)}}else{var b=this.$el.find(".titleContainer").height();this.$el.find(".boardsWrapper").css("padding-top",b+"px")}},animatePinToModal:function(){var e=P.modalManager.get().getAnimatedModule();if(e){e.setDescriptionInputHeight();var t=e.getContent(),o=t.offset(),n=this.$el.offset().left;n+=(this.$el.width()/2-P.CONST.PIN_WIDTH)/2,this._pinGridOffset=o;var a=Math.round((this.$el.height()-2*en-t.height())/2),r=this.$el.offset().top-o.top+a+en;t.transition({x:n-o.left,y:r,duration:nn,easing:"cubic-bezier(0,0.9,0.3,1)",opacity:1},function(){t.detach(),this.insertChild(e,this.$(".pinModuleHolder")),t.transition({x:0,y:0,duration:0}).css({top:0,position:"static",left:0})}.bind(this))}},hideDupPinWarning:function(){var e=this.getPinDupWarning();e&&e.fadeOut(function(){e.hide()})},showPinDupWarning:function(){var e=this.getPinDupWarning();e&&e.fadeIn(function(){e.show()})},onChildChange:function(e){switch(e.target.id){case"boardPicker":var t=e.data,o=t.id,n=t.name;o||n?(o||n)&&(o?P.timer.setTimeout(function(){this.createPin(t)}.bind(this),50):this.showCreateBoard(n)):this.showCreateBoard("")}},getPinDupWarning:function(){return this.getChildById("pinDupWarning")},getCloseButton:function(){return this.getChildById("closeButton")},showCreateBoard:function(e){if(!this._showingCreateBoard){this._showingCreateBoard=!0,this.hideDupPinWarning();var t={board_name:e,form_class:"modalPinCreate",class_name:"pinCreate",custom_board_create_success_destroy:!0,close_typeahead_on_selection:!0,link_to_users_profiles:!1,add_collaborators_after_creating:!0,navigate_on_success:!1,show_secret_boards_learn_more:!1,show_collaborators_learn_more:!1,show_map_learn_more:!1,typeahead_overflow_visible:!1,prevent_default_on_enter_collabs:!0};this.getCloseButton().fadeOut();var o=new P.modules.BoardCreate({id:"boardCreate",options:t});o.render().then(function(){var e=o.getContent();e.transition({opacity:0,duration:1}),this.insertChild(o,this.$(".boardsWrapper")),o.animateIn(function(){this.getCloseButton().fadeIn(),o.setCollabsMaxHeight(),this.$el.addClass(this.CssClassName.SHOWING_CREATE_BOARD)}.bind(this))}.bind(this))}},hideCreateBoard:function(e){this._showingCreateBoard=!1,this.showPinDupWarning(),this.$el.removeClass(this.CssClassName.SHOWING_CREATE_BOARD);var t=this.getChildById("boardCreate");t&&t.animateOut(function(){this.getCloseButton().fadeIn()}.bind(this))},getPinResource:function(){var e="PinResource",t={},o,n=P.modalManager.get(),a=n&&n.getAnimatedModule();a&&(o=a);var r=this.getChildById("pin");r&&(o=r);var i=o.data,s=o.getDescriptionText();this.isRepin()&&(t.pin_id=i.id,e="RepinResource");var l=this.options.method;l&&(t.method=l),t.description=s;var u=i.link;if(t.link=u,t.is_video=i.is_video,t.guid=this.options.guid,!this.isRepin()){var d=i.image_url;d=this.prependSchemeIfNeeded(d,u),t.image_url=d}var c=this.getNetworkChecked(P.SocialConnect.TWITTER);return""!==c&&(t.share_twitter=c),c=this.getNetworkChecked(P.SocialConnect.FACEBOOK),""!==c&&(t.share_facebook=c),P.resourceFactory.instance.create(e,t)},prependSchemeIfNeeded:function(e,t){if(!t)return e;var o=new RegExp(/http(s?):/);if(!o.test(e)){var n=o.exec(t);if(n&&n.length){var a=n[0];e=a+e}}return e},showPinItLoadingForBoardId:function(e){this.$el.addClass(this.CssClassName.PINIT_PINNING);var t=this.getBoardpicker(),o=t.getSelectedElement(),n=o.find(".Button");o.addClass(this.CssClassName.PINIT_ITEM_ACTIVE),this._$button=n,n.addClass(this.CssClassName.PINIT_BUTTON_LOADING)},showPinItSuccess:function(){return this.options.is_csr&&window.parent.postMessage("showToast",P.CONST.PIN_IT_DOMAIN),new Promise(function(e,t){this._removeButtonLoadingClass().addClass(this.CssClassName.PINIT_BUTTON_SUCCESS),setTimeout(e,500)}.bind(this))},_removeButtonLoadingClass:function(){var e=this.getBoardpicker(),t=e.getSelectedElement();return t.removeClass(this.CssClassName.PINIT_ITEM_ACTIVE),this._$button.removeClass(this.CssClassName.PINIT_BUTTON_LOADING)},_hideSocialCheckboxes:function(){this.$(".socialShareWrapper").hide()},createPin:function(e){if(!this.requestPending&&this._isPinDescriptionValid()){var t=e.id;this.showPinItLoadingForBoardId(t);var o=e.privacy===P.CONST.BoardPrivacy.SECRET;o&&this._hideSocialCheckboxes();var n=this.getPinResource();n.options.board_id=t,this.requestPending=!0,n.callCreate({showError:!1}).then(function(e){this._onPinCreateSuccess(e)}.bind(this),function(e){if(P.ga.trackEvent(this.GACategory,P.CONST.GA_ACTION_ERROR),this._removeButtonLoadingClass(),this.$el.removeClass(this.CssClassName.PINIT_PINNING),"create"===this.options.action&&e.api_error_code===P.CONST.API_SERVER_SPAM_CONTENT){var t={name:"ConfirmDialog",options:{fluid:!0,template:"blocked_source"}};P.moduleFactory.load(t).then(function(e){e.render().then(function(){this.parent.appendChild(e),this.destroy()}.bind(this))}.bind(this))}else P.errorUtil.showError(e.message)}.bind(this)).fin(function(){this.requestPending=!1,this.hideLoading()}.bind(this))}},onBoardCreated:function(e){var t=e.data,o=this.getBoardpicker(),n=_.clone(o.resource);return n.callGet(n).then(function(e){if(e&&!e.error){var o=this.getBoardpicker();o.options.select_first_board=!1,o.model.set(e.resource_response.data),o.renderExistingData().then(function(){this.hideCreateBoardModuleAndHighlightBoard(t)}.bind(this))}}.bind(this))},hideCreateBoardModuleAndHighlightBoard:function(e){this.hideCreateBoard(),this.adjustHeight(!0),P.dom.deferDomManipulation(function(){var t=e.id;this.hightlightBoardWithId(t),this.createPin(e)}.bind(this))},hightlightBoardWithId:function(e){var t=this.getBoardpicker(),o=t.getAllBoards(),n=_.find(o,function(t){return t.id===e}),a=_.indexOf(o,n);a>=0&&t.selectBoardAtIndex(a)},_onPinCreateSuccess:function(e){P.ga.trackEvent(this.GACategory,P.CONST.GA_ACTION_SUCCESS),this._shouldAnimatePinBackToGrid=!1;var t=this.getBoardpicker();this.pinForm&&(t=this.pinForm.getBoardPicker());var o=P.resourceFactory.instance.clone(t.resource);P.resourceCache.instance.callGet(o),P.ExperienceManager.instance.refreshPlacedExperiences(),this.showPinItSuccess().then(function(){var t=e.resource_response.data;if(this.modal&&this.isRepin()){var o={pin:t};P.modules.PinCreate.prototype.triggerCommonPinCreateEvents(this,t,{isRepin:this.isRepin(),originalPinId:this.data.id}),this._animateModalOut(),P.toastsManager.instance.removeAllToasts();var n=new P.modules.RepinSuccessToast({data:o}),a=P.browserExtension.instance.isExtensionInstalled(),r={is_extension_installed:!!a,pinned_with_bookmarklet:!this.isRepin()};return void P.experienceUtil.launchPlacedExperience(P.genConst.Placement.WEB_PIN_SUCCESS,r).then(function(e){if(!e&&this._suggestedBoard){o.suggested_board=this._suggestedBoard;var t=new P.modules.RepinSuccessToast({options:{is_recommendation:!0},data:o});P.toastsManager.instance.addToast(t)}P.toastsManager.instance.addToast(n,0)}.bind(this))}this.modal&&(this.modal.options.custom_exit_animation=!1);var i=t.board,s=i.url,l=i.category,u=i.id,d=this.options.action,c=i.name,p=i.privacy,m=i.is_collaborative,h={id:"pinSuccess",name:"PinCreateSuccess",options:{action:d,board_name:c,board_category:l,board_id:u,board_url:s,domain:t.domain,pin_id:t.id,is_collaborative:m,is_extension_installed:!!P.browserExtension.instance.isExtensionInstalled(),privacy:p,method:this.options.method,auto_close:!0,is_csr:this.options.is_csr}};"pin_create_ignition"===this.options.action?h.options.auto_close=!1:this._createdBoardToEdit&&this._createdBoardToEdit.id===i.id&&(h={id:"pinSuccess",name:"PinCreateSuccessBoardEdit",resource:{name:"BoardResource",options:{board_id:i.id,field_set_key:"basic"}},options:{pinCreateInfo:h}}),this.showLoading(),P.moduleFactory.load(h).then(function(e){this.modal?this.modal.setSubmodule(e):"pin_create_ignition"===this.options.action?this.showInModal(e,{}):e.render().then(function(){this.parent.appendChild(e),this.destroy()}.bind(this))}.bind(this)),P.modules.PinCreate.prototype.triggerCommonPinCreateEvents(this,t,{isRepin:this.isRepin(),originalPinId:this.data.id})}.bind(this))},isRepin:function(){return!(!this.data||!this.data.id)},animatePinBackToGrid:function(){var e=P.modalManager.get().getAnimatedModule();if(e){var t=e.getContent(),o=t.offset(),n=this._pinGridOffset.left-o.left,a=this._pinGridOffset.top-o.top;t.detach().appendTo($(".App")).css({position:"absolute",top:o.top+"px",left:o.left+"px"}).transition({x:0,y:0,duration:0}).transition({x:n,y:a,duration:nn,easing:"cubic-bezier(0,0.1,0.7,1)",opacity:0},function(){t.css("zIndex",""),e.destroy(),this.modal.destroy(),P.modalManager.get().setAnimatedModule(null)}.bind(this))}},onContentReady:function(){if(this.isRepin()){if(this.data&&this.data.id){var e=P.resourceFactory.instance.create("RelatedBoardForPinRandomFeedResource",{pin:this.data.id,page_size:1});e.callGet({showError:!1}).then(function(e){e.resource_response.error||(this._suggestedBoard=e.resource_response.data[0])}.bind(this))}this.addQuickPicksLoadingStaticItem(),on=Math.min(660,$(window).height()-2*en)}this.addCreateBoardStaticItems(),this.options.is_csr||this.adjustHeight(!1),this.focus()},addCreateBoardStaticItems:function(){var e=this.getBoardpicker();if(this.getBoardpicker()&&this.getBoardpicker().getAllBoards().length&&!this.$el.find(".PickerItemCreate").length){var t={type:"module",name:"PickerItemCreate",options:{display_text:P.i18n._("Create a Board"),view_type:"pinCreate createBoard allBoardsStaticItem"},data:{is_create_suggestion:!0,name:""}};e.appendModuleToList(t,-1)}},addQuickPicksLoadingStaticItem:function(){if(this.isRepin()){var e=this.getBoardpicker();if(e&&e.getBoardsShortList().length&&e.getAllBoards().length&&e.shouldRenderQuickPicks()){var t={type:"module",name:"BoardPickerSpinnerBlock"};e.appendModuleToList(t,0)}}},getBoardpicker:function(){return this.getChildById("boardPicker")},focus:function(){this.getBoardpicker().focus()},triggerCommonPinCreateEvents:function(e,t,o){e.triggerEvent(P.CONST.EVENT_PIN_CREATE,t,!1),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,t),P.pubSub.instance.publish(t.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,{pin:t,gridPrependCallback:o.gridPrependCallback}),P.pubSub.instance.publish(P.user.instance.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED),o.isRepin&&P.pubSub.instance.publish(o.originalPinId,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,t)},_isPinDescriptionValid:function(){var e=this.getChildByModuleName("Pin");return e&&e.isDescriptionValid()}}),P.modules.PinCreate.prototype.className="PinCreate",goog.provide("P.modules.PinDragAndDrop"),goog.require("P.Module"),goog.require("P.Spinner"),goog.require("P.modules.PinCreate"),goog.require("P.url"),P.modules.PinDragAndDrop=P.Module.extend({events:{dragdrop:"onOverlayDrop",drop:"onOverlayDrop",dragleave:"onOverlayLeave",click:"onOverlayLeave"},onOverlayDrop:function(e){e.preventDefault(),this.options.file_drop?this._createFromFileDrop(e.originalEvent.dataTransfer):this._createFromWebsiteDrop(e.originalEvent.dataTransfer)},onOverlayLeave:function(e){e.preventDefault(),this.removeOverlay()},removeOverlay:function(){this.destroy()},ensurePinCreate:function(e,t,o,n){var a={image_url:e,action:t?"create":"upload",method:"uploaded",render_existing_pin:!0},r={description:t?n||"":"",image_url:e,link:t?o:""},i=t?P.genConst.EventType.DRAG_AND_DROP_FROM_BROWSER:P.genConst.EventType.DRAG_AND_DROP_FROM_FILE,s={container_class:"webNewContentNewRepin",mask_type:"webNewContentNewRepin",modal_style:"webNewContentNewRepin",custom_entrance_animation:!0,custom_exit_animation:!0},l=new P.modules.PinCreate({options:a,id:"pinCreate",resource:{name:"FakePinResource",options:r}});return this.showLoading(),l.render().then(function(){var e=P.context.instanceEvent.fromEventType(i);return P.context.instanceLogger.getInstance().addEvent(e),this.hideLoading(),this.showInModal(l,s),this.triggerEvent(P.CONST.EVENT_PIN_CREATE_OPENED,null,!0),this.removeOverlay(),Promise.resolve()}.bind(this))},_createFromFileDrop:function(e){var t=e&&e.files;if(!t||!t.length)return void this.removeOverlay();if(!(new XMLHttpRequest).upload)return void this.removeOverlay();var o=new FormData;o.append("img",t[0]);var n=new XMLHttpRequest;n.open("POST",P.url.absolutify("/upload-image/")),n.setRequestHeader("Cache-Control","no-cache"),n.setRequestHeader("X-CSRFToken",P.csrf.getCSRFToken()),n.onload=function(){200===n.status?(this._uploadingFilesSpinner.stop(),this.ensurePinCreate(JSON.parse(n.responseText).image_url,!1,null,null)):this.removeOverlay()}.bind(this),this._uploadingFilesSpinner=new P.Spinner({}),this._uploadingFilesSpinner.spin(this.$el),this.$(".overlayText").hide(),n.send(o)},_createFromWebsiteDrop:function(e){var t=e.getData("text/uri-list"),o=e.getData("text/html");if(!t||!o)return void this.removeOverlay();var n=$("<div>"+o+"</div>").find("img");return n.length?(this._uploadingFilesSpinner=new P.Spinner({}),this._uploadingFilesSpinner.spin(this.$el),this.ensurePinCreate(n[0].src,!0,t,n[0].alt),void this.$(".overlayText").hide()):void this.removeOverlay()}}),P.modules.PinDragAndDrop.prototype.className="PinDragAndDrop",goog.provide("P.modules.PinUploader"),goog.require("P.Module"),goog.require("P.modules.PinCreate"),goog.require("P.ga"),P.modules.PinUploader=P.Module.extend({onContentReady:function(){var e=this.getChildById("uploader");this.listen(e,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess)},onUploadSuccess:function(e){P.ga.trackEvent("pin_upload",P.CONST.GA_ACTION_SUCCESS),this.imageUrl=e.data.image_url,this.ensurePinCreate()},ensurePinCreate:function(){var e={image_url:this.imageUrl,action:"upload",method:"uploaded",render_existing_pin:!0};this.options.default_board_id&&(e.default_board_id=this.options.default_board_id);var t={container_class:"webNewContentNewRepin",mask_type:"webNewContentNewRepin",modal_style:"webNewContentNewRepin",custom_entrance_animation:!0,custom_exit_animation:!0},o=new P.modules.PinCreate({id:"pinCreate",options:e,resource:{name:"FakePinResource",options:{description:"",image_url:this.imageUrl,link:""}}});return this.showLoading(),o.render().then(function(){return this.hideLoading(),this.showInModal(o,t),this.triggerEvent(P.CONST.EVENT_PIN_CREATE_OPENED,null,!0),this.destroy(),Promise.resolve()}.bind(this))}}),P.modules.PinUploader.prototype.className="PinUploader",goog.provide("P.modules.Pinnable"),goog.require("P.Module"),goog.require("P.modules.PinCreate");var rn="add_to_map";P.modules.Pinnable=P.Module.extend({events:{"click a.pinImageWrapper":"onClick",click:"onClick"},CssClassName:{DISABLED:"disabled",SELECTED:"selected"},onCreated:function(){this.onImageLoad=this.onImageLoad.bind(this),this.onImageError=this.onImageError.bind(this),this.options.state_isSelected=!1,this.options.state_disabled=!!this.options.disabled},onAdded:function(){this.updateImage()},updateDom:function(){this.$el.toggleClass(this.CssClassName.SELECTED,this.options.state_isSelected),this.$el.toggleClass(this.CssClassName.DISABLED,this.options.state_disabled)},updateImage:function(){var e=this.$(".pinImageWrapper"),t=this.$img=$("<img>");t.on("load",this.onImageLoad),t.on("error",this.onImageError),t.attr("src",this.options.url),e.append(t)},onImageLoad:function(){
this.$img.width()<P.CONST.MIN_PINNABLE_IMAGE_WIDTH||this.$img.height()<P.CONST.MIN_PINNABLE_IMAGE_HEIGHT?(this.log.debug("Too small!",this.$img.width(),this.$img.height()),this.destroy()):this.$el.css("visibility","visible"),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},onImageError:function(){this.destroy()},enable:function(){this.updateOptionsAndDom({state_disabled:!1})},disable:function(){this.updateOptionsAndDom({state_disabled:!0})},select:function(){this._setSelected(!0)},_setSelected:function(e){this.updateOptionsAndDom({state_isSelected:e})},deselect:function(){this._setSelected(!1)},onClick:function(e){if(this.options.view_type===rn){var t=this.$("img").attr("src");this.triggerEvent(P.CONST.EVENT_PLACE_IMAGE_SELECTED,t,!0),this.select()}else if("hoverMask"===e.target.className)return this.createPin(),!1},createPin:function(){var e=this.options.link,t=this.options.url,o={action:"create",method:"scraped",render_existing_pin:!0,hide_pin_credits:!0,is_clone_for_repin:!0,image_url:t},n={container_class:"webNewContentNewRepin",mask_type:"webNewContentNewRepin",modal_style:"webNewContentNewRepin",custom_entrance_animation:!0,custom_exit_animation:!0},a=new P.modules.PinCreate({id:"pinCreate",options:o,resource:{name:"FakePinResource",options:{description:"",image_url:t,link:e}}});this.showInModal(a,n)}}),P.modules.Pinnable.prototype.className="Pinnable",goog.provide("P.modules.PlaceSelector"),goog.require("P.Module"),goog.require("P.modules.TypeaheadField"),P.modules.PlaceSelector=P.Module.extend({onContentReady:function(){this._placeChanged=!1,this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onHint)},onHint:function(e){this.hintData=e.data,this.options.show_hints&&this.determineHint()},determineHint:function(){if(this.hintData&&this.hintData.length){var e=this.getTypeaheadField();if(_.isEmpty(this.results))e.setPrependedStaticItems([{template:"hint_no_city",selectable:!1}]);else{var t=this.hintData[0].feature.name,o=t;-1!==t.indexOf(",")&&(o=t.split(",")[0]),e.setPrependedStaticItems([{template:"hint_specific_city",selectable:!1,locality:o,place:t}])}}},onNoResultsReturned:function(e){this.results=e.data;var t=this.getTypeaheadField();t.setPrependedStaticItems([]),this.hideTypeaheadLoading()},getTypeaheadField:function(){return this.getChildById("placeField")},onResultsReturned:function(e){this.results=e.data;var t=this.getTypeaheadField();t.setPrependedStaticItems([]),this.hideTypeaheadLoading()},onSearchStart:function(e){var t=this.getTypeaheadField();t.showLoading()},hideTypeaheadLoading:function(){var e=this.getTypeaheadField();e.hideLoading()},getSelectedPlace:function(){if(!this._placeChanged)return null;var e=this.getTypeaheadField();if(!e)return"0";var t=e.getTypeaheadSelectedItem();if(!t)return"0";var o=t.get("id");return o?o:"0"},focusPlaceField:function(){var e=this.getTypeaheadField();e.focus()},onItemSelected:function(e){this._placeChanged=!0;var t=e.data.item,o=this.getTypeaheadField(),n=t.get("name");o.setValue(n)}}),P.modules.PlaceSelector.prototype.className="PlaceSelector",goog.provide("P.modules.SearchForm"),goog.require("P.Module"),goog.require("P.modules.SearchInputToken"),goog.require("P.util"),goog.require("P.modalManager"),P.modules.SearchForm=P.Module.extend({events:{"submit > form":"onSubmit",click:"onClick"},CssClassName:{FOCUS:"focus"},onChildItemSelected:function(e){var t=e.data.item,o=t.get("query")||"";this.showGuidedSearch&&this.updateSearchTokens(o,!0);var n=t.get("url");if(n){if(this.options.navigate_on_search){if(this.showGuidedSearch){var a=t.get("type");this.updateQueryStates(o,a,t.get("resultIndex")),"board"!==a&&"user"!==a&&(n+=this.constructQueryStatesParams())}this.navigate(n)}return this.typeaheadField.blur(),!1}},onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,e[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED_FORCE_UPDATE]=this.onSearchQueryUpdatedForceUpdate,e[P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED]=this.onSearchScopeUpdated,e[P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED]=this.onSearchBoostUpdated,e[P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED]=this.onSearchGuideSelected,e[P.CONST.PUBSUB_TOPIC_SEARCH_LINK_CLICKED]=this.onSearchLinkClicked,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.typeaheadField=this.getChildById("searchField"),this.showGuidedSearch=this.options.support_guided_search,this.showGuidedSearch&&(this.tokenizedInput=this.typeaheadField.getChildById("tokenizedInput"),this.queryStates=[],this.queryStatesChange=null),this.selectedListener=this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,this.onTokenRemovedByUser),this.childListen(P.CONST.EVENT_FOCUS,this.onTypeaheadFieldFocus),this.childListen(P.CONST.EVENT_BLUR,this.onTypeaheadFieldBlur),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.listen(P.router.instance,P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),$(document).on("keydown",function(e){this.onKeydown(e)}.bind(this))},onRouteMatched:function(e){this.showGuidedSearch&&e.options.query&&e.options.query!==this.typeaheadField.getValue()&&this.updateSearchTokens(e.options.query)},onTokenRemovedByUser:function(e){if(this.showGuidedSearch&&e.data){var t=e.data.text;this.updateQueryStates(t,"remove_refine")}this.navigateWithTokens()},onTypeaheadFieldFocus:function(){this.$el.addClass(this.CssClassName.FOCUS),this.showGuidedSearch&&this.tokenizedInput.setEditingTokenText()},onTypeaheadFieldBlur:function(){if(this.$el.removeClass(this.CssClassName.FOCUS),this.showGuidedSearch){var e=this.typeaheadField.getValue();this.tokenizedInput.setInputValue(""),this.updateSearchTokens(e,!1)}},onTypeaheadHidden:function(e){if(this.showGuidedSearch&&(!e.data||!e.data.noResults)){var t=this.typeaheadField.getValue();this.tokenizedInput.setInputValue(""),this.updateSearchTokens(t,!1)}},navigateWithTokens:function(){var e=this.typeaheadField.getValue(),t=encodeURIComponent(e),o="/",n=this.currentScope||this.options.scope||"pins";t&&(o="/search/"+n+"/?q="+t,o+=this.constructQueryStatesParams()),this.options.navigate_on_search&&this.navigate(o)},tokenizeQuery:function(e){var t=e.split(/\s+/),o=_.find(t,function(e){return _.contains(P.CONST.SEARCH_FILTER_CONJUNCTIONS,e.toLowerCase())});return o?[e]:t},updateSearchTokens:function(e,t){var o;if(t?(this.clearTypeaheadField(),o=e):o=this.tokenizedInput.setTokenValue(e),o){var n=this.tokenizeQuery(o),a=_.map(n,function(e){return{term:e,position:"1"}});this.addSearchInputTokens(a)}},onSearchQueryUpdated:function(e,t,o){this.updateSearchQuery(o,!1)},onSearchQueryUpdatedForceUpdate:function(e,t,o){this.updateSearchQuery(o,!0)},updateSearchQuery:function(e,t){e=e||"",this.showGuidedSearch?this.typeaheadField.isFocussed()||(this.tokenizedInput.setInputValue(""),this.updateSearchTokens(e,t)):this.setTypeaheadValue(e)},onSearchScopeUpdated:function(e,t,o){var n=o||"pins";this.currentScope=n,this.typeaheadField.setAutocompleteScope(n)},onSearchBoostUpdated:function(e,t,o){var n=o||"";this.currentBoost=n},onSearchGuideSelected:function(e,t,o){var n=o.term||"",a=o.position,r=o.color,i=o.index;if(n){var s=[{term:n,position:a,color:r}];this.addSearchInputTokens(s),this.updateQueryStates(n,"add_refine",i)}this.navigateWithTokens()},onSearchLinkClicked:function(e,t,o){this.onChildItemSelected({data:o})},removeSearchInputToken:function(e){this.tokenizedInput.removeToken(e)},addSearchInputTokens:function(e){var t=_.map(e,function(e){return new P.modules.SearchInputToken({options:{term:e.term,position:e.position,color:e.color}})});this.tokenizedInput.addTokensAndUpdateInputView(t)},setTypeaheadValue:function(e){this.typeaheadField.setValue(e)},clearTypeaheadField:function(){this.typeaheadField.clear()},_getTypeaheadHighlightedItem:function(){return this.typeaheadField.getTypeaheadHighlightedItem()},focus:function(){this.typeaheadField.focus()},onSubmit:function(e){var t=this._getTypeaheadHighlightedItem();if(t)return!1;var o=this.typeaheadField.getValue();if(""===o.trim())return P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED_WITH_EMPTY_QUERY,o),!1;this.showGuidedSearch&&(this.updateSearchTokens(o,!0),this.typeaheadField.abortSearch(),this.typeaheadField.blur());var n=encodeURIComponent(o),a=this.currentScope||this.options.scope||"pins";if(this.typeaheadField.setAutocompleteScope(a),this.options.navigate_on_search){var r="/search/"+a+"/?q="+n;"recent_week"===this.currentBoost&&(r="/search/pins/recent/?q="+n),this.showGuidedSearch&&(this.updateQueryStates(o,"typed"),r+=this.constructQueryStatesParams()),this.navigate(r)}return P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,o),this.typeaheadField.blur(),this.typeaheadField.abortSearch(),!1},constructSingleQueryStateParam:function(e){var t="";return"typed"===e.type||"hashtag"===e.type||"typo_auto_original"===e.type?t+=e.term+"|"+e.type:"recentsearch"===e.type||"autocomplete"===e.type||"trending"===e.type?t+=e.term+"|"+e.type+"|"+e.index:"guide"===e.type&&(t+=e.term+"|"+e.type+"|"+e.filter_type+"|"+e.index),t},constructQueryStatesParams:function(){var e="";if(this.queryStates.length>0){var t=[];_.each(this.queryStates,function(e){t.push(this.constructSingleQueryStateParam(e))}.bind(this));var o={term_meta:t};this.queryStatesChange&&(o[this.queryStatesChange.action]=this.constructSingleQueryStateParam(this.queryStatesChange),this.queryStatesChange=null),e="&"+$.param(o)}return e},updateQueryStates:function(e,t,o){var n;if("typed"===t||"hashtag"===t||"typo_auto_original"===t)this.queryStates=[],n=this.tokenizeQuery(e),_.each(n,function(e){this.queryStates.push({term:e,type:t})}.bind(this));else if("recent_query"===t)this.queryStates=[],n=this.tokenizeQuery(e),_.each(n,function(e){this.queryStates.push({term:e,type:"recentsearch",index:o})}.bind(this));else if("trending"===t)this.queryStates=[],n=this.tokenizeQuery(e),_.each(n,function(e){this.queryStates.push({term:e,type:"trending",index:o})}.bind(this));else if(_.contains(["query","pin_search","board_search","people_search"],t))this.queryStates=[],n=this.tokenizeQuery(e),_.each(n,function(e){this.queryStates.push({term:e,type:"autocomplete",index:o})}.bind(this));else if("add_refine"===t)this.queryStates.push({term:e,type:"guide",filter_type:"word",index:o}),this.queryStatesChange={action:"add_refine",term:e,type:"guide",filter_type:"word",index:o};else if("remove_refine"===t){var a=_.find(this.queryStates,function(t){return t.term===e});a&&(this.queryStates.splice(_.indexOf(this.queryStates,a),1),a.action="remove_refine",this.queryStatesChange=a)}},onClick:function(){this.focus()},onKeydown:function(e){var t=P.modalManager.get();t.hasModals()||!P.dom.body_is_active&&P.dom.is_active_element(this.$el.find("input")[0])&&e.keyCode===P.util.keyCode.TAB&&(this.typeaheadField.isFocussed()?this.typeaheadField.blur():this.typeaheadField.focus(),e.preventDefault())}}),P.modules.SearchForm.prototype.className="SearchForm",goog.provide("P.modules.SocialTypeaheadField"),goog.require("P.modules.TypeaheadField"),goog.require("P.string"),goog.require("P.SocialConnect"),P.modules.SocialTypeaheadField=P.modules.TypeaheadField.extend({onCreated:function(){P.modules.TypeaheadField.prototype.onCreated.apply(this),this.allowedSocialNetworks=this.options.allowed_social_networks||this.DEFAULT_ALLOWED_SOCIAL_NETWORKS,this._updateNetworks()},DEFAULT_ALLOWED_SOCIAL_NETWORKS:[P.SocialConnect.FACEBOOK,P.SocialConnect.TWITTER,P.SocialConnect.GPLUS,P.SocialConnect.YAHOO],onContentReady:function(){P.modules.TypeaheadField.prototype.onContentReady.apply(this),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.updateTypeaheadStaticItems),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),P.pubSub.instance.subscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED,function(){this._updateNetworks(),this.updateTypeaheadStaticItems(),this.render()}.bind(this))},onItemSelected:function(e){var t=e.data.item,o=t.attributes;o.network&&(this.connectToNetwork(o.network),this.options.bubble_network_item_click||e.stopPropagation())},_updateSocialConnectItems:function(){this._socialConnectItems=_.map(this._networksToConnect,function(e){return{template:"socialConnect",selectable:!0,network:e}})},_updateNetworks:function(){var e=P.user.instance;this._networksToConnect=[];for(var t=0;t<this.allowedSocialNetworks.length;t++){var o=this.allowedSocialNetworks[t];e.get("connected_to_"+o)||e.get(o+"_url")||this._networksToConnect.push(o)}this._updateSocialConnectItems()},updateTypeaheadStaticItems:function(){var e=[];if(this.options.allow_email){var t=this.getValue();if(t){var o=P.string.isEmailAddress(t),n=this.options.email_options||{};n.template||(n.template="emailSelect"),e=[_.extend(n,{selectable:o,email:t,is_valid:o})]}}var a=e.concat(this._socialConnectItems);this.setAppendedStaticItems(a)},_markNetworkAsConnected:function(e){this._networksToConnect=_.without(this._networksToConnect,e),this._updateSocialConnectItems(),this.updateTypeaheadStaticItems(),this.render()},connectToNetwork:function(e){var t={success:function(){this._markNetworkAsConnected(e)}.bind(this)};P.SocialNetworkSettingsManager.instance().handleConnect(e,!0,t)}}),P.modules.SocialTypeaheadField.prototype.className="SocialTypeaheadField",goog.provide("P.modules.UserBoards"),goog.require("P.Module"),goog.require("P.modules.Board"),goog.require("P.modules.BoardCreateRep"),goog.require("P.ga"),goog.require("P.resourceFactory");var sn=P.CONST.BOARD_PRIVACY_SECRET,ln="publicBoardsGrid",un="secretBoardsGrid";P.modules.UserBoards=P.Module.extend({onContentReady:function(){var e={};e[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onBoardCreated,e[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,e[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,this.extraData.isOwnProfile&&(e[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,this.initializeBoardsSortManager(ln),this.initializeBoardsSortManager(un),this.setupMessageHandlers()),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,e)},onBoardCreated:function(e,t,o){var n=o,a=n.id,r=n.privacy,i=r===sn?un:ln,s=this.getChildById(i),l=new P.modules.Board({options:{show_board_context:!1},resource:{name:"BoardResource",options:{board_id:a}}});s.items.appendChild(l),l.render(),s.forceDragState()},onBoardDeleted:function(e,t,o){},onBoardUpdated:function(e,t,o){o===P.CONST.PUBSUB_MESSAGE_BOARD_PRIVACY_CHANGED&&this.render()},onBoardRemovedSelf:function(e,t,o){this.render()},addCreateBoardRep:function(e,t,o){if(!o.items.getChildById(e)){var n=new P.modules.BoardCreateRep({id:e,options:{secret:t===sn}});n.render().then(function(){o.items.appendChild(n)})}},initializeBoardsSortManager:function(e){var t=this.getChildById(e),o={cancel:".BoardCreateRep",over:function(e,t){var o=30,n=$(window).scrollTop(),a=t.offset.top-n,r=t.item.height(),i=0>a,s=a>P.Viewport.height-r;s&&(o*=-1),(i||s)&&$(window).scrollTop(n-o)},update:function(t,o){this.onBoardsSortUpdate(t,o,e)}.bind(this)};t.setDragState(t.DRAGGING_DISABLED),t.items.initializeSortManager(o,"Board",function(e){return e.data&&e.data.id})},onBoardsSortUpdate:function(e,t,o){var n=this.getChildById(o);this.saveBoardOrder(n.items.getSortOrder())},saveBoardOrder:function(e){var t="BoardsReorderResource",o={board_ids:e},n=P.resourceFactory.instance.create(t,o),a="user_boards_reorder";n.callUpdate({showError:!1}).then(function(){P.ga.trackEvent(a,P.CONST.GA_ACTION_SUCCESS)},function(){P.ga.trackEvent(a,P.CONST.GA_ACTION_ERROR)})},setupMessageHandlers:function(){var e=[this.getChildById(ln),this.getChildById(un)],t={};t[P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN]=this.handleConversationOpen.bind(this,e),t[P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED]=this.handleConversationClosed.bind(this,e),t[P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS]=this.handleConversationClosed.bind(this,e),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,t),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onItemsRequestSuccess.bind(this,e))},handleConversationOpen:function(e){e.forEach(function(e){e.setDragState(e.DRAGGING_ENABLED)})},handleConversationClosed:function(e){e.forEach(function(e){e.setDragState(e.DRAGGING_DISABLED)})},onItemsRequestSuccess:function(e){e.forEach(function(e){e.forceDragState()})}}),P.modules.UserBoards.prototype.className="UserBoards",goog.provide("P.modules.ActiveConversations"),goog.require("P.conversationsManager"),goog.require("P.Module"),goog.require("P.modules.Conversation"),P.modules.ActiveConversations=P.Module.extend({getConversationHeads:function(){return this.$(".ConversationHead")},openConversation:function(e){P.conversationsManager.instance.openConversation(e)},closeConversation:function(e){P.conversationsManager.instance.closeConversation(e)},scaleConversationDownAndRemove:function(e){P.conversationsManager.instance.scaleConversationDownAndRemove(e)},getConversationsManager:function(){return P.conversationsManager.instance}}),P.modules.ActiveConversations.prototype.className="ActiveConversations",goog.provide("P.modules.AddAPlace"),goog.require("P.Module"),goog.require("P.modules.Pinnable"),goog.require("P.modules.GridItems"),goog.require("P.moduleFactory"),goog.require("P.util"),goog.require("P.i18n"),goog.require("P.errorUtil");var dn="pinitButton";P.modules.AddAPlace=P.Module.extend({events:{"keyup .description":"onDescriptionKeyup"},CssClassName:{ERROR:"error",HAS_ERROR:"hasError",VISIBLE:"visible"},onDescriptionKeyup:function(e){this._enableIfReady()},onContentReady:function(){if(this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.childListen(P.CONST.EVENT_PLACE_IMAGE_SELECTED,this.onPlaceImageSelected),P.util.scrollbarWidth()>0){var e=this.getChildById("images");if(e){var t=e.getGridItems();t&&t.setHasScroll(!0)}}},setPlace:function(e){this.place=e},onUploadSuccess:function(e){var t=e.data.image_url;this.setImage(t);var o={name:"Pinnable",options:{url:t,view_type:"add_to_map"}};P.moduleFactory.load(o).then(function(e){var t=e;e.render().then(function(){var o=this.getGridItems();o.prependChildItem(e);var n=this.getImages();_.each(n,function(e){e.deselect()}),t.select(),this._enableIfReady()}.bind(this))}.bind(this))},getGridItems:function(){var e=this.getChildById("images").getGridItems();return e},setImage:function(e){this._image=e},onButtonClick:function(e){var t=e.target;if(t.id===dn){e.stopPropagation();var o=this._image;if(!o)return void P.errorUtil.showError(P.i18n._("Please pick an image for this pin."));this._enableIfReady()&&(t.showLoading(),this.triggerEvent(P.CONST.EVENT_PINIT_BUTTON_CLICKED,o,!0))}},_enableIfReady:function(){var e=this.getChildById(dn),t=this.hasValidDescription();return t?(this.removeErrorState(),this._image?(this.removeErrorState(),e.enable(),!0):!1):(this.addErrorState(),!1)},onPlaceImageSelected:function(e){var t=this.getImages();_.each(t,function(e){e.deselect()});var o=e.data;this._image=o,this._enableIfReady(),this.focus()},onAddedToDom:function(){this.focus()},focus:function(){this.$(".description").focus()},addErrorState:function(){this._setDescriptionError(!0),this.focus()},_setDescriptionError:function(e){this.$(".description").toggleClass(this.CssClassName.HAS_ERROR,e),this.$(".descriptionLabel").toggleClass(this.CssClassName.ERROR,e),this.$(".required").toggleClass(this.CssClassName.VISIBLE,e)},removeErrorState:function(){this._setDescriptionError(!1)},getImages:function(){var e=this.getChildById("images").getGridItems(),t=e.children;return t},hasValidDescription:function(){var e=this.$(".description");return!!e.val().length}}),P.modules.AddAPlace.prototype.className="AddAPlace",goog.provide("P.modules.BoardPage"),goog.require("P.Module"),goog.require("P.modules.AddPinToMap"),goog.require("P.modules.BoardCollaboratorInviter"),goog.require("P.modules.GroupBoardInviteLanding"),goog.require("P.modules.InviteModal"),goog.require("P.modules.PinCreate"),goog.require("P.Sticky"),goog.require("P.unauthUsage"),goog.require("P.util"),goog.require("P.modalManager"),goog.require("P.ga"),goog.require("P.timer"),goog.require("P.experienceUtil"),goog.require("P.context.instanceEvent"),goog.require("P.genConst"),goog.require("P.app"),goog.require("P.MarkerOptions"),goog.require("P.resourceFactory");var cn="addToMap",pn=["description","privacy"],mn=300,hn=220,gn="toggleView",_n=400,fn=200,bn=1500,kn="linear",yn="cubic-bezier(.19, 1, .48, 1)",vn="cubic-bezier(.29, 0, .29, 1)",Pn="cubic-bezier(.19, 1, .48, 1)",wn=250,Tn="touchmove.placePinsBoard",Ln="paddingTop";P.modules.BoardPage=P.Module.extend({events:{click:"onClick"},CssClassName:{CENTERED_WITHIN_WRAPPER:"centeredWithinWrapper",DROP_PREVIEW:"dropPreview",GRID_ROW_LAYOUT:"rowLayout",GRID_VARIABLE_HEIGHT:"variableHeightLayout",FADE:"fade",HAS_FOOTER:"hasFooter",HIDDEN:"hidden",MAP_HIDE:"hideMap",MAP_SHOW:"showMap",MAP_VIEW:"mapView",NUB_VISIBLE:"visible",PAD_ITEMS:"padItems",POSITION_ADD_PIN_REP:"positionAddPinRep",UI_STATE_CONVERSATION:"ui-state-conversation"},isPlaceBoard:function(){var e=this.data;return e?e.layout===P.CONST.BOARD_LAYOUT_PLACES:!1},isDesktopPlaceBoard:function(){return this.isPlaceBoard()&&!P.context.instance.is_mobile_agent},onCreated:function(){this.map=null,this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady),this._pinCountForMap=0,this._pinCountTotal=0,this._onPrependedToMapBoard=this._onPrependedToMapBoard.bind(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.isDesktopPlaceBoard()&&this.alignHeaderToMap()},addTutorials:function(){var e;e=this.isPlaceBoard()&&this.extraData.canEdit?_.isEmpty(this.getPins())?P.genConst.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER:P.genConst.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER:P.genConst.Placement.WEB_BOARD_TAKEOVER,P.experienceUtil.launchPlacedExperience(e,{board_id:this.data.id})},getGrid:function(){return this.getChildById("grid")},getBoardHeader:function(){return this.getChildById("boardHeader")},getBoardInfoBar:function(){return this.getBoardHeader().getChildById("boardInfoBar")},getBoardTitleHeight:function(){return this.$(".boardHeaderWrapper").height()},getMapControlButtons:function(){return this.$(".mapControlButtons, .leaflet-control-container")},showMapButtonsIfPossible:function(){this.showAddToMapButtonIfPossible(),this.showToggleViewButtonIfPossible(),this.showAddPinRepWithPlaceIfPossible()},showAddToMapButtonIfPossible:function(){var e=this._getAddToMapButton();e&&e.getContent().show().animate({opacity:1})},showToggleViewButtonIfPossible:function(){var e=this._getToggleViewButton();e&&e.getContent().show()},showAddPinRepWithPlaceIfPossible:function(){var e=this.$(".AddPinRepWithPlace");e&&e.css("pointer-events","auto")},addMarkersToMap:function(){var e=this.getPins();this._pinCountForMap=e.length;var t=_.filter(e,function(e){return e.getCoordinates&&null!==e.getCoordinates()}),o=t.length>0;this._pinCountForMap&&o&&(this.map.addMarkersToMap(e),this.map.fitViewToPinMarkers())},getPins:function(){var e=this.getGrid();if(!e)return[];var t=e.getGridItemsChildren();return t.length?t:[]},getPinCount:function(){return this.getPins().length},_getAddToMapButton:function(){return this.getChildById(cn)},_getToggleViewButton:function(){return this.getChildById(gn)},onMapReady:function(e){this.showMapButtonsIfPossible(),this.setMapPaddingTopLeft(),this.addMarkersToMap(),this.isDesktopPlaceBoard()&&(this._lockMapControls(),this.alignHeaderToMap(),this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize))},onPinContentChanged:function(e){var t=e.target;this.isDesktopPlaceBoard()&&this.inMapViewMode&&(t.getPlaceData()?(this.reconfigurePin(t,this.CssClassName.GRID_ROW_LAYOUT),t.focusPlacePin()):(t.unfocusPlacePin(),t.getContent().addClass(this.CssClassName.HIDDEN),this.repositionGrid()))},onResize:function(){if(this.inMapViewMode){var e=this.map.getContent(),t=this.getMapHeightInMapViewMode(),o=this.$(".gridContainer");e.css("height",t),o.css("width",this.getGrid().$el.width()),this.getGrid().updateNavigators(),this.setMapPaddingTopLeft(),this.map.resizeMap()}},onScroll:function(){if(this.isDesktopPlaceBoard()&&!this.inMapViewMode&&!this.inTransition){var e=this.getScrollableElement().scrollTop();if(400>=e){var t=mn,o=1-e/t,n=.35*e,a=this.map.getContent();a.css({opacity:o,y:n})}}},getLoggingObjectIdStr:function(){return this.data.id},addPermanentMarkerFromTypeahead:function(e){this.map.clearPlaceholderMarkers(),this.addPermanentMarkerToMap(e),this.hideMapModal()},addPermanentMarkerToMap:function(e){e=e.data,e.highlighted=!0,e.animated=!0,e.placeholder=!1,e=this._generateMapMarkerData(e),this.map.addPermanentMarker(e)},onSetPlaceholderMarkers:function(e){var t=e.data,o=t.markerOptionsList;o=_.compact(o),_.each(o,function(e){e.placeholder=!0,e.highlighted=!1,e.animated=!1});var n=_.map(o,function(e){return this._generateMapMarkerData(e)}.bind(this));this.map.setPlaceholderMarkers(n,!1)},onHighlightPlaceholderMarker:function(e){var t=e.data.index;this.map.clearPlaceholderHighlights(),this.map.highlightPlaceholderMarker(t)},onClearHighlightedPlaceholderMarkerHighlight:function(e){this.map.clearPlaceholderHighlights()},onClearPlaceholderMarkers:function(){this.map.clearPlaceholderMarkers()},_generateMapMarkerData:function(e){var t=e.pin||this.getPinToAddToMap(),o=[e.latitude,e.longitude],n=e.id,a={pin:t,coordinates:o,id:n},r=_.extend(a,e);return r},updateDom:function(){var e=0===this._pinCountTotal;this.$(".EmptyStateCardBoard").toggleClass(this.CssClassName.HIDDEN,!e),this.$(".Grid").toggleClass(this.CssClassName.HIDDEN,e),1===this._pinCountTotal?this.getGrid().show():0===this._pinCountTotal&&this.getGrid().hide()},onRemovedFromDom:function(){P.context.instance.is_mobile_agent?this._detachTouchmoveListener():this.isPlaceBoard()&&(this.hideMapModal(),this.map.clearMarkers(),this.getPins().forEach(function(e){e.data&&e.resetShowOnMapButton()}))},_getPinByPinId:function(e){for(var t=this.getPins(),o,n=0,a=t.length;a>n;++n)if(o=t[n],o.data&&o.getId()===e)return o;return null},onMapPopupOpened:function(e){var t=e.data,o=this._getPinByPinId(t);o.scrollIntoView(),this.map.highlightMarkerForPinId(t)},onContentReady:function(){var e={};if(this.map=this.getChildById("map"),this.userAgentPlatform=this.extraData.userAgentPlatform,this.extraData.show_invite_modal){var t=this.extraData.invite_type,o;switch(t){case"reminder_1":P.Invite.trackInviteFunnelAction("recipient_invite_reminder1_landing",!0),o="user";break;case"reminder_2":P.Invite.trackInviteFunnelAction("recipient_invite_reminder2_landing",!0),o="user";break;case"user":P.Invite.trackInviteFunnelAction("recipient_invite_landing",!0),P.Invite.trackInviteFunnelAction("invite_landing"),o="user";break;default:case"board":P.util.trackRegisterAction("board_invite_landing"),o="board"}if("board"!==o||this.userAgentPlatform!==P.CONST.USER_AGENT_PLATFORM_ANDROID&&this.userAgentPlatform!==P.CONST.USER_AGENT_PLATFORM_IOS)P.modules.InviteModal.showInviteModal(this.options.inviter_user_id,o);else{var n=P.experiments.instance.v2ActivateExperiment("new_gb_landing"),a=-1!==$.inArray(n,["enabled","employees"]);a?P.modules.GroupBoardInviteLanding.showBoardRepModal(this.data.id,this.options.inviter_user_id,this.options.invite_code):P.modules.InviteModal.showInviteModal(this.options.inviter_user_id,o)}}P.user.instance.isAuthenticated()?this.options.board_collab_inviter&&this.showBoardCollaboratorInviterModal():(Cookie.set(P.CONST.COOKIE_LAST_UNAUTH_BOARD_ID,this.data.id),P.unauthUsage.logUrl()),this.data.id&&(e={},e[P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR]=this.onBannedUser,e[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,e[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,e[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,e[P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED]=this.onBoardWriteAccessUpdated,e[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onPinAdded,e[P.CONST.PUBSUB_TOPIC_BULK_PINS_CREATED]=this.onBulkPinsAdded,e[P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD]=this.onPrependNewPinMapBoard,e[P.CONST.PUBSUB_TOPIC_PIN_FLAGGED]=this.onPinFlagged,this.pubsubSubscribe(this.data.id,e));var r={};if(r[P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT]=this.toggleBulkEditMode,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_BULK_EDIT,r),this.childListen(P.CONST.EVENT_PIN_UPDATED,this.onChildPinUpdated),this.childListen(P.CONST.EVENT_PIN_DELETED,this.onPinDeleted),this.childListen(P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON,this.resetShowPinOnMapButtonStates),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onChildItemsAddedToGrid),this.map&&(this.childListen(P.CONST.EVENT_MAP_CLICK,this.onMapClick),this.childListen(P.CONST.EVENT_MAP_CLUSTER_CLICK,this.onClusterClick),P.context.instance.is_mobile_agent?(this.childListen(P.CONST.EVENT_MAP_POPUP_OPENED,this.onPopupOpened),e={},this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e)):(this.attachHoverListeners(),this.childListen(P.CONST.EVENT_PIN_PLACE_CLICK,this.onPinPlaceClick),this.childListen(P.CONST.EVENT_MAP_POPUP_OPENED,this.onMapPopupOpened),this.childListen(P.CONST.EVENT_PIN_MOUSE_IN,this.onPinMouseIn),this.childListen(P.CONST.EVENT_PIN_MOUSE_OUT,this.onPinMouseOut),this.childListen(P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP,this.onPinAddToMapCachePinId),this.childListen(P.CONST.EVENT_MODAL,this.onPlaceBoardModal))),this.options.show_edit&&(this.extraData.canEdit&&this.showEditModal(),delete this.options.show_edit),this.extraData&&this.extraData.canEdit&&P.experiments.instance.v2InGroup("rearrange_pins_internal","employees")&&this._initializePinsRearrangeManagers(),this.isPlaceBoard()&&!this.isDesktopPlaceBoard()&&(this._sticky=new P.Sticky(this.$(".addPinToMapButton"),{$boundTo:this.$el,$scrollable:this.getScrollableElement(),headerHeight:$(".Header").height()})),_.defer(this.addTutorials.bind(this)),this.inBulkEditMode=!1,this.numPinsFlagged=0,this._pinCountTotal=this.data.pin_count,this.isDesktopPlaceBoard()){var i=_.throttle(this.onScroll,16);this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,i),this.inTransition=!1,this.currentlyFocusedPin=null,this._setMapView(!1),this.childListen(P.CONST.EVENT_PIN_CONTENT_CHANGED,this.onPinContentChanged),this.childListen(P.CONST.EVENT_PIN_PLACE_ADDED,this.onPinPlaceAdded),this.childListen(P.CONST.EVENT_ROW_ITEM_DEACTIVATED,this.onRowPlacePinDeactivated),this.childListen(P.CONST.EVENT_SCROLL_GRID_TO_ITEM_END,this.onScrollToGridItemEnd)}if(!this.data.pin_count){var s={event_type:P.genConst.EventType.VIEW,view_type:P.genConst.ViewType.EMPTY_STATE,view_parameter:P.genConst.ViewParameterType.BOARD_EMPTY},l=P.context.instanceEvent.fromPlainObject(s);P.context.instanceLogger.getInstance().addEvent(l)}},_initializePinsRearrangeManagers:function(){var e=this,t=this.getGrid();if(t){var o="addPinRep",n=e.getGrid().items.getChildById(o),a={drop:function(t,o){e._onPinRearrangeDroppableDrop(o,$(this))},over:function(t,o){e._onPinRearrangeDroppableOver(o,$(this))},out:function(t,o){e._onPinRearrangeDroppableOut($(this))}};t.setDragState(t.DRAGGING_ENABLED),t.items.initializeDropManager(a),n&&(t.items.disableDraggingForChildModule(n),t.items.disableDroppingForChildModule(n))}},_onPinRearrangeDroppableDrop:function(e,t){var o=e.draggable,n=this.getGrid().items.getChildByElement(o.find(".Pin")),a=this.getGrid().items.getChildByElement(t.find(".Pin"));t.removeClass(this.CssClassName.DROP_PREVIEW),t.transition({paddingLeft:0,easing:Pn,duration:230}),e.helper.hasClass(this.CssClassName.UI_STATE_CONVERSATION)||this.splicePinOrder(n,a);
},_onPinRearrangeDroppableOver:function(e,t){e.helper.hasClass(this.CssClassName.UI_STATE_CONVERSATION)||(t.addClass(this.CssClassName.DROP_PREVIEW),t.transition({paddingLeft:25,easing:Pn,duration:230}))},_onPinRearrangeDroppableOut:function(e){e.removeClass(this.CssClassName.DROP_PREVIEW),e.transition({paddingLeft:0,easing:Pn,duration:230})},splicePinOrder:function(e,t){var o="SplicePinResource",n={board_id:this.data.id,source_pin:e.getId(),target_pin:t.getId()},a=P.resourceFactory.instance.create(o,n),r="board_pins_reorder";a.callUpdate().then(function(){P.ga.trackEvent(r,P.CONST.GA_ACTION_SUCCESS),this.getGrid().items.reorderChildModule(e,t)}.bind(this),function(){P.ga.trackEvent(r,P.CONST.GA_ACTION_ERROR)})},showBoardCollaboratorInviterModal:function(){var e=new P.modules.BoardCollaboratorInviter({options:{},resource:{name:"BoardResource",options:{board_id:this.data.id}}});this.showInModal(e)},toggleBulkEditMode:function(e,t,o){(o===P.CONST.ENTER_BULK_EDIT&&!this.inBulkEditMode||o===P.CONST.EXIT_BULK_EDIT&&this.inBulkEditMode)&&(this.inBulkEditMode=!this.inBulkEditMode,this.getPins().forEach(function(e){e.data&&P.pubSub.instance.publish(e.data.id,P.CONST.PUBSUB_TOPIC_TOGGLE_BULK_EDIT,o)}))},onPlaceBoardModal:function(e){var t=e.data.module;"AddPinToMap"===t.className&&(this.listen(t,P.CONST.EVENT_MODAL_ANIMATE_SHOW_START,this.onAddPinToMapBeginShowing),this.listen(t,P.CONST.EVENT_MODAL_ANIMATE_SHOW_END,this.onAddPinToMapEndShowing),this.listen(t,P.CONST.EVENT_MODAL_ANIMATE_HIDE_START,this.onAddPinToMapBeginHiding),this.listen(t,P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.listen(t,P.CONST.EVENT_CENTER_MAP_GEO_FEATURE,this.onCenterMapGeoFeature),this.listen(t,P.CONST.EVENT_BUTTON_CLICK,this.onModalButtonClick),this.listen(t,P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD,this.addPermanentMarkerFromTypeahead),this.listen(t,P.CONST.EVENT_PLACE_SELECTED,this.onPlaceSelected),this.listen(t,P.CONST.EVENT_SET_PLACEHOLDER_MARKERS,this.onSetPlaceholderMarkers),this.listen(t,P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER,this.onHighlightPlaceholderMarker),this.listen(t,P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,this.onClearHighlightedPlaceholderMarkerHighlight),this.listen(t,P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,this.onClearPlaceholderMarkers),this.listen(t,P.CONST.EVENT_TYPEAHEAD_SEARCH_WORLD,this.onSearchGlobally))},onButtonClick:function(e){var t=e.target;t.id===gn&&this._toggleBoardView()},onModalButtonClick:function(e){var t=e.target;"wrongPlace"===t.id?this._place=null:t.id===cn&&this.disablePinsAndButton()},_setMapView:function(e){this.inMapViewMode=e},_toggleBoardView:function(){this.inMapViewMode?this._switchBoardViewTo("board"):this._switchBoardViewTo("map")},_switchBoardViewTo:function(e){if(!this.inTransition){this.inTransition=!0,this._changeCurrentlyFocusedPin(null);var t,o,n;"map"===e?(n=this.CssClassName.GRID_ROW_LAYOUT,t=this._maximizeMapStartAnimation.bind(this),o=this._maximizeMapEndAnimation.bind(this)):(n=this.CssClassName.GRID_VARIABLE_HEIGHT,t=this._minimizeMapStartAnimation.bind(this),o=this._minimizeMapEndAnimation.bind(this));var a=this;return new Promise(function(r,i){a.disablePinsAndButton(),a._scrollToTopAndClearMapEffects().then(function(){t().then(function(){a._getToggleViewButton().showLoading(),a.getGrid().hide(),a._switchGridViewTo(n),o().then(function(){a._getToggleViewButton().hideLoading(),a._setMapView("map"===e),a.enablePinsAndButton(),a.inTransition=!1,r(void 0)})})})})}},_scrollToTopAndClearMapEffects:function(){return new Promise(function(e,t){var o=this.map.getContent(),n=[];n.push(o.transition({opacity:1,y:0,duration:fn}));var a=Math.round(this.scrollY/6)+1;n.push(P.util.scrollToTop({newScrollOffset:0,duration:a})),$.when.apply($,n).done(function(){e(void 0)})}.bind(this))},_switchGridViewTo:function(e){var t=e===this.CssClassName.GRID_ROW_LAYOUT,o=this.getGrid(),n=o.getContent(),a=o.getGridItems(),r=a.getContent();n.toggleClass(this.CssClassName.GRID_ROW_LAYOUT,t),n.toggleClass(this.CssClassName.HAS_FOOTER,!t),r.toggleClass(this.CssClassName.PAD_ITEMS,!t),r.toggleClass(this.CssClassName.CENTERED_WITHIN_WRAPPER,!t),this._pinCountTotal>0&&o.show(),this.reconfigurePins(e),this.switchGridLayout(e)},switchGridLayout:function(e){var t=e===this.CssClassName.GRID_ROW_LAYOUT,o=this.getGrid(),n=o.getGridItems(),a=n.$el,r=this.$(".gridContainer");a.toggleClass(this.CssClassName.GRID_ROW_LAYOUT,t),a.toggleClass(this.CssClassName.GRID_VARIABLE_HEIGHT,!t),this.$el.addClass(this.CssClassName.POSITION_ADD_PIN_REP),n.switchLayoutManager(e),this.$el.removeClass(this.CssClassName.POSITION_ADD_PIN_REP),t?(o.attachRowSliderScrollListener(),o.increaseRowContainerHeight(100),r.css({position:"absolute",width:o.$el.width()})):(r.css({position:"",width:""}),P.user.instance.isAuthenticated()||o.attachScrollListener(),o.resetRowContainerHeight())},reconfigurePins:function(e){this.getPins().forEach(function(t){this.reconfigurePin(t,e)}.bind(this))},reconfigurePin:function(e,t){var o=t===this.CssClassName.GRID_ROW_LAYOUT?!0:!1,n=t===this.CssClassName.GRID_ROW_LAYOUT?"TOP_CENTER":"BOTTOM_CENTER";e.data&&(e.configurePlacePinMode(o),e.updateSendPinDropdownPosition(n))},_maximizeMapStartAnimation:function(){var e=this;return new Promise(function(t,o){var n=e.map.getContent(),a=e.$(".transformWrapper"),r=P.Viewport.height-n.offset().top;e.map.zoomIntoBounds(),n.css("height",r),e.map.resizeMap(),a.css("y",mn-r),a.transition({y:e.getBoardTitleHeight(),duration:_n},function(){e.collapseBoardInfoBar(n.offset().top),e.$el.addClass(e.CssClassName.MAP_VIEW),a.css("top",""),a.css("transform",""),t(void 0)})})},_maximizeMapEndAnimation:function(){var e=this;return new Promise(function(t,o){var n=e.map.getContent(),a=e.getGrid().getContent(),r=e.getMapHeightInMapViewMode();a.transition({y:-a.height(),easing:vn,duration:fn},function(){n.css("height",r),e.map.resizeMap(),a.css("transform",""),e._unlockMapControls(),t(void 0)})})},_minimizeMapStartAnimation:function(){var e=this;return new Promise(function(t,o){var n=e.map.getContent(),a=e.getGrid().getContent(),r=P.Viewport.height-n.offset().top;n.css("height",r),a.css("y",-a.height()),a.transition({y:0,easing:vn,duration:_n},function(){a.css("transform",""),t(void 0)})})},_minimizeMapEndAnimation:function(){var e=this;return new Promise(function(t,o){var n=e.map.getContent(),a=e.$(".transformWrapper"),r=e.getBoardInfoBar().getContent(),i=e.$(".smallBoardName");e._lockMapControls();var s=[];s.push(i.transition({y:0,easing:kn,duration:fn})),s.push(r.transition({y:-r.height(),easing:kn,duration:fn})),$.when.apply($,s).done(function(){e.$el.removeClass(e.CssClassName.MAP_VIEW),r.css("y",0),e.expandBoardInfoBar(),e.map.zoomOutOfBounds(mn);var o=e.getBoardTitleHeight();a.transition({y:mn-n.height(),easing:yn,duration:_n},function(){n.css("height",mn),a.css({transform:"",top:-o}),t(void 0)})})})},collapseBoardInfoBar:function(e){this.getBoardInfoBar().setCollapsible(!1),this.getBoardInfoBar().collapse(e)},expandBoardInfoBar:function(){this.getBoardInfoBar().setCollapsible(!0),this.getBoardInfoBar().expand()},_lockMapControls:function(){this.map.disableMapControls()},_unlockMapControls:function(){this.map.enableMapControls()},onBoardWriteAccessUpdated:function(e){this.renderHeader()},getMapHeightInMapViewMode:function(){var e=this.map.getContent(),t=P.Viewport.height-e.offset().top,o=t-hn;return o},_removePinFromMap:function(e){if(this.map){var t=e.getId();this.map.removeMarkerForPinId(t)}},onPinDeleted:function(e){if(P.context.instance.is_mobile_agent||this.renderHeader(),this.map){var t=e.data;this.isDesktopPlaceBoard()&&this.inMapViewMode&&(t.getContent().addClass(this.CssClassName.HIDDEN),this.repositionGrid()),this._removePinFromMap(t)}this._decrementPinCount()},onCenterMapGeoFeature:function(e){var t=e.data,o=this.map.getCityBoundsFromCenter(t);this.map.fitBounds(o)},onPinFlagged:function(){this.numPinsFlagged+=1},getNumPinsFlagged:function(){return this.numPinsFlagged},onSearchGlobally:function(e){this._searchingGlobally=!0,this.map.fitWorld()},onCitySelected:function(e){var t=e.data;this._city=t;var o,n;t.bounds?n=t.bounds:o=t.latLng,n||(n=this.getCityBoundsFromCenter(o)),this.map.fitBounds(n)},makeLatLngBoundsFromLatLngAndPadding:function(e,t){var o=L.latLng(e.lat-t,e.lng-t),n=L.latLng(e.lat+t,e.lng+t);return L.latLngBounds(o,n)},getCityBoundsFromCenter:function(e){var t=.05;return this.makeLatLngBoundsFromLatLngAndPadding(e,t)},onTypeaheadNoResultsReturned:function(e){this.map&&this.map.clearPlaceholderMarkers()},onPlaceSelected:function(e){var t=e.data.index;this.map.showOnlyPlaceholderMarkerAtIndex(t),this._place=e.data},onPlaceholderMarkerOpened:function(e){var t=e.data.place_id,o=e.data.index,n=this.data.id;P.pubSub.instance.publish(n,P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED,{place_id:t}),this.map.highlightPlaceholderMarker(o)},disablePinsAndButton:function(){this._setPinsAndButtonEnabled(!1)},enablePinsAndButton:function(){this._setPinsAndButtonEnabled(!0)},_setPinsAndButtonEnabled:function(e){var t=this.$(".locationBoardPageContentWrapper, .locationBoardContentWrapperBackground, .addAPlace"),o=this.map.getAttributionElement(),n,a=P.app.instance._getScrollToTopModule();a&&(n=a.$el),t=t.add(o),a&&(n.length&&(t=t.add(n)),t.toggleClass(this.CssClassName.FADE,!e))},toggleMapControlButtonsFade:function(){this.getMapControlButtons().fadeToggle(fn)},setMapPaddingTopLeft:function(){var e,t;if(P.context.instance.is_mobile_agent){var o=P.app.instance.getHeader();if(!o)return;e=o.getHeight()+P.CONST.PIN_MARGIN/2,t=L.point(0,e),this.map.setPaddingTopLeft(t)}else if(this.isDesktopPlaceBoard()&&!this.inMapViewMode)t=L.point(0,100);else{var n=this._getAddToMapButton(),a;this.isDesktopPlaceBoard()||n||(a=this.getGrid());var r=a||n;if(!r)return;var i=r.getOffset(),s=r.getPosition(),l=r.getWidth()+i.left+s.left;e=100,t=L.point(l,e),this.map.setPaddingTopLeft(t)}},hideMapModal:function(){P.modalManager.get().removeTopModal()},alignHeaderToMap:function(){var e=this.$(".transformWrapper"),t=this.getBoardTitleHeight();e.css("top",-t)},_onPrependedToMapBoard:function(){var e=this.getPins()[0];e.data||(e=this.getPins()[1]);var t=this._markerToPrepend;t.pin=e,this.addPermanentMarkerFromTypeahead({data:t}),this.isDesktopPlaceBoard()&&this.inMapViewMode&&this.reconfigurePin(e,this.CssClassName.GRID_ROW_LAYOUT)},onPrependNewPinMapBoard:function(e,t,o){this._markerToPrepend=o.marker,this.hideMapModal(),P.modules.PinCreate.prototype.triggerCommonPinCreateEvents(this,o.pin,{isRepin:!1,gridPrependCallback:this._onPrependedToMapBoard})},onPinMouseOut:function(e){var t=e.data;this.currentlyFocusedPin&&this.currentlyFocusedPin.getId()===t||this.map.unHighlightMarkerForPinId(t)},onPinMouseIn:function(e){var t=e.data;this.map.highlightMarkerForPinId(t)},onPinPlaceClick:function(e){var t=e.data;this.isDesktopPlaceBoard()?this.inMapViewMode?this._changeCurrentlyFocusedPin(t):this._switchBoardViewTo("map").then(function(){this._changeCurrentlyFocusedPin(t)}.bind(this)):this.map.highlightMarkerForPinId(t),this.map.openPopupForPin(t)},onPinPlaceAdded:function(e){if(this.inMapViewMode)this.onPinPlaceClick(e);else{var t=e.data;this.map.highlightMarkerForPinId(t),P.timer.setTimeout(function(){this.map.unHighlightMarkerForPinId(t)}.bind(this),bn)}},repositionGrid:function(){this.getGrid().getGridItems().positionGrid()},_changeCurrentlyFocusedPin:function(e){var t=this._getPinByPinId(e);if(this.currentlyFocusedPin!==t){var o=this.currentlyFocusedPin;if(o){var n=o.getId();o.unfocusPlacePin(),this.map.unHighlightMarkerForPinId(n)}t&&(this.getGrid().scrollToItem(t),this.map.zoomToAndHighlightMarkerForPinId(e)),this.currentlyFocusedPin=t}},onScrollToGridItemEnd:function(e){var t=e.data;t.focusPlacePin()},onAddPinToMapBeginShowing:function(e){var t=e.target;this.configureAddPinToMapModal(t),this.disablePinsAndButton(),this.map.toggleTranslucentMarkers(!0),this.detachHoverListeners(),this.map.closeAllMarkerPopups(),this.attachHoverListeners(),this.isDesktopPlaceBoard()&&(this._changeCurrentlyFocusedPin(null),this._scrollToTopAndClearMapEffects().then(function(){var e=this.$(".transformWrapper"),t=this.map.getContent(),o=this.getGrid().getContent(),n=P.Viewport.height-t.offset().top;t.css("height",n),this.map.resizeMap(),this.inMapViewMode?o.css("y",-hn):e.css("y",mn-n),this.toggleMapControlButtonsFade(),e.addClass(this.CssClassName.FADE),P.timer.setTimeout(function(){this.setMapPaddingTopLeft()}.bind(this),200)}.bind(this)))},configureAddPinToMapModal:function(e){this.map.getZoom()>=8?e.center=this.map.getCenter():e.center=null},onRowPlacePinDeactivated:function(e){this._changeCurrentlyFocusedPin(null)},onAddPinToMapEndShowing:function(e){var t=e.target;t.focus(),P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},onAddPinToMapBeginHiding:function(e){if(!this.inTransition){var t=e.target;if(this.isDesktopPlaceBoard()||this.enablePinsAndButton(),this.setPinToAddToMap(null),this.ensureModalChildDropdownsHidden(t),this.map.clearPlaceholderMarkers(),this.detachHoverListeners(),this.map.toggleTranslucentMarkers(!1),this.attachHoverListeners(),this.isDesktopPlaceBoard()){var o=this.$(".transformWrapper"),n=this.map.getContent(),a=this.getGrid().getContent();this.toggleMapControlButtonsFade(),o.removeClass(this.CssClassName.FADE),P.timer.setTimeout(function(){this.setMapPaddingTopLeft();var e=this.inMapViewMode?this.getMapHeightInMapViewMode():mn;n.css("height",e),this.inMapViewMode?a.css("transform","none"):o.css("transform","none"),this.enablePinsAndButton()}.bind(this),200)}}},ensureModalChildDropdownsHidden:function(e){e.hideChildDropdowns()},onPinAddToMapCachePinId:function(e){var t=e&&e.data;this.setPinToAddToMap(t)},getPinToAddToMap:function(){return this._pinToAddToMap},setPinToAddToMap:function(e){this._pinToAddToMap=e},_getPinsWithCoordinates:function(){var e=[];return this.map&&this.getPins().forEach(function(t){if(t.data){var o=t.getCoordinates&&t.getCoordinates();o&&e.push(t)}}),e},detachHoverListeners:function(){this.map&&this._toggleHoverListeners(!1)},_toggleHoverListeners:function(e){var t=this._getPinsWithCoordinates();_.each(t,function(t){var o=t.getCoordinates&&t.getCoordinates();if(o){var n=e?P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER:P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER;t.trigger(n)}})},attachHoverListeners:function(){this.map&&this._toggleHoverListeners(!0)},onRendered:function(){this.isPlaceBoard()&&this.attachHoverListeners(),P.Module.prototype.onRendered()},resetShowPinOnMapButtonStates:function(e){this.isDesktopPlaceBoard()?this._changeCurrentlyFocusedPin(null):this.getPins().forEach(function(e){e.data&&e.resetShowOnMapButton()})},onChildItemsAddedToGrid:function(e){this.map&&(this.attachHoverListeners(),this.updatePinsOnMap()),this.inBulkEditMode&&this.getPins().forEach(function(e){e.data&&e.changePinBulkEditMode(!0)}),this.inMapViewMode&&(this.reconfigurePins(this.CssClassName.GRID_ROW_LAYOUT),this.repositionGrid())},updatePinsOnMap:function(){var e=this._pinCountForMap,t=this.getPins();if(!t)return void(this._pinCountForMap=0);var o=t.length,n=o-e-1;n&&(t=t.slice(e),this.map.addMarkersToMap(t,!0),this._pinCountForMap=o)},onBoardUpdated:function(e,t,o){var n=!1;if(o.url!==this.data.url&&this.inDom)this.data.url=o.url,this.navigate(o.url);else{for(var a=0;a<pn.length;a++){var r=o[pn[a]];"undefined"!=typeof r&&this.data[pn[a]]!==r&&(n=!0,this.data[pn[a]]=r)}n&&this.renderHeader()}o.layout!==this.data.layout&&(this.data.layout=o.layout,o.url===this.data.url?window.location.reload():this.navigate(o.url,this,P.genConst.ForceRefreshType.PAGE))},_setPinCount:function(e){this._pinCountTotal=e,this.updateDom()},_incrementPinCount:function(){this._setPinCount(this._pinCountTotal+1)},_decrementPinCount:function(){this._setPinCount(this._pinCountTotal-1)},_prependGridItem:function(e,t){var o=this.getGrid();o&&(o.prependNewItems(e,t),this._incrementPinCount())},_onPrependedInBulkEdit:function(){var e=this.getPins(),t=e[0].data?e[0]:e[1];t.changePinBulkEditMode(!0)},onPinAdded:function(e,t,o){if(this.inBulkEditMode){var n=this._onPrependedInBulkEdit.bind(this);this._prependGridItem(1,n)}else this._prependGridItem(1,o.gridPrependCallback),this.renderHeader();this.map&&(this.addMarkersToMap(),P.context.instance.is_mobile_agent||(this.detachHoverListeners(),this.attachHoverListeners()),this.isDesktopPlaceBoard()&&this.inMapViewMode&&(this.reconfigurePins(this.CssClassName.GRID_ROW_LAYOUT),this.repositionGrid(),this.getGrid().updateNavigators()))},onBulkPinsAdded:function(){var e=this.getGrid();e.render().then(function(){_.defer(function(){this._setPinCount(),this.isDesktopPlaceBoard()&&this.inMapViewMode&&this._switchGridViewTo(this.CssClassName.GRID_ROW_LAYOUT)}.bind(this))}.bind(this))},onBannedUser:function(e,t,o){this.renderHeader();var n=this.getGrid();n.render()},onBoardDeleted:function(){this.inDom&&this.navigateToUserPage()},navigateToUserPage:function(){var e=this.extraData&&this.extraData.currentUsername,t="/",o=e?t+e+"/":t;this.navigate(o)},getHeader:function(){return this.getChildById("boardHeader")},renderHeader:function(){var e=this.getHeader();this.isDesktopPlaceBoard()&&this.inMapViewMode||e.render().then(function(){this.isDesktopPlaceBoard()&&!this.inMapViewMode&&_.defer(function(){this.alignHeaderToMap()}.bind(this))}.bind(this))},showEditModal:function(){var e=this.getHeader();return e.showEditModal()},onChildPinUpdated:function(e){var t=e.data,o=t.board.id,n=t.place,a=e.target,r=t.id;if(o!==this.data.id)return a.destroy(),void this._removePinFromMap(a);if(!n)return void this._removePinFromMap(a);if(this.map){var i=this.map.getMarkerForPin(r);if(i){var s=i.getLatLng(),l=s.lat,u=s.lng,d=n.latitude,c=n.longitude;if(c!==u||d!==l){this.map.removeMarkerForPinId(r);var p={data:n};p.data.pin=a,this.addPermanentMarkerFromTypeahead(p)}}else{var m={data:n};m.data.pin=a,this.addPermanentMarkerToMap(m)}}},onBoardRemovedSelf:function(e,t,o){this.data.privacy===P.CONST.BOARD_PRIVACY_SECRET&&this.inDom?this.navigateToUserPage():this.renderHeader()},onClick:function(e){if(P.context.instance.is_mobile_agent){var t=!this.$el.hasClass(this.CssClassName.MAP_HIDE);if(!t)return;if(!this.map)return;var o=e.target,n=$(this.map.$el).has(o);n.length||(this.hidePlaceBoardNub(),P.timer.setTimeout(function(){this.$el.addClass(this.CssClassName.MAP_HIDE).removeClass(this.CssClassName.MAP_SHOW).css(Ln,""),P.timer.setTimeout(function(){this.map.closeAllMarkerPopups(),this.map.fitViewToPinMarkers(),this._detachTouchmoveListener()}.bind(this),wn)}.bind(this),250))}},showPlaceBoardNub:function(){this._getNub().addClass(this.CssClassName.NUB_VISIBLE)},hidePlaceBoardNub:function(){this._getNub().removeClass(this.CssClassName.NUB_VISIBLE)},_getNub:function(){return this.$(".mapUnfocusNub")},onMapClick:function(e){P.context.instance.is_mobile_agent?this._focusMap(!0):this.isDesktopPlaceBoard()&&(this.inMapViewMode?this._changeCurrentlyFocusedPin(null):this._switchBoardViewTo("map"))},_getPlaceBoardFocusPaddingTop:function(){var e=this.getChildById("boardHeader"),t=e.getOffset(),o=$(window).height(),n=o-t.top,a=this.getChildById("boardInvites");a&&(n+=a.getHeight(!0));var r=this.getScrollableElement().scrollTop();return n+=r},_focusMap:function(e){var t=!this.$el.hasClass(this.CssClassName.MAP_SHOW);if(t){var o=this._getPlaceBoardFocusPaddingTop(),n=parseInt(this.$el.css(Ln),10);o=n+o+"px",this.$el.addClass(this.CssClassName.MAP_SHOW).removeClass(this.CssClassName.MAP_HIDE).css(Ln,o),P.timer.setTimeout(function(){e&&this.map.zoomIn(),this._attachTouchmoveListener(),this.showPlaceBoardNub()}.bind(this),wn)}},onPopupOpened:function(e){this._focusMap(!1)},onClusterClick:function(e){P.context.instance.is_mobile_agent?this._focusMap(!0):this.isDesktopPlaceBoard()&&!this.inMapViewMode&&this._switchBoardViewTo("map")},_attachTouchmoveListener:function(){$(document).on(Tn,function(e){e.preventDefault()})},_detachTouchmoveListener:function(){$(document).off(Tn)}}),P.modules.BoardPage.prototype.className="BoardPage",goog.provide("P.modules.Closeup"),goog.require("P.Module"),goog.require("P.modules.CloseupBottom"),goog.require("P.modules.CloseupContent"),goog.require("P.modules.CloseupSidebar"),goog.require("P.modules.UnauthCloseup"),goog.require("P.modules.UnauthPinInGridCloseup"),goog.require("P.modules.Pin"),goog.require("P.modules.PinActionBar"),goog.require("P.SourceContentManager"),goog.require("P.unauthUsage"),goog.require("P.util"),goog.require("P.modalManager"),goog.require("P.url"),goog.require("P.ExperienceManager"),goog.require("P.genConst"),goog.require("P.router"),goog.require("P.resourceFactory");var En="actions",xn="content",On="sidebar",Cn="bottom",Sn=".closeupActionBarContainer",Fn=736,Nn=564,In=57,An=40,Rn=14;P.modules.Closeup=P.Module.extend({events:{click:"_onClick","click button.close":"onCloseButtonClick","click div.arrow-nav":"onNavArrowClick"},CssClassName:{CAN_CLOSE:"canClose",CLOSE_BUTTON_VISIBLE:"visible",LITE:"lite"},getOwnedScrollables:function(){return this.options.can_close?this.$el:$()},onCreated:function(){this.closeDiv=$('<button class="Button borderless close"><em></em>&nbsp;</button>');var e=P.experiments.instance.v2ActivateExperiment("web_closeup_remove_board_rep");["enabled","employee"].indexOf(e)>-1&&this.$el.addClass("modularCloseup");var t=P.experiments.instance.v2ActivateExperiment("web_modular_closeup");["enabled","employee"].indexOf(t)>-1&&this.$el.addClass("modularCloseup")},onKeydown:function(e){var t=P.modalManager.get();t.hasModals()||(this.options.can_close&&e.keyCode===P.util.keyCode.ESCAPE&&this._close(),e.keyCode!==P.util.keyCode.RIGHT&&e.keyCode!==P.util.keyCode.LEFT||this.navigateStarted||this._shouldRenderAsLite()?e.keyCode===P.util.keyCode.ENTER&&this._actionBar&&!this._actionBar.areDropdownsShowing()&&P.dom.body_is_active()&&(this._logCustomContextEvent(P.genConst.EventType.KEYPRESS,P.genConst.ElementType.CLOSEUP_PINIT_SHORTCUT,P.genConst.ComponentType.CLOSEUP_SHORTCUT_BUTTON,{}),this._actionBar.triggerPinItButton()):(this._logCustomContextEvent(P.genConst.EventType.KEYPRESS,e.keyCode===P.util.keyCode.RIGHT?P.genConst.ElementType.NEXT_CLOSEUP_BUTTON:P.genConst.ElementType.PREV_CLOSEUP_BUTTON,P.genConst.ComponentType.CLOSEUP_NAV_BUTTON,{}),this.triggerCloseupNav(e.keyCode)))},triggerCloseupNav:function(e){this.sourceContentManager||this.setSourceContentManager(),this.navigateStarted=!0,this.sourceContentManager.setItemByKeyPress(e),this._removeTransitionContent(),this.clearBottomRenderInterval()},setNewCloseupPin:function(e){var t=this.getChildById(xn);e&&t?t.changeCloseupContent(e):this._close()},setSourceContentManager:function(){this.options.source_data&&this.resource.options.id?this.sourceContentManager=new P.SourceContentManager(this.resource.options.id,this.options.source_data,this.setNewCloseupPin.bind(this)):this.sourceContentManager=null},_close:function(){this._removeTransitionContent(),delete this.options.source_data,this.options.origin_location?this.navigate(this.options.origin_location):this.triggerEvent(P.CONST.EVENT_CLOSE,this,!0)},_unsticky:function(){this._actionBar&&this._actionBar.unsticky()},_updateSticky:function(){if(this.parent&&this.inDom&&this._actionBar){var e=this.$(".pinActionBarStickyContainer"),t=this.getScrollableElement(),o=0;this.options.can_close||P.context.instance.is_mobile_agent||(o=$(".Header").height()),this._actionBar.updateSticky({$boundTo:e,$scrollable:t,headerHeight:o})}},resetCloseButton:function(){this.$close.removeClass(this.CssClassName.CLOSE_BUTTON_VISIBLE)},onAddedToDom:function(){if(this.hasError)return this.detachElement(),void this.destroy();this._positionActionBar(),this.options.can_close&&$("body").on("keydown.closeup",function(e){this.onKeydown(e)}.bind(this)),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate);var e=P.util.scrollbarWidth();this.$close||(this.$close=this.$(".close")),this.$close.css("right",e+Rn+"px").addClass(this.CssClassName.CLOSE_BUTTON_VISIBLE),P.context.instance.is_mobile_agent&&P.context.instance.deep_link_action&&P.context.instance.is_tablet_agent||this._focusOnContent();var t=this.getChildById(xn);t&&_.defer(t.addTutorials.bind(t))},_positionActionBar:function(){this._actionBar&&this.inDom&&this.contentReady&&this._updateSticky()},_focusOnContent:function(){this.$(".closeupContainer").focus(),this.options.can_close?$(".Closeup").scrollTop(0):$(window).scrollTop(0)},onContentReady:function(){P.user.instance.isAuthenticated()||(Cookie.set(P.CONST.COOKIE_LAST_UNAUTH_PIN_ID,this.data.id),P.unauthUsage.logUrl()),this._actionBar=this.getChildById(En),this.options.show_repin?(this.showRepinModal(),delete this.options.show_repin):this.options.show_edit&&(this.extraData.canEdit&&this.showEditModal(),delete this.options.show_edit),this._positionActionBar(),this.extraData&&this.extraData.showContextualReg&&P.UserRegistration.showSignupModal("CloseupSignupModal",this.resource,{sent_pin:!0,sender:this.options.sender,redirect_to_signup:!0}),this._sourceData={};var e=this.getChildById(xn);e&&_.defer(e.addTutorials.bind(e));var t={};t[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,t[P.CONST.PUBSUB_TOPIC_PIN_HIDDEN]=this.onPinHidden,this.pubsubSubscribe(this.resource.options.id,t),this.listen(P.router.instance,P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),this._focusOnContent(),this._handleExperimentUrlParam()},_handleExperimentUrlParam:function(){if(P.context.instance.is_mobile_agent&&this.extraData&&this.extraData.track_exp_url){var e=P.experiments.instance.v2GetGroup("fb_browser_upsell_pin_share");"enabled"===e?window.location.hash="fbomw_e":"employee"===e?window.location.hash="fbomw_em":"control"===e&&(window.location.hash="fbomw_c")}else if(P.context.instance.has_pin_list_data&&window.history){var t=P.experiments.instance.v2GetGroup("fbo_pinlist_web"),o=this.options.ptrf;if(o||("enabled"===t?o="fbopl_e":"employee"===t?o="fbopl_m":"control"===t&&(o="fbopl_c")),o){var n=P.url.appendQueryString(window.location.pathname,{ptrf:o});window.history.replaceState("state"in window.history?window.history.state:{},document.title,n)}}},onPinDeleted:function(e){this.options.can_close?this._close():(this.destroy(),this.navigate("/"))},onPinHidden:function(e){this.options.can_close&&this._close()},_removeTransitionContent:function(){this._removeTransitionImage(),this._removeTransitionTitle()},_removeTransitionTitle:function(){this.transitionText&&(this.transitionText.remove(),this.transitionText=null)},_removeTransitionImage:function(){this.transitionPinImage&&(this.transitionPinImage.remove(),this.transitionPinImage=null)},removeTransitionImageAndTextOnLoad:function(e){var t=e.getPin(),o=t.getPinMedia(),n=o.attr("src");o.load(this._removeTransitionContent.bind(this)),o.error(this._removeTransitionContent.bind(this)),o.attr("src",n),o[0]&&o[0].complete&&this._removeTransitionContent()},onRemovedFromDom:function(){this._actionBar&&this._actionBar.removeDropdowns(),this._unsticky(),this.options.can_close&&$("body").off("keydown.closeup"),this._removeListeners();var e=this.getPin();if(e){var t=e.getId();t&&P.pubSub.instance.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CLOSE_CLOSEUP,t)}},_shouldRenderAsLite:function(){var e=P.ExperienceManager.instance.getPlacedExperience(P.genConst.Placement.WEB_PIN_CLOSEUP);return e&&(e.experience_id===P.genConst.Experience.WEB_PIN_CLOSEUP_LITE||e.display_data&&e.display_data.lite)},isPinInSourceData:function(){var e=this.resource.options.id,t=this.options.source_data;if(!t||!t.data)return!1;for(var o=0;o<t.data.length;o++)if(t.data[o]&&"pin"===t.data[o].type&&t.data[o].id===e)return!0;return!1},render:function(){if(!this.options.can_close)try{return P.Module.prototype.render.apply(this,arguments)}catch(e){throw console.error(e),e}this.$el.empty().addClass(this.CssClassName.CAN_CLOSE);var t=this._shouldRenderAsLite();if(t&&this.$el.addClass(this.CssClassName.LITE),this.$el.append(this.closeDiv),!P.user.instance.isAuthenticated()&&!P.context.instance.is_mobile_agent){var o=P.resourceFactory.instance.clone(this.resource);o.options.field_set_key="detailed";var n;return n=P.experiments.instance.v2InGroup("unauth_pin_closeup_grid",["enabled2","employees","enabled2_no_signup_modal"])?new P.modules.UnauthPinInGridCloseup({resource:o,options:{pin_overlay:!0}}):new P.modules.UnauthCloseup({resource:o,options:{can_close:!0}}),n.render().then(function(){this.insertChild(n,this.$el)}.bind(this))}var a='<div class="sidebarContainer loading"></div>',r=P.experiments.instance.v2GetGroup("web_closeup_remove_board_rep"),i=P.experiments.instance.v2GetGroup("web_modular_closeup"),s=["enabled","employee"].indexOf(i)>-1,l=["enabled","employee"].indexOf(r)>-1||s;l&&(a=""),this.$el.append('<div class="closeupActionBarContainer" data-component-type="'+P.genConst.ComponentType.MODAL_PIN+'"></div><div class="closeupContainer" tabindex="1">'+a+'</div><div class="closeupBottom"></div>');var u=this.$(".closeupContainer"),d=!!this.transitionText;d&&u.append(this.transitionText);var c=!!this.transitionPinImage;c&&u.append(this.transitionPinImage);var p=P.resourceFactory.instance.clone(this.resource);p.options.allow_stale=!0;var m=this.resource.options.id,h=P.resourceFactory.instance.clone(this.resource);h.options.field_set_key="detailed";var g=this.isPinInSourceData(),_=new P.modules.CloseupContent({id:xn,resource:h,options:{show_comments:this.options.show_comments,is_modular_closeup:s,has_source_data:g}}),f=this.$(Sn),b=P.experiments.instance.v2GetGroup("web_modular_closeup"),k=-1!==["enabled","employee"].indexOf(b),y=new P.modules.PinActionBar({id:En,options:{pin_id:m,class_name:k?"modularCloseup":"",is_modular_closeup:k},resource:p});if(y.errorStrategy=P.CONST.ErrorStrategy.BUBBLE,y.render(),this._actionBar=y,this.insertChild(y,f),!l){var v=P.resourceFactory.instance.clone(this.resource);v.options.field_set_key="closeup_sidebar";var w=this.$(".sidebarContainer"),T=new P.modules.CloseupSidebar({id:On,resource:v,options:{force_render_remote:!0}});T.render().then(function(){this.insertChild(T,w),w.removeClass("loading"),this._focusOnContent()}.bind(this))}var L=_.render().then(function(){this.insertChild(_,u),c&&this.removeTransitionImageAndTextOnLoad(_),this.contentReady=!0,this.onContentReady();var e=t?"firstPinnerRelatedPinsOnly":null,o=new P.modules.CloseupBottom({id:Cn,options:{pin_id:this.resource.options.id,view_type:e}}),n=this.$(".closeupBottom");o.render().then(function(){this.insertChild(o,n)}.bind(this)),P.dom.blur();var a=P.experiments.instance.v2GetGroup("web_closeup_remove_board_rep");["enabled","employee"].indexOf(a)>-1&&this._focusOnContent()}.bind(this));return c?Promise.resolve(void 0):L},handleError:function(e){e.api_error_code===P.CONST.API_ERROR_PIN_NOT_FOUND&&(this.hasError=!0),P.Module.prototype.handleError.call(this,e)},setCloseupBottomMinHeight:function(){var e=this.$(".closeupContainer").height(),t=this.getScrollableElement().scrollTop(),o=this.getChildById(Cn);if(o){var n=P.Viewport.height,a=t+n-e;o.setMinHeight(a)}},removeCloseupBottomMinHeight:function(){var e=this.getChildById(Cn);e&&e.setMinHeight(null)},showRepinModal:function(){this._actionBar&&P.user.instance.isAuthenticated()&&this._actionBar.showRepinModal()},showEditModal:function(){var e=this.getChildById(xn);return e.showEditModal()},setAsMainModule:function(e,t,o){var n=this.getChildById(xn),a=this.getChildById(On),r=this.getChildById(Cn),i=t.options.id,s=this.getUnauthCloseup();if(!n||!a||!r)return o.evt?o.evt.data.pinId=i:s&&s.setResource({name:t.name,options:_.extend({},t.options)}),P.Module.prototype.setAsMainModule.apply(this,arguments);if(e.can_close?0===this.closeDiv.parent().length&&(this.$el.prepend(this.closeDiv),this.$el.addClass(this.CssClassName.CAN_CLOSE)):this.closeDiv.parent().length>0&&(this.closeDiv.remove(),this.$el.removeClass(this.CssClassName.CAN_CLOSE)),this.options.can_close=e.can_close,this.hasSameOptions(e,t)&&this.contentReady&&!this._forceRefreshRequested(o))return Promise.resolve(void 0);
this.setOptions(e),this.setResource(t);var l=this.sourceContentManager&&this.sourceContentManager.getCurrentPinData();l?(l.id!==i&&(this.sourceContentManager.setupSourceContentManager(this.options.source_data,i),l=this.sourceContentManager.getCurrentPinData()),this.transitionPinImage=this._getCloseupTransitionPinImage(),this.transitionPinImage&&(this.$(".closeupContainer").prepend(this.transitionPinImage),n.emptyCloseupImage(this.transitionPinImage[0].style.height,l))):o.evt&&o.evt.currentTarget||n.empty();var u={name:t.name,options:_.extend({},t.options)},d=P.resourceFactory.instance.clone(this.resource);d.options.allow_stale=!0;var c=new P.modules.PinActionBar({id:En,options:{pin_id:i},resource:d});return u.options.field_set_key="detailed",n.setResource(u),l&&l.promoter?(n.options.show_promoted_pin_credit_detailed=!0,n.options.promoter_detailed_view=l.promoter):n.options.show_promoted_pin_credit_detailed=!1,this.transitionPinImage&&(n.options.spinner={enable:!1}),this.setCloseupBottomMinHeight(),c.render(),l&&a.updateBoardGrid(l.board,i),n.render().then(function(){var e=this.$(Sn);this.insertChild(c,e),this._actionBar&&this._actionBar.destroy(),this._actionBar=c,this._positionActionBar(),this.removeTransitionImageAndTextOnLoad(n),r.setOptions({pin_id:i}),this.bottomRenderInterval=window.setInterval(function(){r.render().then(function(){this.removeCloseupBottomMinHeight()}.bind(this)),this.clearBottomRenderInterval()}.bind(this),1e3),this.navigateStarted=!1,P.dom.blur(),l&&a.updateBoardDetails(n.data.board),a.updateDomain(n.data.link?n.data.domain:null),a.updateRelatedRecipes(n.data.rich_recipe_top_ingredients)}.bind(this))},onRouteMatched:function(e){if(!e.navigateData.fromNavigate){this._sourceData[this.resource.options.id]=this.options.source_data;var t=e.resource&&e.resource.options&&e.resource.options.id,o=this._sourceData[t];o&&(this.updateOptions({source_data:o}),this.sourceContentManager.setupSourceContentManager(this.options.source_data,t))}},onChildNavigate:function(e){if(P.NuxUtils.preventNavigationIfNecessary(e),this.log.debug("Closeup got navigate event from child",e.target,"for url:",e.data.url),!P.url.isOffsiteUrl(e.data.url)){var t=this.getChildById(On),o=e.target.data&&e.target.data.id,n=this.getUnauthCloseup();if(t===e.currentTarget&&"Pin"===e.target.className||"CloseupContent"===e.target.className&&this.navigateStarted){if(e.target.$el.closest(".CloseupRelatedPins").length>0)return;if(e.data.handled=!0,"boardPinsGrid"===e.target.options.view_type){var a=t.data&&t.data.board&&t.data.board.id;o&&a&&this.sourceContentManager&&this.sourceContentManager.setupResource(P.resourceFactory.instance.create("BoardFeedResource",{board_id:a}),o)}}else if(e.target.$el.closest(".CloseupRelatedPins").length>0||n===e.currentTarget&&"Pin"===e.target.className){var r=this.getChildById(Cn)||n,i=e.data.url;if(!r||-1===i.indexOf("/pin/")||-1!==i.indexOf("/repins/")||-1!==i.indexOf("/likes/"))return;e.data.handled=!0,this._sourceData[this.resource.options.id]=this.options.source_data,this.updateOptions({source_data:r.getChildInfoByModuleName("GridItems")}),this.sourceContentManager&&this.sourceContentManager.setupSourceContentManager(this.options.source_data,o)}return!1}},onNavArrowClick:function(e){var t=e.target;t&&(t.classList.contains("right-arrow")?this.triggerCloseupNav(P.util.keyCode.RIGHT):t.classList.contains("left-arrow")&&this.triggerCloseupNav(P.util.keyCode.LEFT))},onCloseButtonClick:function(e){return this._close(),this.resetCloseButton(),!1},_onClick:function(e){if(this.options.can_close){var t=e.target;(t&&(t===this.$el[0]||t===this.$(".closeupContainer")[0])||t===this.$(".closeupBottom")[0])&&(e.stopPropagation(),this._close())}},getUnauthCloseup:function(){return P.experiments.instance.v2InGroup("unauth_pin_closeup_grid",["enabled2","employees","enabled2_no_signup_modal"])?this.getChildByModuleName("UnauthPinInGridCloseup"):this.getChildByModuleName("UnauthCloseup")},performTransition:function(e){var t=e.evt&&e.evt.target||null,o=e.evt&&e.evt.currentTarget||null;return t&&"Pin"===t.className&&"summary"===t._getViewType()&&"Closeup"!==o.className&&(this.transitionPinImage=this._getTransitionPinImage(t),this.transitionText=this._getTransitionPinTitle(t)),this.render()},calculateTransitionCSS:function(e,t){var o=e.height,n=e.width,a=Fn,r,i,s,l=P.experiments.instance.v2GetGroup("web_modular_closeup");-1!==["enabled","employee"].indexOf(l)?(a=Nn,n>a&&(o=a*o/n,n=a),r=In,i=32):(a>n?(s=Math.round((a-n)/2),r=An>s?s+In:An+In):r=In,i=(a-n)/2);var u={linkImageCSS:{height:o,padding:r+"px "+i+"px"+(r-In)+"px","z-index":10},imageCSS:{height:o,width:n}};return t&&(u.linkImageCSS.padding=In+"px 0px 0px"),u},_getTransitionPinTitle:function(e){var t,o,n="";return e.data&&e.data.rich_summary?(t=e.data.rich_summary.display_name,o=e.data.rich_summary.site_name,n+=o&&"<div class='sourceWrapper'>"+o+"</div>",n+=t&&"<h2 class='pinTitle'>"+t+"</h2"):n+="<div class='noTitle'></div>",$("<div class='transitionTitle'>"+n+"</div>")},_getTransitionPinImage:function(e){var t=e.getPinMedia();if(!t||e.isPinStory())return null;var o=t.clone(),n=e.getSourceUrl()||e.getImageUrl(P.CONST.IMAGE_SIZE_ORIG),a=$("<a class='transitionImage'></a>").append(o);a[0].onclick=function(){this._logCustomContextEvent(P.genConst.EventType.CLICK,P.genConst.ElementType.PIN_CLOSEUP_TRANSITION_IMAGE,P.genConst.ComponentType.PIN_CLOSEUP_TRANSITION_IMAGE,{}),this.navigate(n,null,!1,{pinId:e.getId()})}.bind(this),o.length&&(o[0].onload=null);var r=this.calculateTransitionCSS(P.ImageDimensions.getDetailedImageDimensions(e.data),e.isVideo()&&e.data.attribution);return a.css(r.linkImageCSS),o.css(r.imageCSS),a},_getCloseupTransitionPinImage:function(){var e=this.sourceContentManager&&this.sourceContentManager.getCurrentPinData();if(!e||e.embed&&"pinstory"===e.embed.subtype)return null;var t=document.createElement("img");t.src=e.images["236x"].url,t.className="pinImg fullBleed noFade",t.alt=e.title,t.onload=null;var o=document.createElement("a");o.className="transitionImage",o.onclick=function(){this.navigate(e.link,null,null,{pinId:e.id})}.bind(this),o.appendChild(t);var n=this.calculateTransitionCSS(P.ImageDimensions.getDetailedImageDimensions(e),e.is_video&&e.attribution);return $(o).css(n.linkImageCSS),n.imageCSS.background=e.dominant_color||"#f8f8f8",$(t).css(n.imageCSS),$(o)},getPin:function(){var e=this.getChildByModuleName("UnauthCloseup")||this.getChildByModuleName("FacebookShareUnauthCloseupWeb")||this.getChildByModuleName("FBOCloseupMweb")||this.getChildByModuleName("UnauthPinInGridCloseup")||this.getChildByModuleName("FBOPinListContainerWeb")||this.getChildById(xn);return e?e.getPin():null},getLoggingObjectIdStr:function(){return this.resource.options.id},clearBottomRenderInterval:function(){window.clearInterval(this.bottomRenderInterval),this.bottomRenderInterval=null,this._focusOnContent()}}),P.modules.Closeup.prototype.className="Closeup",goog.provide("P.modules.Header"),goog.require("P.modules.HeaderBase"),goog.require("P.modules.SearchForm"),goog.require("P.router"),goog.require("P.util"),goog.require("P.router"),P.modules.Header=P.modules.HeaderBase.extend({events:{"click .menuContainer":"toggleSlideout","click .closeMenu":"toggleSlideout","click .openInApp":"openInApp","click .circleLogo":"redirectToHomePage"},CssClassName:_.extend(P.modules.HeaderBase.prototype.CssClassName,{OPEN:"open"}),onContentReady:function(){P.modules.HeaderBase.prototype.onContentReady.call(this);var e={};this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,e),this.listen(P.router.instance,P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched)},onRouteMatched:function(e){var t=e.navigateData.currentModule||{},o=["SearchPage","Closeup"];if(!_.contains(o,e.module)&&_.contains(o,t.className)){var n=this.getChildById("mainSearchTextbox");n.clearTypeaheadField()}},getHeight:function(){return this.$el.height()},getUserMenu:function(){return this.getChildById("userMenu")},getHomeElement:function(){return this.$(".logo")},toggleSlideout:function(){this.$(".menuOverlay").toggleClass(this.CssClassName.OPEN)},openInApp:function(){this.triggerEvent(P.CONST.EVENT_UNAUTH_BANNER_OPEN_IN_APP,null,!0)},redirectToHomePage:function(){P.util.changeWindowLocation("/",!1)}}),P.modules.Header.prototype.className="Header",goog.provide("P.modules.ModalAnalyticsHomeAudienceCardIntro"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeAudienceCardIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return"RIGHT_CENTER"},getHighlightedElement:function(){return this.getHighlightedCardModule("audience")}}),P.modules.ModalAnalyticsHomeAudienceCardIntro.prototype.className="ModalAnalyticsHomeAudienceCardIntro",goog.provide("P.modules.ModalAnalyticsHomeDomainCardIntro"),goog.require("P.modules.ModalAnalyticsHomeIntroBase"),P.modules.ModalAnalyticsHomeDomainCardIntro=P.modules.ModalAnalyticsHomeIntroBase.extend({getStepPosition:function(){return"LEFT_CENTER"},getHighlightedElement:function(){return this.getHighlightedCardModule("domain")}}),P.modules.ModalAnalyticsHomeDomainCardIntro.prototype.className="ModalAnalyticsHomeDomainCardIntro",goog.provide("P.modules.ModalFirstPinClickthrough"),goog.require("P.modules.ModalFirstPinExperience"),P.modules.ModalFirstPinClickthrough=P.modules.ModalFirstPinExperience.extend({getPlacementId:function(){return P.genConst.Placement.WEB_PIN_CLOSEUP},getExperienceId:function(){return P.genConst.Experience.WEB_SEO_NUX_FIRST_CLICKTHROUGH_TOOLTIP}}),P.modules.ModalFirstPinClickthrough.prototype.className="ModalFirstPinClickthrough",goog.provide("P.modules.NuxModalJumpStartBoardStep"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartBoardStep=P.modules.NuxModalJumpStartStep.extend({onShow:function(e){this.animateChain([".boardImage",".title"],function(e,t){this.animateIn(e,t)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,e)},onExit:function(e){this.animateChain([".title",".boardImage"],function(e,t){this.animateOut(e,t)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,e)}}),P.modules.NuxModalJumpStartBoardStep.prototype.className="NuxModalJumpStartBoardStep",goog.provide("P.modules.NuxModalJumpStartExtensionStep"),goog.require("P.modules.NuxModalJumpStartStep");var Bn="installButton";P.modules.NuxModalJumpStartExtensionStep=P.modules.NuxModalJumpStartStep.extend({onContentReady:function(){P.modules.NuxModalJumpStartStep.prototype.onContentReady.call(this);var e=this.getChildById(Bn);e&&this.listen(e,P.CONST.EVENT_BUTTON_CLICK,this.onInstallButtonClick)},onInstallButtonClick:function(){P.browserExtension.instance.handleExtensionInstall(function(){})},onShow:function(e){this.animateChain([".pinItImage",".title",".textAndButton",".install"],function(e,t){this.animateIn(e,t)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,e)},onExit:function(e){this.animateChain([".title",".pinItImage",".textAndButton"],function(e,t){this.animateOut(e,t)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,e)}}),P.modules.NuxModalJumpStartExtensionStep.prototype.className="NuxModalJumpStartExtensionStep",goog.provide("P.modules.NuxModalJumpStartPinStep"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartPinStep=P.modules.NuxModalJumpStartStep.extend({onShow:function(e){this.animateChain([".pinImage",".title"],function(e,t){this.animateIn(e,t)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,e)},onExit:function(e){this.animateChain([".title",".pinImage"],function(e,t){this.animateOut(e,t)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,e)}}),P.modules.NuxModalJumpStartPinStep.prototype.className="NuxModalJumpStartPinStep",goog.provide("P.modules.NuxModalJumpStartSaveStep"),goog.require("P.modules.NuxModalJumpStartStep"),P.modules.NuxModalJumpStartSaveStep=P.modules.NuxModalJumpStartStep.extend({onShow:function(e){this.animateChain([".browserContainer",".title"],function(e,t){this.animateIn(e,t)}.bind(this)),P.modules.StepBase.prototype.onShow.call(this,e)},onExit:function(e){this.animateChain([".title",".browserContainer"],function(e,t){this.animateOut(e,t)}.bind(this)),P.modules.StepBase.prototype.onExit.call(this,e)}}),P.modules.NuxModalJumpStartSaveStep.prototype.className="NuxModalJumpStartSaveStep",goog.provide("P.modules.PinForm"),goog.require("P.Form"),goog.require("P.i18n"),goog.require("P.modules.UserSocialNetworkSettings"),goog.require("P.modules.PlaceSelector"),goog.require("P.string"),goog.require("P.validator"),goog.require("P.SocialConnect");var Mn=P.SocialConnect.FACEBOOK,Dn=P.SocialConnect.TWITTER,Vn=".socialShareWrapper";P.modules.PinForm=P.modules.UserSocialNetworkSettings.extend({events:{'change [name="share_facebook"]':"onFacebookCheckboxChanged","focus .PlaceSelector input":"onPlaceSelectorFocus",click:"_onClick"},setImage:function(e){this.options.image_url=e;var t=this.getChildById("pinPreview");t.setImage(e)},_onClick:function(e){var t=$(e.target).closest(".PlaceSelector").length;if(!t){var o=this.getPlaceSelector();if(o){var n=o.getTypeaheadField(),a=n.getTypeahead();a.isOpen()&&a.hide()}}},getPlaceSelector:function(){return this.getChildById("placeSelector")},onPlaceSelectorFocus:function(e){var t=this.getPlaceSelector();if(t){var o=t.getTypeaheadField(),n=o.getTypeaheadItemsToRender(),a=n&&n.length>0;if(a){var r=o.getTypeahead();r.show()}}},onCreated:function(){P.modules.UserSocialNetworkSettings.prototype.onCreated.apply(this,arguments),this.networkToSelectorMap={},this.networkToSelectorMap[Mn]='[name="share_facebook"]',this.networkToSelectorMap[Dn]='[name="share_twitter"]'},onItemSelected:function(e){this.getChildById("removePlaceButton").show()},onFacebookCheckboxChanged:function(e){var t=this.getNetworkChecked(Mn);P.user.instance.set(P.CONST.FB_PUBLISH_KEY,t),t&&P.FbUtil.maybeRequestFbTimelinePermission({error:function(){this.setNetworkChecked(Mn,!1),P.user.instance.set(P.CONST.FB_PUBLISH_KEY,!1)}.bind(this)})},onContentReady:function(){var e={message:P.i18n._("Don't forget a description!")},t={description:[P.validator.Required(e),P.validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]};this.form=new P.Form(this.$("form"),t),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_CHANGE,this._onChildChange),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick);var o=this.getBoardPicker();o.getSelectedBoardPrivacy()===P.CONST.BoardPrivacy.SECRET&&this.hideSocialExplicitSharing();var n=this.getChildById("uploader");n&&this.listen(n,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess)},onButtonClick:function(e){var t=e.target;"removePlaceButton"===t.id&&this.removePlace()},removePlace:function(){this.$(".pinPlaceId").val(0);var e=this.getPlaceSelector(),t=e.getTypeaheadField();t.reset(),t.enableInput(),this.getChildById("removePlaceButton").hide()},_onChildChange:function(e){if("boardPicker"===e.target.id){var t=e.data;t.privacy===P.CONST.BoardPrivacy.SECRET?this.hideSocialExplicitSharing():this.showSocialExplicitSharing()}},hideSocialExplicitSharing:function(){this.$(Vn).hide()},showSocialExplicitSharing:function(){this.$(Vn).show()},onSubmitValidated:function(e){this.triggerEvent(P.CONST.EVENT_SUBMIT_VALIDATED,e,!0)},onUploadSuccess:function(e){var t=e.data.image_url,o=this.getChildById("pinPreview");o.setImage(t),this.options.image_url=t},getBoardPicker:function(){return this.getChildById("boardPicker")},getBoardId:function(){return this.getBoardPicker().getSelectedBoardId()},getDescription:function(){return this.getChildById("pinDescriptionField").getValue()},setNetworkChecked:function(e,t){var o=this.networkToSelectorMap[e];o&&this.$(o).prop("checked",t)},getNetworkChecked:function(e){var t=this.networkToSelectorMap[e];if(t){var o=this.$(t);return o.length?o.is(":checked"):""}},getImageUrl:function(){return this.options.image_url},getLink:function(){return this.$("#pinFormLink").val()||""},getData:function(){var e={board_id:this.getBoardId(),description:this.getDescription(),link:this.getLink()},t=this.getNetworkChecked(P.SocialConnect.TWITTER);""!==t&&(e.share_twitter=t),t=this.getNetworkChecked(P.SocialConnect.FACEBOOK),""!==t&&(e.share_facebook=t);var o=this.getImageUrl();if(o&&(e.image_url=o,P.string.beginsWith(o,"//"))){var n=document.referrer;if(n){var a;P.string.beginsWith(n,"http://")?a="http:":P.string.beginsWith(n,"https://")&&(a="https:"),a&&(e.image_url=a+e.image_url)}}var r=this.$(".pinPlaceId");if(r.length){e.place=r.val();var i=this.getPlaceSelector();if(i){var s=i.getTypeaheadField(),l=s.getValue();(0===l.length||"0"===r.val())&&(e.place=0)}}return this.data&&this.data.source_interest&&(e.source_interest_id=this.data.source_interest.id),e}}),P.modules.PinForm.prototype.className="PinForm"}});